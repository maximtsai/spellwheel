class InternalHoverTextManager{constructor(i){PhaserScene=i||PhaserScene,this.hoverTextList=[],this.lastHovered=null,messageBus.subscribe("pointerMove",this.onPointerMove.bind(this)),messageBus.subscribe("pointerDown",this.onPointerDown.bind(this))}update(i){}onPointerMove(i,t){let e=gameVars.mouseposx,s=gameVars.mouseposy,h=null;for(let o=this.hoverTextList.length-1;o>=0;o--){let r=this.hoverTextList[o];if(r&&r.checkCoordOver(e,s)){h=r,this.lastHovered!==h&&h.onHover&&h.onHover();break}}this.lastHovered&&this.lastHovered!==h&&this.lastHovered.onHoverOut&&this.lastHovered.onHoverOut(),this.lastHovered=h}onPointerDown(i,t){this.onPointerMove(i,t)}addToHoverTextList(i){this.hoverTextList.push(i)}removeHoverText(i){for(let t in this.hoverTextList)if(this.hoverTextList[t]===i){this.hoverTextList.splice(parseInt(t),1);break}}}class HoverDisplay{constructor(i){this.hoverBacking=PhaserScene.add.sprite(-3,0,"pixels","semiblack_pixel.png"),this.hoverBacking.visible=!1,this.hoverBacking.setDepth(i.depth||9992),this.hoverTextDisplay=PhaserScene.add.text(0,0," ",{fontFamily:"robotomedium",fontSize:isMobile?20:19,color:"#FFFFBB",align:"left"}),this.hoverTextDisplay.visible=!1,this.hoverTextDisplay.setDepth(i.depth||9992),this.setOrigin(i.originX,i.originY),this.setPosition(i.x,i.y),this.hoverTextDisplay.setOrigin(i.originX,.5),this.stopAudioTemp=!0}addTween(i){this.currTween&&this.currTween.stop();let t={targets:[this.hoverBacking,this.hoverTextDisplay],duration:100};t={...t,...i},this.currTween=PhaserScene.tweens.add(t)}isMultiLine(){return this.hoverBacking.scaleY>20}setPosition(i,t){this.hoverBacking.x=i-3,this.hoverBacking.y=t,this.hoverTextDisplay.x=this.hoverBacking.x+3*(1-2*this.hoverBacking.originX-(this.hoverBacking.originX-.5)*4),this.hoverTextDisplay.y=this.hoverBacking.y-.5*this.hoverTextDisplay.height*(2*this.hoverBacking.originY-1)-3}setOrigin(i=.5,t=.5){this.hoverBacking.setOrigin(i,t),this.hoverTextDisplay.setOrigin(i,.5),0==i?this.hoverTextDisplay.setAlign("left"):1==i?this.hoverTextDisplay.setAlign("right"):this.hoverTextDisplay.setAlign("center")}getText(){return this.hoverTextDisplay.text}setAlign(i){this.hoverTextDisplay.setAlign(i)}stopNextAudio(){this.stopAudioTemp=!0}getStopNextAudio(){return!!this.stopAudioTemp&&(this.stopAudioTemp=!1,!0)}setText(i){this.hoverTextDisplay.text!==i&&(this.hoverTextDisplay.setText(i),"left"==gameOptions.infoBoxAlign?this.hoverTextDisplay.width>170?this.hoverTextDisplay.setFontSize(17):this.hoverTextDisplay.setFontSize(19):this.hoverTextDisplay.text.length>80?this.hoverTextDisplay.setFontSize(18):this.hoverTextDisplay.setFontSize(isMobile?20:19),this.hoverTextDisplay.x=this.hoverBacking.x+3*(1-2*this.hoverBacking.originX-(this.hoverBacking.originX-.5)*4),this.hoverTextDisplay.y=this.hoverBacking.y-.5*this.hoverTextDisplay.height*(2*this.hoverBacking.originY-1)-3,this.hoverBacking.setScale((this.hoverTextDisplay.width+13)*.5*this.hoverTextDisplay.scaleX+3,(this.hoverTextDisplay.height+4)*.5*this.hoverTextDisplay.scaleY),i.length>0?this.setVisible(!0):this.setVisible(!1))}setAlpha(i){this.hoverTextDisplay.alpha=i,this.hoverBacking.alpha=.85*i}setVisible(i){this.hoverTextDisplay.visible=i,this.hoverBacking.visible=i}}class HoverText{constructor(i){this.origin={},this.origin.x=i.origin?i.origin.x:.5,this.origin.y=i.origin?i.origin.y:.5,this.width=i.width,this.height=i.height,this.x=i.x-this.width*this.origin.x,this.y=i.y-this.height*this.origin.y,this.endX=i.x+this.width*(1-this.origin.x),this.endY=i.y+this.height*(1-this.origin.y),this.text=i.text||"...",this.onHover=i.onHover,this.onHoverOut=i.onHoverOut,this.displayX=i.displayX,this.displayY=i.displayY,this.originX=i.displayOrigin?i.displayOrigin.x:0,this.originY=i.displayOrigin?i.displayOrigin.y:0,globalObjects.hoverTextManager.addToHoverTextList(this),this.depth=0}checkCoordOver(i,t){return!(i<this.x)&&!(i>this.endX)&&!(t<this.y)&&!(t>this.endY)}getPosX(){return this.getXPos()}getPosY(){return this.getYPos()}getXPos(){return this.x}getYPos(){return this.y}getWidth(){return this.endX-this.x}getHeight(){return this.endY-this.y}setText(i){this.text=i}setPos(i,t){this.x=i,this.y=t,this.endX=this.x+this.width,this.endY=this.y+this.height}bringToTop(){console.log("TODO")}setOrigin(i,t){console.log("todo")}destroy(){!this.isDestroyed&&(this.isDestroyed=!0,globalObjects.hoverTextManager.removeHoverText(this))}}

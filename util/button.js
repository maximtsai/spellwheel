const NORMAL="normal",HOVER="hover",PRESS="press",DISABLE="disable";class Button{constructor(t){this.scene=t.scene||PhaserScene,this.state=NORMAL,this.normal=t.normal,this.hover=t.hover||t.normal,this.press=t.press||t.normal,this.disable=t.disable||t.normal,this.onMouseDownFunc=t.onMouseDown,this.onMouseUpFunc=t.onMouseUp,this.onDragFunc=t.onDrag,this.onHoverFunc=t.onHover||null,this.onHoverOutFunc=t.onHoverOut||null,this.onDropFunc=t.onDrop||null,this.cursorInteractive=t.cursorInteractive,this.destructibles=[],this.imageRefs={},this.oldImageRef=null,this.currImageRef=null,buttonManager.addToButtonList(this),this.handlePreload(),this.setState(NORMAL),this.isDraggable=t.isDraggable||!1,this.depth=0}setState(t){let e;switch(t){case NORMAL:e=this.normal;break;case HOVER:e=this.hover;break;case PRESS:e=this.press;break;case DISABLE:e=this.disable;break;default:console.error("Invalid state ",t);return}if(this.state=t,e.ref){this.oldImageRef=this.currImageRef,this.currImageRef=e.ref,this.imageRefs[this.oldImageRef]&&(this.imageRefs[this.oldImageRef].visible=!1);let s=this.imageRefs[e.ref];if(!s){s=e.atlas?this.scene.add.sprite(0,0,e.atlas,e.ref):this.scene.add.sprite(0,0,e.ref);let i=this.imageRefs[this.oldImageRef];i&&(s.setOrigin(i.originX,i.originY),s.scrollFactorX=i.scrollFactorX,s.scrollFactorY=i.scrollFactorY),s.setDepth(this.depth),this.imageRefs[e.ref]=s}this.forceInvis||(s.visible=!0)}else e.ref=this.normal.ref;let r=this.imageRefs[this.oldImageRef];r||(r=this.imageRefs[this.currImageRef]),void 0===e.x?this.imageRefs[e.ref].x=r.x||0:(this.imageRefs[e.ref].x=e.x,this.text&&(this.text.x=this.imageRefs[e.ref].x,this.text.offsetX&&(this.text.x+=this.text.offsetX))),void 0===e.y?this.imageRefs[e.ref].y=r.y||0:(this.imageRefs[e.ref].y=e.y,this.text&&(this.text.y=this.imageRefs[e.ref].y,this.text.offsetY&&(this.text.y+=this.text.offsetY))),void 0===e.alpha?this.imageRefs[e.ref].alpha=r.alpha||1:(this.imageRefs[e.ref].alpha=e.alpha,this.text&&(this.text.alpha=this.imageRefs[e.ref].alpha)),void 0===e.scaleX?this.imageRefs[e.ref].scaleX=r.scaleX||1:this.imageRefs[e.ref].scaleX=e.scaleX,void 0===e.scaleY?this.imageRefs[e.ref].scaleY=r.scaleY||1:this.imageRefs[e.ref].scaleY=e.scaleY,void 0!==e.origin&&this.setOrigin(origin.x,origin.y),void 0===e.tint?this.imageRefs[e.ref].setTint(r.tint):this.imageRefs[e.ref].setTint(e.tint),this.text&&(t===DISABLE?this.text.visible=!1:this.text.visible=!0)}setVisible(t=!0){for(let e in this.imageRefs)this.imageRefs[e].setVisible(t);!1===t?this.forceInvis=!0:this.forceInvis=!1}checkCoordOver(t,e){if(this.state===DISABLE)return!1;let s=void 0!==this.normal.scrollFactorX?this.normal.scrollFactorX:1,i=void 0!==this.normal.scrollFactorY?this.normal.scrollFactorY:1,r=t+PhaserScene.cameras.main.scrollX*s,h=e+PhaserScene.cameras.main.scrollY*i,a=this.imageRefs[this.currImageRef],o=a.width*Math.abs(a.scaleX),n=a.height*Math.abs(a.scaleY),l=a.x-a.originX*o,f=a.x+(1-a.originX)*o;if(r<l||r>f)return!1;let c=a.y-a.originY*n,g=a.y+(1-a.originY)*n;return!(h<c)&&!(h>g)}onHover(){this.state===NORMAL&&this.setState(HOVER),this.onHoverFunc&&this.onHoverFunc()}onHoverOut(){this.onHoverOutFunc&&this.onHoverOutFunc(),this.setState(NORMAL)}onMouseDown(t,e){if(this.state!==DISABLE&&(this.setState(PRESS),this.onMouseDownFunc&&this.onMouseDownFunc(t,e),this.isDraggable&&!this.isDragged)){this.setPos(gameVars.mouseposx+PhaserScene.cameras.main.scrollX,gameVars.mouseposy+PhaserScene.cameras.main.scrollY),this.isDragged=!0;let s=buttonManager.getDraggedObj();s&&s.onDrop&&s.onDrop().bind(),buttonManager.setDraggedObj(this)}}onDrag(t,e){this.onDragFunc&&this.onDragFunc(t,e)}clickMouseUp(){this.state!==DISABLE&&this.onMouseUpFunc&&this.onMouseUpFunc()}onMouseUp(t,e){this.state===PRESS&&(this.setState(HOVER),this.onMouseUpFunc&&this.onMouseUpFunc(t,e))}onDrop(t,e){this.isDragged=!1,buttonManager.setDraggedObj(),this.onDropFunc&&this.onDropFunc(t,e)}setDepth(t=0){for(let e in this.depth=t,this.text&&this.text.setDepth(t+1),this.imageRefs)this.imageRefs[e].setDepth(t)}setRotation(t){this.normal.rotation=t,this.hover.rotation=t,this.press.rotation=t,this.disable.rotation=t,this.text&&this.text.setRotation(t)}getPosX(){return this.getXPos()}getPosY(){return this.getYPos()}getScaleX(){return this.imageRefs[this.currImageRef].scaleX}getScaleY(){return this.imageRefs[this.currImageRef].scaleY}getXPos(){return this.normal.x}getYPos(){return this.normal.y}getWidth(){return this.imageRefs[this.currImageRef].width*this.imageRefs[this.currImageRef].scaleX}getHeight(){return this.imageRefs[this.currImageRef].height*this.imageRefs[this.currImageRef].scaleY}getState(){return this.state}getIsDragged(){return this.isDragged&&this.state!==DISABLE}getIsInteracted(){return this.state===HOVER||this.isDragged||this.state===PRESS}getIsHovered(){return this.state===HOVER}setOnMouseDownFunc(t){this.onMouseDownFunc=t}setOnMouseUpFunc(t){this.onMouseUpFunc=t}setOnHoverFunc(t){this.onHover=t}setOnHoverOutFunc(t){this.onHoverOutFunc=t}setNormalRef(t){this.normal.ref=t,this.state===NORMAL&&this.setState(NORMAL)}setHoverRef(t){this.hover.ref=t,this.state===HOVER&&this.setState(HOVER)}setHoverAlpha(t){this.hover.alpha=t}setPressRef(t){this.press.ref=t,this.state===PRESS&&this.setState(PRESS)}setDisableRef(t){this.disable.ref=t,this.state===DISABLE&&this.setState(DISABLE)}setAllRef(t){this.normal.ref=t,this.hover.ref=t,this.press.ref=t,this.disable.ref=t,this.setState(this.state)}setPos(t,e){if(void 0!==t)for(let s in this.normal.x=t,this.hover.x=t,this.press.x=t,this.disable.x=t,this.imageRefs)this.imageRefs[s].x=t;if(void 0!==e)for(let i in this.normal.y=e,this.hover.y=e,this.press.y=e,this.disable.y=e,this.imageRefs)this.imageRefs[i].y=e}setScrollFactor(t,e){if(void 0!==t)for(let s in this.normal.scrollFactorX=t,this.hover.scrollFactorX=t,this.press.scrollFactorX=t,this.disable.scrollFactorX=t,this.imageRefs)this.imageRefs[s].scrollFactorX=t;if(void 0!==e)for(let i in this.normal.scrollFactorY=e,this.hover.scrollFactorY=e,this.press.scrollFactorY=e,this.disable.scrollFactorY=e,this.imageRefs)this.imageRefs[i].scrollFactorY=e}setAlpha(t=1){for(let e in this.imageRefs)this.imageRefs[e].alpha=t}setScale(t,e){for(let s in void 0===e&&(e=t),this.imageRefs)this.imageRefs[s].scaleX=t,this.imageRefs[s].scaleY=e}bringToTop(){}setOrigin(t,e){for(let s in this.imageRefs)this.imageRefs[s].setOrigin(t,e);return this}addText(t,e){let s=this.normal.depth?this.normal.depth+1:1;return this.text=this.scene.add.text(this.normal.x,this.normal.y,t,e).setAlpha(this.normal.alpha).setOrigin(.5,.5).setDepth(s),this.text}setTextOffset(t,e){this.text.offsetX=t,this.text.offsetY=e,this.text.x=this.imageRefs[this.currImageRef].x+this.text.offsetX,this.text.y=this.imageRefs[this.currImageRef].y+this.text.offsetY}setStroke(t,e){this.text&&this.text.setStroke(t,e)}getText(){return this.text}setText(t){return this.text&&this.text.setText(t),this.text}tweenToPos(t,e,s,i,r){let h={targets:this.imageRefs[this.currImageRef],ease:i,duration:s,onUpdate:r,onComplete:()=>{this.setPos(t,e)}};void 0!==t&&(h.x=t),void 0!==e&&(h.y=e),this.scene.tweens.add(h)}tweenToScale(t,e,s,i,r,h){let a={targets:this.imageRefs[this.currImageRef],ease:i,duration:s,onUpdate:r,onComplete:()=>{this.setScale(t,e),h&&h()}};void 0!==t&&(a.scaleX=t),void 0!==e&&(a.scaleY=e),this.scene.tweens.add(a)}tweenToAlpha(t,e,s,i){let r={targets:this.imageRefs[this.currImageRef],ease:s,duration:e,alpha:t,onComplete:()=>{this.setAlpha(t),i&&i()}};this.scene.tweens.add(r)}handlePreload(){this.hover.preload&&this.setState(HOVER),this.press.preload&&this.setState(PRESS),this.disable.preload&&this.setState(DISABLE)}addToDestructibles(t){this.destructibles.push(t)}destroy(){if(!this.isDestroyed){if(this.isDestroyed=!0,this.destructibles.length>0)for(let t=0;t<this.destructibles.length;t++)this.destructibles[t].destroy();for(let e in this.destructibles=[],buttonManager.removeButton(this),this.text&&this.text.destroy(),this.imageRefs)this.imageRefs[e].destroy()}}}

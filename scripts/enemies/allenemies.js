class Enemy{constructor(e,t,a,s=1){this.scene=e,this.level=s,gameVars.currLevel=s,this.initPreStats(),this.initStats(),this.initAttacks();e=isMobile?0:-8;this.resetStats(t,a+=e),this.createHealthBar(gameConsts.halfWidth,a),this.createChargeBar(gameConsts.halfWidth),this.subscriptions=[messageBus.subscribe("enemyTakeEffect",this.takeEffect.bind(this)),messageBus.subscribe("enemyClearEffect",this.clearEffects.bind(this)),messageBus.subscribe("enemyTakeDamage",this.takeDamage.bind(this)),messageBus.subscribe("enemyTakeTrueDamage",this.takeTrueDamage.bind(this)),messageBus.subscribe("enemyTakeDamagePercent",this.takeDamagePercent.bind(this)),messageBus.subscribe("enemyTakeDamagePercentTotal",this.takeDamagePercentTotal.bind(this)),messageBus.subscribe("setSlowMult",this.setSlowMult.bind(this)),messageBus.subscribe("setPauseDur",this.setPauseDur.bind(this)),messageBus.subscribe("disruptOpponentAttack",this.disruptOpponentAttack.bind(this)),messageBus.subscribe("disruptOpponentAttackPercent",this.disruptOpponentAttackPercent.bind(this)),messageBus.subscribe("statusesTicked",this.updateStatuses.bind(this)),messageBus.subscribe("enemyStartDamageCountdown",this.startDamageCountdown.bind(this)),messageBus.subscribe("enemyAddShield",this.addShield.bind(this)),messageBus.subscribe("spellClicked",this.playerClickedSpell.bind(this)),messageBus.subscribe("playerDied",this.playerDied.bind(this)),messageBus.subscribe("addCastAggravate",this.addCastAggravate.bind(this))],this.boundUpdateFunc=this.update.bind(this),updateManager.addFunction(this.boundUpdateFunc)}initPreStats(){this.delayLoad=!1}getLevel(){return this.level}removeExtraSprite(t){for(let e=0;e<this.extraSprites.length;e++)this.extraSprites[e]==t&&this.extraSprites.splice(e,1)}addExtraSprite(e,t=null,a=null){e.startOffsetX=null===t?e.x-this.x:t,e.startOffsetY=null===a?e.y-this.y:a,this.extraSprites.push(e)}initStats(){this.destructibles=[],this.health=1e3,this.shield=0,this.shieldOffsetY=0,this.isAsleep=!1,this.timeSinceLastAttacked=9999,this.castAggravateCharge=0,this.damageNumOffset=0,this.healthBarLengthMax=101,this.extraSprites=[],this.statuses=[],this.attackCharge=0,this.nextAttackChargeNeeded=999,this.nextAttackMultiples=1,this.delayBetweenAttacks=50,this.attackCooldown=50,this.nextAttackIndex=0,this.currentAttackSetIndex=0,this.pauseMultDuration=0,this.healthTextPopups=[],this.isAngry=!1,this.slowMult=1,this.slowMultDuration=0,this.timeWhenLastDamageTaken=0,this.damageCountdown=0,this.accumulatedTimeDamage=0,this.specialDamageAbsorptionActive=!1,this.storeDamage=!1,this.dead=!1,this.pullbackScale=.9,this.pullbackScaleDefault=this.pullbackScale,this.attackDurMult=1,this.attackScale=1.1,this.attackScaleDefault=this.attackScale,this.lastAttackLingerMult=1,this.extraRepeatDelay=0,this.attackSlownessMult=1,this.pullbackHoldRatio=.5,this.chargeBarAlphaOffset=isMobile?-.1:-.18,this.accumulatedDamageReaction=0,this.initStatsCustom(),this.prevHealth=this.health,this.healthMax=this.health}initStatsCustom(){}createHealthBar(e,t){this.healthBarLengthMax=65+Math.floor(5*Math.sqrt(this.healthMax)),this.healthBarMax=this.scene.add.sprite(e,isMobile?16:14,"blackPixel"),this.healthBarMaxGoalScale=this.healthBarLengthMax+3,this.healthBarMax.setScale(0,11),this.healthBarMax.startScaleY=this.healthBarMax.scaleY,this.healthBarMax.setOrigin(.5,.5),this.healthBarMax.setDepth(10),this.healthBarRed=this.scene.add.sprite(e-this.healthBarLengthMax-3,this.healthBarMax.y,"pixels","red_pixel.png"),this.healthBarRed.setScale(this.healthBarLengthMax+3,this.healthBarMax.scaleY),this.healthBarRed.setOrigin(0,.5),this.healthBarRed.alpha=0,this.healthBarRed.setDepth(10),this.healthBarFlash=this.scene.add.sprite(e-this.healthBarLengthMax-3,this.healthBarMax.y,"pixels","white_pixel.png"),this.healthBarFlash.setScale(this.healthBarLengthMax+3,this.healthBarMax.scaleY-2),this.healthBarFlash.setOrigin(0,.5),this.healthBarFlash.alpha=0,this.healthBarFlash.setDepth(10),this.healthBarCurr=this.scene.add.sprite(e-this.healthBarLengthMax-1,this.healthBarMax.y,"pixels","green_pixel.png"),this.healthBarCurr.setScale(this.healthBarLengthMax+1,this.healthBarMax.scaleY-2),this.healthBarCurr.setOrigin(0,.5),this.healthBarCurr.alpha=0,this.healthBarCurr.setDepth(10),this.healthBarText=this.scene.add.bitmapText(e,this.healthBarMax.y-3,"plainBold","zxcv",20),this.healthBarText.setDepth(10),this.healthBarText.setOrigin(.5,.5),this.healthBarText.alpha=0,this.healthBarText.setText(this.health),this.delayLoad||this.loadUpHealthBar()}loadUpHealthBar(){this.delayLoad=!1,this.scene.tweens.add({targets:[this.healthBarMax],delay:200,duration:100*gameVars.gameManualSlowSpeedInverse+5*this.healthBarLengthMax,scaleX:this.healthBarMaxGoalScale,ease:"Quint.easeInOut"}),this.scene.tweens.add({delay:5*this.healthBarLengthMax+150,targets:[this.healthBarCurr,this.healthBarText],duration:250*gameVars.gameManualSlowSpeedInverse,alpha:1})}loadUpHealthBarSecond(){this.healthBarLengthMax=45+Math.floor(5.5*Math.sqrt(this.healthMax)),this.healthBarMaxGoalScale=this.healthBarLengthMax+3,this.scene.tweens.add({targets:[this.healthBarMax],duration:100*gameVars.gameManualSlowSpeedInverse+5*this.healthBarLengthMax,scaleX:this.healthBarMaxGoalScale,ease:"Quint.easeInOut"}),this.scene.tweens.add({targets:[this.healthBarCurr],duration:100*gameVars.gameManualSlowSpeedInverse+5*this.healthBarLengthMax,x:gameConsts.halfWidth-this.healthBarLengthMax-1,scaleX:this.healthBarLengthMax+1,ease:"Quint.easeInOut"});var e=0==this.healthBarLengthMax?0:this.healthBarLengthMax+3;this.scene.tweens.add({targets:[this.healthBarFlash],duration:100*gameVars.gameManualSlowSpeedInverse+5*this.healthBarLengthMax,x:gameConsts.halfWidth-this.healthBarLengthMax-3,scaleX:e,ease:"Quint.easeInOut"}),this.scene.tweens.add({targets:[this.healthBarRed],duration:100*gameVars.gameManualSlowSpeedInverse+5*this.healthBarLengthMax,x:gameConsts.halfWidth-this.healthBarLengthMax-3,scaleX:this.healthBarLengthMax+3,ease:"Quint.easeInOut"}),this.scene.tweens.add({targets:[this.healthBarCurr,this.healthBarText],duration:400*gameVars.gameManualSlowSpeedInverse,alpha:1})}createChargeBar(e){var t=Math.floor(.2*this.nextAttackChargeNeeded),a=(this.chargeBarWarningBig=this.scene.add.image(gameConsts.halfWidth,0,"enemies","warning.png"),this.chargeBarWarningBig.setOrigin(.5,0),this.chargeBarWarningBig.setScale(.1*gameConsts.width,.65),this.chargeBarWarningBig.alpha=0,this.chargeBarWarningBig.setDepth(1),isMobile?333:315),a=(this.chargeBarReady1=this.scene.add.image(e,a,"enemies","ready_glow.png").setAlpha(0).setDepth(9).setBlendMode(Phaser.BlendModes.ADD),this.chargeBarReady2=this.scene.add.image(e,a,"enemies","ready_glow.png").setAlpha(0).setDepth(9).setBlendMode(Phaser.BlendModes.ADD),this.chargeBarOutline=this.scene.add.image(e,a,"whitePixel"),this.chargeBarOutline.setScale(t+4,isMobile?14:11),this.chargeBarOutline.setOrigin(.5,.5),this.chargeBarOutline.visible=!1,this.chargeBarOutline.alpha=.4,this.chargeBarOutline.setDepth(9),this.chargeBarMax=this.scene.add.image(e,a,"pixels","black_blue_pixel.png"),this.chargeBarMax.setScale(t+2,isMobile?12:10),this.chargeBarMax.setOrigin(.5,.5),this.chargeBarMax.visible=!1,this.chargeBarMax.setDepth(9),this.voidPause=this.scene.add.image(e,this.chargeBarMax.y,"pixels","purple_pixel.png"),this.voidPause.alpha=0,this.voidPause.setScale(t+2,this.chargeBarMax.scaleY-2),this.voidPause.setOrigin(.5,.5),this.voidPause.setDepth(9),this.chargeBarWarning=this.scene.add.image(e,this.chargeBarMax.y,"pixels","red_pixel.png"),this.chargeBarWarning.alphaMult=1,this.chargeBarWarning.setScale(t+2,this.chargeBarMax.scaleY),this.chargeBarWarning.setOrigin(.5,.5),this.chargeBarWarning.visible=!1,this.chargeBarWarning.setDepth(9),this.chargeBarWarning.setAlpha(.35),this.chargeVertical=this.scene.add.image(e,this.chargeBarMax.y,"blurry","yellow_vertical.webp").setScale(1.5,1.35).setAlpha(0).setOrigin(0,.5),this.chargeVertical2=this.scene.add.image(e,this.chargeBarMax.y,"blurry","yellow_vertical.webp").setScale(-1.5,1.35).setAlpha(0).setOrigin(0,.5),this.chargeBarCurr=this.scene.add.image(e,this.chargeBarMax.y,"pixels","yellow_pixel.png"),this.chargeBarCurr.setScale(0,this.chargeBarMax.scaleY-2),this.chargeBarCurr.setOrigin(.5,.5),this.chargeBarCurr.alpha=.9,this.chargeBarCurr.setDepth(9),this.chargeBarAngry=this.scene.add.image(e,this.chargeBarMax.y,"pixels","red_pixel.png"),this.chargeBarAngry.midAlpha=.55,this.chargeBarAngry.setScale(0,this.chargeBarMax.scaleY-2),this.chargeBarAngry.setOrigin(.5,.5),this.chargeBarAngry.alpha=.9,this.chargeBarAngry.setDepth(9),this.chargeBarAngry.visible=!1,this.chargeBarFlash1=this.scene.add.image(e,this.chargeBarMax.y,"whitePixel").setAlpha(0).setDepth(9),this.chargeBarFlash2=this.scene.add.image(e,this.chargeBarMax.y,"whitePixel").setAlpha(0).setDepth(9),this.chargeBarFlash1.scaleY=this.chargeBarMax.scaleY,this.chargeBarFlash2.scaleY=this.chargeBarMax.scaleY,this.chargeBarEst1=this.scene.add.image(e,this.chargeBarMax.y,"misc","estbar.webp"),this.chargeBarEst1.setScale(.085,this.chargeBarMax.scaleY-2),this.chargeBarEst1.setOrigin(1,.5),this.chargeBarEst1.alpha=0,this.chargeBarEst1.setDepth(9),this.chargeBarShow=!1,this.chargeBarEstScale=8.5,this.chargeBarEst2=this.scene.add.image(e,this.chargeBarMax.y,"misc","estbar.webp"),this.chargeBarEst2.setScale(-.085,this.chargeBarMax.scaleY-2),this.chargeBarEst2.setOrigin(1,.5),this.chargeBarEst2.alpha=0,this.chargeBarEst2.setDepth(9),isMobile?this.chargeBarMax.y-23:this.chargeBarMax.y-22);this.angrySymbol=this.scene.add.sprite(e,a-8,"misc","angry1.png"),this.angrySymbol.setDepth(9),this.angrySymbol.visible=!1,this.angrySymbolIsHiding=!0,this.attackNameHighlight=this.scene.add.image(e,a-13,"blurry","glow_flat_red.webp").setAlpha(0).setDepth(9),this.attackGlow=this.scene.add.image(e,a-10,"blurry","glow_flat.webp").setAlpha(0).setDepth(9).setVisible(!1),this.attackDarken=this.scene.add.image(e,this.chargeBarMax.y-1,"blurry","attack_dark.png").setAlpha(0).setDepth(this.attackGlow.depth-1).setScale(0,1).setVisible(!1),this.attackName=this.scene.add.bitmapText(this.x,a,"normal","",isMobile?38:36),this.attackName.setDepth(9),this.attackName.setOrigin(.5,.85)}setDepth(e){this.sprite.depth=e-5,this.chargeBarReady1.depth=e,this.chargeBarReady2.depth=e,this.chargeBarOutline.depth=e,this.chargeBarMax.depth=e,this.voidPause.depth=e,this.chargeBarWarning.depth=e,this.chargeVertical.depth=e,this.chargeVertical2.depth=e,this.chargeBarCurr.depth=e,this.chargeBarAngry.depth=e,this.chargeBarFlash1.depth=e,this.chargeBarFlash2.depth=e,this.chargeBarEst1.depth=e,this.chargeBarEst2.depth=e,this.angrySymbol.depth=e,this.attackNameHighlight.depth=e,this.attackGlow.depth=e,this.attackDarken.depth=e,this.attackName.depth=e}resetStats(e,t){this.x=e,this.y=t,this.sprite&&(this.sprite.x=this.x,this.sprite.y=this.y);for(let e=0;e<this.extraSprites.length;e++)this.extraSprites[e].x=this.x+this.extraSprites[e].startOffsetX,this.extraSprites[e].y=this.y+this.extraSprites[e].startOffsetY;this.health=this.healthMax,this.prevHealth=this.health}initSpriteAnim(e){this.sprite.setScale(.98*e,.95*e),this.delayLoad||this.scene.tweens.add({targets:this.sprite,duration:750*gameVars.gameManualSlowSpeedInverse,ease:"Quad.easeOut",scaleX:e,scaleY:e,alpha:1})}initSprite(e,t=1,a=0,s=0,i){this.isDestroyed||(this.x+=a,this.y+=s,this.atlas=a=i||"enemies",this.sprite=this.scene.add.sprite(this.x,this.y,a,e),this.sprite.setDepth(1),this.sprite.setAlpha(0),this.sprite.startX=this.sprite.x,this.sprite.startY=this.sprite.y,this.defaultSprite=e,this.initSpriteAnim(t),this.sprite.startScale=t,this.delayedDamageText=this.scene.add.bitmapText(this.x,this.y,"block","",64),this.delayedDamageText.alpha=.95,this.delayedDamageText.setOrigin(.5,.6),this.delayedDamageText.setDepth(2),this.shieldSprite=this.scene.add.sprite(this.x,this.y+this.shieldOffsetY,"shields","shield10.png"),this.shieldSprite.alpha=.85,this.shieldSprite.setDepth(8).setScale(this.shieldScale||1),this.shieldSprite.visible=!1,this.shieldSprite.startScale=this.shieldSprite.scaleX,s=68*this.shieldSprite.startScale+(this.shieldTextOffsetY||0),this.shieldText=this.scene.add.bitmapText(gameConsts.halfWidth,this.y+s+this.shieldOffsetY,this.shieldTextFont||"armor","",this.shieldTextSize||48),this.shieldText.alpha=1,this.shieldText.setOrigin(.5,.55),this.shieldText.setDepth(8),this.shieldText.visible=!1)}setSpriteIfNotInactive(e,t,a,s=1){this.dead||this.isAsleep||this.isDestroyed||this.setSprite(e,t,a,s)}setSprite(t,a,s,i=1){if(!(this.isDestroyed||this.forceOverrideSprite&&t!==this.forceOverrideSprite)){let e=a||1;var h,r;return this.sprite?(e=a||this.sprite.startScale,a=this.sprite.originX,h=this.forcedOriginY||this.sprite.originY,r=this.sprite.frame,this.sprite.stop(),r.name!==t&&this.sprite.setFrame(t),this.sprite.setOrigin(a,h)):this.sprite=this.scene.add.sprite(this.x,this.y,this.atlas,t),this.sprite.setDepth(i),this.sprite.startScale=e,s||(this.sprite.setScale(1.02*e),this.scene.tweens.add({targets:this.sprite,duration:300*gameVars.gameManualSlowSpeedInverse,scaleX:e,scaleY:e})),this.sprite}}setDefaultSprite(e,t=null,a){if(!(this.isDestroyed||this.forceOverrideSprite&&e!==this.forceOverrideSprite))return this.defaultSprite=e,t=t||(this.sprite?this.sprite.startScale:1),this.sprite.stop(),this.setSprite(e,t,a)}update(i){if(!this.dead&&!this.isDestroyed){let a=i*gameVars.timeSlowRatio,t=!1,s=1;if(!this.isAsleep){let e=0;if(this.attackCharge&&(e=this.attackCharge/(this.nextAttackChargeNeeded+.01)),this.attackCooldown<=0){if(0<this.pauseMultDuration&&(this.pauseMultDuration-=a,a=0),1<(s=this.nextAttack.chargeMult||1)&&(challenges.angryEnemies?s*=1.1:cheats.calmEnemies&&(s=.5*s+1)),!(this.attackCharge>this.nextAttackChargeNeeded-145)||this.attackName.hasWarned||this.nextAttack.isPassive||!this.attackName.active||this.dead||(this.attackName.hasWarned=!0,h=this.attackName.origScale,this.attackName.currAnim&&this.attackName.currAnim.stop(),this.attackGlow.currAnim&&this.attackGlow.currAnim.stop(),this.attackDarken.currAnim&&this.attackDarken.currAnim.stop(),this.attackGlow.visible=!0,this.attackDarken.visible=!0,this.attackName.width&&this.attackGlow.setScale(.009*this.attackName.width,1.4),this.attackName.setAlpha(.95),r=this.nextAttack.name.length<=7,this.attackName.currAnim=PhaserScene.tweens.add({targets:this.attackName,ease:"Cubic.easeIn",duration:500*gameVars.gameManualSlowSpeedInverse,alpha:1,yoyo:!0,repeat:-1,scaleX:h+(r?.25:.09),scaleY:h+(r?.35:.2)}),this.attackGlow.currAnim=PhaserScene.tweens.add({targets:this.attackGlow,duration:500*gameVars.gameManualSlowSpeedInverse,alpha:.7,ease:"Quad.easeIn",yoyo:!0,repeat:-1,scaleX:.014*this.attackName.width,scaleY:1.55}),this.attackDarken.currAnim=PhaserScene.tweens.add({targets:this.attackDarken,duration:500*gameVars.gameManualSlowSpeedInverse,alpha:.85,ease:"Quad.easeInOut"})),this.chargeBarShow=!1,this.chargeVertical.scaleY=1.28,this.chargeVertical2.scaleY=1.28,this.isAngry){let e=Math.max(8,.34*s),t=(challenges.angryEnemies?e=1.2:cheats.calmEnemies&&(e=1+.6*e),0);0<this.castAggravateCharge&&(this.castAggravateCharge-=a,t=0<=this.castAggravateCharge?a:a+this.castAggravateCharge),this.attackCharge+=a*e*this.slowMult+t,this.chargeVertical.alpha=Math.min(1,this.chargeVertical.alpha+.3*a*i),this.chargeVertical2.alpha=this.chargeVertical.alpha,this.chargeVertical.scaleY=1.4,this.chargeVertical2.scaleY=1.4}else if(this.chargeVertical.alpha=Math.max(0,this.chargeVertical.alpha-.04*a*i)*(1-.08*i),this.chargeVertical2.alpha=this.chargeVertical.alpha,t=this.attackCharge>this.nextAttackChargeNeeded-45,gameVars.playerNotMoved&&1===s&&!t&&this.castAggravateCharge<=0)this.chargeBarCurr.alpha=.7,this.chargeBarShow=!0;else if(t||1<s||0<this.castAggravateCharge){this.isUsingAttack||(this.chargeVertical.alpha=Math.min(.65,this.chargeVertical.alpha+.29*a*i),this.chargeVertical2.alpha=this.chargeVertical.alpha);let e=0;0<this.castAggravateCharge&&(this.castAggravateCharge-=a,e=0<=this.castAggravateCharge?a:a+this.castAggravateCharge),1<s||t?this.chargeBarCurr.alpha=.99:this.chargeBarCurr.alpha=.85,1<s?this.attackCharge+=.5*a*this.slowMult*s:this.attackCharge+=a*this.slowMult*s,this.attackCharge+=3.3*e}else this.chargeBarCurr.alpha=.7,this.chargeBarShow=!0;this.chargeBarCurr.scaleX=Math.min(.2*this.nextAttackChargeNeeded,.2*this.attackCharge+1),this.chargeVertical.x=gameConsts.halfWidth-this.chargeBarCurr.scaleX-1.5,this.chargeVertical2.x=gameConsts.halfWidth+this.chargeBarCurr.scaleX+1.5,this.chargeBarShow?(this.chargeBarEst1.x=gameConsts.halfWidth-this.chargeBarCurr.scaleX,this.chargeBarEst2.x=gameConsts.halfWidth+this.chargeBarCurr.scaleX,this.chargeBarEst1.currAnim||(this.chargeBarEst1.alpha=0,this.chargeBarEst2.alpha=0,this.chargeBarEst1.currAnim=PhaserScene.tweens.add({delay:250,targets:[this.chargeBarEst1,this.chargeBarEst2],duration:1250,alpha:.33,yoyo:!0,repeat:-1}))):this.chargeBarEst1.currAnim&&(this.chargeBarEst1.currAnim.stop(),this.chargeBarEst1.currAnim=null,PhaserScene.tweens.add({targets:[this.chargeBarEst1,this.chargeBarEst2],duration:470+4*this.chargeBarEst1.scaleX,alpha:0,ease:"Quad.easeOut"}));let e=this.chargeBarEstScale;this.chargeBarCurr.scaleX+2*e+10.05>this.chargeBarMax.scaleX&&(e=99);this.attackCharge,this.nextAttackChargeNeeded;var h=.01*Math.min(e,.5*(this.chargeBarMax.scaleX-this.chargeBarCurr.scaleX)-1),r=(this.chargeBarEst1.scaleX=h,this.chargeBarEst2.scaleX=-h,1.18*this.chargeBarCurr.scaleX/(this.chargeBarMax.scaleX+1)+this.chargeBarAlphaOffset),h=.06*i;if(this.chargeBarOutline.alpha=r*h+this.chargeBarOutline.alpha*(1-h),this.attackDarken&&(this.attackDarken.scaleX=.009*this.chargeBarMax.scaleX+.1),this.chargeBarAngry.scaleX=this.chargeBarCurr.scaleX,this.attackPaused)this.chargeVertical.alpha=Math.max(0,this.chargeVertical.alpha-.35*a*i),this.chargeVertical2.alpha=this.chargeVertical.alpha;else if(this.isUsingAttack)this.chargeVertical.alpha=Math.max(0,this.chargeVertical.alpha-.35*a*i),this.chargeVertical2.alpha=this.chargeVertical.alpha;else if(this.attackCharge>=this.nextAttackChargeNeeded){if(void 0!==this.nextAttack.damage&&0!==this.nextAttack.damage)if(this.chargeBarReady1.setAlpha(1).setScale(.9,.5),this.chargeBarReady2.setAlpha(1).setScale(.9,.5),this.chargeBarReady1.x=this.chargeBarMax.x-this.chargeBarMax.scaleX,this.chargeBarReady2.x=this.chargeBarMax.x+this.chargeBarMax.scaleX,this.chargeBarReadyAnim=this.scene.tweens.add({targets:[this.chargeBarReady1,this.chargeBarReady2],scaleX:1.25,scaleY:.95,ease:"Cubic.easeIn",duration:100*gameVars.gameManualSlowSpeedInverse,onComplete:()=>{this.chargeBarReadyAnim=this.scene.tweens.add({targets:[this.chargeBarReady1,this.chargeBarReady2],scaleX:.9,scaleY:.8,alpha:.95,ease:"Cubic.easeOut",duration:400*gameVars.gameManualSlowSpeedInverse,onComplete:()=>{this.chargeBarReadyAnim=this.scene.tweens.add({targets:[this.chargeBarReady1,this.chargeBarReady2],alpha:0,scaleX:.75,scaleY:.75,duration:600*gameVars.gameManualSlowSpeedInverse,ease:"Quad.easeIn"}),this.scene.tweens.add({targets:[this.chargeBarOutline],alpha:0,duration:800*gameVars.gameManualSlowSpeedInverse,ease:"Cubic.easeIn"})}})}}),this.nextAttack.isBigMove){this.chargeBarFlash1.setAlpha(1).setScale(0,this.chargeBarMax.scaleY),this.chargeBarFlash1.x=this.chargeBarMax.x,this.chargeBarFlash2.setAlpha(1).setScale(0,this.chargeBarMax.scaleY),this.chargeBarFlash2.x=this.chargeBarMax.x;let e=this.chargeBarMax.x-this.chargeBarMax.scaleX,t=this.chargeBarMax.x+this.chargeBarMax.scaleX,a=150+Math.floor(this.chargeBarMax.scaleX);this.scene.tweens.add({targets:this.chargeBarFlash1,x:this.chargeBarMax.x-.5*this.chargeBarMax.scaleX,scaleX:.5*this.chargeBarMax.scaleX,ease:"Quart.easeOut",duration:a-20,completeDelay:150,onComplete:()=>{this.chargeBarFlash1.scaleY=this.chargeBarMax.scaleY+6,this.chargeBarFlash2.scaleY=this.chargeBarFlash1.scaleY,this.scene.tweens.add({delay:20,targets:[this.chargeBarFlash1,this.chargeBarFlash2],scaleY:this.chargeBarMax.scaleY,ease:"Cubic.easeOut",duration:150}),this.scene.tweens.add({targets:this.chargeBarFlash1,x:e,scaleX:0,ease:"Quart.easeOut",duration:a,onComplete:()=>{this.chargeBarFlash1.setAlpha(0)}})}}),this.scene.tweens.add({targets:this.chargeBarFlash2,x:this.chargeBarMax.x+.5*this.chargeBarMax.scaleX,scaleX:.5*this.chargeBarMax.scaleX,ease:"Quart.easeOut",duration:a-20,completeDelay:130,onComplete:()=>{this.scene.tweens.add({targets:this.chargeBarFlash2,x:t,scaleX:0,ease:"Quart.easeOut",duration:a,onComplete:()=>{this.chargeBarFlash2.setAlpha(0)}})}})}else{this.chargeBarFlash1.setAlpha(1).setScale(0,this.chargeBarMax.scaleY),this.chargeBarFlash1.x=this.chargeBarMax.x-this.chargeBarMax.scaleX;let e=this.chargeBarMax.x+this.chargeBarMax.scaleX,t=100+Math.floor(this.chargeBarMax.scaleX);this.scene.tweens.add({targets:this.chargeBarFlash1,x:this.chargeBarMax.x,scaleX:this.chargeBarMax.scaleX,ease:"Cubic.easeOut",duration:t,completeDelay:120,onComplete:()=>{this.scene.tweens.add({targets:this.chargeBarFlash1,x:e,scaleX:0,ease:"Cubic.easeOut",duration:t,onComplete:()=>{this.chargeBarFlash1.setAlpha(0)}})}})}this.chargeBarWarning.visible=!0,this.chargeBarWarning.alpha=.34,this.chargeBarWarningBig.alpha=Math.min(.5,this.chargeBarWarningBig.alpha+.05*a),this.addTween({targets:[this.chargeVertical,this.chargeVertical2],alpha:0,duration:500,ease:"Cubic.easeOut"}),this.useMove()}else this.attackCharge>=.9*this.nextAttackChargeNeeded-30?(this.chargeBarWarning.visible=!0,this.chargeBarWarning.alpha+=this.slowMult*(a+.5)*.03*this.chargeBarWarning.alphaMult,this.chargeBarWarningBig.alpha=.5*this.chargeBarWarning.alpha-.1,.89<this.chargeBarWarning.alpha?this.chargeBarWarning.alphaMult=-1:this.chargeBarWarning.alpha<.05&&(this.chargeBarWarning.alphaMult=1)):this.attackCharge>=.8*this.nextAttackChargeNeeded-75?(this.chargeBarWarning.visible=!0,this.chargeBarWarning.alpha+=this.slowMult*(a+.5)*.01*this.chargeBarWarning.alphaMult,this.chargeBarWarningBig.alpha=.4*this.chargeBarWarning.alpha-.12,.53<this.chargeBarWarning.alpha?this.chargeBarWarning.alphaMult=-1:this.chargeBarWarning.alpha<.04&&(this.chargeBarWarning.alphaMult=1)):(this.chargeBarWarning.visible=!1,this.chargeBarWarningBig.alpha*=1-.08*a)}else this.isUsingAttack||(r=this.isAngry?1.5:1,this.attackCooldown-=a*r,this.attackCooldown<=0&&(this.attackCooldown=0,this.readyNextAttack()));this.timeSinceLastAttacked+=a,this.isAsleep?(this.chargeBarAngry.visible=!1,this.chargeBarCurr.visible=!1,this.chargeVertical.alpha=0,this.chargeVertical2.alpha=0):this.timeSinceLastAttacked<18?this.isAngry||(this.isAngry=!0,this.isAsleep||(this.chargeBarAngry.alpha=1,this.chargeBarAngry.visible=!0,this.showAngrySymbol(this.customAngry||"angry")),this.chargeBarCurr.visible=!1,this.chargeVertical.alpha=0,this.chargeVertical2.alpha=0):1<s?(this.isAngry=!1,this.chargeBarAngry.visible=!0,this.chargeBarCurr.visible=!0,this.chargeBarAngry.alpha=this.chargeBarAngry.midAlpha,1.1<s&&this.showAngrySymbol("exclamation")):(t?(this.chargeBarAngry.visible=!0,this.chargeBarAngry.alpha=1):(this.chargeBarAngry.visible=!0,this.chargeBarAngry.alpha=.8*(e-.15)),this.isAngry=!1,this.chargeBarCurr.visible=!0,this.hideAngrySymbol()),0<this.slowMultDuration&&(this.slowMultDuration-=a,this.chargeBarAngry.alpha=this.chargeBarAngry.midAlpha+.05,this.chargeBarCurr.alpha=.7,this.slowMultDuration<=0)&&(this.slowMult=1,this.chargeBarAngry.alpha=1.63*this.chargeBarAngry.midAlpha,this.chargeBarCurr.alpha=.9)}}}setDefense(e){this.defense=e}playShieldHitAnim(){this.shieldSprite.alpha=1,this.shieldSprite.play(this.shieldSprite.damageAnim||"shieldHit"),this.shieldSprite.setScale(1.1*this.shieldSprite.startScale),this.shieldText.setDepth(99),this.scene.tweens.add({targets:this.shieldSprite,scaleX:this.shieldSprite.startScale,scaleY:this.shieldSprite.startScale,duration:150*gameVars.gameManualSlowSpeedInverse,alpha:.85})}adjustDamageTaken(t,a,e=!1){var s=globalObjects.player.getStatuses().mindReinforce;if(s&&(t+=s.displayAmt),this.defense&&!e&&(t=Math.max(0,t-this.defense)),a&&this.statuses.mindStrike){s=Math.max(0,Math.ceil(t));this.statuses.mindStrike.cleanUp(this.statuses,s,!0);let e=Math.sqrt(s);setTimeout(()=>{messageBus.publish("animateTrueDamageNum",gameConsts.halfWidth-45,218-2.2*e,"X2",.5+.1*e)},15*Math.floor(e)),t+=s}if(0<this.shield&&!e)if(t<this.shield){a=60*(Math.random()-.5),s=50*(Math.random()-.5);messageBus.publish("animateBlockNum",this.shieldText.x+1+a,this.shieldText.y-30+s,-t,.65+.09*Math.sqrt(t)),this.shield-=t,t=0,this.playShieldHitAnim(),this.shieldText.setText(this.shield).setAlpha(1);let e=Math.random()<.5;this.scene.tweens.add({targets:this.shieldText,scaleX:this.shieldText.startScale+1.25,scaleY:this.shieldText.startScale+1.25,y:"-=3",x:e?"-=6":"+=6",duration:60*gameVars.gameManualSlowSpeedInverse,ease:"Quint.easeOut",onComplete:()=>{this.scene.tweens.add({targets:this.shieldText,scaleX:this.shieldText.startScale,scaleY:this.shieldText.startScale,y:"+=3",duration:500*gameVars.gameManualSlowSpeedInverse,ease:"Quart.easeOut"}),this.scene.tweens.add({targets:this.shieldText,x:e?"+=13":"-=13",duration:100*gameVars.gameManualSlowSpeedInverse,ease:"Quint.easeInOut",onComplete:()=>{this.shieldText.setDepth(8),this.scene.tweens.add({targets:this.shieldText,x:this.shieldText.startX,duration:400*gameVars.gameManualSlowSpeedInverse,ease:"Bounce.easeOut"}),this.scene.tweens.add({delay:1500,targets:this.shieldText,alpha:.75,duration:1500})}})}})}else messageBus.publish("animateBlockNum",this.shieldText.x+1,this.shieldText.y-15,-t,.65+.09*Math.sqrt(t)),t-=this.shield,this.clearShield();return t}useMove(){this.isDestroyed||this.health<=0||(this.attackCharge=0,this.attackCooldown=this.delayBetweenAttacks,this.chargeBarCurr.alpha=1,this.chargeBarAngry.alpha=1,this.timeSinceLastAttacked+=24,(this.castAggravateCharge=0)!==this.nextAttack.damage?this.launchAttack(this.nextAttack.attackTimes,this.nextAttack.prepareSprite,this.nextAttack.preAttackSprite,this.nextAttack.attackSprites,void 0,this.nextAttack.finishDelay,this.nextAttack.transitionFast):(this.nextAttack.message&&messageBus.publish(this.nextAttack.message,this.nextAttack.messageDetail),this.nextAttack.attackFinishFunction&&this.nextAttack.attackFinishFunction(),this.nextAttack.finaleFunction&&this.nextAttack.finaleFunction()),this.nextAttack.block&&messageBus.publish("enemyAddShield",this.nextAttack.block))}repositionAngrySymbol(){this.angrySymbol.x=this.attackName.x+.496*this.attackName.width+18}readyNextAttack(){if(!this.isDestroyed){this.nextAttackIndex>=this.attacks[this.currentAttackSetIndex].length&&(this.nextAttackIndex=0),this.nextAttack=this.attacks[this.currentAttackSetIndex][this.nextAttackIndex],this.nextAttack||(this.nextAttackIndex=0,this.nextAttack=this.attacks[this.currentAttackSetIndex][this.nextAttackIndex]),this.nextAttackChargeNeeded=this.nextAttack.chargeAmt||250,this.nextAttackMultiples=this.nextAttack.attackMultiplier||1;var t=this.nextAttack.name;this.nextAttack.startFunction&&this.nextAttack.startFunction();let e=1;var a=7<t.length;e=a?.8:.98,this.attackName.setText(t).setAlpha(.2).setScale(e),this.repositionAngrySymbol(),this.attackName.setScale(.9*e),this.attackName.hasWarned=!1,this.nextAttack.isPassive||(t=this.attackName.width/200,this.attackNameHighlight.setScale(t,2.25).setAlpha(.24),PhaserScene.tweens.add({targets:this.attackNameHighlight,duration:300*gameVars.gameManualSlowSpeedInverse,ease:"Quad.easeOut",alpha:this.nextAttack.isBigMove?1.1:.9,onComplete:()=>{PhaserScene.tweens.add({targets:this.attackNameHighlight,ease:"Quad.easeOut",duration:gameVars.gameManualSlowSpeedInverse*this.nextAttack.isBigMove?1250:850,alpha:0})}}),PhaserScene.tweens.add({targets:this.attackNameHighlight,duration:gameVars.gameManualSlowSpeedInverse*this.nextAttack.isBigMove?1500:1100,ease:"Cubic.easeOut",scaleX:t+(this.nextAttack.isBigMove?1.8:1.5)}),PhaserScene.tweens.add({delay:300,targets:this.attackNameHighlight,ease:this.nextAttack.isBigMove?"Quad.easeIn":"Quad.easeOut",duration:gameVars.gameManualSlowSpeedInverse*this.nextAttack.isBigMove?1300:900,scaleY:0})),PhaserScene.tweens.add({targets:this.attackName,duration:500*gameVars.gameManualSlowSpeedInverse,alpha:1}),this.attackName.currAnim&&this.attackName.currAnim.stop(),this.attackGlow.currAnim&&(this.attackGlow.currAnim.stop(),this.attackGlow.currAnim=PhaserScene.tweens.add({targets:this.attackGlow,duration:200*gameVars.gameManualSlowSpeedInverse,alpha:0})),this.attackDarken.currAnim&&(this.attackDarken.currAnim.stop(),this.attackDarken.isAnimating=!0,PhaserScene.tweens.add({targets:this.attackDarken,duration:200*gameVars.gameManualSlowSpeedInverse,alpha:0,onComplete:()=>{this.attackDarken.isAnimating=!1}})),this.attackName.origScale=e,PhaserScene.tweens.add({targets:this.attackName,ease:"Cubic.easeOut",duration:400*gameVars.gameManualSlowSpeedInverse,scaleX:a&&!this.nextAttack.isBigMove?e+.02:1.6*e,scaleY:a&&!this.nextAttack.isBigMove?1.25*e:1.6*e,onComplete:()=>{PhaserScene.tweens.add({targets:this.attackName,ease:"Cubic.easeIn",duration:500*gameVars.gameManualSlowSpeedInverse,scaleX:e,scaleY:e,onComplete:()=>{this.nextAttack.isBigMove&&this.attackName.active&&(this.attackName.currAnim=PhaserScene.tweens.add({targets:this.attackName,ease:"Cubic.easeIn",duration:750*gameVars.gameManualSlowSpeedInverse,yoyo:!0,repeat:-1,scaleX:this.attackName.origScale+.065,scaleY:this.attackName.origScale+.14}),this.attackGlow.setAlpha(0),this.attackName.width&&this.attackGlow.setScale(.009*this.attackName.width,1.4),this.attackGlow.visible=!0,this.attackGlow.currAnim=PhaserScene.tweens.add({targets:this.attackGlow,duration:750*gameVars.gameManualSlowSpeedInverse,ease:"Quad.easeIn",yoyo:!0,alpha:.95,repeat:-1,scaleX:.014*this.attackName.width,scaleY:1.5}))}})}}),this.prepareChargeBar(!0,this.nextAttack.isBigMove,this.nextAttack.customCall),this.nextAttackIndex++}}setPauseDur(e=50){this.pauseMultDuration=e}setSlowMult(e=0,t=90){this.slowMult=e,this.slowMultDuration=t}disruptOpponentAttackPercent(e=.5){e=this.attackCharge*e;this.disruptOpponentAttack(e)}disruptOpponentAttack(e=1){this.attackCharge-=e,this.chargeBarMax.visible&&0<this.chargeBarMax.alpha&&(this.voidPause.alpha=1,this.voidPause.setScale(this.chargeBarMax.scaleX,this.chargeBarMax.scaleY),this.scene.tweens.add({targets:this.voidPause,duration:200*gameVars.gameManualSlowSpeedInverse,alpha:0,scaleY:0}),this.scene.tweens.add({targets:this.voidPause,duration:200*gameVars.gameManualSlowSpeedInverse,scaleX:this.healthBarMax.scaleX+40,ease:"Quad.easeOut"}))}prepareChargeBar(e=!0,t,a){this.chargeBarReadyAnim&&(this.chargeBarReadyAnim.stop(),this.scene.tweens.add({targets:[this.chargeBarReady1,this.chargeBarReady2],alpha:0,scaleX:.4,scaleY:.4,duration:250*gameVars.gameManualSlowSpeedInverse})),this.chargeBarMax.visible=!0,this.chargeBarOutline.visible=!0;var s=Math.floor(.2*this.nextAttackChargeNeeded),i=(this.chargeBarMax.scaleX=.6*s+2,this.chargeBarOutline.scaleX=this.chargeBarMax.scaleX+3+(isMobile?1:0),this.chargeBarOutline.alpha=3,this.chargeBarOutline.isAnimating=!0,this.chargeBarWarning.visible=!1,this.chargeBarWarning.scaleX=s+2,this.chargeBarCurr.scaleX=0,this.chargeBarCurr.alpha=.9,this.chargeBarAngry.scaleX=0,this.chargeBarAngry.alpha=.9,this.attackDarken.isAnimating=!0,this.attackDarken.alpha*=.6,this.scene.tweens.add({targets:this.attackDarken,alpha:0,duration:500,onComplete:()=>{this.attackDarken.isAnimating=!1}}),2-gameVars.timeSlowRatio);e?(a?""!==a&&" "!==a&&playSound(a,.7):t?playSound("enemy_attack_major",.65):(this.enemyAttackSfxFlip?playSound("enemy_attack_2",.58):playSound("enemy_attack",.67),this.enemyAttackSfxFlip=!this.enemyAttackSfxFlip),this.scene.tweens.add({targets:this.chargeBarMax,scaleX:s+2,duration:gameVars.gameManualSlowSpeedInverse*s*7*i,ease:"Quart.easeOut"}),this.scene.tweens.add({targets:this.chargeBarOutline,scaleX:s+4+(isMobile?1:0),duration:gameVars.gameManualSlowSpeedInverse*s*7*i,alpha:1,ease:"Quart.easeOut",onComplete:()=>{this.chargeBarOutline.isAnimating=!1}})):(this.scene.tweens.add({targets:this.chargeBarMax,scaleX:s+2,duration:50*gameVars.gameManualSlowSpeedInverse,ease:"Quart.easeOut"}),this.scene.tweens.add({targets:this.chargeBarOutline,scaleX:s+4+(isMobile?1:0),duration:50*gameVars.gameManualSlowSpeedInverse,alpha:1,ease:"Quart.easeOut",onComplete:()=>{this.chargeBarOutline.isAnimating=!1}}))}takeEffect(e){this.statuses[e.name]=e}hasEffect(e){return!!this.statuses[e]}clearEffects(){for(var e in this.statuses){e=this.statuses[e];e&&e.cleanUp(this.statuses)}this.statuses=[],this.clearShield()}startDamageCountdown(){}addShield(e){this.isDestroyed||(this.shield=e,this.shieldSprite.visible=!0,this.shieldSprite.play(this.shieldSprite.flashAnim||"shieldFlash"),this.shieldSprite.alpha=.2,this.shieldSprite.setScale(1.1*this.shieldSprite.startScale),this.scene.tweens.add({targets:this.shieldSprite,scaleX:this.shieldSprite.startScale,scaleY:this.shieldSprite.startScale,alpha:1,ease:"Cubic.easeIn",duration:150*gameVars.gameManualSlowSpeedInverse,onComplete:()=>{this.scene.tweens.add({targets:this.shieldSprite,alpha:.85,duration:250*gameVars.gameManualSlowSpeedInverse})}}),this.shieldText.visible=!0,this.shieldText.setScale(.1),this.shieldText.setText(this.shield),this.shieldText.startX=this.shieldText.x,this.shieldText.startScale=.8+.005*Math.sqrt(e),this.scene.tweens.add({targets:this.shieldText,scaleX:this.shieldText.startScale,scaleY:this.shieldText.startScale,ease:"Back.easeOut",duration:250*gameVars.gameManualSlowSpeedInverse}),this.scene.tweens.add({delay:1e3,targets:this.shieldText,alpha:.75,duration:1500}))}clearShield(){this.shield=0,this.shieldSprite.alpha=1,this.scene.tweens.add({targets:this.shieldSprite,scaleX:1.25*this.shieldSprite.startScale,scaleY:1.25*this.shieldSprite.startScale,duration:250*gameVars.gameManualSlowSpeedInverse,alpha:0,onComplete:()=>{this.shieldSprite.visible=!1}}),this.shieldText&&(this.shieldText.setText(0),this.scene.tweens.add({targets:this.shieldText,scaleX:0,scaleY:0,ease:"Quad.easeOut",duration:250*gameVars.gameManualSlowSpeedInverse,onComplete:()=>{this.shieldText.visible=!1}}))}handleSpecialDamageAbsorption(e){return e}reactToDamageTypes(e,t,a){a&&(this.accumulatedDamageReaction+=e,this.reactTimeout&&clearTimeout(this.reactTimeout),this.reactTimeout=setTimeout(()=>{this.accumulatedDamageReaction=0,this.reactTimeout=null},1700))}takeDamage(t,a=!0,s=0,i){if(!globalObjects.player.isDead()&&!this.delayLoad){a&&cheats.extraDmg&&(t*=2),a&&cheats.extraExtraDmg&&(t*=2);var h=this.health;let e=this.adjustDamageTaken(t,a);this.specialDamageAbsorptionActive&&(e=this.handleSpecialDamageAbsorption(e)),this.setHealth(Math.max(0,this.health-e));t=h-this.health;this.reactToDamageTypes(t,a,i),0<t&&(20<t?(this.animateShake(1.5),messageBus.publish("tempPause",50,.15)):(this.animateShake(1.1),6<=t&&messageBus.publish("tempPause",30,.2)),this.animateDamageNum(t,void 0,this.damageNumOffset+s)),a&&(this.timeSinceLastAttacked=0),this.health<=0&&this.die()}}flashHealthChange(e,t=1){this.isDestroyed||(this.healthBarCurr.scaleX,this.healthBarRed.alpha=.4+.4*t,1.05<t&&(this.healthBarMax.scaleY=this.healthBarMax.startScaleY+3,this.healthBarRed.scaleY=this.healthBarMax.scaleY,this.healthBarCurr.scaleY=this.healthBarMax.scaleY-1.5,PhaserScene.tweens.add({targets:[this.healthBarMax,this.healthBarRed],scaleY:this.healthBarMax.startScaleY,ease:"Quad.easeIn",duration:700*gameVars.gameManualSlowSpeedInverse}),PhaserScene.tweens.add({targets:this.healthBarCurr,scaleY:this.healthBarMax.startScaleY-2,ease:"Quad.easeIn",duration:700*gameVars.gameManualSlowSpeedInverse}),this.healthBarText.setScale(1.4),PhaserScene.tweens.add({targets:this.healthBarText,scaleX:1,scaleY:1,ease:"Cubic.easeOut",duration:500*gameVars.gameManualSlowSpeedInverse})),this.healthBarFlash.scaleX=this.healthBarCurr.scaleX+2,0===this.healthBarCurr.scaleX&&(this.healthBarFlash.scaleX=0),this.healthBarFlash.scaleY=this.healthBarMax.scaleY,this.healthBarFlash.alpha=1+.2*t,this.healthBarFlashTween&&this.healthBarFlashTween.stop(),this.healthBarFlashTween=PhaserScene.tweens.add({delay:50,targets:this.healthBarFlash,alpha:0,ease:"Quad.easeOut",duration:500*gameVars.gameManualSlowSpeedInverse*t+150}),this.healthBarRedTween&&this.healthBarRedTween.stop(),this.healthBarRedTween=PhaserScene.tweens.add({targets:this.healthBarRed,delay:50,alpha:0,ease:"Cubic.easeOut",duration:550*gameVars.gameManualSlowSpeedInverse*t+100}))}updateHealthBar(e,t){var a;this.isDestroyed||(this.health<=0?(this.flashHealthChange(this.healthBarCurr.scaleX,2),this.healthBarCurr.scaleX=0):(a=1+this.healthBarLengthMax*this.health/this.healthMax,4<=t?13<=t?this.flashHealthChange(this.healthBarCurr.scaleX,1.1):this.flashHealthChange(this.healthBarCurr.scaleX):0<t&&this.flashHealthChange(this.healthBarCurr.scaleX,.4),this.healthBarCurr.scaleX=a),this.healthBarText.setText(this.health))}takeTrueDamage(t,a=!0,s=0,i,h){if(!globalObjects.player.isDead()&&!this.delayLoad){i&&cheats.extraDmg&&(t*=2),i&&cheats.extraExtraDmg&&(t*=2);i=this.health;let e=this.adjustDamageTaken(t,a,!0);this.specialDamageAbsorptionActive&&(e=this.handleSpecialDamageAbsorption(e)),this.setHealth(Math.max(0,this.health-e),!0);t=i-this.health;this.reactToDamageTypes(t,a,h),0<t&&(this.animateShake(),i=.1*-e+s,this.animateDamageNum(t,!0,i),a)&&(this.timeSinceLastAttacked=0),this.health<=0&&this.die()}}setHealth(e,t){this.prevHealth=this.health,this.health=e;e=this.prevHealth-e;this.updateHealthBar(void 0,e)}getHealth(){return this.health}takeDamagePercent(e,t=0,a){var s=this.health-this.accumulatedTimeDamage,e=Math.ceil(.01*e*s)+t;this.takeDamage(e,void 0,void 0,a)}takeDamagePercentTotal(e,t=0){var a=this.healthMax,e=Math.ceil(e*a)+t;this.takeDamage(e)}setAsleep(){this.isDestroyed||(this.isAsleep=!0,this.isUsingAttack=!1,this.chargeBarWarningBig.visible=!1,this.chargeBarAngry.visible=!1,this.chargeBarWarning.visible=!1,this.attackDarken.visible=!1,this.hideAngrySymbol(),PhaserScene.tweens.add({targets:[this.chargeBarCurr],alpha:0,duration:400*gameVars.gameManualSlowSpeedInverse}),this.chargeBarEst1.visible=!1,this.chargeBarEst2.visible=!1,this.addTween({targets:[this.chargeVertical,this.chargeVertical2],alpha:0,duration:500,ease:"Cubic.easeOut"}),PhaserScene.tweens.add({targets:[this.chargeBarMax,this.chargeBarCurr,this.chargeBarOutline],scaleX:0,ease:"Cubic.easeOut",duration:400*gameVars.gameManualSlowSpeedInverse}),this.attackName&&(this.attackName.visible=!1,this.attackGlow.visible=!1))}setAwake(){this.isDestroyed||(this.chargeBarAngry.scaleX=0,this.chargeBarWarning.scaleX=0,this.castAggravateCharge+=20,this.isAsleep=!1,this.attackName&&(this.attackName.visible=!0),this.chargeBarEst1.visible=!0,this.chargeBarEst2.visible=!0,this.attackPaused=!1,this.unhideCurrentAttack())}hideAngrySymbol(){this.isDestroyed||this.angrySymbolIsHiding||(this.angrySymbolIsHiding=!0,this.angrySymbolAnim&&this.angrySymbolAnim.stop(),this.angrySymbolAnim=PhaserScene.tweens.add({targets:[this.angrySymbol],scaleX:0,scaleY:0,ease:"Cubic.easeIn",duration:200*gameVars.gameManualSlowSpeedInverse,onComplete:()=>{this.angrySymbol.visible=!1}}))}showAngrySymbol(e){this.isDestroyed||(this.angrySymbol.currAnim!==e&&(this.angrySymbol.currAnim=e,this.angrySymbol.play(e)),this.angrySymbolIsHiding&&(this.angrySymbolIsHiding=!1,this.angrySymbolAnim&&this.angrySymbolAnim.stop(),this.angrySymbolAnim="angry"===e||"angrybone"===e?this.scene.tweens.add({targets:this.angrySymbol,scaleX:2.2,scaleY:2.2,rotation:.17,duration:125*gameVars.gameManualSlowSpeedInverse,ease:"Quint.easeOut",onComplete:()=>{this.angrySymbolAnim=this.scene.tweens.add({targets:this.angrySymbol,rotation:0,scaleX:.85,scaleY:.85,duration:215*gameVars.gameManualSlowSpeedInverse,ease:"Back.easeOut"})}}):this.scene.tweens.add({targets:this.angrySymbol,scaleX:.85,scaleY:.85,duration:200*gameVars.gameManualSlowSpeedInverse,ease:"Back.easeOut"}),this.angrySymbol.visible=!0))}playerDied(){if(!this.dead&&!this.isDestroyed){this.bgMusic&&fadeAwaySound(this.bgMusic,350),this.bgMusic2&&fadeAwaySound(this.bgMusic2,350),this.bgMusic3&&fadeAwaySound(this.bgMusic3,350),this.tutorialButton&&this.tutorialButton.destroy(),this.setAsleep();for(let e=0;e<this.subscriptions.length;e++)this.subscriptions[e].unsubscribe();this.subscriptions=[]}}cleanUp(){}destroy(){if(!this.isDestroyed){this.dead=!0,this.isDestroyed=!0,this.clearEffects(),this.cleanUp();var e=getBackgroundBlackout2();this.addTween({targets:e,duration:500,alpha:0}),this.attackName.currAnim&&this.attackName.currAnim.stop(),this.attackGlow.currAnim&&this.attackGlow.currAnim.stop(),this.attackDarken.currAnim&&this.attackDarken.currAnim.stop(),globalObjects.textPopupManager.hideInfoText(),messageBus.publish("closeCombatText");for(let e=0;e<this.destructibles.length;e++)this.destructibles[e]&&this.destructibles[e].destroy();this.bgMusic&&fadeAwaySound(this.bgMusic,200),this.bgMusic2&&fadeAwaySound(this.bgMusic2,200),this.bgMusic3&&fadeAwaySound(this.bgMusic3,200),this.popupTimeout&&clearTimeout(this.popupTimeout),this.healthBarMax.destroy(),this.healthBarCurr.destroy(),this.healthBarText.destroy(),this.chargeBarWarningBig.destroy(),this.chargeBarMax.destroy(),this.chargeBarOutline.destroy(),this.chargeBarWarning.destroy(),this.chargeBarAngry.destroy(),this.chargeBarCurr.destroy(),this.attackGlow.destroy(),this.attackDarken.destroy(),this.attackNameHighlight.destroy(),this.chargeVertical.destroy(),this.chargeVertical2.destroy(),this.chargeBarEst1.currAnim&&(this.chargeBarEst1.currAnim.stop(),this.chargeBarEst1.currAnim=null),this.chargeBarEst1.destroy(),this.chargeBarEst2.destroy(),this.voidPause.destroy(),this.attackName.destroy(),this.angrySymbol.destroy(),this.chargeBarFlash1.destroy(),this.chargeBarFlash2.destroy(),this.sprite.destroy(),this.delayedDamageText.destroy(),this.shieldSprite.destroy(),this.shieldText.destroy();for(let e=0;e<this.subscriptions.length;e++)this.subscriptions[e].unsubscribe();this.subscriptions=[],updateManager.removeFunction(this.boundUpdateFunc)}}addToDestructibles(e){this.destructibles.push(e)}die(){if(!this.dead){this.dead=!0,this.tutorialButton&&this.tutorialButton.destroy(),this.bgMusic&&this.bgMusic.stop(),this.bgMusic3&&this.bgMusic3.stop(),this.breatheTween&&this.breatheTween.stop(),this.attackGlow&&(this.attackGlow.currAnim&&this.attackGlow.currAnim.stop(),this.attackGlow.visible=!1,this.attackGlow.y=-100),this.attackDarken&&(this.attackDarken.currAnim&&this.attackDarken.currAnim.stop(),this.attackDarken.visible=!1),messageBus.publish("closeCombatText"),this.clearEffects(),this.sprite.setScale(this.sprite.startScale),globalObjects.magicCircle.setTimeSlowRatio(1),this.flashHealthChange(this.healthBarCurr.scaleX,2),this.healthBarCurr.scaleX=0,this.healthBarText.setText("0");for(let e=0;e<this.subscriptions.length;e++)this.subscriptions[e].unsubscribe();for(var e in this.subscriptions=[],this.attackAnim&&(this.attackAnim.stop(),this.sprite.setScale(this.sprite.startScale)),this.animateShake(3),this.chargeBarWarningBig.visible=!1,this.chargeBarWarningBig.scaleY=100,this.chargeBarWarning.visible=!1,this.chargeBarWarning.scaleY=100,this.chargeBarAngry.visible=!1,this.chargeBarAngry.scaleY=100,this.chargeBarCurr.visible=!1,this.chargeBarCurr.scaleY=100,this.chargeBarEst1.visible=!1,this.chargeBarEst2.visible=!1,this.hideAngrySymbol(),this.voidPause.visible=!1,this.chargeVertical.visible=!1,this.chargeVertical2.visible=!1,this.attackName.visible=!1,this.attackGlow.visible=!1,this.attackDarken.visible=!1,messageBus.publish("enemyHasDied"),this.statuses){var t=this.statuses[e];null!=t&&(t.cleanUp(this.statuses),delete this.statuses[e])}this.sprite.x-=5,PhaserScene.tweens.add({delay:0,targets:[this.sprite],x:"+=8",ease:"Cubic.easeOut",duration:50*gameVars.gameManualSlowSpeedInverse,onStart:()=>{PhaserScene.tweens.add({targets:[this.sprite],x:"-=5",ease:"Cubic.easeInOut",duration:70*gameVars.gameManualSlowSpeedInverse,onStart:()=>{PhaserScene.tweens.add({targets:[this.sprite],x:"+=2",duration:50*gameVars.gameManualSlowSpeedInverse})}})}}),this.sprite.setScale(this.sprite.startScale),PhaserScene.time.delayedCall(750,()=>{PhaserScene.tweens.add({targets:[this.chargeBarCurr],scaleX:0,ease:"Cubic.easeOut",duration:400*gameVars.gameManualSlowSpeedInverse,onComplete:()=>{PhaserScene.tweens.add({targets:[this.chargeBarMax,this.chargeBarOutline],scaleX:0,ease:"Cubic.easeOut",duration:400*gameVars.gameManualSlowSpeedInverse,onComplete:()=>{PhaserScene.tweens.add({targets:[this.healthBarMax],scaleX:0,duration:1e3*gameVars.gameManualSlowSpeedInverse}),PhaserScene.tweens.add({delay:400,targets:[this.healthBarText],alpha:0,duration:300*gameVars.gameManualSlowSpeedInverse})}})}})})}}animateShake(s=1){if(!this.disableAnimateShake){this.sprite.x-=4,s<=1?this.sprite.setTint(16759739):s<1.25?this.sprite.setTint(16742263):this.sprite.setTint(16711680),PhaserScene.time.delayedCall(50+20*s,()=>{this.sprite.clearTint()});let a=2-gameVars.timeSlowRatio;PhaserScene.tweens.add({targets:this.sprite,x:this.x+3*s,ease:"Quad.easeOut",duration:100*gameVars.gameManualSlowSpeedInverse*a,onComplete:()=>{PhaserScene.tweens.add({targets:this.sprite,x:this.x-2*s,ease:"Cubic.easeInOut",duration:100*gameVars.gameManualSlowSpeedInverse*a,onComplete:()=>{PhaserScene.tweens.add({targets:this.sprite,x:this.x,ease:"Cubic.easeInOut",duration:60*gameVars.gameManualSlowSpeedInverse*a})}})}});for(let t=0;t<this.extraSprites.length;t++){let e=this.extraSprites[t];e.x-=4,PhaserScene.tweens.add({targets:e,x:this.x+3*s+e.startOffsetX,ease:"Quad.easeOut",duration:100*gameVars.gameManualSlowSpeedInverse*a,onComplete:()=>{PhaserScene.tweens.add({targets:e,x:this.x-2*s+e.startOffsetX,ease:"Cubic.easeInOut",duration:100*gameVars.gameManualSlowSpeedInverse*a,onComplete:()=>{PhaserScene.tweens.add({targets:e,x:this.x+e.startOffsetX,ease:"Cubic.easeInOut",duration:60*gameVars.gameManualSlowSpeedInverse*a})}})}})}}}animateDamageNum(e,t=!1,a=0){var s=Date.now(),i=s-this.timeWhenLastDamageTaken;let h=0,r=0;i<1500&&(h=(Math.random()-.5)*(1500-i)*.06,r=(Math.random()-.5)*(1500-i)*.03),0<a&&(h*=1/(a+1),r*=1/(a+1)),this.timeWhenLastDamageTaken=s;i=.5+.2*Math.sqrt(e);t?messageBus.publish("animateTrueDamageNum",gameConsts.halfWidth+h,100+r+a,"-"+e,i):messageBus.publish("animateDamageNumAccumulate",e,a)}initAttacks(){this.attacks=[[{name:"Hit",nameDetail:"Hit - 3 damage",chargeAmt:250,damage:3},{name:"Hit 2",nameDetail:"Hit 5 damage",chargeAmt:350,damage:5},{name:"Hit 3",nameDetail:"Hit 20 damage",chargeAmt:600,damage:20}]]}interruptCurrentAttack(){this.attackCharge=0,this.attackCooldown=this.delayBetweenAttacks,this.chargeBarCurr.alpha=1,this.attackName.setText(" "),this.isUsingAttack=!1,this.attackAnim&&this.attackAnim.stop(),this.sprite.setScale(this.sprite.startScale)}hideCurrentAttack(){this.chargeBarCurr.x=-999,this.hideAngrySymbol(),this.attackName.x=-999,this.chargeBarWarning.x=-999,this.chargeBarAngry.x=-999}unhideCurrentAttack(){this.chargeBarCurr.x=gameConsts.halfWidth,this.attackName.x=gameConsts.halfWidth,this.chargeBarWarning.x=gameConsts.halfWidth,this.chargeBarAngry.x=gameConsts.halfWidth}setNextAttack(e,t=0){this.currentAttackSetIndex=e,this.nextAttackIndex=t}showFlash(e,t){this.flash=this.scene.add.sprite(e,t,"blurry","flash.webp").setOrigin(.5,.5).setScale(.5).setDepth(999),PhaserScene.tweens.add({targets:this.flash,rotation:2,scaleX:1.25,scaleY:1.25,ease:"Quad.easeIn",duration:600*gameVars.gameManualSlowSpeedInverse,onComplete:()=>{PhaserScene.tweens.add({targets:this.flash,rotation:4,scaleX:0,scaleY:0,duration:600*gameVars.gameManualSlowSpeedInverse,ease:"Quad.easeOut",onComplete:()=>{this.flash.destroy()}})}})}showVictory(e){sdkGameplayStop(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton(),globalObjects.magicCircle.disableMovement();let t=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-35,"misc","victory_banner.png").setScale(100,1.2).setDepth(9998).setAlpha(0),a=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-44,"misc","victory_text.png").setScale(.95).setDepth(9998).setAlpha(0),s=this.scene.add.text(gameConsts.halfWidth,gameConsts.halfHeight+2,getLangText("cont_ui"),{fontFamily:"Verdana",color:"#F0F0F0",fontSize:18}).setAlpha(0).setOrigin(.5,.5).setAlign("center").setDepth(9998);swirlInReaperFog(),PhaserScene.tweens.add({targets:t,alpha:.75,duration:500*gameVars.gameManualSlowSpeedInverse}),PhaserScene.tweens.add({targets:[a],alpha:1,ease:"Quad.easeOut",duration:500*gameVars.gameManualSlowSpeedInverse}),playSound("victory"),setTimeout(()=>{s.alpha=1},1e3),PhaserScene.tweens.add({targets:a,scaleX:1,scaleY:1,duration:800*gameVars.gameManualSlowSpeedInverse}),PhaserScene.tweens.add({targets:e,y:gameConsts.halfHeight-110,ease:"Cubic.easeOut",duration:400*gameVars.gameManualSlowSpeedInverse,completeDelay:400,onComplete:()=>{this.dieClickBlocker?(canvas&&(canvas.style.cursor="pointer"),this.dieClickBlocker.setOnMouseUpFunc(()=>{canvas&&(canvas.style.cursor="default"),this.dieClickBlocker.destroy(),PhaserScene.tweens.add({targets:[a,t],alpha:0,duration:400*gameVars.gameManualSlowSpeedInverse,onComplete:()=>{a.destroy(),t.destroy(),playReaperAnim(this,this.customReaperAnim)}}),s.destroy(),PhaserScene.tweens.add({targets:e,y:"+=90",ease:"Quad.easeOut",duration:400*gameVars.gameManualSlowSpeedInverse,onComplete:()=>{e.destroy()}}),PhaserScene.tweens.add({targets:e,alpha:0,duration:400*gameVars.gameManualSlowSpeedInverse})})):createGlobalClickBlocker(!0).setOnMouseUpFunc(()=>{hideGlobalClickBlocker(),PhaserScene.tweens.add({targets:[a,t],alpha:0,duration:400*gameVars.gameManualSlowSpeedInverse,onComplete:()=>{a.destroy(),t.destroy(),playReaperAnim(this,this.customReaperAnim)}}),s.destroy(),PhaserScene.tweens.add({targets:e,y:"+=90",ease:"Quad.easeOut",duration:400*gameVars.gameManualSlowSpeedInverse,onComplete:()=>{e.destroy()}}),PhaserScene.tweens.add({targets:e,alpha:0,duration:400*gameVars.gameManualSlowSpeedInverse})})}})}launchAttack(l=1,o,d,c=[],u=!1,p=0,g=!1){if(!this.dead&&!this.isDestroyed){this.isUsingAttack=!0;let i,h=(this.nextAttack.isPassive||(i=getBackgroundBlackout2(),this.addTween({targets:i,duration:400,alpha:.12,ease:"Quad.easeInOut"})),(2-gameVars.timeSlowRatio)*this.attackSlownessMult);this.nextAttack.attackStartFunction&&this.nextAttack.attackStartFunction();var t=this.pullbackScale*this.sprite.startScale,a=Math.sqrt(10*Math.abs(this.pullbackScale-this.pullbackScaleDefault))+1;a*=this.pullbackDurMult||1;let r=gameVars.timeSlowRatio<.9?.5:1;a=u?200*h*a+this.extraRepeatDelay:300*h*a;if(o){let e=o;Array.isArray(o)&&(void 0===this.sprite.prepareNum?this.sprite.prepareNum=0:this.sprite.prepareNum=(this.sprite.prepareNum+1)%o.length,e=o[this.sprite.prepareNum]),u?PhaserScene.time.delayedCall(gameVars.gameManualSlowSpeedInverse*a*this.pullbackHoldRatio,()=>{this.setSpriteIfNotInactive(e,this.sprite.startScale,!0)}):this.pullbackInitialDelay?PhaserScene.time.delayedCall(this.pullbackInitialDelay,()=>{this.setSpriteIfNotInactive(e,this.sprite.startScale,!0)}):this.setSpriteIfNotInactive(e,this.sprite.startScale,!0)}let n=g?0:1,e=this.customInitialPullback||"Cubic.easeOut";u&&(e=this.customRepeatPullback||e),this.attackAnim=this.scene.tweens.add({targets:this.sprite,scaleX:t,scaleY:t,rotation:0,duration:gameVars.gameManualSlowSpeedInverse*a*r*n,ease:e,onComplete:()=>{var e,t,a,s;this.dead||this.isDestroyed||(e=(u?150*h:175*h)*this.attackDurMult,t=this.attackScale*this.sprite.startScale,e+=Math.floor(200*this.attackScale),d&&0<d.length&&(a=this.sprite.originX,s=this.sprite.originY,this.sprite.setFrame(d).setOrigin(a,s)),this.attackAnim=this.scene.tweens.add({targets:this.sprite,scaleX:t,scaleY:t,duration:gameVars.gameManualSlowSpeedInverse*e*n*r,rotation:0,ease:this.attackEase||"Cubic.easeIn",onComplete:()=>{this.dead||this.isDestroyed||(u||messageBus.publish("enemyMadeAttack",this.nextAttack.damage),this.dead)||this.isDestroyed||(0<c.length&&(void 0===this.sprite.attackNum?this.sprite.attackNum=0:this.sprite.attackNum=(this.sprite.attackNum+1)%c.length,this.setSpriteIfNotInactive(c[this.sprite.attackNum],this.sprite.startScale,void 0,10)),0<this.health&&(0<this.nextAttack.damage&&messageBus.publish("selfTakeDamage",this.nextAttack.damage),this.nextAttack.message&&messageBus.publish(this.nextAttack.message,this.nextAttack.messageDetail),this.nextAttack.attackFinishFunction)&&this.nextAttack.attackFinishFunction(),1<l?this.launchAttack(l-1,o,d,c,!0,p,g):(this.attackAnim=this.scene.tweens.add({targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,rotation:0,duration:500*gameVars.gameManualSlowSpeedInverse*h*r*n,ease:this.returnEase||"Cubic.easeInOut"}),PhaserScene.time.delayedCall(p,()=>{this.isUsingAttack=!1}),PhaserScene.time.delayedCall(400*h*this.lastAttackLingerMult+100,()=>{this.sprite.attackNum=0,this.sprite.prepareNum=0,this.attackDurMult=1,i&&this.addTween({targets:i,duration:500,alpha:0}),this.dead||this.isDestroyed||(this.setSpriteIfNotInactive(this.defaultSprite,void 0,!0),this.nextAttack.finaleFunction&&this.nextAttack.finaleFunction())})))}}))}})}}getMaxHealth(){return this.healthMax}addSprite(e,t,a,s){e=this.scene.add.sprite(e,t,a,s);return this.addToDestructibles(e),e}addImage(e,t,a,s){e=this.scene.add.image(e,t,a,s);return this.addToDestructibles(e),e}addTween(t){if(t.onStart){let e=t.onStart;t.onStart=()=>{this.isDestroyed||e()}}if(t.onComplete){let e=t.onComplete;t.onComplete=()=>{this.isDestroyed||e()}}var e=PhaserScene.tweens.add(t);return(-1===t.repeat||20<t.repeat)&&this.addToDestructibles(e),e}addText(e,t,a,s,i){e=this.scene.add.text(e,t,a,s,i);return this.addToDestructibles(e),e}addSubscription(e,t,a){e=messageBus.subscribe(e,t,a);return this.subscriptions.push(e),e}addTimeout(e,t){return this.isDestroyed?setTimeout(()=>{},0):setTimeout(()=>{this.isDestroyed||e()},gameVars.gameManualSlowSpeedInverse*t)}addTimeoutIfAlive(e,t){return this.isDestroyed||this.dead?setTimeout(()=>{},0):setTimeout(()=>{this.isDestroyed||this.dead||e()},gameVars.gameManualSlowSpeedInverse*t)}addBitmapText(e,t,a,s,i,h,r,n){e=PhaserScene.add.bitmapText(e,t,a,s,i,h,r,n);return this.addToDestructibles(e),e}addDelay(e,t){return this.addDelayedCall(t,e)}addDelayIfAlive(e,t){return this.isDestroyed||this.dead?PhaserScene.time.delayedCall(0,()=>{}):PhaserScene.time.delayedCall(gameVars.gameManualSlowSpeedInverse*t,()=>{this.isDestroyed||this.dead||e()})}addDelayedCall(e,t){return this.isDestroyed?PhaserScene.time.delayedCall(0,()=>{}):PhaserScene.time.delayedCall(gameVars.gameManualSlowSpeedInverse*e,()=>{this.isDestroyed||t()})}updateStatuses(){if(!this.dead)for(var e in this.statuses){var t=this.statuses[e];null!=t&&(t.duration<=0&&(t.cleanUp(this.statuses),delete this.statuses[e]),t.onUpdate&&t.onUpdate(),t.duration--,t.duration<=0)&&(t.cleanUp(this.statuses),delete this.statuses[e])}}heal(e){this.health=Math.min(this.healthMax,this.health+e),this.prevHealth=this.health,this.updateHealthBar(!0)}setMaxHealth(e){this.healthMax=e,this.updateHealthBar(!0)}playerClickedSpell(){this.castAggravateCharge=cheats.calmEnemies?16:20,challenges.angryEnemies&&(this.castAggravateCharge=24)}addCastAggravate(e){this.castAggravateCharge+=e}setPredictScale(e=8.3){this.lastChargeEstScale!=this.chargeBarEstScale&&(this.lastChargeEstScale=this.chargeBarEstScale,this.chargeBarEst1.currAnim)&&(this.chargeBarEst1.currAnim.stop(),this.chargeBarEst1.alpha=.6,this.chargeBarEst2.alpha=.6,this.chargeBarEst1.currAnim=PhaserScene.tweens.add({delay:250,targets:[this.chargeBarEst1,this.chargeBarEst2],duration:1250,alpha:.08,onComplete:()=>{this.chargeBarEst1.currAnim=PhaserScene.tweens.add({delay:250,targets:[this.chargeBarEst1,this.chargeBarEst2],duration:1250,alpha:.39,yoyo:!0,repeat:-1})}})),this.chargeBarEstScale=e}}function createEnemy(e){switch(globalObjects.currentEnemy&&globalObjects.currentEnemy.destroy(),e){case-7:case-6:case-5:case-4:globalObjects.currentEnemy=new Dummytime(PhaserScene,gameConsts.halfWidth,310,e);break;case-3:globalObjects.currentEnemy=new Dummybody(PhaserScene,gameConsts.halfWidth,310,e);break;case-2:globalObjects.currentEnemy=new Dummyshield(PhaserScene,gameConsts.halfWidth,310,e);break;case-1:globalObjects.currentEnemy=new Dummymind(PhaserScene,gameConsts.halfWidth,310,e);break;case 0:globalObjects.currentEnemy=new LesserDummy(PhaserScene,gameConsts.halfWidth,329,e);break;case 1:globalObjects.currentEnemy=new Dummy(PhaserScene,gameConsts.halfWidth,125,e);break;case 2:globalObjects.currentEnemy=new Goblin(PhaserScene,gameConsts.halfWidth,182,e);break;case 3:globalObjects.currentEnemy=new Tree(PhaserScene,gameConsts.halfWidth,isMobile?310:308,e);break;case 4:globalObjects.currentEnemy=new Magician(PhaserScene,gameConsts.halfWidth,171,e);break;case 5:globalObjects.currentEnemy=new Statue(PhaserScene,gameConsts.halfWidth+7,260,e);break;case 6:globalObjects.currentEnemy=new Knight(PhaserScene,gameConsts.halfWidth,163,e);break;case 7:case 8:case 9:case 10:globalObjects.currentEnemy=new KillerRobotDemo(PhaserScene,gameConsts.halfWidth,158,e);break;default:globalObjects.currentEnemy=new Goblin(PhaserScene,gameConsts.halfWidth,185)}sdkGameplayStart()}class Dummy extends Enemy{constructor(e,t,a,s){super(e,t,a,s),this.initSprite("dummy.png",.95,0,5,"dummyenemy"),globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),this.initTutorial()}initStatsCustom(){this.health=gameVars.isHardMode?80:70,this.isAsleep=!0,this.pullbackScale=.78,this.attackScale=1.25,this.extrasOnDie=[],this.finalArms=[]}initSpriteAnim(e){let t=this.sprite.y;var a=.425*this.sprite.height;this.sprite.setScale(.9*e,.9*e),this.sprite.setOrigin(.5,.95),this.delayLoad||this.addTween({targets:this.sprite,duration:240,y:t+a,ease:"Cubic.easeIn",scaleX:.85*e,scaleY:1.01*e,alpha:1,onComplete:()=>{playSound("balloon",.3).detune=-800,this.addTween({targets:this.sprite,duration:200,ease:"Cubic.easeOut",scaleX:1.1*e,scaleY:.85*e,onComplete:()=>{this.addTween({targets:this.sprite,duration:250,ease:"Back.easeOut",scaleX:e,scaleY:e,onComplete:()=>{this.sprite.setOrigin(.5,.5).setPosition(this.sprite.x,t)}})}})}})}initTutorial(){gameVars.latestLevel=this.level-1,sdkSetItem("latestLevel",gameVars.latestLevel.toString()),gameVars.maxLevel=Math.max(gameVars.maxLevel,this.level),sdkSetItem("maxLevel",gameVars.maxLevel.toString()),this.bgMusic=playMusic("bite_down_simplified",.65,!0),globalObjects.magicCircle.disableMovement(),globalObjects.bannerTextManager.setDialog([getLangText("level1_diag_b")]),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.height-130,0),globalObjects.bannerTextManager.showBanner(!1),globalObjects.bannerTextManager.setOnFinishFunc(()=>{globalObjects.bannerTextManager.setOnFinishFunc(()=>{}),globalObjects.bannerTextManager.closeBanner(),globalObjects.magicCircle.enableMovement(),this.shadow=this.addImage(globalObjects.player.getX(),globalObjects.player.getY()-1,"misc","shadow_circle.png").setScale(14).setDepth(9999).setAlpha(0),this.shadowSmall=this.addImage(gameConsts.halfWidth,globalObjects.player.getY(),"circle","greyed.png").setAlpha(.05).setDepth(104).setScale(.71),this.shadow.currAnim=this.addTween({targets:[this.shadow],alpha:.55,duration:500,scaleX:13.7,scaleY:13.7,onComplete:()=>{this.shadow.currAnim=this.addTween({targets:[this.shadow],alpha:.25,y:globalObjects.player.getY()-50,ease:"Quart.easeInOut",duration:2800,scaleX:15.7,scaleY:15.7})}}),this.shadowSmall.currAnim=this.addTween({targets:[this.shadowSmall],alpha:.75,ease:"Back.easeOut",duration:750,easeParams:[2]}),this.glowCirc2=this.addSprite(gameConsts.halfWidth,globalObjects.player.getY(),"shields","ring_flash0.png").setAlpha(.3).setDepth(999).setScale(2),this.addDelay(()=>{this.glowCirc2.playReverse("ring_flash"),this.glowCirc2.currAnim=this.addTween({targets:this.glowCirc2,alpha:1,ease:"Cubic.easeOut",duration:150,completeDelay:1e3,onComplete:()=>{this.glowCirc2.currAnim=this.addTween({targets:this.glowCirc2,alpha:.3,ease:"Cubic.easeIn",duration:150,onComplete:()=>{this.glowCirc2.currAnim=this.addTween({targets:this.glowCirc2,alpha:1,ease:"Cubic.easeOut",duration:150}),this.glowCirc2.play("ring_flash")}})}})},400),globalObjects.textPopupManager.setInfoText(gameConsts.halfWidth,gameConsts.height-37,getLangText("level1_tut_z"),"center"),this.addTimeout(()=>{this.playerSpellCastSub=this.addSubscription("recordSpell",(e,t)=>{"matterEnhance"===e&&(this.playerSpellCastSub.unsubscribe(),this.playerSpellCastSub2.unsubscribe(),this.createEnhancePopup())}),this.playerSpellCastSub2=this.addSubscription("recordSpellAttack",(e,t)=>{2<=globalObjects.player.getPlayerCastSpellsCount()&&(this.playerSpellCastSub.unsubscribe(),this.playerSpellCastSub2.unsubscribe(),this.clearStartShadow())})},400)})}createEnhancePopup(){this.clearStartShadow(),globalObjects.textPopupManager.setInfoText(gameConsts.width,gameConsts.halfHeight-135,getLangText("level1_tut_a"),"right"),this.rune2=this.addSprite(globalObjects.textPopupManager.getCenterPos(),globalObjects.textPopupManager.getBoxBottomPos()+18,"circle","bright_rune_enhance.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.75).setAlpha(0),this.enhancePopupListener=this.addSubscription("recordSpell",(e,t)=>{this.firstEnhanceCast&&(this.enhancePopupListener.unsubscribe(),this.enhancePopupListener2.unsubscribe(),this.clearEnhancePopup(),this.enhancePopupListener=null,this.enhancePopupListener2=null),"matterEnhance"===e&&(this.firstEnhanceCast=!0)}),this.enhancePopupListener2=this.addSubscription("recordSpellAttack",(e,t)=>{this.firstEnhanceCast&&(this.enhancePopupListener.unsubscribe(),this.enhancePopupListener2.unsubscribe(),this.clearEnhancePopup(),this.enhancePopupListener=null,this.enhancePopupListener2=null)}),this.addTween({targets:[this.rune2],alpha:1,duration:200,completeDelay:200,onComplete:()=>{this.addTween({targets:[this.rune2],scaleX:1,scaleY:1,ease:"Quart.easeOut",duration:500,onComplete:()=>{this.addTween({targets:[this.rune2],scaleX:.82,scaleY:.82,ease:"Back.easeOut",duration:300})}})}})}clearStartShadow(){globalObjects.textPopupManager.hideInfoText(),this.shadow.currAnim&&this.shadow.currAnim.stop(),this.shadowSmall.currAnim&&this.shadowSmall.currAnim.stop(),this.glowCirc2.currAnim&&this.glowCirc2.currAnim.stop(),this.addTween({targets:[this.shadow,this.shadowSmall,this.glowCirc2],alpha:0,ease:"Cubic.easeOut",duration:500,onComplete:()=>{this.glowCirc2.visible=!1,this.shadow.visible=!1,this.shadowSmall.visible=!1}})}clearEnhancePopup(){this.rune2&&this.addTween({targets:[this.rune2],alpha:0,duration:300,onComplete:()=>{this.rune2.visible=!1}}),this.rune3&&this.addTween({targets:[this.rune3,this.rune4],alpha:0,ease:"Cubic.easeIn",duration:1300}),globalObjects.textPopupManager.hideInfoText()}tryInitTutorial4(){if(!this.dead&&!this.isAsleep&&!this.shownTut4){this.shownTut4=!0,this.timeSinceLastAttacked=-15,this.clearEnhancePopup(),globalObjects.textPopupManager.setInfoText(gameConsts.width,253,getLangText("level1_tut_b"),"right"),messageBus.publish("setSlowMult",.25,15);let t=this.addSprite(gameConsts.halfWidth,320,"misc","shadow_bar.png").setDepth(9980).setAlpha(0).setScale(7);this.addTween({targets:t,alpha:.4,scaleY:4.2,scaleX:5,ease:"Cubic.easeInOut",duration:800,onComplete:()=>{this.glowBarAnim=this.addTween({delay:2750,targets:t,alpha:0,scaleY:5.2,scaleX:6,ease:"Cubic.easeInOut",duration:1200})}}),this.addTimeout(()=>{let e=this.addSubscription("spellClicked",()=>{this.hasShownAttackWarning||(this.hasShownAttackWarning=!0,messageBus.publish("setSlowMult",.99,1),this.glowBarAnim&&this.glowBarAnim.stop(),this.addTween({targets:t,alpha:0,scaleY:5.2,scaleX:6,ease:"Quad.easeInOut",duration:1e3,onComplete:()=>{t.destroy()}})),e.unsubscribe(),this.addTimeout(()=>{globalObjects.textPopupManager.hideInfoText(),this.rune3&&this.addTween({targets:[this.rune3,this.rune4],alpha:0,ease:"Cubic.easeIn",duration:1300})},1200)});this.addTimeout(()=>{this.hasShownAttackWarning||(this.hasShownAttackWarning=!0,messageBus.publish("setSlowMult",.99,1),this.glowBarAnim&&this.glowBarAnim.stop(),this.addTween({targets:t,alpha:0,scaleY:5.2,scaleX:6,ease:"Quad.easeInOut",duration:1e3,onComplete:()=>{t.destroy()}}))},4500)},1500)}}tryInitTutorial5(){var e;this.dead||this.isAsleep||this.shownTut5||(this.shownTut5=!0,globalObjects.textPopupManager.setInfoText(gameConsts.width,262,getLangText("level1_tut_c"),"right"),e="zh_cn"===language||"zh_tw"===language?globalObjects.textPopupManager.getBoxCenterPos()+24:globalObjects.textPopupManager.getBoxCenterPos()+25,this.rune3=this.addSprite(globalObjects.textPopupManager.getCenterPos()-24,e,"circle","bright_rune_enhance.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.75).setAlpha(0),this.rune4=this.addSprite(globalObjects.textPopupManager.getCenterPos()+24,e,"circle","bright_rune_enhance.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.75).setAlpha(0),this.addTween({targets:[this.rune3,this.rune4],alpha:1,duration:200,completeDelay:200,onComplete:()=>{this.addTween({targets:[this.rune3,this.rune4],scaleX:1,scaleY:1,ease:"Quart.easeOut",duration:500,onComplete:()=>{this.addTween({targets:[this.rune3,this.rune4],scaleX:.82,scaleY:.82,ease:"Back.easeOut",duration:300})}})}}),this.addTimeout(()=>{let e=this.addSubscription("spellClicked",()=>{e.unsubscribe(),this.addTween({targets:[this.rune3,this.rune4],alpha:0,ease:"Cubic.easeIn",duration:1300}),this.addTimeout(()=>{globalObjects.textPopupManager.hideInfoText()},1200)})},1500))}setHealth(e){super.setHealth(e);var t,a,e=this.prevHealth/this.healthMax,s=this.health/this.healthMax;if(0!=s&&(s<=.5&&this.fighting&&!this.tilted&&(this.tilted=!0,this.setDefaultSprite("dummy_angry_tilted.png",null,!0),t=this.addImage(this.sprite.x+10,this.sprite.y-10,"enemies","dizzystar.png").setRotation(3*Math.random()).setScale(.7),a=this.addImage(this.sprite.x+10,this.sprite.y-5,"enemies","dizzystar.png").setRotation(3*Math.random()).setScale(1.1),this.addTween({targets:t,x:"+=55",y:"-=60",ease:"Quart.easeOut",duration:700}),this.addTween({targets:t,scaleX:0,scaleY:0,ease:"Quad.easeIn",duration:700}),this.addTween({targets:t,rotation:"-=5",duration:700}),this.addTween({targets:a,x:"+=110",y:"-=5",ease:"Quart.easeOut",duration:850}),this.addTween({targets:a,scaleX:0,scaleY:0,ease:"Quad.easeIn",duration:850}),this.addTween({targets:a,rotation:"+=5.5",duration:850})),this.canAngryEyes&&!this.angryEyes&&s<.999&&(this.angryEyes=!0,this.flash=this.addImage(this.x+3,this.y-50,"blurry","flash.webp").setOrigin(.5,.5).setScale(.9*this.sprite.startScale).setDepth(-1).setRotation(.2),fadeAwaySound(this.bgMusic,200),this.addTween({targets:this.flash,scaleX:3.5*this.sprite.startScale,scaleY:.05*this.sprite.startScale,duration:300,onStart:()=>{}}),this.addTween({targets:this.flash,duration:300,ease:"Quad.easeIn",alpha:0,onComplete:()=>{this.flash.destroy()}}),this.currAnim=this.addTween({delay:350,targets:this.sprite,scaleX:this.sprite.startScale+.24,scaleY:this.sprite.startScale+.24,duration:580,completeDelay:20,ease:"Quart.easeOut",onComplete:()=>{this.currAnim=this.addTween({targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,duration:350,ease:"Quart.easeIn",onComplete:()=>{zoomTemp(1.03),playSound("punch"),this.bgMusic=playSound("bite_down",.75,!0,!0),this.setAwake(),this.currentAttackSetIndex=0,this.nextAttackIndex=0,this.brows=this.addImage(this.x,this.y-32,"dummyenemy","dummybrows.png").setOrigin(.5,1.15).setScale(1.5*this.sprite.startScale).setDepth(99),this.addTween({targets:this.brows,scaleX:2.2*this.sprite.startScale,scaleY:2.2*this.sprite.startScale,ease:"Quart.easeOut",duration:200,onComplete:()=>{this.addTween({targets:this.brows,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,ease:"Quart.easeIn",duration:700,onComplete:()=>{this.addTimeout(()=>{this.tryInitTutorial4()},800),this.setDefaultSprite("dummy_angry.png",.95),this.brows.destroy(),this.brows=null,this.fighting=!0}})}}),this.snort=this.addImage(this.x-3,this.y-71,"dummyenemy","dummysnort.png").setOrigin(.5,-.05).setScale(.8*this.sprite.startScale).setDepth(99),this.destructibles.push(this.snort),this.addTween({targets:this.snort,scaleX:1.1*this.sprite.startScale,scaleY:1.1*this.sprite.startScale,duration:500,ease:"Cubic.easeOut"}),this.addTween({targets:this.snort,duration:500,alpha:0,ease:"Quad.easeIn"});var e=getTempPoolObject("spells","brickPattern2.png","brickPattern",1e3);e.setPosition(this.x,this.y).setScale(this.sprite.startScale+.25).setDepth(-1),this.addTween({targets:e,scaleX:.7*this.sprite.startScale,scaleY:.7*this.sprite.startScale,duration:1e3,easeParams:[.5],ease:"Back.easeIn"}),this.addTween({targets:e,alpha:0,ease:"Cubic.easeIn",duration:1e3})}})}})),.95<=e&&s<.95)){this.canAngryEyes=!0;let e=this.scene.add.sprite(this.x+35,this.y-52,"misc","angry1.png").play("angry").setScale(.3).setDepth(9999);this.addTween({targets:e,scaleX:.9,scaleY:.9,duration:300,easeParams:[3],ease:"Back.easeOut",onComplete:()=>{this.addTween({delay:1e3,targets:e,scaleX:0,scaleY:0,duration:300,ease:"Back.easeIn",onComplete:()=>{e.destroy()}})}}),this.eyes=this.addImage(this.x+1,this.y-41,"dummyenemy","dummyeyes.png").setOrigin(.5,.75).setScale(this.sprite.startScale,0),this.addExtraSprite(this.eyes,1,-40),this.addTween({targets:this.eyes,scaleY:this.sprite.startScale,ease:"Back.easeOut",duration:350,onComplete:()=>{this.setDefaultSprite("dummy_w_eyes.png",.95),this.eyes&&(this.removeExtraSprite(this.eyes),this.eyes.destroy(),this.eyes=null)}})}}die(){if(!this.dead){if(super.die(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton(),this.rune2&&this.rune2.destroy(),this.rune3&&(this.rune3.destroy(),this.rune4.destroy()),this.extrasOnDie)for(let e=0;e<this.extrasOnDie.length;e++)this.extrasOnDie[e].destroy();if(this.finalArms)for(let e=0;e<this.finalArms.length;e++)this.finalArms[e].destroy();this.spaceTween&&(this.spaceTween.stop(),this.spaceTween.destroy()),this.isUsingSpaceBG&&(switchBackgroundInstant("star_shatter.webp"),setTimeout(()=>{switchBackground("grass_bg.webp")},50)),this.eyesTween&&(this.eyesTween.stop(),this.eyesTween.destroy()),this.playerSpellCastSub&&(this.playerSpellCastSub.unsubscribe(),this.playerSpellCastSub2.unsubscribe()),this.playerSpellCastAny&&this.playerSpellCastAny.unsubscribe(),this.enhancePopupListener&&(this.enhancePopupListener.unsubscribe(),this.enhancePopupListener2.unsubscribe()),this.eyes&&(this.removeExtraSprite(this.eyes),this.eyes.destroy(),this.eyes=null),this.flash&&this.flash.destroy(),this.brows&&this.brows.destroy(),this.currAnim&&this.currAnim.stop(),this.glowHealth&&this.glowHealth.destroy(),this.currDummyAnim&&this.currDummyAnim.stop(),globalObjects.textPopupManager.hideInfoText(),this.x+=10,this.y+=this.sprite.height*this.sprite.scaleY*.45,this.sprite.y=this.y,this.sprite.setOrigin(.51,.96),this.dieClickBlocker=new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:gameConsts.halfHeight,alpha:.001,scaleX:1e3,scaleY:1e3},onMouseUp:()=>{}}),this.addTween({targets:this.sprite,rotation:-1.31,ease:"Cubic.easeIn",duration:1e3,onComplete:()=>{this.x-=80,this.y=262,this.sprite.y=this.y,this.addTween({targets:this.sprite,y:262,ease:"Cubic.easeOut",duration:100}),this.setSprite("dummy_broken.png",this.sprite.scaleX),this.sprite.setRotation(0),this.sprite.setOrigin(.85,.78),playSound("victory_2"),this.showFlash(this.x,this.y-75);let e=this.addImage(this.x,this.y-75,"tutorial","rune_energy_large.png").setScale(.5).setDepth(10001);this.addTween({targets:e,x:gameConsts.halfWidth,scaleX:1,scaleY:1,ease:"Cubic.easeOut",duration:1650,onComplete:()=>{this.showVictory(e)}})}})}}healAnim(e=25){this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:.82*this.sprite.startScale,scaleY:.82*this.sprite.startScale,rotation:-.2,x:gameConsts.halfWidth-19,y:this.sprite.startY+19,ease:"Quint.easeOut",duration:600,onComplete:()=>{this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:1.2*this.sprite.startScale,scaleY:1.2*this.sprite.startScale,rotation:.07,x:gameConsts.halfWidth+8,y:this.sprite.startY-15,ease:"Quart.easeIn",duration:550,onComplete:()=>{this.tilted=!1,this.setDefaultSprite("dummy_angry.png",null,!0),playSound("magic",.6),this.heal(e),messageBus.publish("animateHealNum",this.x,this.y+30,"+"+e,.5+.2*Math.sqrt(this.healthMax)),this.healSprite||(this.healSprite=this.addImage(gameConsts.halfWidth,this.y-90,"misc","heal.png").setScale(.9).setDepth(99).setAlpha(1)),this.healSprite.setAlpha(1).setPosition(gameConsts.halfWidth,this.y-90),this.scene.tweens.add({targets:this.healSprite,y:"-=30",duration:1e3}),this.scene.tweens.add({targets:this.healSprite,alpha:0,duration:1e3,ease:"Cubic.easeIn"}),this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,rotation:0,x:gameConsts.halfWidth,y:this.sprite.startY,easeParams:[2],ease:"Bounce.easeOut",duration:600})}})}})}initAttacks(){this.attacks=[[{name:gameVars.isHardMode?"}10 ":"}8 ",chargeAmt:410,damage:gameVars.isHardMode?10:8,attackFinishFunction:()=>{screenShake(5),zoomTemp(1.015);let e=this.addSprite(gameConsts.halfWidth-15,globalObjects.player.getY()-185,"spells","damageEffect3.png").setDepth(998).setScale(1.4);this.addTimeout(()=>{e.x+=30,e.y+=10,this.addTimeout(()=>{e.destroy()},150)},75),playSound("body_slam"),this.snort.setScale(.8*this.sprite.startScale).setAlpha(1),this.addTween({targets:this.snort,scaleX:1.1*this.sprite.startScale,scaleY:1.1*this.sprite.startScale,duration:400,ease:"Cubic.easeOut"}),this.addTween({targets:this.snort,duration:400,alpha:0,ease:"Quad.easeIn"})}},{name:"HEAL\\35",chargeAmt:315,damage:0,startFunction:()=>{this.addTimeout(()=>{this.tryInitTutorial5()},800)},finaleFunction:()=>{this.healAnim(35)}},{name:gameVars.isHardMode?";25":";20",chargeAmt:415,damage:gameVars.isHardMode?25:20,isBigMove:!0,attackFinishFunction:()=>{playSound("punch"),playSound("body_slam");let e=this.addSprite(gameConsts.halfWidth,globalObjects.player.getY()-120,"spells","brickPattern2.png").setDepth(998).setScale(.75);this.addTween({targets:e,rotation:1,alpha:0,duration:800,onComplete:()=>{e.destroy()}})}},{name:"HEAL\\20",chargeAmt:205,damage:0,finaleFunction:()=>{this.healAnim(20)}},{name:"ASCENSION",chargeAmt:600,damage:0,chargeMult:3.25,isBigMove:!0,startFunction:()=>{this.currentAttackSetIndex=1,this.nextAttackIndex=0},finaleFunction:()=>{globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton(),this.setAsleep(),this.interruptCurrentAttack(),fadeAwaySound(this.bgMusic,3500);let a=this.addImage(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setScale(500).setDepth(-5).setAlpha(0),s=this.addImage(gameConsts.halfWidth,this.sprite.y,"backgrounds","star.png").setDepth(5).setAlpha(0).setScale(2.2).setOrigin(.5,.53),h=this.addImage(this.sprite.x,this.sprite.y,"dummyenemy","dummy_ascended.png").setDepth(9).setAlpha(0).setScale(this.sprite.scaleX),i=this.addImage(this.sprite.x,this.sprite.y-27,"dummyenemy","scary_eyes2.png").setDepth(9).setAlpha(0).setScale(.5*this.sprite.scaleX).setOrigin(.5,.48);this.spaceTween=this.addTween({targets:s,rotation:"+=6.281",duration:22e3,repeat:1e3}),this.extrasOnDie.push(a),this.extrasOnDie.push(s),this.extrasOnDie.push(h),this.extrasOnDie.push(i),this.addTween({targets:[h],alpha:1,ease:"Quad.easeIn",duration:4e3}),fadeBackground(),this.addTween({targets:[a],alpha:1,duration:3850,ease:"Quad.easeInOut",onComplete:()=>{preloadImage("star_bg.webp"),a.setDepth(5),playFakeBGMusic("but_never_forgotten_metal_prelude"),this.addTween({delay:120,targets:[h],duration:600,scaleX:1.2,scaleY:1.2,ease:"Quint.easeOut",completeDelay:50,onComplete:()=>{this.addTween({targets:[h],duration:1250,scaleX:.62,scaleY:.62,ease:"Quint.easeIn",onComplete:()=>{var e,t;this.dead||(this.addTween({targets:[i],alpha:1,ease:"Cubic.easeOut",duration:150}),this.addTween({targets:[i],scaleX:2*this.sprite.scaleX,scaleY:2*this.sprite.scaleX,ease:"Quart.easeIn",duration:150,onComplete:()=>{this.addTween({targets:[i],scaleX:.75*this.sprite.scaleX,scaleY:.75*this.sprite.scaleX,ease:"Quint.easeOut",duration:400,onComplete:()=>{this.eyesTween=this.addTween({targets:[i],scaleX:.77*this.sprite.scaleX,scaleY:.77*this.sprite.scaleX,ease:"Cubic.easeIn",duration:1500,repeat:1e4,yoyo:!0})}})}}),this.addTween({targets:[h],duration:500,scaleX:.73,scaleY:.73,ease:"Quart.easeOut"}),a.setVisible(!0),s.setAlpha(1),this.isUsingSpaceBG=!0,switchBackgroundInstant("star_bg.webp"),preloadImage("star_shatter.webp"),this.bgMusic=playMusic("but_never_forgotten_metal",.93,!0),e=this.addImage(this.sprite.x,this.sprite.y,"blurry","black_pulse.png").setDepth(5).setAlpha(1).setScale(0),this.addTween({targets:e,scaleX:8,scaleY:8,rotation:"+=10",ease:"Quad.easeOut",duration:550}),t=this.addImage(this.sprite.x,this.sprite.y,"misc","shadow_circle.png").setScale(3.5).setDepth(7),this.addTween({targets:t,duration:550,scaleX:50,scaleY:50,ease:"Quad.easeOut"}),this.setAwake(),this.addTween({targets:[e,t],duration:550,alpha:0,completeDelay:500,onComplete:()=>{playSound("ringknell",.9);for(let e=0;e<4;e++){var t=1+.43*e,a=this.addImage(this.x,this.y+24,"enemies","long_arm.png").setRotation(.5).setOrigin(.5,.92).setAlpha(.2).setDepth(h.depth-1);this.finalArms.push(a),a.goalRot=t,this.addTween({targets:a,duration:250,ease:"Cubic.easeOut",scaleX:.78,scaleY:.78,alpha:1}),this.addTween({delay:150-50*e,targets:a,duration:900+280*e,rotation:t,ease:"Cubic.easeInOut"})}for(let e=0;e<4;e++){var s=-1-.43*e,i=this.addImage(this.x,this.y+24,"enemies","long_arm.png").setRotation(-.5).setOrigin(.5,.92).setScale(-.3,.3).setAlpha(.2).setDepth(h.depth-1);this.finalArms.push(i),i.goalRot=s,this.addTween({targets:i,duration:250,ease:"Cubic.easeOut",scaleX:-.78,scaleY:.78,alpha:1}),this.addTween({delay:150-50*e,targets:i,duration:900+280*e,rotation:s,ease:"Cubic.easeInOut"})}}}))}})}})}})}},{name:gameVars.isHardMode?"|15":"|12 ",chargeAmt:335,damage:gameVars.isHardMode?15:12,isBigMove:!0,attackFinishFunction:()=>{screenShake(5),zoomTemp(1.015),playSound("body_slam");let e=poolManager.getItemFromPool("brickPattern2");(e=e||this.addSprite(gameConsts.halfWidth,globalObjects.player.getY()-120,"spells","brickPattern2.png").setDepth(998).setScale(.75)).setDepth(998).setScale(.75).setAlpha(1).setVisible(!0),this.addTween({targets:e,rotation:1,alpha:0,duration:800,onComplete:()=>{poolManager.returnItemToPool(e,"brickPattern2")}}),this.addTimeout(()=>{globalObjects.textPopupManager.setInfoText(gameConsts.halfWidth,gameConsts.height-23,getLangText("watch_health"),"center"),this.addTimeout(()=>{this.playerSpellCastAny=this.addSubscription("playerCastedSpell",()=>{this.addTimeout(()=>{globalObjects.textPopupManager.hideInfoText()},1200),this.playerSpellCastAny.unsubscribe()})},1200)},1e3)}}],[{name:";999",chargeAmt:999,damage:999,isBigMove:!0,attackFinishFunction:()=>{screenShake(9),zoomTemp(1.04),playSound("body_slam");let e=poolManager.getItemFromPool("brickPattern2");(e=e||this.addSprite(gameConsts.halfWidth,globalObjects.player.getY()-120,"spells","brickPattern2.png").setDepth(998).setScale(.75)).setDepth(998).setScale(.75).setAlpha(1).setVisible(!0),this.addTween({targets:e,rotation:1,alpha:0,duration:800,onComplete:()=>{poolManager.returnItemToPool(e,"brickPattern2")}})}}]]}}class Dummypractice extends Enemy{constructor(e,t,a,s){super(e,t,a,s),this.shieldOffsetY=-100,this.initSprite("dummy_paper.png",1,0,5,"dummyenemy"),globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),this.addTimeout(()=>{this.initTutorial()},50)}initStatsCustom(){this.health=100,this.isAsleep=!0,this.attackScale=1,this.pullbackScale=1,this.damageCanEmit=!0}initSpriteAnim(e){this.sprite.setScale(.98*e,.3*e).setRotation(.4*Math.random()-.2),setTimeout(()=>{playSound("balloon",.4).detune=-50},50),this.scene.tweens.add({targets:this.sprite,duration:700,ease:"Quart.easeOut",scaleX:e,scaleY:e,rotation:0,alpha:1})}showPoster(e="dummy_paper_hit.png",t){this.poster=this.addSprite(this.sprite.x,this.sprite.y,"dummyenemy",e).setDepth(this.sprite.depth-1).setScale(.1*this.sprite.startScale),this.poster.setRotation(-.7),this.addExtraSprite(this.poster),this.addTween({delay:100,targets:this.poster,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,duration:500,onComplete:()=>{}}),this.addTween({delay:100,targets:this.poster,rotation:0,ease:"Quint.easeIn",duration:500,onComplete:()=>{playSound("boing"),this.addTween({targets:this.poster,rotation:-.2,ease:"Quart.easeOut",duration:100,onComplete:()=>{this.addTween({targets:this.poster,rotation:-.02,ease:"Bounce.easeOut",duration:260})}})}})}hidePosterFast(){var e;this.poster&&(playSound("balloon",.4),e=this.poster.scaleX,this.addTween({targets:this.poster,scaleX:1.03*e,scaleY:1.03*e,rotation:-.04,ease:"Quint.easeOut",duration:135,onComplete:()=>{this.posterTween&&this.posterTween.stop(),this.addTween({targets:this.poster,scaleX:0,scaleY:0,ease:"Quart.easeIn",duration:700}),this.addTween({targets:this.poster,rotation:-.7,ease:"Quad.easeIn",duration:600})}}))}hidePoster(){this.poster&&(this.posterTween&&this.posterTween.stop(),this.poster.setScale(1.09*this.sprite.startScale),this.addTween({targets:this.poster,scaleX:.96*this.sprite.startScale,scaleY:.96*this.sprite.startScale,rotation:-.07,ease:"Bounce.easeOut",duration:230,completeDelay:20,onComplete:()=>{this.addTween({targets:this.poster,rotation:-.9,scaleX:0,scaleY:0,ease:"Cubic.easeIn",duration:750})}}))}initTutorial(){this.bgMusic=playMusic("bite_down_simplified",.65,!0)}setHealth(e){super.setHealth(e);this.prevHealth,this.healthMax,this.health,this.healthMax}takeDamage(e,t,a){super.takeDamage(e,t,a),this.damageCanEmit&&(this.damageCanEmit=!1,this.createDamageParticles(),this.addTimeout(()=>{this.damageCanEmit=!0},400))}tempShiftSFX(){this.runSfxLoop&&(this.runSfxLoop.detune=750,setVolume(this.runSfxLoop,1,300),this.addTimeout(()=>{this.runSfxLoop.detune=0,setVolume(this.runSfxLoop,0,300)},600))}startFight(){this.fightStarted=!0,this.setAwake(),playSound("inflate",.6).detune=500,this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:.85*this.sprite.startScale,scaleY:.85*this.sprite.startScale,rotation:-.25,ease:"Quint.easeOut",duration:700,onComplete:()=>{playSound("tractor_start",.4),this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:1.25*this.sprite.startScale,scaleY:1.25*this.sprite.startScale,rotation:.08,ease:"Quart.easeIn",duration:600,onComplete:()=>{this.setDefaultSprite("dummy_paper_face.png"),this.showPoster("dummy_paper_rawr.png",.02),this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,rotation:-.02,easeParams:[2],ease:"Bounce.easeOut",duration:500,onComplete:()=>{this.runSfxLoop=playSound("tractor_loop",0,!0),this.currDummyAnim=this.runTween=this.addTween({targets:[this.sprite],rotation:.02,ease:"Quart.easeInOut",duration:500,repeat:-1,yoyo:!0}),this.posterTween=this.addTween({delay:1e3,targets:this.poster,rotation:.02,ease:"Quart.easeInOut",duration:500,repeat:-1,yoyo:!0,onStart:()=>{this.poster.rotation=-.02}})}});var e=getTempPoolObject("spells","brickPattern2.png","brickPattern",700);e.setPosition(this.x,this.y-120).setScale(.65).setDepth(-1).setAlpha(.5),this.addTween({targets:e,scaleX:.85,scaleY:.85,duration:700,ease:"Cubic.easeOut"}),this.addTween({targets:e,alpha:0,ease:"Cubic.easeIn",duration:700})}})}})}throwWeapon(t,s,i=1){this.dead||this.isDestroyed||(this.tempShiftSFX(),this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:.85*this.sprite.startScale,scaleY:.85*this.sprite.startScale,rotation:i%2==1?-.25:.25,ease:"Quart.easeOut",duration:650,onComplete:()=>{let a=this.addImage(this.x,this.y-105,"dummyenemy",t).setDepth(0).setScale(.2);this.addTween({targets:a,rotation:(Math.random()<.5?-12.566:12.566)+.2*Math.random()-.1,duration:1300});var e=6*Math.random()-3;this.addTween({targets:a,y:this.y-310,x:"+="+e,scaleX:.8,scaleY:.8,ease:"Cubic.easeOut",duration:550,onComplete:()=>{a.setDepth(20),a.setScale(1.14),this.addTween({targets:a,scaleX:1,scaleY:1,ease:"Cubic.easeOut",duration:500}),this.addTween({targets:a,y:globalObjects.player.getY()-220,ease:"Cubic.easeIn",duration:750,onComplete:()=>{messageBus.publish("selfTakeDamage",s);let e=this.addSprite(gameConsts.halfWidth,globalObjects.player.getY()-190,"spells").play("damageEffect").setRotation(3*(Math.random()-.5)).setScale(1.5).setDepth(195);this.addTween({targets:e,scaleX:1.25,scaleY:1.25,ease:"Cubic.easeOut",duration:150,onComplete:()=>{e.destroy()}});var t=i%3*200-300;playSound("punch").detune=t,this.addTween({delay:500,targets:a,alpha:0,duration:500})}})}}),this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:1.1*this.sprite.startScale,scaleY:1.1*this.sprite.startScale,rotation:i%2==1?.05:-.05,ease:1<i?"Cubic.easeIn":"Quart.easeIn",duration:1<i?250:450,onComplete:()=>{i<=1&&(this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,rotation:0,ease:"Bounce.easeOut",duration:400}))}}),1<i&&this.addTimeout(()=>{this.throwWeapon(t,s,i-1)},250)}}))}throwTriple(t,a,s=1,i,h=!1){this.dead||this.isDestroyed||globalObjects.player.isDead()||(this.tempShiftSFX(),this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:.85*this.sprite.startScale,scaleY:.85*this.sprite.startScale,rotation:s%2==1?-.25:.25,ease:"Quart.easeOut",duration:i?500:600,onComplete:()=>{let e=t;1===s&&h&&(e="bird.png",setTimeout(()=>{playSound("chirp1")},400)),s%2==1?(this.tweenWeaponToPlayer(t,a,this.x-100,this.y-280,this.x-10,globalObjects.player.getY()-220,0,-120),this.tweenWeaponToPlayer(t,a,this.x,this.y-295,this.x,globalObjects.player.getY()-220,175,0),this.tweenWeaponToPlayer(t,a,this.x+100,this.y-280,this.x+10,globalObjects.player.getY()-220,350,120)):(this.tweenWeaponToPlayer(e,a,this.x+100,this.y-280,this.x+10,globalObjects.player.getY()-220,0,-120),this.tweenWeaponToPlayer(t,a,this.x,this.y-295,this.x,globalObjects.player.getY()-220,175,0),this.tweenWeaponToPlayer(t,a,this.x-100,this.y-280,this.x-10,globalObjects.player.getY()-220,350,120)),this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:1.1*this.sprite.startScale,scaleY:1.1*this.sprite.startScale,rotation:s%2==1?.05:-.05,ease:"Quart.easeIn",duration:i?350:400,onComplete:()=>{s<=1&&(this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,rotation:0,ease:"Bounce.easeOut",duration:400}))}}),1<s&&this.addTimeout(()=>{this.throwTriple(t,a,s-1)},i?350:400)}}))}tweenWeaponToPlayer(e,a,t,s,i,h,r,n=0){let l=this.addImage(this.x,this.y-90,"dummyenemy",e).setDepth(0).setScale(.25);this.addTween({targets:l,rotation:.1*Math.random()-12.566,duration:1200}),this.addTween({delay:r,targets:l,x:t,y:s,scaleX:.9,scaleY:.9,ease:"Cubic.easeOut",duration:500,onComplete:()=>{l.setDepth(20),this.addTween({targets:l,x:i,y:h,ease:"Cubic.easeIn",duration:700,onComplete:()=>{messageBus.publish("selfTakeDamage",a);let e=this.addSprite(l.x,globalObjects.player.getY()-190,"spells").play("damageEffect").setRotation(3*(Math.random()-.5)).setScale(1.5).setDepth(195);this.addTween({targets:e,scaleX:1.25,scaleY:1.25,ease:"Cubic.easeOut",duration:150,onComplete:()=>{e.destroy()}});var t=n;playSound("razor_leaf").detune=t,this.addTween({delay:500,targets:l,alpha:0,duration:500})}})}})}createDamageParticles(){var e=getTempPoolObject("dummyenemy","cloud1.png","cloud1",1100),t=getTempPoolObject("dummyenemy","cloud2.png","cloud1",1100),a=(e.setPosition(this.x,this.y-100).setScale(.6+.2*Math.random()).setRotation(Math.random()-.5).setAlpha(1),t.setPosition(this.x,this.y-100).setScale(.8+.2*Math.random()).setRotation(Math.random()-.5).setAlpha(1),6.28*Math.random()),s=220*Math.sin(a),a=-200*Math.abs(Math.cos(a)),s=(this.addTween({targets:e,x:"+="+s,y:"+="+a,ease:"Cubic.easeOut",duration:1e3}),6.28*Math.random()),a=220*Math.sin(s);Math.abs(Math.cos(s));this.addTween({targets:t,x:"+="+a,y:"+="+a,ease:"Cubic.easeOut",duration:1e3}),this.addTween({targets:[e,t],alpha:0,ease:"Cubic.easeIn",duration:1e3}),this.addTween({targets:[e,t],rotation:.1*(Math.random()-.5),ease:"Quad.easeOut",duration:1e3})}die(){if(!this.dead){super.die(),globalObjects.textPopupManager.hideInfoText(),this.dieClickBlocker=createGlobalClickBlocker(!1),this.sprite.setScale(this.sprite.startScale).setRotation(0);let e=this.addSprite(this.sprite.startX,this.sprite.y,"dummyenemy","dummy_paper_dark.png").setScale(this.sprite.startScale).setDepth(11).setAlpha(.1);this.currDummyAnim&&this.currDummyAnim.stop(),this.addTween({targets:e,alpha:.7,ease:"Cubic.easeIn",duration:1800}),this.addTween({targets:[this.sprite,e],scaleY:0,rotation:.06,ease:"Quad.easeIn",duration:1800,onComplete:()=>{e.setAlpha(.25),this.sprite.setFrame("dummy_paper_back.png"),this.sprite.setRotation(0),playSound("victory_2"),this.addTween({targets:[this.sprite,e],scaleY:-.2,ease:"Cubic.easeOut",duration:900,onComplete:()=>{this.showComplete(e)}}),this.addTween({targets:[this.sprite,e],rotation:.22,ease:"Quad.easeOut",duration:1e3,onComplete:()=>{}})}})}}initAttacks(){this.attacks=[[{name:"}5 ",chargeAmt:300,damage:5,isBigMove:!0,attackFinishFunction:()=>{playSound("body_slam");let e=this.addSprite(gameConsts.halfWidth+20*(Math.random()-.5),globalObjects.player.getY()-185,"spells","damageEffect1.png").setDepth(998).setScale(1.4);this.addTimeout(()=>{e.destroy()},150)}}]]}showComplete(e){sdkGameplayStop(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton(),globalObjects.magicCircle.disableMovement();let t=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-35,"misc","victory_banner.png").setScale(100,1.2).setDepth(9998).setAlpha(0),a=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-44,"misc","complete.png").setScale(.95).setDepth(9998).setAlpha(0),s=this.scene.add.text(gameConsts.halfWidth,gameConsts.halfHeight+2,getLangText("cont_ui"),{fontFamily:"Verdana",color:"#F0F0F0",fontSize:18}).setAlpha(0).setOrigin(.5,.5).setAlign("center").setDepth(9998);PhaserScene.tweens.add({targets:t,alpha:.75,duration:500}),PhaserScene.tweens.add({targets:[a],alpha:1,ease:"Quad.easeOut",duration:500}),playSound("victory"),this.addTimeout(()=>{s.alpha=1},1e3),PhaserScene.tweens.add({targets:a,scaleX:1,scaleY:1,duration:800,onComplete:()=>{canvas&&(canvas.style.cursor="pointer"),this.dieClickBlocker.setOnMouseUpFunc(()=>{canvas&&(canvas.style.cursor="default"),PhaserScene.tweens.add({targets:[this.sprite,e],alpha:0,duration:800}),hideGlobalClickBlocker(),s.destroy(),PhaserScene.tweens.add({targets:[a,t],alpha:0,duration:800,completeDelay:200,onComplete:()=>{a.destroy(),t.destroy();var e=this.targetLevel||1-this.level;beginPreLevel(e)}})})}})}}class Dummybody extends Dummypractice{constructor(e,t,a,s){super(e,t,a,s),this.numBodySpellsCast=0,this.numNonBodySpellsCast=0,this.spellHoverListener=this.addSubscription("recordSpell",(e,t)=>{"matterReinforce"!==e&&"mindReinforce"!=e||(this.numBodySpellsCast++,2<=this.numBodySpellsCast&&(this.showBodyTutorial(),this.spellHoverListener.unsubscribe(),this.attackHoverListener.unsubscribe()))}),this.attackHoverListener=this.addSubscription("recordSpellAttack",(e,t)=>{this.numNonBodySpellsCast++,4<=this.numNonBodySpellsCast&&(this.showThornsTutorial(),this.spellHoverListener.unsubscribe(),this.attackHoverListener.unsubscribe())})}initStatsCustom(){this.health=145,this.isAsleep=!0,this.attackScale=1,this.pullbackScale=1,this.damageCanEmit=!0}initTutorial(){}showBodyTutorial(){this.addTimeout(()=>{this.spellHoverListener=this.addSubscription("playerCastedSpell",(e,t)=>{this.spellHoverListener.unsubscribe(),globalObjects.textPopupManager.hideInfoText()})},2e3),globalObjects.textPopupManager.setInfoText(gameConsts.width,gameConsts.halfHeight-160,getLangText("dummy_body_one"),"right")}showThornsTutorial(){this.addTimeout(()=>{globalObjects.textPopupManager.setInfoText(gameConsts.width,gameConsts.halfHeight-160,getLangText("dummy_body_a"),"right");var e=globalObjects.textPopupManager.getBoxBottomPos(),t=globalObjects.textPopupManager.getCenterPos();this.rune3=this.addImage(t-36,e+18,"circle","bright_rune_matter.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.8,.8).setAlpha(0),this.rune4=this.addImage(t+36,e+18,"circle","bright_rune_reinforce.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.8,.8).setAlpha(0),this.addTween({targets:[this.rune3,this.rune4],scaleX:1,scaleY:1,ease:"Quart.easeOut",duration:500,onComplete:()=>{this.addTween({targets:[this.rune3,this.rune4],scaleX:.8,scaleY:.8,ease:"Back.easeOut",duration:300})}}),this.addTween({targets:[this.rune3,this.rune4],alpha:1,duration:200,completeDelay:1e3,onComplete:()=>{this.addTimeout(()=>{this.spellHoverListener=this.addSubscription("playerCastedSpell",(e,t)=>{this.spellHoverListener.unsubscribe(),this.addTimeout(()=>{globalObjects.textPopupManager.hideInfoText(),this.addTween({targets:[this.rune3,this.rune4],alpha:0,duration:300,onComplete:()=>{this.rune3.visible=!1,this.rune4.visible=!1}})},1e3)})},1e3)}})},500)}setHealth(e){super.setHealth(e);e=this.prevHealth/this.healthMax;this.health,this.healthMax;1<=e&&this.isAsleep&&(this.startFight(),this.bgMusic=playMusic("bite_down_simplified",.65,!0))}cleanUp(){this.runSfxLoop&&fadeAwaySound(this.runSfxLoop,300)}die(){this.dead||(this.spellHoverListener&&this.spellHoverListener.unsubscribe(),this.attackHoverListener&&this.attackHoverListener.unsubscribe(),this.malfunctionTween&&this.malfunctionTween.stop(),this.rune3&&this.addTween({targets:[this.rune3,this.rune4],alpha:0,duration:300}),globalObjects.textPopupManager.hideInfoText(),playSound("clunk2"),this.runTween&&this.runTween.stop(),this.runSfxLoop&&fadeAwaySound(this.runSfxLoop,300),super.die())}healAnim(e=null){e=e||this.healthMax,this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:.82*this.sprite.startScale,scaleY:.82*this.sprite.startScale,rotation:-.25,ease:"Quint.easeOut",duration:750,onComplete:()=>{this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:1.2*this.sprite.startScale,scaleY:1.2*this.sprite.startScale,rotation:.07,ease:"Quart.easeIn",duration:600,onComplete:()=>{playSound("magic",.6),this.heal(e),messageBus.publish("animateHealNum",this.x,this.y-50,"+"+e,.5+.2*Math.sqrt(this.healthMax)),this.healSprite||(this.healSprite=this.addImage(gameConsts.halfWidth,this.y-90,"misc","heal.png").setScale(.9).setDepth(999).setAlpha(1)),this.healSprite.setAlpha(1).setPosition(gameConsts.halfWidth,this.y-90),this.scene.tweens.add({targets:this.healSprite,y:"-=30",duration:1e3}),this.scene.tweens.add({targets:this.healSprite,alpha:0,duration:1e3,ease:"Cubic.easeIn"}),this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,rotation:0,easeParams:[2],ease:"Bounce.easeOut",duration:600})}})}})}initAttacks(){this.attacks=[[{name:"}2x6",chargeAmt:400,finishDelay:600,transitionFast:!0,isBigMove:!0,damage:-1,startFunction:()=>{},attackStartFunction:()=>{this.hidePosterFast()},attackFinishFunction:()=>{this.throwTriple("star.png",2,2)}},{name:"HEAL \\50",chargeAmt:700,finishDelay:2e3,transitionFast:!0,damage:-1,attackStartFunction:()=>{this.healAnim(50)}},{name:"}2x12}",chargeAmt:700,finishDelay:2600,transitionFast:!0,isBigMove:!0,damage:-1,startFunction:()=>{},attackStartFunction:()=>{},attackFinishFunction:()=>{this.throwTriple("star.png",2,4)}},{name:"HEAL \\50",chargeAmt:750,finishDelay:2e3,transitionFast:!0,damage:-1,attackStartFunction:()=>{this.healAnim(50)}},{name:"}}2x15}}",chargeAmt:800,finishDelay:3600,transitionFast:!0,isBigMove:!0,damage:-1,startFunction:()=>{},attackStartFunction:()=>{},attackFinishFunction:()=>{this.throwTriple("star.png",2,5,!0)}},{name:"HEAL \\50",chargeAmt:800,finishDelay:2e3,transitionFast:!0,damage:-1,attackStartFunction:()=>{this.healAnim(50)}},{name:"}}}2x30}}}",chargeAmt:900,finishDelay:4500,transitionFast:!0,isBigMove:!0,damage:-1,startFunction:()=>{},attackStartFunction:()=>{},attackFinishFunction:()=>{this.throwTriple("star.png",2,10,!0)}},{name:"WAITING...",chargeAmt:300,transitionFast:!0,damage:-1},{name:";18",chargeAmt:500,finishDelay:500,transitionFast:!0,isBigMove:!0,damage:-1,startFunction:()=>{},attackStartFunction:()=>{},attackFinishFunction:()=>{this.throwWeapon("scythe.png",18,1)}},{name:"Malfunctioning...",chargeAmt:350,chargeMult:10,damage:-1,isPassive:!0,startFunction:()=>{this.runSfxLoop.detune=900,setVolume(this.runSfxLoop,1,300),this.sprite.setRotation(-.09),this.malfunctionTween=this.addTween({targets:this.sprite,rotation:.09,ease:"Cubic.easeOut",duration:400,repeat:-1})},attackStartFunction:()=>{this.addTimeout(()=>{this.takeDamage(999,!1)},10),playSound("clunk"),this.runSfxLoop.detune=0,setVolume(this.runSfxLoop,0,400),this.malfunctionTween.stop(),this.sprite.setRotation(.2),this.addTween({delay:1e3,targets:this.sprite,rotation:0,ease:"Quart.easeIn",duration:400})}}]]}}class Dummymind extends Dummypractice{constructor(e,t,a,s){super(e,t,a,s),this.addTimeout(()=>{this.resetCast=messageBus.subscribe("resetCircle",()=>{this.healAnim()}),this.subscriptions.push(this.resetCast)},100)}initStatsCustom(){this.health=50,this.isAsleep=!0,this.attackScale=1,this.pullbackScale=1,this.numTimesHealed=0}showHPGauge(){this.hpBG=this.addImage(gameConsts.halfWidth-160-10*getLangText("HP").length,gameConsts.halfHeight-165,"blackPixel").setScale(23*getLangText("HP").length-10,30).setAlpha(0).setDepth(-1);let e=0;"zh_tw"!==language&&"zh_cn"!==language||(this.hpBG.scaleX+=16,this.hpBG.scaleY+=4,e=2),this.hpText=this.addText(this.hpBG.x-this.hpBG.scaleX+10,this.hpBG.y+e,getLangText("HP")+"50",{fontFamily:"germania",color:"#F0F0F0",fontSize:50}).setAlpha(0).setOrigin(0,.5).setAlign("left"),this.hpText.startX=this.hpText.x,this.addTween({targets:[this.hpText],alpha:1,ease:"Quad.easeOut",duration:800}),this.addTween({targets:[this.hpBG],alpha:.5,ease:"Quad.easeOut",duration:800})}initTutorial(){this.bgMusic=playMusic("bite_down_simplified",.65,!0),globalObjects.magicCircle.disableMovement(),globalObjects.bannerTextManager.setDialog([getLangText("level1_train_diag_a")]),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.height-130,0),globalObjects.bannerTextManager.showBanner(!1,"fr"===language);var e=globalObjects.bannerTextManager.getDepth()+1;this.rune1=this.addImage(gameConsts.halfWidth-260,gameConsts.height-130,"tutorial","rune_energy_large.png").setDepth(e).setScale(.8,.8).setAlpha(0),this.rune2=this.addImage(gameConsts.halfWidth+260,gameConsts.height-130,"tutorial","rune_energy_large.png").setDepth(e).setScale(.8,.8).setAlpha(0),this.addTween({targets:[this.rune1,this.rune2],alpha:1,scaleX:1,scaleY:1,duration:400}),globalObjects.bannerTextManager.setOnFinishFunc(()=>{globalObjects.magicCircle.enableMovement(),globalObjects.bannerTextManager.setOnFinishFunc(()=>{}),globalObjects.bannerTextManager.closeBanner(),this.showPoster(),this.addTween({targets:[this.rune1,this.rune2],alpha:0,duration:200}),this.canShowShieldTip=!0,this.showGoal(),this.addDelay(()=>{this.glowCirc2=this.addSprite(gameConsts.halfWidth,globalObjects.player.getY(),"shields","ring_flash0.png").setAlpha(.3).setDepth(999).setScale(1.12),this.addDelay(()=>{this.glowCirc2.playReverse("ring_flash"),this.glowCirc2.currAnim=this.addTween({targets:this.glowCirc2,alpha:1,ease:"Cubic.easeOut",duration:150,scaleX:1.35,scaleY:1.35,completeDelay:1e3,onComplete:()=>{this.playerSpellCastSub=messageBus.subscribe("recordSpellAttack",(e,t)=>{this.playerSpellCastSub.unsubscribe(),globalObjects.textPopupManager.hideInfoText()}),this.subscriptions.push(this.playerSpellCastSub),this.glowCirc2.currAnim=this.addTween({targets:this.glowCirc2,alpha:.3,ease:"Cubic.easeIn",duration:150,onComplete:()=>{this.glowCirc2.setAlpha(.6),this.glowCirc2.currAnim=this.addTween({targets:this.glowCirc2,alpha:1,ease:"Cubic.easeIn",scaleX:1.12,scaleY:1.12,duration:200}),this.glowCirc2.play("ring_flash")}})}})},400),globalObjects.textPopupManager.setInfoText(gameConsts.halfWidth,gameConsts.height-37,getLangText("level1_train_popup"),"center")},1500)})}showGoal(){this.backingBox=this.addImage(0,0,"blackPixel").setAlpha(0),this.text=PhaserScene.add.text(10,10,getLangText("level1_train_tut_a"),{fontFamily:"garamondmax",fontSize:24,color:"#FFFFFF",align:"left"}).setAlpha(0).setOrigin(0,0).setDepth(100),this.backingBox.setScale(.5*this.text.width+10,.5*this.text.height+10).setOrigin(0,0),this.addToDestructibles(this.text),this.highlightGoal()}highlightGoal(){this.text.setScale(.98),this.addTween({targets:[this.text],alpha:1,scaleX:1,scaleY:1,ease:"Back.easeOut",duration:600}),this.addTween({targets:[this.backingBox],alpha:.8,duration:600}),this.addTimeout(()=>{this.fadeGoal()},4e3)}fadeGoal(){this.addTween({targets:[this.text],alpha:.8,duration:600}),this.addTween({targets:[this.backingBox],alpha:.6,duration:600})}healAnim(){this.dead||(this.currDummyAnim=this.addTween({delay:2040,targets:[this.sprite,this.poster],scaleX:.82*this.sprite.startScale,scaleY:.82*this.sprite.startScale,rotation:-.25,ease:"Quint.easeOut",duration:500,onComplete:()=>{this.currDummyAnim=this.addTween({targets:[this.sprite,this.poster],scaleX:1.2*this.sprite.startScale,scaleY:1.2*this.sprite.startScale,rotation:.07,ease:"Quart.easeIn",duration:480,onComplete:()=>{playSound("magic",.6),this.isFacingFront=!this.isFacingFront,this.isFacingFront?(this.poster.setFrame("dummy_paper_haha.png"),this.setDefaultSprite("dummy_paper_face.png",void 0,!1)):(this.poster.setFrame("dummy_paper_hit.png"),this.setDefaultSprite("dummy_paper_back.png",void 0,!1),playSound("balloon",.6)),this.heal(this.healthMax),this.hpBG?this.highlightGoal():this.showHPGauge(),this.hpText&&(this.hpText.setText(getLangText("HP")+this.health),this.addTween({targets:this.hpText,scaleX:1.05,scaleY:1.05,ease:"Quart.easeOut",duration:750,onComplete:()=>{this.addTween({targets:this.hpText,scaleX:1,scaleY:1,ease:"Back.easeOut",duration:350})}})),this.clearEffects(),this.numTimesHealed++,messageBus.publish("animateHealNum",this.x,this.y-50,"+"+this.healthMax,.5+.2*Math.sqrt(this.healthMax)),this.healSprite||(this.healSprite=this.addImage(gameConsts.halfWidth,this.y-90,"misc","heal.png").setScale(.9).setDepth(999).setAlpha(1)),this.healSprite.setAlpha(1).setPosition(gameConsts.halfWidth,this.y-90),this.scene.tweens.add({targets:this.healSprite,y:"-=30",duration:1e3}),this.scene.tweens.add({targets:this.healSprite,alpha:0,duration:1e3,ease:"Cubic.easeIn",onComplete:()=>{2===this.numTimesHealed?(globalObjects.bannerTextManager.setDialog([getLangText("level1_train_diag_b")]),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.height-130,0),globalObjects.bannerTextManager.showBanner(.5)):4===this.numTimesHealed&&(globalObjects.bannerTextManager.setDialog([getLangText("level1_train_diag_c")]),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.height-130,0),globalObjects.bannerTextManager.showBanner(.5))}}),this.currDummyAnim=this.addTween({targets:[this.sprite,this.poster],scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,rotation:0,easeParams:[2],ease:"Bounce.easeOut",duration:600})}})}}))}setHealth(e){super.setHealth(e);this.prevHealth,this.healthMax;var e=this.health/this.healthMax,t=this.prevHealth-this.health;this.hpText&&(this.hpText.setText(getLangText("HP")+this.health),13<t?(this.hpText.x=this.hpText.startX-7,this.hpText.setScale(1.06),this.hpText.setColor("#FF7777"),this.addTween({targets:this.hpText,x:this.hpText.startX+5,scaleX:1.09,scaleY:1.12,duration:40,onComplete:()=>{this.addTween({targets:this.hpText,x:this.hpText.startX,scaleX:1,scaleY:1,ease:"Bounce.easeOut",easeParams:[2.5],duration:350,onComplete:()=>{this.hpText.setColor("#FFFFFF")}})}})):(this.hpText.setScale(1.01),this.hpText.x=this.hpText.startX+2,this.addTween({targets:this.hpText,x:this.hpText.startX,scaleX:1,scaleY:1,ease:"Bounce.easeOut",duration:350}))),0!=e&&this.canShowShieldTip&&(this.canShowShieldTip=!1,this.addTimeout(()=>{var e=globalObjects.bannerTextManager.getDepth()+1,t=(globalObjects.textPopupManager.setInfoText(gameConsts.width,gameConsts.halfHeight-110,getLangText("dummy_mind_tut"),"right"),globalObjects.textPopupManager.getBoxBottomPos()),a=globalObjects.textPopupManager.getCenterPos();this.rune3=this.addImage(a-32,t+16,"circle","bright_rune_mind.png").setDepth(e).setScale(.8,.8).setAlpha(0),this.rune4=this.addImage(a+37,t+16,"circle","bright_rune_strike.png").setDepth(e).setScale(.8,.8).setAlpha(0),this.addTween({targets:[this.rune3,this.rune4],alpha:1,duration:200,completeDelay:1e3,onComplete:()=>{this.playerSpellCastSub2=messageBus.subscribe("playerCastedSpell",()=>{this.playerSpellCastSub2.unsubscribe(),this.addTimeout(()=>{this.addTween({targets:[this.rune3,this.rune4],alpha:0,duration:300,onComplete:()=>{this.rune3.visible=!1,this.rune4.visible=!1}}),globalObjects.textPopupManager.hideInfoText()},1e3)}),this.subscriptions.push(this.playerSpellCastSub2)}})},500))}die(){this.dead||(globalObjects.textPopupManager.hideInfoText(),this.rune1&&(this.rune1.visible=!1,this.rune2.visible=!1),this.currDummyAnim&&this.currDummyAnim.stop(),this.playerSpellCastSub&&this.playerSpellCastSub.unsubscribe(),this.playerSpellCastSub2&&this.playerSpellCastSub.unsubscribe(),this.poster&&(this.poster.setFrame("dummy_paper_ouch.png"),this.hidePoster()),this.hpText&&(this.hpText.setText(getLangText("HP")+"0"),this.addTween({delay:400,targets:[this.hpText,this.hpBG],alpha:0,duration:1500})),this.backingBox&&this.addTween({targets:[this.text,this.backingBox],alpha:0,duration:300}),this.rune3&&(this.rune3.visible=!1),this.rune4&&(this.rune4.visible=!1),super.die())}initAttacks(){this.attacks=[[{name:"}5 ",chargeAmt:300,damage:5,isBigMove:!0,attackFinishFunction:()=>{playSound("body_slam");let e=this.addSprite(gameConsts.halfWidth+20*(Math.random()-.5),globalObjects.player.getY()-185,"spells","damageEffect1.png").setDepth(998).setScale(1.4);this.addTimeout(()=>{e.destroy()},150)}}]]}}class Dummyshield extends Dummypractice{constructor(e,t,a,s){super(e,t,a,s)}initStatsCustom(){this.health=70,this.isAsleep=!0,this.attackScale=1,this.pullbackScale=1,this.damageCanEmit=!0,this.spellsCastCount=0}initTutorial(){this.addTimeout(()=>{this.createPicketSign()},1e3),this.playerSpellCastSub=messageBus.subscribe("playerCastedSpell",()=>{this.spellsCastCount++,5==this.spellsCastCount&&(globalObjects.textPopupManager.setInfoText(gameConsts.width,gameConsts.halfHeight-160,getLangText("shield_dummy_overwrite"),"right"),this.playerSpellCastSub.unsubscribe()),3<=this.spellsCastCount&&this.spellsCastCount%2==1&&(this.picketButton.setScale(1.02,1.05),this.picketVisual.setScale(1.02,1.05),this.picketButton.tweenToScale(1.05,1.15,200,"Cubic.easeOut",void 0,()=>{this.picketButton.tweenToScale(1,1,700,"Back.easeOut")}),this.addTween({targets:this.picketVisual,scaleX:1.05,scaleY:1.15,ease:"Cubic.easeOut",duration:200,onComplete:()=>{this.addTween({targets:this.picketVisual,scaleX:1,scaleY:1,ease:"Back.easeOut",duration:700})}}))}),this.subscriptions.push(this.playerSpellCastSub)}showGoal(){this.backingBox=this.addImage(0,0,"blackPixel").setAlpha(0),this.text=PhaserScene.add.text(8,8,getLangText("level2_train_tut_a"),{fontFamily:"garamondmax",fontSize:24,color:"#FFFFFF",align:"left"}).setAlpha(0).setOrigin(0,0).setDepth(100),this.backingBox.setScale(.5*this.text.width+8,.5*this.text.height+8).setOrigin(0,0),this.addToDestructibles(this.text),this.highlightGoal()}highlightGoal(){this.text.setScale(.98),this.addTween({targets:[this.text],alpha:1,scaleX:1,scaleY:1,ease:"Back.easeOut",duration:600}),this.addTween({targets:[this.backingBox],alpha:.8,duration:600})}createPicketSign(){this.picketVisual=this.addSprite(this.x-170,this.y+15,"dummyenemy","picketsign.png").setScale(1,0).setOrigin(.5,1).setDepth(11),playSound("balloon",.6),this.addTween({targets:this.picketVisual,scaleY:1,ease:"Back.easeOut",duration:500,onComplete:()=>{this.addTimeout(()=>{this.showGoal()},600),this.picketButton=new Button({normal:{ref:"picketsign.png",atlas:"dummyenemy",alpha:1,x:this.picketVisual.x,y:this.picketVisual.y},hover:{ref:"picketsign_hover.png",atlas:"dummyenemy"},press:{ref:"picketsign_press.png",atlas:"dummyenemy",alpha:1},disable:{alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{this.clickPicketSign()}}),this.picketButton.setOrigin(.5,1),this.picketButton.setDepth(11)}})}clickPicketSign(){this.bgMusic=playMusic("bite_down_simplified",.65,!0),this.playerSpellCastSub.unsubscribe(),globalObjects.textPopupManager.hideInfoText(),this.picketButton.destroy(),playSound("balloon",.5).detune=-500,this.addTween({targets:this.picketVisual,scaleY:0,scaleX:.5,ease:"Back.easeIn",duration:400,easeParams:[1.5],completeDelay:400,onComplete:()=>{this.picketVisual.destroy(),this.addTween({targets:[this.text,this.backingBox],alpha:0,duration:600}),this.startFight()}})}setHealth(e){super.setHealth(e);this.prevHealth,this.healthMax,this.health,this.healthMax}cleanUp(){this.picketButton&&this.picketButton.destroy(),this.runSfxLoop&&fadeAwaySound(this.runSfxLoop,300)}die(){this.dead||(this.rune1&&(this.rune1.visible=!1,this.rune2.visible=!1),this.malfunctionTween&&this.malfunctionTween.stop(),playSound("clunk2"),this.runTween&&this.runTween.stop(),this.runSfxLoop&&fadeAwaySound(this.runSfxLoop,300),this.picketButton&&this.picketButton.destroy(),super.die())}initAttacks(){this.attacks=[[{name:"}6",chargeAmt:550,finishDelay:800,transitionFast:!0,chargeMult:8,damage:-1,startFunction:()=>{},attackStartFunction:()=>{this.hidePosterFast()},attackFinishFunction:()=>{this.tempShiftSFX(),this.throwWeapon("dagger.png",6,1)}},{name:"}10",chargeAmt:550,chargeMult:8,finishDelay:800,transitionFast:!0,damage:-1,isBigMove:!0,startFunction:()=>{this.addTimeout(()=>{},10)},attackStartFunction:()=>{},attackFinishFunction:()=>{this.tempShiftSFX(),this.throwWeapon("sword.png",10,1)}},{name:"Malfunctioning...",chargeAmt:300,chargeMult:4,damage:-1,isPassive:!0,startFunction:()=>{this.runSfxLoop.detune=900,setVolume(this.runSfxLoop,1,300),this.sprite.setRotation(.07),this.malfunctionTween=this.addTween({targets:this.sprite,rotation:-.06,ease:"Cubic.easeOut",duration:250,repeat:-1})},attackStartFunction:()=>{this.addTimeout(()=>{this.takeDamage(20,!1)},10),playSound("clunk2"),this.runSfxLoop.detune=0,setVolume(this.runSfxLoop,0,400),this.malfunctionTween.stop(),this.sprite.setRotation(.2),this.addTween({delay:1e3,targets:this.sprite,rotation:0,ease:"Quart.easeIn",duration:400})}},{name:"}2x6",chargeAmt:500,chargeMult:8,finishDelay:1e3,transitionFast:!0,damage:-1,startFunction:()=>{this.addTimeout(()=>{},10)},attackStartFunction:()=>{},attackFinishFunction:()=>{this.tempShiftSFX(),this.throwTriple("star.png",2,2)}},{name:"|12x2",chargeAmt:700,finishDelay:1600,transitionFast:!0,chargeMult:8,damage:-1,isBigMove:!0,startFunction:()=>{this.addTimeout(()=>{},10)},attackStartFunction:()=>{},attackFinishFunction:()=>{this.tempShiftSFX(),this.throwWeapon("sword.png",12,2)}},{name:"Malfunctioning...",chargeAmt:400,chargeMult:7,damage:-1,isPassive:!0,startFunction:()=>{this.runSfxLoop.detune=900,setVolume(this.runSfxLoop,1,300),this.sprite.setRotation(-.09),this.malfunctionTween=this.addTween({targets:this.sprite,rotation:.09,ease:"Cubic.easeOut",duration:400,repeat:-1})},attackStartFunction:()=>{this.addTimeout(()=>{this.takeDamage(25,!1)},10),playSound("clunk"),this.runSfxLoop.detune=0,setVolume(this.runSfxLoop,0,400),this.malfunctionTween.stop(),this.sprite.setRotation(.2),this.addTween({delay:1e3,targets:this.sprite,rotation:0,ease:"Quart.easeIn",duration:400})}},{name:";30",chargeAmt:1e3,finishDelay:800,transitionFast:!0,chargeMult:8,damage:-1,isBigMove:!0,startFunction:()=>{this.addTimeout(()=>{},10)},attackStartFunction:()=>{},attackFinishFunction:()=>{this.tempShiftSFX(),this.throwWeapon("dummy_dead.png",30,1)}},{name:";12x3",chargeAmt:1e3,finishDelay:800,transitionFast:!0,chargeMult:8,damage:-1,isBigMove:!0,startFunction:()=>{this.addTimeout(()=>{},10)},attackStartFunction:()=>{},attackFinishFunction:()=>{this.tempShiftSFX(),this.throwWeapon("sword.png",12,3)}},{name:"}6",chargeAmt:550,transitionFast:!0,chargeMult:8,damage:-1,startFunction:()=>{this.addTimeout(()=>{},10)},attackStartFunction:()=>{},attackFinishFunction:()=>{this.tempShiftSFX(),this.throwWeapon("bird.png",6,1),setTimeout(()=>{playSound("chirp1")},1e3)}},{name:"Malfunctioning...",chargeAmt:700,chargeMult:8,damage:-1,isPassive:!0,startFunction:()=>{this.runSfxLoop.detune=900,setVolume(this.runSfxLoop,1,300),this.sprite.setRotation(.07),this.malfunctionTween=this.addTween({targets:this.sprite,rotation:-.06,ease:"Cubic.easeOut",duration:250,repeat:-1})},attackStartFunction:()=>{this.addTimeout(()=>{this.takeDamage(30,!1)},10),playSound("clunk2"),this.runSfxLoop.detune=0,setVolume(this.runSfxLoop,0,400),this.malfunctionTween.stop(),this.sprite.setRotation(.2),this.addTween({delay:1e3,targets:this.sprite,rotation:0,ease:"Quart.easeIn",duration:400})}}]]}}class Dummytime extends Dummypractice{constructor(e,t,a,s){super(e,t,a,s)}initStatsCustom(){this.health=105,this.isAsleep=!0,this.attackScale=1,this.pullbackScale=1,this.damageCanEmit=!0,this.spellsCastCount=0}initTutorial(){this.playerSpellCastSub=this.addSubscription("playerCastedSpell",()=>{this.spellsCastCount++,2<=this.spellsCastCount&&(this.playerSpellCastSub.unsubscribe(),this.addTween({targets:[this.text,this.backingBox],alpha:0,duration:600}))}),this.addDelay(()=>{this.showGoal()},1e3)}showGoal(){this.backingBox=this.addImage(0,0,"blackPixel").setAlpha(0),this.text=PhaserScene.add.text(8,8,getLangText("level4_train_tut_a"),{fontFamily:"garamondmax",fontSize:24,color:"#FFFFFF",align:"left"}).setAlpha(0).setOrigin(0,0).setDepth(100),this.backingBox.setScale(.5*this.text.width+8,.5*this.text.height+8).setOrigin(0,0),this.addToDestructibles(this.text),this.addTween({targets:[this.text],alpha:1,scaleX:1,scaleY:1,ease:"Back.easeOut",duration:600}),this.addTween({targets:[this.backingBox],alpha:.8,duration:600})}startFight(){super.startFight(),this.bgMusic=playMusic("bite_down_simplified",.7,!0)}setHealth(e){super.setHealth(e);this.prevHealth,this.healthMax;e=this.health/this.healthMax;e<.999&&!this.fightStarted&&(this.startFight(),this.addDelay(()=>{this.addTween({targets:[this.text,this.backingBox],alpha:0,duration:600})},3e3))}cleanUp(){this.runSfxLoop&&fadeAwaySound(this.runSfxLoop,300)}die(){this.dead||(this.playerSpellBodyTrack&&this.playerSpellBodyTrack.unsubscribe(),this.playerSpellBodyTrack2&&this.playerSpellBodyTrack2.unsubscribe(),this.playerSpellCastSub&&this.playerSpellCastSub.unsubscribe(),this.runea&&(this.runea.destroy(),this.runeb.destroy()),this.rune1&&(this.rune1.destroy(),this.rune2.destroy()),this.rune3&&(this.rune3.destroy(),this.rune4.destroy(),this.rune5.destroy(),this.rune6)&&this.rune6.destroy(),playSound("clunk2"),this.runTween&&this.runTween.stop(),this.runSfxLoop&&fadeAwaySound(this.runSfxLoop,300),super.die())}healAnim(e=null){e=e||this.healthMax,this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:.82*this.sprite.startScale,scaleY:.82*this.sprite.startScale,rotation:-.25,ease:"Quint.easeOut",duration:750,onComplete:()=>{this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:1.2*this.sprite.startScale,scaleY:1.2*this.sprite.startScale,rotation:.07,ease:"Quart.easeIn",duration:600,onComplete:()=>{playSound("magic",.6),this.heal(e),messageBus.publish("animateHealNum",this.x,this.y-70,"+"+e,.5+.2*Math.sqrt(this.healthMax)),this.healSprite||(this.healSprite=this.addImage(gameConsts.halfWidth,this.y-90,"misc","heal.png").setScale(.9).setDepth(999).setAlpha(1)),this.healSprite.setAlpha(1).setPosition(gameConsts.halfWidth,this.y-90),this.scene.tweens.add({targets:this.healSprite,y:"-=30",duration:1e3}),this.scene.tweens.add({targets:this.healSprite,alpha:0,duration:1e3,ease:"Cubic.easeIn"}),this.currDummyAnim=this.addTween({targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,rotation:0,easeParams:[2],ease:"Bounce.easeOut",duration:600})}})}})}initAttacks(){this.attacks=[[{name:";15x5;",chargeAmt:620,finishDelay:3400,isBigMove:!0,transitionFast:!0,damage:-1,startFunction:()=>{this.addDelay(()=>{globalObjects.textPopupManager.setInfoText(gameConsts.width,gameConsts.halfHeight-160,getLangText("level4_train_tut_b1"),"right");var e=globalObjects.textPopupManager.getBoxBottomPos(),t=globalObjects.textPopupManager.getCenterPos();this.runea=this.addSprite(t-31,e+17,"circle","bright_rune_protect.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.75).setAlpha(0),this.runeb=this.addSprite(t+29,e+17,"circle","bright_rune_time.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.75).setAlpha(0),this.addTween({targets:[this.runea,this.runeb],alpha:1,duration:200}),this.addTween({targets:[this.runea,this.runeb],scaleX:1.1,scaleY:1.1,ease:"Quart.easeOut",duration:600,onComplete:()=>{this.addTween({targets:[this.runea,this.runeb],scaleX:.85,scaleY:.85,ease:"Back.easeOut",duration:400})}}),this.playerSpellShieldTrack=this.addSubscription("recordSpell",e=>{"timeProtect"===e&&(this.playerSpellShieldTrack.unsubscribe(),this.playerSpellShieldTrack=null,globalObjects.textPopupManager.hideInfoText(),this.addTween({targets:[this.runea,this.runeb],alpha:0,duration:200,onComplete:()=>{this.runea.visible=!1,this.runeb.visible=!1}}))})},1500)},attackStartFunction:()=>{this.hidePosterFast()},attackFinishFunction:()=>{this.throwWeapon("sword.png",15,5)}},{name:"OUT OF AMMO...",chargeAmt:220,transitionFast:!0,isPassive:!0,damage:-1,startFunction:()=>{globalObjects.textPopupManager.setInfoText(gameConsts.width,gameConsts.halfHeight-170,getLangText("level4_train_tut_b"),"right");var e=globalObjects.textPopupManager.getBoxBottomPos(),t=globalObjects.textPopupManager.getCenterPos();this.runea&&this.addTween({targets:[this.runea,this.runeb],alpha:0,duration:200}),this.rune1=this.addSprite(t-31,e+18,"circle","bright_rune_reinforce.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.75).setAlpha(0),this.rune2=this.addSprite(t+28,e+18,"circle","bright_rune_time.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.75).setAlpha(0),this.addTween({targets:[this.rune1,this.rune2],alpha:1,duration:200}),this.addTween({targets:[this.rune1,this.rune2],scaleX:1.1,scaleY:1.1,ease:"Quart.easeOut",duration:600,onComplete:()=>{this.addTween({targets:[this.rune1,this.rune2],scaleX:.85,scaleY:.85,ease:"Back.easeOut",duration:400})}}),this.playerSpellShieldTrack&&this.playerSpellShieldTrack.unsubscribe(),this.playerSpellBodyTrack=this.addSubscription("recordSpell",e=>{"timeReinforce"===e&&(this.playerSpellBodyTrack.unsubscribe(),this.playerSpellBodyTrack=null,globalObjects.textPopupManager.hideInfoText(),this.addTween({targets:[this.rune1,this.rune2],alpha:0,duration:200,onComplete:()=>{this.rune1.visible=!1,this.rune2.visible=!1}}))})},attackStartFunction:()=>{globalObjects.textPopupManager.hideInfoText(),this.rune1&&this.addTween({targets:[this.rune1,this.rune2],alpha:0,duration:200}),this.currentAttackSetIndex=1,this.nextAttackIndex=0}}],[{name:"FULL HEAL! \\100",chargeAmt:480,finishDelay:2e3,transitionFast:!0,isBigMove:!0,damage:-1,startFunction:()=>{var e,t;30<this.health&&!this.flipShow?(this.flipShow=!0,globalObjects.textPopupManager.setInfoText(gameConsts.width,gameConsts.halfHeight-197,getLangText("level4_train_tut_c"),"right"),e=globalObjects.textPopupManager.getBoxTopPos(),t=globalObjects.textPopupManager.getCenterPos(),this.rune1&&this.addTween({targets:[this.rune1,this.rune2],alpha:0,duration:200}),this.rune3||(this.rune3=this.addSprite(t-48,e+83,"circle","bright_rune_enhance.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.71).setAlpha(0),this.rune4=this.addSprite(+t,e+83,"circle","bright_rune_enhance.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.71).setAlpha(0),this.rune5=this.addSprite(t+48,e+83,"circle","bright_rune_enhance.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.71).setAlpha(0)),this.addTween({targets:[this.rune3,this.rune4,this.rune5],alpha:1,duration:200}),this.addTween({targets:[this.rune3,this.rune4,this.rune5],scaleX:1,scaleY:1,ease:"Quart.easeOut",duration:600,onComplete:()=>{this.addTween({targets:[this.rune3,this.rune4,this.rune5],scaleX:.78,scaleY:.78,ease:"Back.easeOut",duration:400})}}),this.addDelay(()=>{this.playerSpellBodyTrack&&this.playerSpellBodyTrack.unsubscribe(),this.playerSpellBodyTrack2=this.addSubscription("recordSpell",e=>{"timeEnhance"!==e&&"matterEnhance"!==e||(this.playerSpellBodyTrack2.unsubscribe(),this.playerSpellBodyTrack2=null,globalObjects.textPopupManager.hideInfoText(),this.addTween({targets:[this.rune3,this.rune4,this.rune5],alpha:0,duration:200}))})},2e3)):this.flipShow=!1},attackStartFunction:()=>{this.justShown=!0,this.healAnim(100),this.currentAttackSetIndex=2,this.nextAttackIndex=0}}],[{name:"FULL HEAL! \\100",chargeAmt:850,finishDelay:2e3,transitionFast:!0,isBigMove:!0,damage:-1,startFunction:()=>{var e,t;30<this.health&&!this.justShown?(this.justShown=!0,globalObjects.textPopupManager.setInfoText(gameConsts.width,gameConsts.halfHeight-197,getLangText("level4_train_tut_c"),"right"),e=globalObjects.textPopupManager.getBoxTopPos(),t=globalObjects.textPopupManager.getCenterPos(),this.rune1&&this.addTween({targets:[this.rune1,this.rune2],alpha:0,duration:200}),this.rune3||(this.rune3=this.addSprite(t-60,e+83,"circle","bright_rune_enhance.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.71).setAlpha(0),this.rune4=this.addSprite(t-20,e+83,"circle","bright_rune_enhance.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.71).setAlpha(0),this.rune5=this.addSprite(t+20,e+83,"circle","bright_rune_enhance.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.71).setAlpha(0),this.rune6=this.addSprite(t+60,e+83,"circle","bright_rune_enhance.png").setDepth(globalObjects.textPopupManager.getDepth()+1).setScale(.71).setAlpha(0)),this.addTween({targets:[this.rune3,this.rune4,this.rune5,this.rune6],alpha:1,duration:200}),this.addTween({targets:[this.rune3,this.rune4,this.rune5,this.rune6],scaleX:1,scaleY:1,ease:"Quart.easeOut",duration:600,onComplete:()=>{this.addTween({targets:[this.rune3,this.rune4,this.rune5,this.rune6],scaleX:.78,scaleY:.78,ease:"Back.easeOut",duration:400})}}),this.addDelay(()=>{this.playerSpellBodyTrack&&this.playerSpellBodyTrack.unsubscribe(),this.playerSpellBodyTrack2=this.addSubscription("recordSpell",e=>{"timeEnhance"!==e&&"matterEnhance"!==e||(this.playerSpellBodyTrack2.unsubscribe(),this.playerSpellBodyTrack2=null,globalObjects.textPopupManager.hideInfoText(),this.addTween({targets:[this.rune3,this.rune4,this.rune5,this.rune6],alpha:0,duration:200}))})},2e3)):this.justShown=!1},attackStartFunction:()=>{this.healAnim(100),this.currentAttackSetIndex=2,this.nextAttackIndex=0}}]]}}class Goblin extends Enemy{constructor(e,t,a,s){super(e,t,a,s),this.initSprite("gobbo0.png",.92),this.bgMusic=playMusic("bite_down",.7,!0),this.shieldAdded=!1,this.popupTimeout=this.addTimeout(()=>{this.tutorialButton=createTutorialBtn(this.level),this.addToDestructibles(this.tutorialButton)},3e3),this.addSubscription("clearMindBurn",this.clearMindBurn.bind(this)),this.addSubscription("enemyOnFire",this.setOnFire.bind(this))}initStatsCustom(){this.health=gameVars.isHardMode?150:95,this.slashEffect=this.addImage(globalObjects.player.getX(),globalObjects.player.getY()-54,"misc","slash1.png").setScale(.9).setDepth(995).setAlpha(0),this.pullbackScale=.88,this.attackScale=1.22,this.isAnimating=!1,this.attackEase="Quart.easeIn",this.accumulatedAnimDamage=0,this.shieldTextOffsetY=-1}clearMindBurn(){this.burnAnim&&(this.sprite.stop(),this.isAnimating=!1,this.burnAnim=null),this.isBurning=!1,this.dead||(!this.isAnimating&&!this.dead&&0<this.shield&&(this.setSprite("gobbo_extinguish1.png"),this.sprite.play("gobboextinguish"),this.isAnimating=!0,this.sprite.once("animationcomplete",()=>{this.isAnimating=!1,this.setSpriteIfNotInactive(this.defaultSprite)}),playSound("goblin_grunt",.4).detune=500),this.sprite.x=gameConsts.halfWidth+(Math.random()<.5?15:-15),this.addTween({targets:this.sprite,x:gameConsts.halfWidth,ease:"Bounce.easeOut",duration:800}))}setOnFire(e){1<=this.shield&&(this.sprite.stop(),this.isAnimating=!1,this.burnAnim=this.sprite.play("gobboshieldfire"),this.isBurning=!0),this.currDelay=this.addTween({targets:this.sprite,alpha:1,duration:1e3*e-1e3,onComplete:()=>{this.clearMindBurn()}})}takeEffect(e){this.sprite&&("mindStrike"===e.name&&this.shield<=0&&!this.dead?(this.sprite.stop(),this.isAnimating=!1,this.setSprite("gobbo_elec1.png"),this.sprite.x=gameConsts.halfWidth+(Math.random()<.5?-13:13),this.goblinBeingShocked=!0,this.sprite.play("gobboshock"),this.addTween({targets:this.sprite,x:gameConsts.halfWidth,ease:"Bounce.easeOut",easeParams:[1,2.5],duration:260}),this.sprite.once("animationcomplete",()=>{this.setSpriteIfNotInactive(this.defaultSprite),this.goblinBeingShocked=!1})):1<=this.shield&&"mindBurn"==e.name&&(this.sprite.stop(),this.isAnimating=!1,this.burnAnim=this.sprite.play("gobboshieldfire"),this.isBurning=!0)),super.takeEffect(e)}setHealth(e){super.setHealth(e);var e=this.prevHealth/this.healthMax,t=this.health/this.healthMax,a=this.prevHealth-this.health;0!=t&&(12<=a&&0===this.shield&&!this.goblinBeingShocked&&!this.dead&&(this.accumulatedAnimDamage+=a,this.isKnocked=!0,this.setSprite("gobbo_knock1.png"),this.accumTween&&this.accumTween.stop(),this.breatheTween&&(this.breatheTween.stop(),this.breatheTween=null),30<=a&&messageBus.publish("newUnlock","gobbohit"),this.accumulatedAnimDamage<=12||(this.accumulatedAnimDamage<=24?(playSound("derp",.4),this.addDelay(()=>{playSound("derp",.5).detune=300},150),this.sprite.play("gobboknock2")):this.accumulatedAnimDamage<=36?(this.sprite.play("gobboknock3"),playSound("derp",.4),this.addDelay(()=>{playSound("derp",.5).detune=300,this.addDelay(()=>{playSound("derp",.5).detune=600},120)},120)):36<this.accumulatedAnimDamage&&(this.sprite.play("gobboknock4"),playSound("derp",.4),this.addDelay(()=>{playSound("derp",.5).detune=300,this.addDelay(()=>{playSound("derp",.5).detune=600,this.addDelay(()=>{playSound("derp",.6).detune=900},100)},100)},100))),this.sprite.rotation=-.17,this.accumTween=this.addTween({targets:this.sprite,rotation:.03,easeParams:[1.8],ease:"Back.easeIn",duration:650+Math.floor(5.5*this.accumulatedAnimDamage),completeDelay:100,onComplete:()=>{this.isKnocked=!1,this.accumulatedAnimDamage=0,this.setSprite(this.defaultSprite),this.dead||(this.sprite.rotation=0)}})),.99<=e&&t<.99&&(this.currentAttackSetIndex=1,this.nextAttackIndex=0),this.shieldAdded)&&2==this.currentAttackSetIndex&&0===this.shield&&(this.breatheTween&&(this.breatheTween.stop(),this.breatheTween=null),this.setDefaultSprite("gobbo2.png",.92),this.interruptCurrentAttack(),this.currentAttackSetIndex=3,this.nextAttackIndex=0,playSound("goblin_grunt",.95).detune=0,playSound("clunk"))}initAttacks(){this.attacks=[[{name:gameVars.isHardMode?"}8 ":"}4 ",desc:"The goblin waves his\nlittle knife in front\nof your face",chargeAmt:250,damage:gameVars.isHardMode?8:4,attackSprites:["gobbo0_atk.png"],attackFinishFunction:()=>{this.makeSlashEffect(),playSound("sword_hit",.75)}}],[{name:"FANCY SHIELD {60",block:60,isPassive:!0,customCall:" ",chargeAmt:290,transitionFast:!0,startFunction:()=>{this.attackScale=1},attackStartFunction:()=>{playSound("clunk");var e=getTempPoolObject("spells","brickPattern2.png","brickPattern",700);e.setPosition(this.x,this.y).setScale(.8).setDepth(-1).setAlpha(.5),this.addTween({targets:e,scaleX:.85,scaleY:.85,duration:700,ease:"Cubic.easeOut"}),this.addTween({targets:e,alpha:0,ease:"Cubic.easeIn",duration:700}),this.setDefaultSprite("gobboshield1.png",.92).play("gobboshield")},attackFinishFunction:()=>{this.currentAttackSetIndex=2,this.nextAttackIndex=0,this.repeatTweenBreathe(),this.shieldAdded=!0,messageBus.publish("showCombatText",getLangText("goblin_shield"),-41)}}],[{name:gameVars.isHardMode?"}12 ":"}7 ",desc:"Goblin rams you with\nhis shield",chargeAmt:450,damage:gameVars.isHardMode?12:7,startFunction:()=>{this.pullbackScale=.85,this.attackScale=1.3,this.shownTut||this.addDelay(()=>{this.shownTut=!0,globalObjects.textPopupManager.setInfoText(gameConsts.width,gameConsts.halfHeight-150,getLangText("energy_tut_goblin"),"right");var e=globalObjects.textPopupManager.getBoxBottomPos(),t=globalObjects.textPopupManager.getCenterPos(),a=globalObjects.bannerTextManager.getDepth()+1;this.rune3=this.addImage(t-32,e+17,"circle","bright_rune_mind.png").setDepth(a).setScale(.78,.78).setAlpha(0),this.rune4=this.addImage(t+38,e+17,"circle","bright_rune_enhance.png").setDepth(a).setScale(.78,.78).setAlpha(0),messageBus.publish("closeCombatText"),this.addTween({targets:[this.rune3,this.rune4],scaleX:1,scaleY:1,ease:"Quart.easeOut",duration:500,onComplete:()=>{this.addTween({targets:[this.rune3,this.rune4],scaleX:.8,scaleY:.8,ease:"Back.easeOut",duration:300})}}),this.addTween({targets:[this.rune3,this.rune4],alpha:1,duration:200,completeDelay:1e3,onComplete:()=>{this.playerSpellCastSub=this.addSubscription("playerCastedSpell",()=>{this.playerSpellCastSub.unsubscribe(),this.addTimeout(()=>{this.addTween({targets:[this.rune3,this.rune4],alpha:0,duration:300,onComplete:()=>{this.rune3.visible=!1,this.rune4.visible=!1}}),globalObjects.textPopupManager.hideInfoText()},300)})}})},1250)},attackFinishFunction:()=>{playSound("body_slam");let e=getTempPoolObject("spells","damageEffect3.png","damageEffect3",200);e.play("damageEffectShort"),e.setPosition(gameConsts.halfWidth+20*(Math.random()-.5),globalObjects.player.getY()-185).setDepth(998).setScale(1.35),this.addTimeout(()=>{e.x+=10,e.y+=10},100)},finaleFunction:()=>{this.isBurning&&!this.dead&&0<this.shield&&(this.burnAnim.stop(),this.burnAnim=this.sprite.play("gobboshieldfire"))}}],[{name:"MY SHIELD!",isPassive:!0,chargeAmt:300,chargeMult:8,customCall:" ",transitionFast:!0,damage:0,startFunction:()=>{this.accumTween&&this.accumTween.stop(),messageBus.publish("closeCombatText"),this.sprite.x=gameConsts.halfWidth+(Math.random()<.5?15:-15),this.addTween({targets:this.sprite,x:gameConsts.halfWidth,ease:"Bounce.easeOut",duration:1e3})}},{name:"GETTING KNIVES!",isPassive:!0,chargeAmt:300,chargeMult:5,isBigMove:!0,startFunction:()=>{this.pullbackScale=.91,this.attackScale=1.16,this.setDefaultSprite("gobbo3.png",.92)},attackFinishFunction:()=>{playSound("goblin_aha"),this.currentAttackSetIndex=4,this.nextAttackIndex=0,this.setDefaultSprite("gobbo4.png",.92);var e=this.sprite.scaleX;this.sprite.setScale(1.01*this.sprite.scaleX),this.currAnim=this.addTween({targets:this.sprite,scaleX:e,scaleY:e,duration:600,completeDelay:100,onComplete:()=>{this.setDefaultSprite("gobbo5.png",.92),this.repeatTweenBreathe(800,.5)}})}}],[{name:"}4x2 ",chargeAmt:gameVars.isHardMode?150:200,damage:4,attackTimes:2,prepareSprite:"",attackSprites:["gobboAttack1.png","gobboAttack2.png"],attackFinishFunction:()=>{this.makeSlashEffect()}},{name:"}4x3 ",chargeAmt:gameVars.isHardMode?170:220,damage:4,attackTimes:3,attackSprites:["gobboAttack1.png","gobboAttack2.png"],attackFinishFunction:()=>{this.makeSlashEffect()}},{name:"}4x4 ",chargeAmt:gameVars.isHardMode?190:240,damage:4,attackTimes:4,attackSprites:["gobboAttack1.png","gobboAttack2.png"],attackFinishFunction:()=>{this.makeSlashEffect()}},{name:"LAUGH IN YOUR FACE",isPassive:!0,chargeAmt:600,finishDelay:1e3,chargeMult:5,damage:-1,tease:!0,attackSprites:["gobbo4.png"],attackFinishFunction:()=>{playSound("goblin_aha")}}]]}makeSlashEffect(){screenShake(4),playSound("sword_slice",.7).detune=Math.floor(200*Math.random()-100),this.slashEffectAnim&&this.slashEffectAnim.stop();var e=0<this.slashEffect.scaleX;this.slashEffect.setAlpha(1.2).setScale(e?-.5:.5,.4),this.slashEffectAnim=this.addTween({targets:this.slashEffect,delay:25,duration:330,ease:"Quart.easeIn",alpha:0}),this.addTween({targets:this.slashEffect,scaleX:e?-1.05:1.05,scaleY:.65,duration:340,ease:"Quart.easeOut",alpha:0})}initSpriteAnim(e){super.initSpriteAnim(e),this.sprite.startX=this.sprite.x,this.sprite.x=gameConsts.halfWidth+150,this.sprite.setRotation(.05),this.addTween({targets:this.sprite,rotation:-.05,duration:150,yoyo:!0,completeDelay:20,onComplete:()=>{this.addTween({targets:this.sprite,rotation:-.05,duration:180,yoyo:!0,completeDelay:20,onComplete:()=>{this.addTween({targets:this.sprite,rotation:-.05,duration:210,completeDelay:20,onComplete:()=>{this.addTween({targets:this.sprite,rotation:0,ease:"Quad.easeOut",duration:250,onComplete:()=>{this.repeatTweenBreathe()}})}})}})}}),this.addTween({targets:this.sprite,x:this.sprite.startX,duration:1350,ease:"Cubic.easeOut"})}repeatTweenBreathe(a=1500,s=1,e){if(!this.dead&&!this.isDestroyed){this.breatheTween&&(this.breatheTween.stop(),this.breatheTween=null);let t=Math.ceil(3.5*s);var i=this.isBurning?.18:1;this.breatheTween=this.addTween({targets:this.sprite,duration:a*(.5*Math.random()+1)*i,rotation:this.isKnocked?0:-.02*s,x:this.sprite.startX-t,ease:"Cubic.easeInOut",completeDelay:150,onComplete:()=>{var e=this.isBurning?.2:1;this.breatheTween=this.addTween({targets:this.sprite,duration:a*(.5*Math.random()+1)*e,rotation:this.isKnocked?0:.02*s,x:this.sprite.startX+t,ease:"Cubic.easeInOut",completeDelay:150,onComplete:()=>{this.repeatTweenBreathe(a,s,!0)}})}})}}die(){this.dead||(super.die(),messageBus.publish("closeCombatText"),this.burnAnim&&this.burnAnim.stop(),this.sprite.stop(),this.isAnimating=!1,this.currAnim&&this.currAnim.stop(),this.sprite.rotation=0,this.accumTween&&this.accumTween.stop(),globalObjects.textPopupManager.hideInfoText(),this.rune3&&(this.rune3.visible=!1,this.rune4.visible=!1),this.dieClickBlocker=new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:gameConsts.halfHeight,alpha:.001,scaleX:1e3,scaleY:1e3},onMouseUp:()=>{}}),this.addTween({targets:this.sprite,rotation:-.2,ease:"Cubic.easeIn",duration:25,onComplete:()=>{playSound("goblin_grunt",.8).detune=-150,this.setDefaultSprite("gobboDead.png"),this.sprite.setRotation(0),this.x-=5,this.y+=48,this.addTimeout(()=>{this.showFlash(this.x,this.y),this.addTimeout(()=>{let e=this.addImage(this.x,this.y,"tutorial","rune_protect_large.png").setScale(.5).setDepth(9999);playSound("victory_2"),this.addTween({targets:e,x:gameConsts.halfWidth,y:gameConsts.halfHeight-170,scaleX:1,scaleY:1,ease:"Cubic.easeOut",duration:1500,onComplete:()=>{this.showVictory(e)}})},250)},2300)}}))}}class KillerRobotDemo extends Enemy{constructor(e,t,a,s){super(e,t,a,s),this.initSprite("robot_dead.png",1),this.shieldAdded=!1,this.sprite.startY=a,this.addTimeout(()=>{this.setAsleep()},10),this.sprite.alpha=0,this.sprite.rotation=-.2,this.addTimeout(()=>{this.initPreBattleLogic()},10)}initSpriteAnim(){}initPreBattleLogic(){this.lightShineLeft=this.addSprite(this.sprite.x,this.sprite.y,"blurry","star_blur.png").setDepth(-1).setAlpha(0).setRotation(-.9).setScale(.2),this.lightShineLeftTop=this.addSprite(this.lightShineLeft.x,this.lightShineLeft.y,"blurry","star_blur.png").setDepth(12).setAlpha(0).setRotation(this.lightShineLeft.rotation),this.musicNote=this.addImage(-100,0,"blurry","note.png").setScale(0).setDepth(),this.addTween({delay:500,targets:this.lightShineLeft,alpha:.9,duration:400}),this.addTween({delay:500,targets:this.lightShineLeft,scaleX:.75,scaleY:.75,duration:400,ease:"Cubic.easeIn",onComplete:()=>{this.addTween({targets:this.lightShineLeft,scaleX:0,scaleY:0,duration:450,ease:"Cubic.easeOut"})}}),this.addTween({delay:500,targets:this.lightShineLeft,rotation:"+=0.2",duration:1250}),this.addTween({delay:650,targets:this.sprite,duration:800,alpha:1,ease:"Quad.easeIn"}),this.addTween({delay:700,targets:this.sprite,duration:800,rotation:"-=0.1"}),this.addTween({delay:700,targets:this.sprite,duration:800,y:"+=70",ease:"Cubic.easeIn",onComplete:()=>{playSound("clunk"),this.addTween({targets:this.sprite,duration:650,rotation:.15,onComplete:()=>{playSound("clunk",.5).detune=400,this.addDelayIfAlive(()=>{playSound("clunk2",.4).detune=400},100),this.addTween({targets:this.sprite,duration:250,rotation:0,ease:"Bounce.easeOut"})}}),this.addTween({targets:this.sprite,duration:400,y:"-=5",ease:"Cubic.easeOut",onComplete:()=>{this.addTween({targets:this.sprite,duration:500,y:"+=7",ease:"Bounce.easeOut",completeDelay:1300,onComplete:()=>{this.bgMusic=playMusic("jpop",.3,!0),fadeInSound(this.bgMusic,.85,1200),this.playMusicNoteRepeat()}})}})}})}initPreStats(){}initStatsCustom(){this.health=10}playMusicNoteRepeat(){var e,t;this.dead||(e=Math.floor(100*Math.random()-50),this.musicNote.x=this.sprite.x-.7*e,this.musicNote.y=this.sprite.y,t=Math.floor(40*Math.random()+100),this.addTween({targets:this.musicNote,scaleX:1,scaleY:1,ease:"Quart.easeOut",duration:400,onComplete:()=>{this.addTween({delay:700,targets:this.musicNote,scaleX:0,scaleY:0,ease:"Quart.easeIn",duration:400})}}),this.addTween({targets:this.musicNote,x:"-="+e,y:"-="+t,ease:"Quart.easeOut",duration:1500,onComplete:()=>{this.playMusicNoteRepeat()}}))}setHealth(e){super.setHealth(e);this.prevHealth,this.healthMax;e=this.health/this.healthMax;0!=e&&e<.99&&(this.playedSound||(this.playedSound=!0,playSound("voca_short_pain")),this.addDelayIfAlive(()=>{this.bgMusic.detune=60*this.health-1200},150))}initAttacks(){this.attacks=[[{name:"|12",chargeAmt:350,damage:12,attackTimes:1,startFunction:()=>{},attackStartFunction:()=>{}}]]}die(){if(!this.dead){super.die(),this.currAnim&&this.currAnim.stop(),globalObjects.bannerTextManager.closeBanner(),playSound("voca_kya_damaged",.15).seek=.85,playSound("cutesy_down",.8),this.lightShineLeft.visible=!1,this.lightShineLeftTop.visible=!1;let e=this.addSprite(this.sprite.x,this.sprite.y,"enemies","robot_blast.png").setDepth(0).setOrigin(.5,.65).setScale(.2).setAlpha(.5);this.addTween({targets:e,alpha:0,duration:700,ease:"Quad.easeIn",onComplete:()=>{e.destroy()}}),this.addTween({targets:e,scaleX:.6,scaleY:.6,duration:700,ease:"Cubic.easeOut"}),globalObjects.textPopupManager.hideInfoText(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton(),this.dieClickBlocker=new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:gameConsts.halfHeight,alpha:.001,scaleX:1e3,scaleY:1e3},onMouseUp:()=>{}}),globalObjects.magicCircle.disableMovement(),playSound("clunk"),this.sprite.setRotation(.2),this.sprite.y-=5,this.addTween({targets:this.sprite,rotation:0,ease:"Quart.easeIn",duration:1500}),this.sprite.alpha=.5,this.addTween({targets:this.sprite,y:"+=7",ease:"Back.easeIn",duration:1500,onComplete:()=>{playSound("clunk2");let e=this.addSprite(this.x,this.y,"tutorial","rune_protect_large.png").setScale(0).setVisible(!1);this.addTween({targets:e,x:gameConsts.halfWidth,y:gameConsts.halfHeight-170,scaleX:1,scaleY:1,ease:"Cubic.easeOut",duration:3e3,onComplete:()=>{this.showVictory(e)}})}})}}showVictory(e){sdkGameplayStop(),globalObjects.magicCircle.disableMovement();let t=this.addSprite(gameConsts.halfWidth,gameConsts.halfHeight-35,"misc","victory_banner.png").setScale(100,1.2).setDepth(9998).setAlpha(0),a=this.addSprite(gameConsts.halfWidth,gameConsts.halfHeight-44,"misc","victory_text.png").setScale(.95).setDepth(9998).setAlpha(0),s=this.addText(gameConsts.width-15,gameConsts.halfHeight+2,getLangText("cont_ui"),{fontFamily:"Verdana",color:"#F0F0F0",fontSize:20}).setAlpha(0).setOrigin(1,.5).setAlign("right").setDepth(9998);this.addTween({targets:t,alpha:.75,duration:500}),this.addTween({targets:[a],alpha:1,ease:"Quad.easeOut",duration:500}),playSound("victory_false"),this.addTimeout(()=>{s.alpha=1},1e3),this.addTween({targets:a,scaleX:1,scaleY:1,duration:800}),this.addTween({targets:e,y:gameConsts.halfHeight-110,ease:"Cubic.easeOut",duration:400,onComplete:()=>{canvas&&(canvas.style.cursor="pointer"),this.dieClickBlocker.setOnMouseUpFunc(()=>{canvas&&(canvas.style.cursor="default"),this.dieClickBlocker.destroy(),s.destroy(),this.addTween({targets:[a,t],alpha:0,duration:400,onComplete:()=>{a.destroy(),t.destroy(),gotoMainMenu()}}),e.destroy()})}})}}class Knight extends Enemy{constructor(e,t,a,s){super(e,t,a,s),this.initSprite("void_knight.png",1),this.sprite.setOrigin(.5,.5),this.shieldAdded=!1,this.initMisc(),this.popupTimeout=this.addTimeout(()=>{this.tutorialButton=createTutorialBtn(this.level),this.addToDestructibles(this.tutorialButton)},3e3),this.addTimeoutIfAlive(()=>{globalObjects.magicCircle.disableMovement(),this.initFog(),this.setAsleep(),this.bgMusic=playMusic("into_the_void",0,!0),fadeInSound(this.bgMusic,.8,400)},0),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton()}initStatsCustom(){this.health=gameVars.isHardMode?150:130,this.eyeObjects=[],this.pullbackScale=.92,this.attackScale=1.11,this.isFirstMode=!0,this.shieldAmts=0,this.shieldTextFont="void",this.shieldsActive=0,this.eyeShieldObjects=[],this.eyeUpdateTick=30,this.lastAttackLingerMult=1.2,this.slashEffect=this.addImage(globalObjects.player.getX(),globalObjects.player.getY()-55,"misc","slash1.png").setScale(.9).setDepth(995).setAlpha(0),this.voidSlashEffect=this.addImage(globalObjects.player.getX(),globalObjects.player.getY()-260,"spells","darkSlice.png").setScale(.8).setDepth(995).setAlpha(0).setOrigin(.15,.5),this.voidSlashEffect2=this.addImage(globalObjects.player.getX(),globalObjects.player.getY()-260,"spells","darkSlice.png").setScale(.8).setDepth(995).setAlpha(0).setOrigin(.15,.5),this.isFirstVoidSlash=!0,this.shieldTextOffsetY=-20,this.shieldTextSize=52}customReaperAnim(){let a=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight-185,"misc","locket2.png").setOrigin(.5,.5).setDepth(200).setAlpha(0).setRotation(.25).setScale(.6);a.currAnim=PhaserScene.tweens.add({delay:500,targets:a,scaleX:.8,scaleY:.8,alpha:1,ease:"Quart.easeOut",rotation:0,y:"+=12",duration:2300,onStart:()=>{playSound("whoosh");var e=playSound("sleepless",.1);fadeInSound(e,.8,750)},onComplete:()=>{playSound("locket_open"),playSound("water_drop",.6);var e=PhaserScene.add.image(a.x,a.y,"circle","circle.png").setDepth(99).setScale(.3).setAlpha(1.1);PhaserScene.tweens.add({targets:e,scaleX:1.5,scaleY:1.5,ease:"Quart.easeOut",duration:2e3}),PhaserScene.tweens.add({targets:e,alpha:0,ease:"Quad.easeOut",duration:1950}),a.setScale(.98*a.scaleX),a.y+=3,PhaserScene.tweens.add({targets:a,scaleX:1.025*a.scaleX,scaleY:1.025*a.scaleX,ease:"Cubic.easeOut",y:"-=2",duration:70,onComplete:()=>{a.setFrame("locket3.png"),PhaserScene.tweens.add({targets:a,scaleX:.98*a.scaleX,scaleY:.98*a.scaleX,ease:"Back.easeOut",y:"+=1",duration:250,onComplete:()=>{PhaserScene.tweens.add({delay:50,targets:a,alpha:0,scaleX:.91*a.scaleX,scaleY:.91*a.scaleX,ease:"Back.easeIn",y:"+=44",duration:2500})}})}});let t=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"pixels","white_pixel.png").setScale(500,500).setAlpha(0).setDepth(15e4);PhaserScene.tweens.add({targets:t,rotation:0,duration:2500,onComplete:()=>{clearDeathFog()}}),PhaserScene.tweens.add({targets:t,alpha:1,ease:"Quad.easeIn",duration:2900,onComplete:()=>{a.destroy(),gotoMainMenu();let e=new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:gameConsts.halfHeight,alpha:.15,scaleX:1e3,scaleY:1e3},onMouseUp:()=>{}});globalObjects.postFightScreen.clearGloom(),PhaserScene.tweens.add({targets:t,alpha:0,ease:"Quad.easeOut",duration:800,onComplete:()=>{e.destroy(),showWishlistPage()}})}})}})}initSpriteAnim(e){this.sprite.setScale(e),this.sprite.setAlpha(0);let t=this.addImage(this.sprite.x,this.sprite.y-2,"enemies","void_knight_fog.png").setDepth(this.sprite.depth+1).setOrigin(this.sprite.originX,this.sprite.originY).setAlpha(0);t.setScale(.96*e),setTimeout(()=>{this.bgMusic=playMusic("into_the_void",.05,!0),fadeInSound(this.bgMusic,.89,400)},100),this.scene.tweens.add({targets:t,duration:1200,scaleX:e,scaleY:e,y:"+=2",ease:"Cubic.easeOut",alpha:1,onComplete:()=>{this.sprite.alpha=1,globalObjects.magicCircle.enableMovement(),this.scene.tweens.add({delay:250,targets:t,duration:2500,ease:"Cubic.easeInOut",alpha:0}),this.voidTentaEye=this.addImage(this.x+50,this.y-30,"enemies","void_tentacle_eye.png").setDepth(this.sprite.depth-1).setRotation(-1.2).setScale(1.3).setVisible(!1),this.voidTentaEye.visible=!0,this.addTween({targets:this.voidTentaEye,rotation:0,ease:"Back.easeOut",scaleX:1.2,x:"+=25",y:"-=20",scaleY:1.2,duration:650,onComplete:()=>{this.addTween({targets:this.voidTentaEye,rotation:-.05,ease:"Back.easeOut",scaleX:1.15,scaleY:1.15,duration:400,onComplete:()=>{this.addTween({targets:this.voidTentaEye,rotation:-.38,y:"-=20",x:"+=10",ease:"Quad.easeInOut",duration:250,yoyo:!0,repeat:1,onComplete:()=>{this.addTween({targets:this.voidTentaEye,rotation:-.19,y:"-=10",x:"+=5",ease:"Back.easeOut",duration:350,onComplete:()=>{this.addTween({delay:100,targets:this.voidTentaEye,rotation:-1.1,x:"-=42",ease:"Back.easeIn",scaleX:1,scaleY:1,duration:350,onStart:()=>{playSound("meat_click_right",.2),playSound("void_body",.35),globalObjects.encyclopedia.showButton(),globalObjects.options.showButton()},onComplete:()=>{this.voidTentaEye.x+=12,this.voidTentaEye.visible=!1}})}})}})}})}}),messageBus.publish("showCombatText","...",-15,()=>{this.setAwake()},.6),this.spellCastCount=0,this.playerSpellCastSub=this.addSubscription("playerCastedSpell",()=>{this.spellCastCount++,2<=this.spellCastCount&&(this.playerSpellCastSub.unsubscribe(),this.playerSpellCastSub=null,messageBus.publish("closeCombatText"),this.addDelayIfAlive(()=>{messageBus.publish("showCombatText","!!!",-20,void 0,.6),this.addDelayIfAlive(()=>{messageBus.publish("closeCombatText")},2e3)},500))})}}),this.repeatTweenBreathe()}initMisc(){this.voidShield1b=this.addImage(this.sprite.x,this.sprite.y,"enemies","void_knight_shield_2.png").setScale(1.04).setDepth(3).setAlpha(0),this.voidShield1b.startScale=this.voidShield1b.scaleX,this.voidShield2b=this.addImage(this.sprite.x,this.sprite.y,"enemies","void_knight_shield_2.png").setScale(1.28).setDepth(3).setAlpha(0),this.voidShield2b.startScale=this.voidShield2b.scaleX,this.sigilEffect=this.addImage(this.x,this.y,"enemies","void_knight_sigil.png").setScale(this.sprite.startScale).setDepth(5).setAlpha(0),this.shieldExtraText=this.addBitmapText(gameConsts.halfWidth,this.y+this.shieldTextOffsetY+24,"void","SHIELDED",52).setOrigin(.5).setDepth(18).setVisible(!1)}initFog(){this.bg1=PhaserScene.add.image(gameConsts.halfWidth,.7*gameConsts.halfHeight+1,"backgrounds","background8.webp").setDepth(-10).setScale(1).setAlpha(0).setOrigin(.5,.35),this.fogThick=this.addImage(gameConsts.halfWidth,gameConsts.halfHeight-200,"blurry","fogthick.png").setDepth(9).setAlpha(0).setOrigin(.5,.25).setScale(2),this.graves=this.addImage(gameConsts.halfWidth,gameConsts.height+8,"backgrounds","graves.png").setDepth(9).setScale(1.25,1).setAlpha(0).setOrigin(.5,1),this.addTween({delay:500,targets:[this.bg1],duration:3500,alpha:1,ease:"Cubic.easeInOut"}),this.addTween({targets:[this.fogThick],duration:1e3,alpha:1,scaleX:2,ease:"Cubic.easeInOut"}),this.addTween({targets:[this.graves],alpha:1,duration:1500,scaleX:.98,ease:"Cubic.easeIn"})}reactToDamageTypes(e,t,s){if(super.reactToDamageTypes(e,t,s),!this.emergency&&!this.dead&&this.isFirstMode&&!this.isUsingAttack){let e=this.accumulatedDamageReaction,a=("time"===s&&(e-=10,9<=this.accumulatedDamageReaction)&&(this.setSprite("void_knight_dazed.png"),this.reactTween&&this.reactTween.stop(),this.reactTween=this.addTween({targets:this.sprite,rotation:0,duration:1100,onComplete:()=>{this.isUsingAttack||this.dead||!this.isFirstMode||this.setSprite(this.defaultSprite)}})),0);26<=e&&(a=1,42<=e)&&(a=2);var i=Math.random()<.5;if(0<a)for(let t=0;t<a;t++){let e=getTempPoolObject("enemies","void_shock.png","voidshock",750);e.setDepth(0).setPosition(this.x,this.y).setScale(i?-.1:.1,.6).setAlpha(.15);var h=1.4+Math.random();e.setRotation(Math.random()-.5),this.addTween({delay:70*t,targets:e,scaleX:i?-h:h,scaleY:h-.25,ease:"Cubic.easeIn",alpha:.25+.25*a,duration:100,onComplete:()=>{this.addTween({targets:e,scaleX:.4,scaleY:.7,ease:"Cubic.easeOut",alpha:0,duration:450})}})}}}launchAttack(e=1,t,a,s,i,h,r=!1){this.sigilEffect.visible=!1,this.voidTentacleFront&&!this.nextAttack.isPassive&&(this.voidTentacleFront.visible=!1,this.voidTentacleBack.visible=!1),super.launchAttack(e,t,a,s,i,h,r)}repeatTweenBreathe(a=!0){if(!this.dead){this.breatheTween=this.addTween({targets:this.sigilEffect,duration:2e3,alpha:1,ease:"Cubic.easeInOut",onComplete:()=>{this.breatheTween=this.addTween({targets:this.sigilEffect,duration:2e3,alpha:0,ease:"Cubic.easeInOut",onComplete:()=>{this.repeatTweenBreathe(!a)}})}});let e=gameConsts.halfHeight-200+(a?3:-2);let t=2+(a?.06:0);this.fogTween=this.addTween({targets:this.fogThick,duration:4e3,x:gameConsts.halfWidth+(a?40:-40),ease:"Cubic.easeInOut"}),this.fogTween=this.addTween({targets:this.fogThick,duration:2e3,y:e,alpha:1,scaleX:t,ease:"Cubic.easeInOut",completeDelay:200,onComplete:()=>{this.fogTween=this.addTween({targets:this.fogThick,duration:1800,y:e,alpha:.6,scaleX:t,ease:"Cubic.easeInOut",onComplete:()=>{}})}})}}repeatVoidTweenBreathe(){var e,t,a,s;this.dead||(e=.075*(Math.random()-.5),t=this.sprite.startScale-.02+.04*Math.random(),a=this.sprite.startScale-.02+.04*Math.random(),s=1e3+Math.floor(500*Math.random()),this.breatheTween=this.addTween({targets:this.voidTentacleFront,duration:s,rotation:e,scaleX:t,scaleY:t,ease:"Cubic.easeInOut",onComplete:()=>{this.repeatVoidTweenBreathe()}}),this.breatheTween2=this.addTween({delay:200,targets:this.voidTentacleBack,duration:s-200,scaleX:a,scaleY:a,ease:"Cubic.easeInOut"}))}setHealth(e,t){0<this.shieldAmts&&!t?(this.damageVoidShield(),super.setHealth(this.health)):(super.setHealth(e),this.prevHealth,this.healthMax,0!=(t=this.health/this.healthMax)&&t<.9999&&this.playerSpellCastSub&&(this.playerSpellCastSub.unsubscribe(),this.playerSpellCastSub=null,messageBus.publish("closeCombatText"),this.addDelayIfAlive(()=>{messageBus.publish("showCombatText","!!!",-20,void 0,.6),this.addDelayIfAlive(()=>{messageBus.publish("closeCombatText")},2e3)},500)))}createEyeObject(e,t,a,s=0){e=this.addImage(t,a,"enemies",e).setRotation(3*(Math.random()-.5)).setScale(0).setDepth(110),this.eyeObjects.push(e),t=gameConsts.halfWidth-t,a=globalObjects.player.getY()-175-a,a=Math.atan2(a,t)-1.57;this.addTween({delay:s,targets:e,scaleX:1,scaleY:1,ease:"Back.easeOut",easeParams:[2],duration:300}),this.addTween({delay:s,targets:e,ease:"Cubic.easeOut",rotation:a,duration:500})}update(e){if(super.update(e),this.eyeUpdateTick-=e,this.eyeUpdateTick<0){this.eyeUpdateTick=25;for(let t=0;t<this.eyeShieldObjects.length;t++)if(Math.random()<.4){let e=this.eyeShieldObjects[t];var a,s,i;Math.random()<.1?this.addTween({delay:Math.floor(125*Math.random()),targets:[e.front],scaleY:0,duration:150,ease:"Cubic.easeIn",onComplete:()=>{this.addTween({targets:[e.front],scaleX:e.front.startScale,scaleY:e.front.startScale,duration:150,ease:"Cubic.easeOut"})}}):(i=Math.random()*e.front.startScale*8,s=2*Math.random()*Math.PI,a=Math.sin(s)*i,s=Math.cos(s)*i,i=.15*Math.random(),i*=i,i=e.front.startScale-.04+i,this.addTween({delay:Math.floor(125*Math.random()),targets:[e.front],x:e.back.x+a,y:e.back.y+s,scaleX:i,scaleY:i,duration:400+350*Math.random(),ease:"Quart.easeOut"}))}}}damageVoidShield(){this.shieldAmts--,this.shakeShieldText(),playSound("meat_click_left",.4),playSound("meat_click_right",.4),this.shieldAmts<=0?(messageBus.publish("animateBlockNum",gameConsts.halfWidth,this.sprite.y+50,"-BROKE-",1.05,{y:"+=5",ease:"Quart.easeOut"},{alpha:0,scaleX:1,scaleY:1}),this.clearVoidShield()):(messageBus.publish("animateBlockNum",gameConsts.halfWidth+75-150*Math.random(),this.sprite.y+50-100*Math.random(),"NEGATED",.75,{alpha:.8},{alpha:0}),1===this.shieldsActive?(this.voidShield1b.setScale(1.12*this.voidShield1b.startScale),this.addTween({targets:[this.voidShield1b],scaleX:this.voidShield1b.startScale,scaleY:this.voidShield1b.startScale,duration:250,ease:"Cubic.easeOut"})):this.shieldAmts<=3?(this.voidShield2b.repeatTween&&this.voidShield2b.repeatTween.stop(),this.addTween({targets:[this.voidShield2b],scaleX:1.2*this.voidShield2b.startScale,scaleY:1.2*this.voidShield2b.startScale,alpha:0,duration:250,ease:"Cubic.easeOut"}),this.voidShield1b.setScale(1.25*this.voidShield1b.startScale),this.addTween({targets:[this.voidShield1b],scaleX:this.voidShield1b.startScale,scaleY:this.voidShield1b.startScale,duration:350,ease:"Cubic.easeOut"})):(this.voidShield2b.setScale(1.1*this.voidShield2b.startScale),this.addTween({targets:[this.voidShield2b],scaleX:this.voidShield2b.startScale,scaleY:this.voidShield2b.startScale,duration:250,ease:"Cubic.easeOut"}))),0<this.eyeShieldObjects.length&&this.killEye(this.eyeShieldObjects.pop())}shakeShieldText(){this.shieldAmts<=0&&(this.shieldText.visible=!1),this.shieldText.setText(this.shieldAmts);let e=Math.random()<.5;this.scene.tweens.add({targets:this.shieldText,scaleX:this.shieldText.startScale+1,scaleY:this.shieldText.startScale+1,y:"-=3",x:e?"-=6":"+=6",duration:60*gameVars.gameManualSlowSpeedInverse,ease:"Quint.easeOut",onComplete:()=>{this.scene.tweens.add({targets:this.shieldText,scaleX:this.shieldText.startScale,scaleY:this.shieldText.startScale,y:"+=3",duration:500*gameVars.gameManualSlowSpeedInverse,ease:"Quart.easeOut"}),this.scene.tweens.add({targets:this.shieldText,x:e?"+=13":"-=13",duration:100*gameVars.gameManualSlowSpeedInverse,ease:"Quint.easeInOut",onComplete:()=>{this.shieldText.setDepth(8),this.scene.tweens.add({targets:this.shieldText,x:this.shieldText.startX,duration:400*gameVars.gameManualSlowSpeedInverse,ease:"Bounce.easeOut"}),this.scene.tweens.add({delay:1e3,targets:this.shieldText,alpha:.75,duration:1500})}})}})}createVoidShield(e,t){this.shieldExtraText.setVisible(!0).setScale(.4).setAlpha(1),this.addTween({targets:this.shieldExtraText,scaleX:1,scaleY:1,ease:"Back.easeOut",duration:150,completeDelay:1800,onComplete:()=>{this.addTween({targets:this.shieldExtraText,scaleX:.2,scaleY:.25,alpha:0,ease:"Quart.easeIn",duration:400})}});var a=getBackgroundBlackout();a.setDepth(-3).setAlpha(.35),this.spaceBG=this.addImage(gameConsts.halfWidth,gameConsts.halfHeight,"backgrounds","star.png").setDepth(-3).setAlpha(.45).setScale(1.2),this.scene.tweens.add({targets:[this.spaceBG,a],alpha:0,ease:"Cubic.easeOut",duration:1800,onComplete:()=>{}}),this.shieldText.visible=!0,this.shieldText.setText(e),this.shieldText.setScale(.1),this.shieldText.startX=this.shieldText.x,this.shieldText.startScale=.82,this.scene.tweens.add({targets:this.shieldText,scaleX:this.shieldText.startScale,scaleY:this.shieldText.startScale,ease:"Back.easeOut",duration:250*gameVars.gameManualSlowSpeedInverse}),this.scene.tweens.add({delay:1e3,targets:this.shieldText,alpha:.75,duration:1500}),playSound("void_shield");let s=1;t&&(s=1,this.voidShield1b.startScale=this.voidShield1b.startScale*s),this.voidShield1b.setScale(1.15*this.voidShield1b.startScale).setAlpha(.5),this.addTween({targets:[this.voidShield1b],scaleX:this.voidShield1b.startScale,scaleY:this.voidShield1b.startScale,duration:200,alpha:1,ease:"Cubic.easeIn",onComplete:()=>{this.voidShield1b.repeatTween=this.addTween({targets:this.voidShield1b,alpha:.8,duration:2e3,scaleX:.99*this.voidShield1b.startScale,scaleY:.99*this.voidShield1b.startScale,yoyo:!0,repeat:-1,ease:"Quad.easeInOut"})}}),this.createShieldEye(this.x,this.y+103*s,.5),this.createShieldEye(this.x+47*s,this.y+95*s,.44),this.createShieldEye(this.x-47*s,this.y+95*s,.44),t?(this.voidShield2b.setScale(1.15*this.voidShield2b.startScale).setAlpha(.5),this.addTween({delay:400,targets:[this.voidShield2b],scaleX:1.01*this.voidShield2b.startScale,scaleY:1.01*this.voidShield2b.startScale,duration:200,alpha:1,ease:"Cubic.easeIn",onStart:()=>{playSound("void_shield"),this.voidShield2b.visible=!0},onComplete:()=>{this.voidShield2b.repeatTween=this.addTween({targets:this.voidShield2b,alpha:.8,duration:2e3,scaleX:.99*this.voidShield2b.startScale,scaleY:.99*this.voidShield2b.startScale,yoyo:!0,repeat:-1,ease:"Quad.easeInOut"})}}),this.shieldsActive=2,this.createShieldEye(this.x-86,this.y+111,.38),this.createShieldEye(this.x+86,this.y+111,.38),gameVars.isHardMode?(this.createShieldEye(this.x-120,this.y+75,.38),this.createShieldEye(this.x+120,this.y+75,.38)):this.createShieldEye(this.x,this.y-75,.4)):this.shieldsActive=1,this.shieldAmts=e}killEye(e){let t=e.front,a=e.back;this.addTween({targets:[a,t],scaleX:a.scaleX+.3,scaleY:a.scaleX+.3,duration:400,alpha:0,ease:"Cubic.easeOut",onComplete:()=>{a.destroy(),t.destroy()}})}createShieldEye(e,t,a){var s=this.addImage(e,t,"enemies","void_knight_shield_eye.png").setScale(.85*a,.85*a).setDepth(3);let i=this.addImage(e,t,"enemies","void_knight_shield_eye_2.png").setScale(.85*a,0).setDepth(3);s.startScale=a,i.startScale=a;e={front:i,back:s};this.eyeShieldObjects.push(e),this.addTween({delay:0,targets:[s],scaleX:a,scaleY:a,duration:300,ease:"Back.easeOut"}),this.addTween({delay:250,targets:[i],scaleX:.85*a,scaleY:.1,duration:500,ease:"Back.easeOut",onComplete:()=>{this.addTween({targets:[i],scaleX:a,scaleY:a,duration:500,ease:"Cubic.easeOut"})}})}clearVoidShield(e){for(;0<this.eyeShieldObjects.length;)this.killEye(this.eyeShieldObjects.pop());this.shieldText.visible=!1,e?(this.shieldsActive--,this.addTween({targets:[this.voidShield2b],scaleX:this.voidShield2b.scaleX+.1,scaleY:this.voidShield2b.scaleX+.1,duration:300,ease:"Cubic.easeOut",alpha:0,onComplete:()=>{this.voidShield2b.visible=!1}}),this.voidShield2b.repeatTween&&this.voidShield2b.repeatTween.stop()):0<this.shieldsActive&&(this.shieldsActive=0,this.addTween({targets:[this.voidShield1b],scaleX:this.voidShield1b.scaleX+.1,scaleY:this.voidShield1b.scaleX+.1,duration:250,ease:"Cubic.easeOut",alpha:0,onComplete:()=>{this.voidShield2b.visible=!1}}),this.voidShield1b.repeatTween)&&this.voidShield1b.repeatTween.stop()}makeSlashEffect(){zoomTemp(1.007),this.slashEffectAnim&&this.slashEffectAnim.stop(),this.slashEffectAnim2&&this.slashEffectAnim2.stop();var e=0<this.slashEffect.scaleX;this.slashEffect.setAlpha(1.3).setScale(e?.6:-.6,.54).setRotation(e?-1.5:1.5),this.slashEffectAnim=this.addTween({targets:this.slashEffect,scaleX:e?1:-1,scaleY:.9,duration:310,ease:"Quint.easeOut",alpha:0}),this.slashEffectAnim2=this.addTween({targets:this.slashEffect,delay:10,ease:"Quart.easeIn",duration:300,alpha:0})}pulseCircleInward(e,t){this.isPulsing=!0,this.pulseCircle||(this.pulseCircle=this.addImage(e,t,"blurry","voidcirclelarge.png")),this.pulseCircle.setScale(1).setDepth(10).setAlpha(0).setPosition(e,t).setRotation(6*Math.random()),this.addTween({delay:500,targets:[this.pulseCircle],scaleX:.5,scaleY:.5,duration:450,ease:"Cubic.easeIn",alpha:1.2,onComplete:()=>{this.isPulsing&&!this.dead&&(this.nextAttack.damage+=1,this.attackName.setText("|"+this.nextAttack.damage+" ")),this.addTween({targets:[this.pulseCircle],scaleX:0,scaleY:0,duration:450,alpha:0,ease:"Cubic.easeOut",completeDelay:900,onComplete:()=>{this.isPulsing&&!this.dead&&this.pulseCircleInward(e,t)}})}})}makeVoidSlashEffect(e){var t=e?0:.5,t=(Math.random()-.5)*t;let a=this.isFirstVoidSlash?this.voidSlashEffect:this.voidSlashEffect2;this.isFirstVoidSlash=!this.isFirstVoidSlash,a.x=globalObjects.player.getX()+240*t,a.setAlpha(1).setRotation(.5*Math.PI+t).setScale(.8,.7),this.slashEffectAnim=this.addTween({targets:a,scaleX:e?2.4:1.6,scaleY:e?.9:.7,duration:75,ease:"Back.easeOut",completeDelay:e?150:75,onComplete:()=>{this.slashEffectAnim=this.addTween({targets:a,scaleX:e?2.2:1.6,scaleY:e?.8:.65,alpha:0,duration:200,ease:"Quart.easeIn"})}})}initAttacks(){this.attacks=[[{name:gameVars.isHardMode?"|10":"|8",announceName:"INITIAL STRIKE",desc:"The mysterious knight charges at you!",chargeAmt:415,damage:gameVars.isHardMode?10:8,prepareSprite:"void_knight_pullback.png",attackSprites:["void_knight_attack.png"],attackStartFunction:()=>{playSound("slice_in",.6)},attackFinishFunction:()=>{this.currentAttackSetIndex=1,this.nextAttackIndex=0,this.makeSlashEffect(),playSound("sword_hit",.75),this.sigilEffect.visible=!0}}],[{name:"VOID SHIELD #3",announceName:"VOID SHIELD (3)",desc:"A strange protective shield surrounds the knight",isPassive:!0,chargeAmt:400,damage:-1,attackFinishFunction:()=>{this.createVoidShield(3),this.currentAttackSetIndex=2,this.nextAttackIndex=0,this.sigilEffect.visible=!0}}],[{name:"}4 ",announceName:"FEINT ATTACK",chargeAmt:275,damage:4,attackSprites:["void_knight_attack.png"],attackFinishFunction:()=>{this.makeSlashEffect(),playSound("void_strike_hit",.5),playSound("sword_slice",.5)},finaleFunction:()=>{this.sigilEffect.visible=!0}},{name:"|6x3 ",announceName:"ASSAULT",chargeAmt:500,damage:6,attackTimes:3,prepareSprite:"void_knight_pullback.png",attackSprites:["void_knight_attack.png"],isBigMove:!0,attackStartFunction:()=>{playSound("slice_in",.55)},attackFinishFunction:()=>{this.makeSlashEffect(),playSound("sword_hit",.7)},finaleFunction:()=>{this.sigilEffect.visible=!0}},{name:"|6 ",announceName:"void strike",chargeAmt:750,damage:6,chargeMult:1.5,attackSprites:["void_knight_attack.png"],startFunction:()=>{playSound("void_enhance",.5),this.pulseCircleInward(this.x-14,this.y-39),this.setDefaultSprite("void_knight_pullback.png"),playSound("void_body",.9).detune=0},attackStartFunction:()=>{this.isPulsing=!1},attackFinishFunction:()=>{this.makeVoidSlashEffect(!0),playSound("void_strike_hit",.9),playSound("sword_hit",.2)},finaleFunction:()=>{this.nextAttack.damage=6,this.setDefaultSprite("void_knight.png"),this.sigilEffect.visible=!0}}],[{name:"}8x3 ",announceName:"ASSAULT",chargeAmt:400,damage:8,attackTimes:3,prepareSprite:"void_knight_pullback.png",attackSprites:["void_knight_attack.png"],attackFinishFunction:()=>{this.makeSlashEffect(),playSound("sword_hit",.7)}}],[{name:"|8x3 ",announceName:"ASSAULT",chargeAmt:400,damage:8,attackTimes:3,prepareSprite:"void_knight_pullback.png",attackSprites:["void_knight_attack.png"],attackFinishFunction:()=>{this.makeSlashEffect(),playSound("sword_hit",.7)}}],[{name:gameVars.isHardMode?"VOID SHIELD #7":"VOID SHIELD #6",announceName:"VOID SHIELD",chargeAmt:800,isPassive:!0,chargeMult:16,finishDelay:250,prepareSprite:"void_knight_3.png",damage:-1,attackFinishFunction:()=>{this.createVoidShield(gameVars.isHardMode?7:6,!0)},finaleFunction:()=>{this.voidTentacleFront.visible=!0,this.voidTentacleBack.visible=!0,this.sigilEffect.visible=!0,this.pullbackScale=.97,this.attackScale=1.08}},{name:"PREPARING... ",isPassive:!0,chargeAmt:450,startFunction:()=>{this.currentAttackSetIndex=6,this.nextAttackIndex=0,this.voidTentacleFront.visible=!0,this.voidTentacleBack.visible=!0},finaleFunction:()=>{this.voidTentacleFront.visible=!0,this.voidTentacleBack.visible=!0}}],[{name:"|4x3 ",announceName:"ASSAIL",chargeAmt:600,chargeMult:1.65,damage:4,attackTimes:3,prepareSprite:"void_knight_3.png",attackSprites:["void_knight_2.png"],isBigMove:!0,attackFinishFunction:()=>{this.makeVoidSlashEffect(),playSound("void_strike_hit"),playSound("void_strike",.15)},finaleFunction:()=>{this.voidTentacleFront.visible=!0,this.voidTentacleBack.visible=!0,this.sigilEffect.visible=!0}},{name:"|10 ",announceName:"ASSAIL",chargeAmt:500,chargeMult:1.65,damage:10,prepareSprite:"void_knight_3.png",attackSprites:["void_knight_2.png"],attackFinishFunction:()=>{this.makeVoidSlashEffect(!0),playSound("void_strike_hit"),playSound("void_strike",.4)},finaleFunction:()=>{this.voidTentacleFront.visible=!0,this.voidTentacleBack.visible=!0,this.sigilEffect.visible=!0}},{name:"|5x3 ",announceName:"ASSAIL",chargeAmt:650,chargeMult:1.65,damage:5,attackTimes:3,prepareSprite:"void_knight_3.png",attackSprites:["void_knight_2.png"],attackFinishFunction:()=>{this.makeVoidSlashEffect(),playSound("void_strike_hit"),playSound("void_strike",.15)},finaleFunction:()=>{this.voidTentacleFront.visible=!0,this.voidTentacleBack.visible=!0,this.sigilEffect.visible=!0}},{name:"|13 ",announceName:"ASSAIL",chargeAmt:550,chargeMult:1.65,damage:13,prepareSprite:"void_knight_3.png",attackSprites:["void_knight_2.png"],attackFinishFunction:()=>{this.makeVoidSlashEffect(!0),playSound("void_strike_hit"),playSound("void_strike",.4)},finaleFunction:()=>{this.voidTentacleFront.visible=!0,this.voidTentacleBack.visible=!0,this.sigilEffect.visible=!0}},{name:"|6x3 ",announceName:"ASSAIL",chargeAmt:700,chargeMult:1.65,damage:6,attackTimes:3,prepareSprite:"void_knight_3.png",attackSprites:["void_knight_2.png"],attackFinishFunction:()=>{this.makeVoidSlashEffect(),playSound("void_strike_hit"),playSound("void_strike",.15)},finaleFunction:()=>{this.voidTentacleFront.visible=!0,this.voidTentacleBack.visible=!0,this.sigilEffect.visible=!0}},{name:"|16 ",announceName:"ASSAIL",chargeAmt:600,chargeMult:1.65,damage:16,prepareSprite:"void_knight_3.png",attackSprites:["void_knight_2.png"],attackFinishFunction:()=>{this.makeVoidSlashEffect(!0),playSound("void_strike_hit"),playSound("void_strike",.4)},finaleFunction:()=>{this.voidTentacleFront.visible=!0,this.voidTentacleBack.visible=!0,this.sigilEffect.visible=!0}},{name:"ENRAGED",chargeAmt:500,chargeMult:12,transitionFast:!0,prepareSprite:"void_knight_3.png",startFunction:()=>{this.createShout()},finaleFunction:()=>{this.voidTentacleFront.visible=!0,this.voidTentacleBack.visible=!0,this.sigilEffect.visible=!0}},{name:";10x3 ",announceName:"ASSAIL",chargeAmt:1100,chargeMult:1.65,damage:10,attackTimes:3,isBigMove:!0,prepareSprite:"void_knight_3.png",attackSprites:["void_knight_2.png"],attackFinishFunction:()=>{this.makeVoidSlashEffect(),playSound("void_strike_hit"),playSound("void_strike",.15)},finaleFunction:()=>{this.voidTentacleFront.visible=!0,this.voidTentacleBack.visible=!0,this.sigilEffect.visible=!0}},{name:";20 ",announceName:"ASSAIL",chargeAmt:900,chargeMult:1.65,damage:20,isBigMove:!0,prepareSprite:"void_knight_3.png",attackSprites:["void_knight_2.png"],attackFinishFunction:()=>{this.makeVoidSlashEffect(!0),playSound("void_strike_hit"),playSound("void_strike",.4)},finaleFunction:()=>{this.voidTentacleFront.visible=!0,this.voidTentacleBack.visible=!0,this.sigilEffect.visible=!0}}]]}startPhase2(){this.forceOverrideSprite=null,this.setDefaultSprite("void_knight_3_empty.png"),this.sprite.setDepth(2),playSound("meat_click_right"),this.setMaxHealth(gameVars.isHardMode?125:110),this.bg2=this.addImage(gameConsts.halfWidth,gameConsts.halfHeight,"backgrounds","gravedark.png").setDepth(-4),this.graves.setVisible(!1),this.heal(this.healthMax),this.setAwake(),this.sigilEffect.setFrame("void_knight_sigil2.png").setScale(this.sprite.startScale),this.repeatTweenBreathe(),this.bgMusic=playMusic("and_into_the_void",1,!0),this.currentAttackSetIndex=5,this.nextAttackIndex=0,this.isLoading=!1,this.shoutSprite=this.addImage(this.x,this.y+5,"misc","black_circle.png").setDepth(11).setScale(.15),this.createShout(),this.voidTentacleFront=this.addImage(this.x+9,this.y-56,"enemies","void_knight_tent_1_front_spike.png").setDepth(3).setOrigin(.5,.34).setScale(0*this.sprite.startScale);var e=this.addImage(this.x,this.y-2,"enemies","blurryball.png").setDepth(0).setScale(4).setAlpha(.6);this.addTween({targets:[e],scaleX:8,scaleY:8,duration:1300,ease:"Quart.easeOut"}),this.addTween({targets:[e],alpha:0,duration:1300,ease:"Cubic.easeIn"}),this.addTween({targets:[this.voidTentacleFront],scaleX:1.32*this.sprite.startScale,scaleY:1.32*this.sprite.startScale,duration:250,ease:"Quad.easeIn",onComplete:()=>{this.addTween({targets:[this.voidTentacleFront],scaleX:1.2*this.sprite.startScale,scaleY:1.2*this.sprite.startScale,duration:60,ease:"Quad.easeOut",onComplete:()=>{this.voidTentacleFront.setFrame("void_knight_tent_1_front.png").setOrigin(.48,.34).setPosition(this.x-8,this.y-50),this.voidTentacleBack=this.addImage(this.x+48,this.y-15,"enemies","void_knight_tent_1_back.png").setDepth(1).setScale(.2*this.sprite.startScale).setOrigin(.65,.454),this.addTween({targets:[this.voidTentacleBack,this.voidTentacleFront],scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,duration:600,ease:"Back.easeOut",onComplete:()=>{this.repeatVoidTweenBreathe()}})}})}})}createShout(){playSound("void_enhance",.9).detune=-50,zoomTemp(1.02),this.shoutSprite.setScale(.15).setAlpha(1),this.addTween({targets:[this.shoutSprite],scaleX:9,scaleY:9,duration:900,ease:"Quad.easeOut"}),this.fogTween&&this.fogTween.stop(),this.fogSpookTween&&this.fogSpookTween.stop(),this.addTween({targets:[this.fogThick,this.fogSpook],duration:100,alpha:1.1,ease:"Cubic.easeOut",onComplete:()=>{messageBus.publish("showCircleShadow"),this.addTween({targets:[this.fogThick,this.fogSpook],duration:1400,alpha:0,ease:"Quad.easeOut",onComplete:()=>{this.fogThick.visible=!1,this.fogSpook.visible=!1}})}}),this.addTween({targets:[this.fogThick,this.fogSpook],duration:1e3,scaleX:10,scaleY:10,ease:"Cubic.easeOut"}),this.addTween({targets:[this.fogThick,this.fogSpook],duration:1e3,scaleX:-9,scaleY:9,ease:"Cubic.easeOut"}),this.addTween({targets:[this.shoutSprite],alpha:0,duration:1e3})}animateDeathOne(){this.isFirstMode=!1,this.isLoading=!0,playSound("clunk"),this.forceOverrideSprite="void_knight_3_empty.png",this.setSprite("void_knight_3_empty.png");let e=this.addImage(this.x+34,this.y-59,"enemies","void_knight_helmet.png").setDepth(4),t=this.addImage(this.x+64,this.y+19,"enemies","void_knight_arm.png").setDepth(0);this.addExtraSprite(e),this.addExtraSprite(t),this.addTimeout(()=>{this.fogSpook=this.addImage(gameConsts.halfWidth,gameConsts.halfHeight-200,"blurry","fogspook.png").setDepth(9).setAlpha(0).setBlendMode(Phaser.BlendModes.ADD).setOrigin(.5,.25).setScale(-2,2),this.fogSpookTween=this.addTween({targets:this.fogSpook,alpha:1,duration:3e3}),this.addTween({delay:350,targets:e,rotation:"+=0.1",x:"+=2",y:"+=1",duration:50}),this.voidTentaEye.visible=!0,this.voidTentaEye.setAlpha(0),this.voidTentaEye.y=this.sprite.y-10,this.addTween({targets:this.voidTentaEye,duration:1e3,ease:"Cubic.easeInOut",alpha:1,onComplete:()=>{this.addTween({targets:this.voidTentaEye,duration:550,ease:"Back.easeOut",y:"-=44"})}}),this.addTween({delay:950,targets:e,y:"+=190",duration:350,ease:"Cubic.easeIn",onStart:()=>{this.addTween({delay:300,targets:this.voidTentaEye,rotation:-1,ease:"Quint.easeOut",scaleX:1.1,scaleY:1.1,duration:500,onComplete:()=>{this.addTween({targets:this.voidTentaEye,rotation:-1.2,ease:"Cubic.easeIn",scaleX:.78,scaleY:.78,x:"-=10",y:"+=20",duration:400,onComplete:()=>{this.voidTentaEye.y+=32,this.voidTentaEye.visible=!1}})}}),this.addTween({targets:e,rotation:.96,duration:350})},onComplete:()=>{playSound("clunk2"),this.addTween({delay:500,targets:[e,t],alpha:0,duration:750,onComplete:()=>{this.removeExtraSprite(e),this.removeExtraSprite(t),e.destroy(),t.destroy(),this.addTimeout(()=>{this.fogTween&&this.fogTween.stop(),this.fogTween=this.addTween({targets:this.fogThick,duration:1e3,alpha:1,ease:"Cubic.easeOut"}),playSound("void_body").detune=0,this.addTimeout(()=>{playSound("meat_click_left"),this.startPhase2()},400)},1350)}})}}),this.addTween({targets:t,y:"+=72",duration:300,ease:"Cubic.easeIn"}),this.addTween({targets:t,rotation:"+=1",x:"-=7",scaleX:"-=0.05",scaleY:"-=0.05",duration:300,onComplete:()=>{t.rotation=.5*Math.PI,playSound("clunk")}})},1500)}die(){if(!this.dead&&!this.isLoading)if(this.currAnim&&this.currAnim.stop(),this.isPulsing=!1,this.interruptCurrentAttack(),this.setAsleep(),this.bgMusic&&this.bgMusic.stop(),this.rune1&&(this.rune1.visible=!1,this.rune2.visible=!1),this.bg2&&this.addTween({targets:this.bg2,alpha:0,duration:900,ease:"Quad.easeOut"}),gameVars.latestLevel=this.level+2,sdkSetItem("latestLevel",gameVars.latestLevel.toString()),gameVars.maxLevel=Math.max(gameVars.maxLevel,this.level),sdkSetItem("maxLevel",gameVars.maxLevel.toString()),this.graves.setVisible(!0).setDepth(-4),this.sigilEffect.alpha=0,this.breatheTween.stop(),this.breatheTween2&&this.breatheTween2.stop(),this.clearVoidShield(),this.shieldAmts=0,this.isFirstMode)this.animateDeathOne(),this.createDeathEffect(7,.75,90);else{playSound("meat_click_left"),playSound("void_body"),super.die(),this.addTween({targets:[this.voidTentacleFront,this.voidTentacleBack],scaleX:0,scaleY:0,duration:400,ease:"Cubic.easeOut",onComplete:()=>{this.voidTentacleFront.destroy(),this.voidTentacleBack.destroy()}});let e=this.addImage(this.x,this.y+21,"enemies","void_knight_3_torso.png").setDepth(4).setScale(this.sprite.startScale).setOrigin(.5,.5646);this.addTween({delay:2e3,targets:e,rotation:"+=1.1",duration:950,ease:"Cubic.easeIn"}),this.addTween({delay:2500,targets:e,y:"+=145",duration:450,ease:"Cubic.easeIn",onStart:()=>{this.voidTentaEye.visible=!0,this.addTween({delay:500,targets:this.voidTentaEye,rotation:-1.5,ease:"Back.easeIn",scaleX:.7,scaleY:.7,alpha:0,x:"-=10",y:"+=15",duration:600,onComplete:()=>{this.voidTentaEye.destroy()}})},onComplete:()=>{e.destroy(),this.setDefaultSprite("void_knight_died.png",void 0,!0),playSound("clunk2"),this.addTimeout(()=>{this.dieClickBlocker=new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:gameConsts.halfHeight,alpha:.001,scaleX:1e3,scaleY:1e3},onMouseUp:()=>{}}),this.graves.setDepth(1);let e=this.addImage(this.x+22,this.y+90,"tutorial","rune_void_large.png").setScale(.5).setDepth(9999);this.flash=this.addImage(e.x,e.y,"blurry","flash.webp").setOrigin(.5,.5).setScale(.9*this.sprite.startScale).setDepth(-1).setRotation(.2),this.addTween({targets:this.flash,scaleX:3.5*this.sprite.startScale,scaleY:.05*this.sprite.startScale,duration:300}),this.addTween({targets:this.flash,duration:300,ease:"Quad.easeIn",alpha:0,onComplete:()=>{this.flash.destroy()}}),playSound("victory_2"),sdkShowHappyTime(),this.addTween({delay:10,targets:e,x:gameConsts.halfWidth,y:gameConsts.halfHeight-180,scaleX:1,scaleY:1,ease:"Cubic.easeOut",duration:1500,onComplete:()=>{this.showVictory(e)}})},2850)}}),this.setDefaultSprite("void_knight_3_legs.png"),this.createDeathEffect()}}createDeathEffect(t=12,a=1,s=100){for(let e=0;e<t;e++){let e=this.addImage(this.x,this.y,"enemies","void_knight_shield_eye.png").setDepth(0).setScale(a*(1+Math.random()));var i=2*Math.random()*Math.PI,h=s+Math.random()*s,r=Math.sin(i)*h,i=Math.cos(i)*h,h=700+700*Math.random();this.addTween({targets:e,x:"+="+r,y:"+="+i,duration:h,ease:"Cubic.easeOut"}),this.addTween({targets:e,scaleX:0,scaleY:0,duration:h,ease:"Quad.easeIn",onComplete:()=>{e.destroy()}})}}}class LesserDummy extends Enemy{constructor(e,t,a,s){super(e,t,a,s),this.initSprite("lesser_dummy_blank.png",.9,0,void 0,void 0,0),this.sprite.setOrigin(.5,.98),globalObjects.encyclopedia.hideButton(),this.bgMusic2=playMusic("wind",.01,!0),fadeInSound(this.bgMusic2,.5,1200),globalObjects.options.hideButton(),this.playerSpellCastSub=messageBus.subscribe("playerCastedSpell",()=>{1===globalObjects.player.getPlayerCastSpellsCount()?this.initTutorial2():2===globalObjects.player.getPlayerCastSpellsCount()&&(this.addTimeout(()=>{this.attemptTutThree()},3e3),this.playerSpellCastSub.unsubscribe())}),this.initTutorial(t,a)}initSpriteAnim(e){var t=this.sprite.y;this.sprite.setScale(.78*e,.78*e).setAlpha(.01),this.sprite.y+=96,this.addTween({targets:this.sprite,alpha:1,ease:"Quart.easeOut",duration:1250}),this.addTween({targets:this.sprite,duration:1500,ease:"Quint.easeInOut",scaleX:e,scaleY:e,y:t,onComplete:()=>{this.mouthSprite=this.addSprite(this.x,this.sprite.y-107,"enemies","lesser_dummy_mouth1.png").setScale(e).setDepth(5),this.addExtraSprite(this.mouthSprite,0,0),this.mouthSprite.play("dummysmile"),this.addTimeout(()=>{this.setDefaultSprite("lesser_dummy_smile.png",void 0,!0),this.mouthSprite.destroy(),this.eyeSprite=this.addSprite(this.x,this.sprite.y-107,"enemies","lesser_dummy_eyes4.png").setScale(e).setDepth(5),this.eyeSprite.play("dummylook")},1e3)}})}initStatsCustom(){this.health=36,this.isAsleep=!0}initTutorial(e,t){let a=this.addImage(e-6,t-50,"misc","shadow_circle.png").setScale(13).setDepth(9999).setAlpha(0);this.addTween({targets:a,alpha:.4,ease:"Cubic.easeInOut",y:t-114,scaleX:8,scaleY:8,duration:1500}),this.shadow=this.addSprite(globalObjects.player.getX(),globalObjects.player.getY()-1,"misc","shadow_circle.png").setScale(6).setDepth(9975).setAlpha(0),this.addTimeout(()=>{0===globalObjects.player.getPlayerCastSpellsCount()&&(globalObjects.magicCircle.disableMovement(),globalObjects.bannerTextManager.setDialog([getLangText("level0_diag_a"),getLangText("level0_diag_b")]),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.height-130,0),globalObjects.bannerTextManager.showBanner(!1),globalObjects.bannerTextManager.setOnFinishFunc(()=>{fadeAwaySound(this.bgMusic2,1200),this.bgMusic=playMusic("bite_down_simplified",.9,!0),fadeInSound(this.bgMusic,.6),this.glowCirc=this.addImage(gameConsts.halfWidth,globalObjects.player.getY(),"circle","circle_highlight_outer.png").setAlpha(0).setDepth(9980),this.glowCirc.currAnim=this.addTween({delay:200,targets:[this.glowCirc],alpha:1,ease:"Cubic.easeIn",duration:900,onComplete:()=>{this.glowCirc.currAnim=this.addTween({targets:[this.glowCirc],alpha:.7,ease:"Quint.easeOut",duration:3e3})}}),globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),globalObjects.magicCircle.enableMovement(),messageBus.publish("highlightRunes"),this.addTween({targets:a,alpha:0,ease:"Cubic.easeOut",scaleX:10,scaleY:10,duration:400,onComplete:()=>{a.destroy()}}),globalObjects.bannerTextManager.setOnFinishFunc(()=>{}),globalObjects.bannerTextManager.closeBanner();let e=messageBus.subscribe("spellClicked",()=>{this.firstPopupClosed=!0,messageBus.publish("unhighlightRunes"),this.glowCirc.currAnim&&this.glowCirc.currAnim.stop(),this.glowCirc.currAnim=this.addTween({targets:[this.glowCirc],alpha:0,ease:"Cubic.easeOut",duration:500}),e.unsubscribe(),this.currShadowTween&&this.currShadowTween.stop(),this.addTween({targets:this.shadow,alpha:0,ease:"Cubic.easeOut",scaleX:8,scaleY:8,duration:500})});this.currShadowTween=this.addTween({targets:this.shadow,alpha:.65,ease:"Cubic.easeOut",scaleX:5.6,scaleY:5.6,duration:1e3,onComplete:()=>{0===globalObjects.player.getPlayerCastSpellsCount()||this.firstPopupClosed||(messageBus.publish("unhighlightRunes"),this.glowCirc.currAnim&&this.glowCirc.currAnim.stop(),this.glowCirc.currAnim=this.addTween({targets:[this.glowCirc],alpha:0,ease:"Cubic.easeOut",duration:500}),globalObjects.textPopupManager.hideInfoText(),e.unsubscribe(),this.addTween({targets:this.shadow,alpha:0,ease:"Cubic.easeOut",scaleX:8,scaleY:8,duration:750,onComplete:()=>{this.eyeSprite.play("dummyblink")}}))}}),this.addTimeout(()=>{0===globalObjects.player.getPlayerCastSpellsCount()&&(globalObjects.magicCircle.showReadySprite(),this.addTimeout(()=>{0===globalObjects.player.getPlayerCastSpellsCount()&&globalObjects.magicCircle.showReadySprite()},6e3))},4e3)}))},1100)}showArrowRotate(){this.addTween({targets:[this.arrowRotate1,this.arrowRotate2],alpha:.8,duration:400}),this.addTween({targets:[this.arrowRotate1],rotation:-1*this.arrowRotate1.rotation,ease:"Cubic.easeInOut",duration:1100,completeDelay:100,onComplete:()=>{this.addTween({delay:900,targets:[this.arrowRotate1,this.arrowRotate2],alpha:0,duration:400}),this.addTween({targets:[this.arrowRotate1],rotation:-1*this.arrowRotate1.rotation,ease:"Cubic.easeInOut",duration:1100})}}),this.addTween({targets:[this.arrowRotate2],rotation:-1*this.arrowRotate2.rotation,ease:"Cubic.easeInOut",duration:1100,completeDelay:100,onComplete:()=>{this.addTween({targets:[this.arrowRotate2],rotation:-1*this.arrowRotate2.rotation,ease:"Cubic.easeInOut",duration:1100,completeDelay:3e3,onComplete:()=>{this.dead||1!==globalObjects.player.getPlayerCastSpellsCount()||this.showArrowRotate()}})}})}initTutorial2(){this.addTimeout(()=>{if(1===globalObjects.player.getPlayerCastSpellsCount()&&!this.dead){globalObjects.textPopupManager.setInfoText(gameConsts.halfWidth,gameConsts.height-37,getLangText("level0_tut_a")),this.arrowRotate1=this.addSprite(globalObjects.player.getX(),globalObjects.player.getY(),"circle","arrow_rotate.png").setOrigin(.5,.5).setDepth(777).setRotation(.15).setAlpha(0),this.arrowRotate2=this.addSprite(globalObjects.player.getX(),globalObjects.player.getY(),"circle","arrow_rotate_small.png").setOrigin(.5,.5).setDepth(777).setScale(.96).setRotation(-.15).setAlpha(0),this.destructibles.push(this.arrowRotate1),this.destructibles.push(this.arrowRotate2),this.showArrowRotate(),this.glowCirc&&(this.glowCirc.currAnim.stop(),this.glowCirc.currAnim=this.addTween({targets:[this.glowCirc],alpha:.95,ease:"Cubic.easeOut",duration:1200,onComplete:()=>{this.glowCirc.currAnim=this.addTween({targets:[this.glowCirc],alpha:.85,ease:"Cubic.easeInOut",duration:1200})}}));let e=messageBus.subscribe("spellClicked",()=>{globalObjects.textPopupManager.hideInfoText(),e.unsubscribe(),this.currShadowTween.stop(),this.glowCirc.currAnim.stop(),this.glowCirc.currAnim=this.addTween({targets:[this.glowCirc],alpha:0,ease:"Cubic.easeOut",duration:500}),this.addTween({targets:this.shadow,alpha:0,ease:"Cubic.easeOut",scaleX:14,scaleY:14,duration:500,completeDelay:1e3,onComplete:()=>{this.attemptTutThree()}})});this.currShadowTween=this.addTween({targets:this.shadow,alpha:.55,ease:"Cubic.easeOut",scaleX:13,scaleY:13,duration:650,onComplete:()=>{1<globalObjects.player.getPlayerCastSpellsCount()&&.54<this.shadow.alpha&&(globalObjects.textPopupManager.hideInfoText(),e.unsubscribe(),this.glowCirc.currAnim.stop(),this.glowCirc.currAnim=this.addTween({targets:[this.glowCirc],alpha:0,ease:"Cubic.easeOut",duration:500}),this.addTween({targets:this.shadow,alpha:0,ease:"Cubic.easeOut",scaleX:18,scaleY:18,duration:500,completeDelay:1e3,onComplete:()=>{this.attemptTutThree()}}))}})}},3200)}attemptTutThree(){this.dead||this.attemptedTutThree||(this.attemptedTutThree=!0,this.addTimeout(()=>{this.shadow.destroy(),this.dead||(this.dead||(this.healthShowText=this.addText(gameConsts.halfWidth,41,getLangText("level0_tut_b"),{fontFamily:"garamondbold",color:"#FFFAFA",fontSize:20}).setOrigin(.5,.5).setAlpha(0).setDepth(1001),this.healthBack=this.addImage(gameConsts.halfWidth,40,"blurry","battletext_bg.png").setScale(.013*this.healthShowText.width,.11*this.healthShowText.height).setDepth(1e3),this.underline=this.addImage(gameConsts.halfWidth,this.healthBack.y-11,"blurry","box_length.png").setScale(0,-.5).setDepth(-1002),this.underline2=this.addImage(gameConsts.halfWidth,this.healthBack.y+11,"blurry","box_length.png").setScale(0,.5).setDepth(-1002),this.addTween({targets:[this.healthShowText,this.healthBack],alpha:1,ease:"Cubic.easeOut",duration:1e3}),this.addTween({targets:[this.underline,this.underline2],scaleX:.016*this.healthShowText.width,ease:"Cubic.easeIn",duration:800,onComplete:()=>{this.addTween({targets:[this.underline,this.underline2],scaleX:.013*this.healthShowText.width,ease:"Cubic.easeOut",duration:700})}})),this.addTimeout(()=>{this.dead||this.eyeSprite.play("dummyblink")},800),this.glowHealth=this.addSprite(gameConsts.halfWidth,12,"blurry","glow_flat_green.webp").setDepth(0).setAlpha(0).setScale(.28,1.5),this.glowHealth2=this.addSprite(gameConsts.halfWidth,20,"blurry","glow_flat_red.webp").setDepth(0).setAlpha(1.1).setScale(.5,2),this.addTween({targets:this.glowHealth2,scaleX:3,ease:"Quad.easeOut",duration:800,onComplete:()=>{this.glowHealth2.destroy()}}),this.addTween({targets:this.glowHealth2,scaleY:0,alpha:0,ease:"Quad.easeIn",duration:800}),this.addTween({targets:this.glowHealth,alpha:.75,scaleX:1.3,ease:"Cubic.easeInOut",duration:1500,onComplete:()=>{this.addTween({targets:this.glowHealth,alpha:0,scaleX:1.2,ease:"Cubic.easeIn",duration:1500,onComplete:()=>{this.addTween({targets:this.glowHealth,alpha:.55,scaleX:1.35,ease:"Cubic.easeInOut",duration:1500,onComplete:()=>{this.addTween({targets:this.glowHealth,alpha:0,duration:1e3})}})}})}}))},1e3))}setHealth(e){var t;super.setHealth(e),0<e&&(14<e?this.eyeSprite.play("dummyblink"):(e=this.sprite.originX,t=this.sprite.originY,this.setDefaultSprite("lesser_dummy_hurt.png").setOrigin(e,t),e=this.addImage(this.sprite.x+8,this.sprite.y-151,"enemies","dizzystar.png").setRotation(3*Math.random()).setScale(.6),t=this.addImage(this.sprite.x+8,this.sprite.y-144,"enemies","dizzystar.png").setRotation(3*Math.random()).setScale(1),this.addTween({targets:e,x:"+=55",y:"-=60",ease:"Quart.easeOut",duration:660}),this.addTween({targets:e,scaleX:0,scaleY:0,ease:"Quad.easeIn",duration:660}),this.addTween({targets:e,rotation:"-=5",duration:660}),this.addTween({targets:t,x:"+=90",y:"+=50",ease:"Quart.easeOut",duration:800}),this.addTween({targets:t,scaleX:0,scaleY:0,ease:"Quad.easeIn",duration:800}),this.addTween({targets:t,rotation:"+=5.5",duration:800})),this.addTween({targets:[this.sprite,this.eyeSprite],rotation:-.1,ease:"Quart.easeOut",duration:50,onComplete:()=>{this.addTween({targets:[this.sprite,this.eyeSprite],rotation:0,ease:"Back.easeOut",duration:400})}}),this.addTween({targets:[this.eyeSprite],x:"-=3",ease:"Quart.easeOut",duration:50,onComplete:()=>{this.addTween({targets:[this.eyeSprite],x:this.x,ease:"Back.easeOut",duration:400})}}))}die(){this.dead||(super.die(),this.healthShowText&&(this.addTween({targets:[this.healthShowText,this.healthBack,this.underline,this.underline2],alpha:0,ease:"Cubic.easeOut",duration:1e3}),this.addTween({targets:[this.underline,this.underline2],scaleX:0,ease:"Cubic.easeOut",duration:1e3})),globalObjects.textPopupManager.hideInfoText(),this.dieClickBlocker=new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:gameConsts.halfHeight,alpha:.001,scaleX:1e3,scaleY:1e3},onMouseUp:()=>{}}),this.eyeSprite&&this.eyeSprite.destroy(),this.glowCirc&&this.glowCirc.destroy(),this.setDefaultSprite("lesser_dummy_hurt.png",this.sprite.scaleX),this.sprite.setOrigin(.5,.99),this.addTween({targets:this.sprite,rotation:-1.25,ease:"Cubic.easeIn",duration:900,onComplete:()=>{this.setSprite("lesser_dummy_dead.png",this.sprite.scaleX),this.sprite.rotation=0,this.sprite.y+=54,this.sprite.x-=81,this.showVictory(),playSound("lesserfall",.75)}}),this.addTween({targets:this.sprite,x:"+=35",ease:"Cubic.easeOut",duration:400}))}showVictory(){sdkGameplayStop(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton(),globalObjects.magicCircle.disableMovement();let e=this.addSprite(gameConsts.halfWidth,gameConsts.halfHeight-35,"misc","victory_banner.png").setScale(100,1.2).setDepth(9998).setAlpha(0),t=this.addSprite(gameConsts.halfWidth,gameConsts.halfHeight-44,"misc","victory_text.png").setScale(.95).setDepth(9998).setAlpha(0),a=this.addText(gameConsts.halfWidth,gameConsts.halfHeight+2,getLangText("cont_ui"),{fontFamily:"Verdana",color:"#F0F0F0",fontSize:18}).setAlpha(0).setOrigin(.5,.5).setAlign("center").setDepth(9998);this.addTween({targets:e,alpha:.8,duration:500}),this.addTween({targets:[t],alpha:1,ease:"Quad.easeOut",duration:500}),this.addTween({targets:t,scaleX:1,scaleY:1,duration:800}),this.addTimeout(()=>{a.alpha=1,canvas&&(canvas.style.cursor="pointer"),this.dieClickBlocker.setOnMouseUpFunc(()=>{canvas&&(canvas.style.cursor="default"),this.dieClickBlocker.destroy(),this.addTween({targets:this.sprite,alpha:0,duration:800}),this.addTween({targets:this.sprite,alpha:0,scaleX:1.03*this.sprite.startScale,scaleY:1.03*this.sprite.startScale,y:"+=5",ease:"Quad.easeIn",duration:800,onComplete:()=>{this.destroy()}}),a.destroy(),this.addTween({targets:[t,e],alpha:0,duration:400,completeDelay:200,onComplete:()=>{globalObjects.magicCircle.enableMovement(),t.destroy(),e.destroy(),beginLevel(1)}})})},1e3)}initAttacks(){this.attacks=[[{name:"}999 ",chargeAmt:999,damage:999,attackFinishFunction:()=>{let e=this.addSprite(gameConsts.halfWidth+20*(Math.random()-.5),globalObjects.player.getY()-185,"spells","damageEffect3.png").setDepth(998).setScale(1.5);this.addTimeout(()=>{e.destroy()},150)}}]]}}class Magician extends Enemy{constructor(e,t,a,s){super(e,t,a,s),this.initSprite("time_magi.png",1,0,5),this.popupTimeout=this.addTimeout(()=>{this.tutorialButton=createTutorialBtn(this.level),this.addToDestructibles(this.tutorialButton)},3e3),this.addTimeout(()=>{this.isDestroyed||(this.customBgMusic=playMusic("magician_theme_1",.95,!0))},1500),this.addSubscription("reapedEnemyGong",()=>{this.zoomAwayClocks()}),this.sprite.startY=this.sprite.y,this.repeatTweenBreathe()}initStatsCustom(){this.health=gameVars.isHardMode?130:110,this.damageNumOffset=45,this.damageNumOffsetDefault=this.damageNumOffset,this.lifeOne=!0,this.timeObjects=[],this.numTimesHealed=0,this.pullbackScale=.8,this.initTemporalObjects()}takeEffect(e){this.sprite&&"mindStrike"==e.name&&this.lifeOne&&!this.dead&&!this.isBeingFlattened&&(this.sprite.stop(),this.isBeingShocked=!0,this.setSprite("time_magi_shock1.png"),this.addDelay(()=>{this.sprite.setFrame("time_magi_shock2.png"),this.addDelay(()=>{this.setSpriteIfNotInactive(this.defaultSprite),this.isBeingShocked=!1},100)},100)),super.takeEffect(e)}setHealth(e){var t=this.health-e;let a=!1;this.lifeOne&&32<=t&&(a=!0,this.damageNumOffset=-44),super.setHealth(e),this.invulnHealthBar&&this.healthBarText.setText("INVINCIBLE");this.prevHealth,this.healthMax,this.health,this.healthMax;0!==this.health&&a&&(this.isBeingFlattened=!0,this.bonk||(this.bonk=this.addImage(this.x,this.y-80,"enemies","bonk.png")),this.bonk.setScale(.7),this.addTween({targets:this.bonk,scaleX:1.08,scaleY:1.08,ease:"Back.easeOut",duration:300,onComplete:()=>{this.addTween({delay:700,targets:this.bonk,scaleX:0,scaleY:0,ease:"Cubic.easeIn",duration:250})}}),this.forceOverrideSprite="time_magi_flattened.png",this.setSprite("time_magi_flattened.png"),playSound("derp",.3).detune=-500,playSound("punch2",.65),this.addTween({targets:this.sprite,delay:1200,duration:700,scaleX:.95,scaleY:1.14,onComplete:()=>{this.sprite.scaleX=1,this.sprite.scaleY=1.04,this.forceOverrideSprite=null,this.damageNumOffset=this.damageNumOffsetDefault,this.setSprite(this.defaultSprite),this.addTween({targets:this.sprite,duration:150,scaleY:1.1,ease:"Quart.easeOut",onComplete:()=>{this.isBeingFlattened=!1,this.addTween({targets:this.sprite,duration:250,scaleY:1,ease:"Back.easeOut"})}})}}))}cleanUp(e){this.cleanedUp||(this.breatheTween&&this.breatheTween.stop(),this.cleanedUp=!0,this.floatingDeathAnim&&(this.floatingDeathAnim.stop().destroy(),this.addTween({targets:this.blackBackground,alpha:0,duration:3e3,onComplete:()=>{this.blackBackground.destroy()}})),this.magicianTimeEpicTheme&&this.magicianTimeEpicTheme.stop(),globalObjects.magicCircle.cancelTimeSlow(),this.clockShield&&(this.clockShield.hitTween&&this.clockShield.hitTween.stop(),this.clockShield.currAnim&&this.clockShield.currAnim.stop(),this.clockShield.alpha+=.15,this.addTween({targets:this.clockShield,scaleX:1.2,scaleY:1.2,alpha:0,duration:300,ease:"Cubic.easeOut",onComplete:()=>{this.clockShield.destroy()}})),this.statuses[0]&&this.statuses[0].cleanUp(),this.addTween({targets:this.timeObjects,scaleX:0,scaleY:0,duration:300,rotation:"+=3",onComplete:()=>{for(let e=0;e<this.timeObjects.length;e++)this.timeObjects[e].destroy();this.timeObjects=[]}}))}zoomAwayClocks(){this.addTween({targets:this.timeFallObjs,scaleX:0,scaleY:0,duration:600,ease:"Quad.easeOut",rotation:"+=3"})}manaulClearTimeObjects(){for(;0<this.timeObjects.length;){let e=this.timeObjects.shift();this.addTween({targets:e,scaleX:0,scaleY:0,ease:"Back.easeIn",duration:600,onComplete:()=>{e.destroy()}})}}die(){if(!this.dead&&!this.invincible)if(this.forceOverrideSprite=null,this.currAnim&&this.currAnim.stop(),this.playerSpellCastSub&&(this.playerSpellCastSub.unsubscribe(),this.playerSpellCastSub=null),messageBus.publish("closeCombatText"),globalObjects.magicCircle.cancelTimeSlow(),this.lifeOne){this.manaulClearTimeObjects(),this.interruptCurrentAttack(),this.setAsleep(),playSound("time_hard"),this.invincible=!0,this.lifeOne=!1,this.customBgMusic.stop(),this.setDefaultSprite("time_magi_fade.png",1),this.sprite.setRotation(-.5);for(let a=0;a<5;a++){var s=2*a;let e=this.addImage(this.x,this.y,"lowq","temporal"+s+".png").setScale(.6).setRotation(6*Math.random()).setAlpha(.6);var s=.95+.25*Math.random(),i=150+Math.floor(100*Math.random()),h=Math.floor(200*Math.random());let t=1500+h;var r=i+t,n="+="+6*(Math.random()<.5?1:-1),s=(this.addTween({targets:e,scaleX:s,scaleY:s,duration:i,ease:"Cubic.easeOut",onComplete:()=>{this.addTween({targets:e,scaleX:0,scaleY:0,duration:t})}}),this.addTween({targets:e,rotation:n,duration:r,ease:"Quad.easeOut"}),12.5*Math.random()),i=(150+.2*h)*Math.sin(s),n=(150+.2*h)*Math.cos(s);this.addTween({targets:e,x:"+="+i,y:"+="+n,duration:r,ease:"Cubic.easeOut",onComplete:()=>{e.destroy()}})}this.addTimeout(()=>{this.revive()},2400)}else super.die(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton(),this.cleanUp(),this.showVictory(),this.setDefaultSprite("time_magi_terrified.png",.98),this.dieClickBlocker=new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:gameConsts.halfHeight,alpha:.001,scaleX:1e3,scaleY:1e3},onMouseUp:()=>{}})}destroy(){super.destroy(),this.customBgMusic&&this.customBgMusic.stop(),this.playerSpellCastSub&&(this.playerSpellCastSub.unsubscribe(),this.playerSpellCastSub=null)}showRune(){let e=PhaserScene.add.image(this.x,this.y-45,"tutorial","rune_time_large.png").setOrigin(.5,.5).setScale(.5).setDepth(9999),t=(playSound("victory_2"),this.showFlash(this.x,this.y),PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight-35,"misc","victory_banner.png").setScale(100,1.2).setDepth(9998).setAlpha(0)),a=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight-44,"misc","victory_text.png").setScale(.95).setDepth(9998).setAlpha(0),s=PhaserScene.add.text(gameConsts.halfWidth,gameConsts.halfHeight+2,getLangText("cont_ui"),{fontFamily:"Verdana",color:"#F0F0F0",fontSize:18}).setAlpha(0).setOrigin(.5,.5).setAlign("right").setDepth(9998);PhaserScene.tweens.add({targets:e,x:gameConsts.halfWidth,scaleX:1,scaleY:1,ease:"Cubic.easeOut",duration:1500}),PhaserScene.tweens.add({targets:t,alpha:.75,duration:500}),PhaserScene.tweens.add({targets:[a],alpha:1,ease:"Quad.easeOut",duration:500}),playSound("victory"),setTimeout(()=>{s.alpha=1},1e3),PhaserScene.tweens.add({targets:a,scaleX:1,scaleY:1,duration:800}),PhaserScene.tweens.add({targets:e,y:gameConsts.halfHeight-110,ease:"Cubic.easeOut",duration:500,onComplete:()=>{canvas&&(canvas.style.cursor="pointer"),this.dieClickBlocker.setOnMouseUpFunc(()=>{canvas&&(canvas.style.cursor="default"),this.dieClickBlocker.destroy(),PhaserScene.tweens.add({targets:[a,t],alpha:0,duration:400,onComplete:()=>{a.destroy(),t.destroy(),s.destroy()}}),PhaserScene.tweens.add({targets:e,y:"+=90",ease:"Quad.easeOut",duration:400,onComplete:()=>{e.destroy(),setTimeout(()=>{globalObjects.magicCircle.enableMovement(),globalObjects.postFightScreen.createWinScreen(this.level)},50)}}),PhaserScene.tweens.add({targets:e,alpha:0,duration:400})})}})}showVictory(){globalObjects.magicCircle.disableMovement(),swirlInReaperFog(),setTimeout(()=>{playReaperDialog([getLangText("magician_death")],[],()=>{PhaserScene.tweens.add({targets:this.timeFallObjs,duration:1e3}),globalObjects.reapSound="magician_end",playReaperAnim(this,()=>{setTimeout(()=>{this.showRune()},900)},!1)})},500)}startReaper(){this.blackBackground=this.addSprite(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setScale(500).setAlpha(0).setDepth(-1),this.floatingDeath=getFloatingDeath(),this.floatingDeath.alpha=0,globalObjects.floatingDeath2.alpha=0,globalObjects.deathLeftHand.alpha=0,globalObjects.deathRightHand.alpha=0,gameVars.deathFlutterDelay=600,setFloatingDeathScale(.35),tweenFloatingDeath(.71,.75,16e3,"Quad.easeInOut"),this.floatingDeathAnim=this.addTween({targets:this.floatingDeath,duration:16e3,alpha:.75,scaleX:.7,scaleY:.7,ease:"Quad.easeInOut"}),this.addTween({targets:this.blackBackground,duration:16e3,alpha:.7,ease:"Quad.easeOut"})}tickTimeShield(){this.dead||this.exhausted||(this.clockShield.currAnim=this.addTween({targets:this.clockShield,duration:250,rotation:"+=0.2618",ease:"Back.easeOut",completeDelay:1250,onComplete:()=>{this.tickTimeShield()}}))}setupTimeShield(){if(!this.specialDamageAbsorptionActive){this.specialDamageAbsorptionActive=!0,this.clockShield=this.addSprite(gameConsts.halfWidth,190,"enemies","red_clock_back_large_red.png").setDepth(1).setAlpha(.75),this.clockShieldArm=this.addImage(this.clockShield.x,this.clockShield.y,"enemies","red_clock_arm_large.png").setDepth(-1).setOrigin(.5,1).setRotation(-.4).setAlpha(0),this.clockShield.currAnim=this.addTween({targets:this.clockShield,duration:600,alpha:.2,rotation:"+=2",ease:"Cubic.easeOut",onComplete:()=>{this.tickTimeShield()}});let a=this.scene.add.bitmapText(gameConsts.halfWidth,100,"damage",this.healthMax,60).setDepth(999).setOrigin(.5,.5),s=this.addImage(a.x,a.y,"blurry","glow.webp").setDepth(998).setAlpha(0),i=(a.startY=a.y,a.setScale(0),{});i={animObj:a,glowObj:s,duration:this.healthMax,onUpdate:()=>{if(this.usingTimeFreeze)i.duration++;else{this.invulnHealthBar=!1,a.y=a.startY+4;let e=this.health<=1?.2:0;var t;this.addTween({targets:a,duration:150,scaleX:1.35-.02*i.duration+e,scaleY:1.35-.02*i.duration+e,ease:"Cubic.easeOut",onComplete:()=>{this.addTween({targets:a,duration:600,scaleX:1.2-.015*i.duration+e,scaleY:1.2-.015*i.duration+e,ease:"Back.easeOut"})}}),s.setScale(a.scaleX),this.addTween({targets:s,duration:850,alpha:.6-.02*i.duration,scaleX:1-.02*i.duration+e,ease:"Cubic.easeOut"}),this.addTween({targets:a,duration:850,y:a.startY,ease:"Cubic.easeInOut"}),0===this.health?a.setText(0):(a.setText(Math.max(0,i.duration-1)),this.setHealth(this.health-1),t=this.health/this.healthMax*Math.PI*2,this.clockShieldArm.setRotation(t-.06),this.addTween({targets:this.clockShieldArm,duration:200,rotation:"+=0.08",ease:"Quart.easeOut",onComplete:()=>{this.addTween({targets:this.clockShieldArm,duration:300,rotation:"-=0.02",ease:"Back.easeOut",onComplete:()=>{}})}}),t=this.health%2==0,this.clockShield.x=gameConsts.halfWidth+(t?4:-4),this.addTween({targets:this.clockShield,x:gameConsts.halfWidth,ease:"Bounce.easeOut",duration:300}),this.clockShield.setAlpha(.4+this.health/this.healthMax*.6),0===this.health&&(this.halo&&this.addTween({targets:this.halo,alpha:0,scaleX:0,scaleY:0,ease:"Back.easeIn",duration:350}),this.addTimeout(()=>{this.invincible=!1,this.die()},1e3)),this.isTerrified?this.health<6&&8!==this.currentAttackSetIndex&&(this.setDefaultSprite("time_magi_terrified.png"),this.currentAttackSetIndex=8,this.nextAttackIndex=0,this.interruptCurrentAttack()):(this.health<13&&(this.pullbackScale=1,this.attackScale=1,this.isTerrified=!0,this.startReaper(),this.customBgMusic&&fadeAwaySound(this.customBgMusic,1e3,""),this.addTimeout(()=>{this.customBgMusic=playMusic("magician_theme_4",.4,!0),fadeInSound(this.customBgMusic,.8),this.setDefaultSprite("time_magi_nervous.png")},750)),this.health%2==0&&(this.health%4==0?playSound("clocktick1",1).detune=-300:playSound("clocktick1",1).detune=0)))}},cleanUp:()=>{i.animObj.setText(0).setScale(1.5),this.addTween({targets:[i.animObj,i.glowObj,this.clockShieldArm,this.clockShield],scaleX:1.65,scaleY:1.65,duration:850,alpha:0,onComplete:()=>{i.animObj.destroy(),i.glowObj.destroy(),this.clockShieldArm.destroy()}}),this.statuses[0]=null}},this.statuses[0]=i}}handleSpecialDamageAbsorption(e){return 1===e?messageBus.publish("animateBlockNum",gameConsts.halfWidth+25-50*Math.random(),this.sprite.y-50*Math.random(),"INVINCIBLE",.75):messageBus.publish("animateBlockNum",gameConsts.halfWidth,this.sprite.y+20,"INVINCIBLE",1.25),this.clockShield.alpha<.3&&(this.clockShield.alpha=.5,this.clockShield.setScale(.9),this.clockShield.hitTween=this.addTween({targets:this.clockShield,duration:400,alpha:.15,scaleX:1,scaleY:1,ease:"Cubic.easeOut"})),0}repeatTweenBreathe(e=1500,t=1){this.breatheTween&&this.breatheTween.stop();let a=Math.ceil(3.5*t);this.breatheTween=this.addTween({targets:this.sprite,duration:e,y:this.sprite.startY-a,ease:"Quad.easeInOut",completeDelay:150,onComplete:()=>{this.breatheTween=this.addTween({targets:this.sprite,duration:e*(.5*Math.random()+1),y:this.sprite.startY+a,ease:"Quad.easeInOut",completeDelay:150,onComplete:()=>{this.repeatTweenBreathe(e,t)}})}})}launchAttack(s=1,i,h,r=[],n=!1,l,o=!1){if(!this.dead&&!this.isDestroyed){this.isUsingAttack=!0;let a=+this.attackSlownessMult;this.nextAttack.attackStartFunction&&this.nextAttack.attackStartFunction();var e=this.pullbackScale*this.sprite.startScale,t=Math.sqrt(10*Math.abs(this.pullbackScale-this.pullbackScaleDefault))+1;t*=this.pullbackDurMult||1;t=n?200*a*t+this.extraRepeatDelay:300*a*t;i&&(n?setTimeout(()=>{this.setSpriteIfNotInactive(i,this.sprite.startScale)},t*this.pullbackHoldRatio):this.setSpriteIfNotInactive(i,this.sprite.startScale)),this.attackAnim=this.scene.tweens.add({targets:this.sprite,scaleX:e,scaleY:e,rotation:0,duration:+t,ease:"Cubic.easeOut",onComplete:()=>{var e,t;this.dead||this.isDestroyed||(e=n?150*a:175*a,t=this.attackScale*this.sprite.startScale*1,e+=Math.floor(200*this.attackScale),this.attackAnim=this.scene.tweens.add({targets:this.sprite,scaleX:t,scaleY:t,duration:e,rotation:0,ease:this.attackEase||"Cubic.easeIn",onComplete:()=>{this.dead||this.isDestroyed||(n||messageBus.publish("enemyMadeAttack",this.nextAttack.damage),this.dead)||this.isDestroyed||(0<r.length&&(void 0===this.sprite.attackNum?this.sprite.attackNum=0:this.sprite.attackNum=(this.sprite.attackNum+1)%r.length,this.setSpriteIfNotInactive(r[this.sprite.attackNum],this.sprite.startScale,void 0,10)),0<this.health&&(0<this.nextAttack.damage&&messageBus.publish("selfTakeDamage",this.nextAttack.damage),this.nextAttack.message&&messageBus.publish(this.nextAttack.message,this.nextAttack.messageDetail),this.nextAttack.attackFinishFunction)&&this.nextAttack.attackFinishFunction(),1<s?this.launchAttack(s-1,i,h,r,!0,l,o):(this.attackAnim=this.scene.tweens.add({targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,rotation:0,duration:500*a*1,ease:this.returnEase||"Cubic.easeInOut"}),setTimeout(()=>{this.isUsingAttack=!1},l),setTimeout(()=>{this.dead||this.isDestroyed||(this.setSpriteIfNotInactive(this.defaultSprite,void 0,!0),this.nextAttack.finaleFunction&&this.nextAttack.finaleFunction())},400*a*this.lastAttackLingerMult+100)))}}))}})}}revive(){this.backClock=PhaserScene.add.image(this.x,this.y,"lowq","temporal9.png").setDepth(-1).setAlpha(.05).setScale(.55),this.backClock.baseScale=this.backClock.scaleX;let e=0,s=460;for(let a=0;a<this.timeFallObjs.length;a++){let t=this.timeFallObjs[a];e+=s,s=Math.floor(.84*s),this.addTween({delay:e,targets:t,x:this.x,y:this.y,duration:275,ease:"Quad.easeIn",onStart:()=>{var e=30*a-600;a%2==0?playSound("time_strike").detune=e:playSound("time_strike_alt").detune=e},onComplete:()=>{var e=.07+.005*a;this.backClock.baseScale+=.08,this.backClock.setScale(this.backClock.baseScale+.07),this.backClock.alpha+=.08,a===this.timeFallObjs.length-1?(this.backClock.baseScale+=.3,this.backClock.setScale(this.backClock.baseScale-.5),this.backClock.alpha=1,playSound("time_strike_hit"),this.addTween({targets:this.sprite,duration:250,rotation:0,ease:"Quart.easeOut"}),this.addTween({targets:this.backClock,duration:400,scaleX:this.backClock.baseScale,scaleY:this.backClock.baseScale,easeParams:[3],ease:"Back.easeOut",completeDelay:100,onComplete:()=>{t.destroy(),this.beginPhaseTwo(),this.addTween({targets:this.backClock,duration:1200,rotation:"+=2",scaleX:"+=1",scaleY:"+=1",alpha:0,ease:"Cubic.easeOut",onComplete:()=>{}})}})):this.addTween({targets:this.backClock,duration:220-4*a,rotation:"-="+e,scaleX:this.backClock.baseScale,scaleY:this.backClock.baseScale,easeParams:[5],ease:"Bounce.easeOut",onComplete:()=>{t.destroy()}})}}),this.addTween({delay:e,targets:t,alpha:0,duration:300,ease:"Cubic.easeIn",onStart:()=>{t.setAlpha(1)}})}}beginPhaseTwo(){globalObjects.bannerTextManager.setDialog([getLangText("magician_c"),getLangText("magician_d")]),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.halfHeight-20,0),globalObjects.bannerTextManager.showBanner(.5),globalObjects.bannerTextManager.setOnFinishFunc(()=>{this.addTween({targets:this.sprite,scaleX:this.sprite.startScale-.2,scaleY:this.sprite.startScale-.2,duration:250,ease:"Cubic.easeOut",onComplete:()=>{this.halo=this.addImage(this.sprite.x,189,"blurry","spellcircle_pulse.png").setScale(.45).setAlpha(0).setDepth(189),this.addTween({delay:50,targets:this.halo,scaleX:1.52,scaleY:1.52,alpha:.96,ease:"Quart.easeIn",duration:400,onComplete:()=>{this.halo.setScale(1.55).setAlpha(1),this.addTween({targets:this.halo,scaleX:1.52,scaleY:1.52,ease:"Back.easeIn",duration:150}),messageBus.publish("animateHealNum",gameConsts.halfWidth,this.sprite.y+84,"INVINCIBLE",1.55,{},{duration:1e3,ease:"Quint.easeIn"})}}),this.addTween({targets:this.sprite,scaleX:this.sprite.startScale+.2,scaleY:this.sprite.startScale+.2,duration:500,ease:"Cubic.easeIn",onComplete:()=>{this.setMaxHealth(20),this.heal(this.healthMax),this.invulnHealthBar=!0,this.healthBarCurr.setFrame("yellow_pixel.png"),this.healthBarText.setText("INVINCIBLE"),this.setDepth(200),this.setAwake(),this.setupTimeShield(),playSound("timeSlow"),this.magicianTimeEpicTheme=playMusic("magician_theme_3",.8),globalObjects.magicCircle.timeSlowFromEnemy(),this.usingTimeFreeze=!0,this.currentAttackSetIndex=2,this.nextAttackIndex=0,this.setSprite("time_magi_cast.png",void 0,!0),this.addTween({targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,duration:450,ease:"Quart.easeOut",onComplete:()=>{this.setSprite("time_magi.png",void 0,!0)}})}})}})})}startChargingUltimate(){let l=gameVars.isHardMode?3:2;for(let n=0;n<20;n++)this.addTween({delay:190*n,duration:300,targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,rotation:0,ease:"Cubic.easeInOut",onStart:()=>{if(!this.finishedChargingUltimate){n%2==0&&(this.sprite.setScale(1.03*this.sprite.startScale),this.sprite.setRotation(.06));var a=this.x,s=this.y+10,i=n*Math.PI/10,h=90*Math.sin(i),i=80*-Math.cos(i);let e=!1,t="clock2.png";(e=gameVars.isHardMode?n%5==0:0===n||10===n||5===n||15===n)&&(t="clock4.png");var r=this.createTimeObject(t,a+h,s+i,0,2,30*n-300),r=(r.setDepth(199),this.addTween({duration:400,targets:r,x:a+h*(e?1.55:1.6),y:s+i*(e?1.55:1.6),ease:"Quart.easeOut"}),2*(n+1));n<6?this.attackName.setText("}"+l+"x"+r+"}"):n<12?(this.attackName.setText("}}"+l+"x"+r+"}}"),this.repositionAngrySymbol()):n<19?(this.attackName.setText("}}}"+l+"x"+r+"}}}"),this.repositionAngrySymbol()):(this.attackName.setText("}}}}"+l+"x"+r+"}}}}"),this.repositionAngrySymbol(),this.nextAttack.chargeMult=7.5,this.setDefaultSprite("time_magi.png"))}}})}showTiredText(){this.dead||(messageBus.publish("showCombatText",getLangText("magician_e"),10),this.addTimeout(()=>{this.playerSpellCastSub=this.addSubscription("playerCastedSpell",()=>{this.playerSpellCastSub.unsubscribe(),clearTimeout(this.spellCastTimeout),this.showTiredText2()}),this.spellCastTimeout=this.addTimeout(()=>{this.playerSpellCastSub.unsubscribe(),this.showTiredText2()},2e3)},3500))}showTiredText2(){this.dead||(messageBus.publish("showCombatText",getLangText("magician_f"),10),this.addTimeout(()=>{this.playerSpellCastSub=this.addSubscription("playerCastedSpell",()=>{this.playerSpellCastSub.unsubscribe(),clearTimeout(this.spellCastTimeout),this.showTiredText3()}),this.spellCastTimeout=this.addTimeout(()=>{this.playerSpellCastSub.unsubscribe(),this.showTiredText3()},2e3)},3500))}showTiredText3(){this.dead||(messageBus.publish("showCombatText",getLangText("magician_g"),10),this.addTimeout(()=>{this.playerSpellCastSub=this.addSubscription("playerCastedSpell",()=>{this.playerSpellCastSub.unsubscribe(),clearTimeout(this.spellCastTimeout),messageBus.publish("closeCombatText")}),this.spellCastTimeout=this.addTimeout(()=>{this.playerSpellCastSub.unsubscribe(),messageBus.publish("closeCombatText")},3e3)},3500))}initAttacks(){this.attacks=[[{name:"}4x3 ",desc:"An advanced magic attack.",chargeAmt:gameVars.isHardMode?400:495,damage:-1,prepareSprite:"time_magi_cast_big.png",attackStartFunction:()=>{this.createTimeObject("clock2.png",this.x-120,this.y-70),this.createTimeObject("clock3.png",this.x-40,this.y-95,150),this.createTimeObject("clock4.png",this.x+40,this.y-80,300),this.addTimeout(()=>{this.fireTimeObjects(4)},800)},attackFinishFunction:()=>{this.health<this.healthMax-20&&(this.currentAttackSetIndex=1,this.nextAttackIndex=0)}},{name:"}3x2 ",desc:"The Time Magician cautiously\npokes you with his\nwand.",chargeAmt:gameVars.isHardMode?350:445,damage:-1,prepareSprite:"time_magi_cast.png",attackStartFunction:()=>{this.createTimeObject("clock2.png",this.x-120,this.y-70),this.createTimeObject("clock3.png",this.x-40,this.y-95,150),this.createTimeObject("clock2.png",this.x+40,this.y-80,300),this.addTimeout(()=>{this.fireTimeObjects(3)},800)},attackFinishFunction:()=>{this.health<this.healthMax-20&&(this.currentAttackSetIndex=1,this.nextAttackIndex=0)}}],[{name:"\\50% MISSING HEALTH",chargeAmt:gameVars.isHardMode?280:345,isPassive:!0,damage:-1,prepareSprite:"time_magi_cast_big.png",attackStartFunction:()=>{},attackFinishFunction:()=>{this.numTimesHealed++;var e=this.healthMax-this.health,e=Math.floor(.5*e);this.heal(e),playSound("magic",.6),messageBus.publish("animateHealNum",this.x,this.y-50,"+"+e,.5+.2*Math.sqrt(e)),this.healSprite||(this.healSprite=this.addImage(gameConsts.halfWidth,this.y-90,"misc","heal.png").setScale(.9).setDepth(999).setAlpha(1)),this.healSprite.setAlpha(1).setPosition(gameConsts.halfWidth,this.y-90),this.scene.tweens.add({targets:this.healSprite,y:"-=30",duration:1e3}),this.scene.tweens.add({targets:this.healSprite,alpha:0,duration:1e3,ease:"Cubic.easeIn",onComplete:()=>{2===this.numTimesHealed&&(globalObjects.bannerTextManager.setDialog([getLangText("magician_a"),getLangText("magician_b")]),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.halfHeight-5,0),globalObjects.bannerTextManager.showBanner(.5))}}),2<=this.numTimesHealed||(this.currentAttackSetIndex=0,this.nextAttackIndex=0)}},{name:";20 ",desc:"A devastating barrage\nof offensive magic.",chargeAmt:gameVars.isHardMode?550:580,isBigMove:!0,prepareSprite:"time_magi_cast_big.png",attackStartFunction:()=>{this.createTimeObjectHuge("clock1.png",this.x-95,60,100,1.4)},attackFinishFunction:()=>{this.addTimeout(()=>{this.fireTimeObjects(20,600)},550),this.currentAttackSetIndex=0,this.nextAttackIndex=0}}],[{name:gameVars.isHardMode?"}3x1}":"}2x1}",desc:"The Time Magician\nuses his ultimate attack",chargeAmt:1300,isBigMove:!0,chargeMult:gameVars.isHardMode?4:3,damage:-1,finishDelay:4200,isPassive:!0,startFunction:()=>{this.setSprite("time_magi_cast_big.png"),this.finishedChargingUltimate=!1,this.startChargingUltimate()},attackStartFunction:()=>{this.finishedChargingUltimate=!0},attackFinishFunction:()=>{this.fireTimeObjects(gameVars.isHardMode?3:2,void 0,135,!0),this.currentAttackSetIndex=3,this.nextAttackIndex=0},finaleFunction:()=>{}}],[{name:"EXHAUSTED...",chargeAmt:300,chargeMult:3,isPassive:!0,startFunction:()=>{this.setDefaultSprite("time_magi_fade.png",1),this.exhausted=!0,globalObjects.magicCircle.cancelTimeSlow(),this.clockShield.currAnim.stop();var e=Math.floor(this.clockShield.rotation/(2*Math.PI));this.clockShield.rotation-=e*Math.PI*2,0<this.clockShield.rotation&&(this.clockShield.rotation-=2*Math.PI),this.addTween({delay:300,targets:this.clockShield,duration:700,scaleX:.85,scaleY:.85,rotation:2*Math.PI,alpha:.75,ease:"Cubic.easeIn",onStart:()=>{this.halo.setDepth(-8),this.addTween({targets:this.halo,alpha:.67,scaleX:1.31,scaleY:1.31,ease:"Quart.easeOut",duration:450})},onComplete:()=>{this.statuses[0].animObj.setScale(.8),this.clockShield.alpha=1,this.clockShieldArm.setRotation(-.4),this.addTween({targets:this.clockShieldArm,duration:200,rotation:0,alpha:1,ease:"Cubic.easeOut"}),this.usingTimeFreeze=!1}})}},{name:"TIRED...",chargeAmt:400,damage:-1,startFunction:()=>{this.showTiredText()},attackStartFunction:()=>{}},{name:":(",chargeAmt:400,damage:-1,attackStartFunction:()=>{}}],[{name:"\\{DELAY INJURIES{\\",desc:"The Time Magician\nslows down his health",chargeAmt:350,prepareSprite:"time_magi_cast_big.png",isPassive:!0,startFunction:()=>{this.preppingTimeShield=!0},attackFinishFunction:()=>{this.usedTimeShield=!0,playSound("time_shield",.6),this.setupTimeShield(),this.currentAttackSetIndex=3,this.nextAttackIndex=0}}],[{name:"}5x2 ",desc:"A basic magic attack.",chargeAmt:350,damage:-1,prepareSprite:"time_magi_cast.png",attackStartFunction:()=>{this.createTimeObject("clock2.png",this.x-120,this.y+30),this.createTimeObject("clock3.png",this.x-75,this.y-20),this.addTimeout(()=>{this.fireTimeObjects(5)},500)}},{name:"}4x3 ",desc:"An advanced magic attack.",chargeAmt:480,damage:-1,prepareSprite:"time_magi_cast_big.png",attackStartFunction:()=>{this.createTimeObject("clock2.png",this.x-110,this.y-40),this.createTimeObject("clock3.png",this.x-60,this.y-75,150),this.createTimeObject("clock4.png",this.x+5,this.y-90,300),this.addTimeout(()=>{this.fireTimeObjects(4)},800)}}],[{name:"}4x3 ",desc:"An advanced magic attack.",chargeAmt:450,damage:-1,prepareSprite:"time_magi_cast_big.png",attackStartFunction:()=>{this.createTimeObject("clock2.png",this.x-120,this.y-70),this.createTimeObject("clock3.png",this.x-40,this.y-80,125),this.createTimeObject("clock4.png",this.x+40,this.y-80,250),this.addTimeout(()=>{this.fireTimeObjects(4)},500)}},{name:"TIME FREEZE ;4x!!!",desc:"The Time Magician prepares\nhis most powerful magics.",chargeAmt:900,isBigMove:!0,prepareSprite:"time_magi_cast_big.png",startFunction:()=>{this.addTimeout(()=>{var e=this.customBgMusic;fadeAwaySound(e,2e3," ")},750),this.usingTimeFreeze=!0},attackFinishFunction:()=>{this.timeBarraged=!0,this.freezingTime=!0;for(let e=0;e<this.timeFallObjs.length;e++)this.timeFallObjs[e].setAlpha(0);playSound("timeSlow"),this.magicianTimeEpicTheme=playMusic("magician_theme_3",.8),globalObjects.magicCircle.timeSlowFromEnemy()}},{name:"TIME-ATTACK |4x5 ",desc:"A devastating barrage\nof offensive magic.",chargeAmt:550,chargeMult:16,prepareSprite:"time_magi_cast_big.png",startFunction:()=>{},attackStartFunction:()=>{this.createTimeObject("clock2.png",this.x-150,115,0),this.createTimeObject("clock4.png",this.x-75,100,75),this.createTimeObject("clock3.png",this.x,105,150),this.createTimeObject("clock3.png",this.x+75,105,225),this.createTimeObject("clock4.png",this.x+150,115,300),this.addTimeout(()=>{this.fireTimeObjects(4)},800)},attackFinishFunction:()=>{}},{name:"TIME-ATTACK |4x7 ",desc:"A devastating barrage\nof offensive magic.",chargeAmt:700,chargeMult:16,prepareSprite:"time_magi_cast_big.png",attackStartFunction:()=>{this.createTimeObject("clock2.png",this.x-220,125,75),this.createTimeObject("clock3.png",this.x-150,115,150),this.createTimeObject("clock4.png",this.x-75,100,225),this.createTimeObject("clock3.png",this.x,105,300),this.createTimeObject("clock4.png",this.x+75,115,375),this.createTimeObject("clock3.png",this.x+150,110,450),this.createTimeObject("clock2.png",this.x+220,125,525),this.addTimeout(()=>{this.fireTimeObjects(4)},900)},attackFinishFunction:()=>{}},{name:"RESTING...",desc:"Time Magician is trying\nto think what to do...",isPassive:!0,chargeAmt:250,chargeMult:1.5,damage:0,startFunction:()=>{this.freezingTime=!1;for(let e=0;e<this.timeFallObjs.length;e++){var t=this.timeFallObjs[e];t.setAlpha(.01+.45*t.scaleX)}globalObjects.magicCircle.cancelTimeSlow(),this.dead||this.addTimeout(()=>{fadeAwaySound(this.magicianTimeEpicTheme,1500)},1500)},attackFinishFunction:()=>{this.isTerrified||(this.currentAttackSetIndex=4,this.nextAttackIndex=0)}}],[{name:"}6 ",desc:"The Time Magician cautiously\npokes you with his\nwand.",chargeAmt:550,damage:-1,prepareSprite:"time_magi_cast_big.png",attackStartFunction:()=>{this.createTimeObject("clock3.png",this.x-25,this.y-110),this.addTimeout(()=>{this.fireTimeObjects(6)},800)}},{name:"}4x2 ",desc:"An advanced magic attack.",chargeAmt:350,damage:-1,prepareSprite:"time_magi_cast_big.png",attackStartFunction:()=>{this.createTimeObject("clock2.png",this.x-110,this.y-70),this.createTimeObject("clock3.png",this.x-35,this.y-100),this.addTimeout(()=>{this.fireTimeObjects(4)},800)}}],[{name:"COWER",isPassive:!0,desc:"The Time Magician is\nafraid of death.",chargeAmt:1e3,chargeMult:1.1,damage:0,startFunction:()=>{}}]]}createTimeObject(e,t,a,s=0,i=1,h=0){t=this.addSprite(t,a,"enemies",e).setRotation(3*(Math.random()-.5)).setScale(0).setDepth(110);return t.durMult=i,this.timeObjects.push(t),this.addTween({delay:s,targets:t,scaleX:1,scaleY:1,ease:"Back.easeOut",easeParams:[3],rotation:"+=1",duration:300*i,onStart:()=>{playSound("time_strike").detune=h}}),t}createTimeObjectHuge(e,t,a,s=0,i=1){let h=this.addSprite(t,a,"enemies",e).setRotation(3*(Math.random()-.5)).setScale(0).setDepth(110);h.durMult=i,h.endScale=1.4,this.timeObjects.push(h),this.addTween({delay:s,targets:h,scaleX:.9,scaleY:.9,ease:"Back.easeOut",easeParams:[2],rotation:"+=1",duration:350,onStart:()=>{playSound("time_strike")},onComplete:()=>{this.addTween({delay:100,targets:h,scaleX:1.4,scaleY:1.4,ease:"Back.easeOut",easeParams:[2.5],rotation:"+=1",duration:400,onStart:()=>{playSound("time_strike",1.2).detune=500}})}})}fireTimeObjects(h=10,r=0,e=175,n=!1){let l=this.timeObjects.length,t=600-Math.floor(50*Math.sqrt(l))+r,a=0;for(;0<this.timeObjects.length;){let i=this.timeObjects.shift();var s=a*e;a++,this.addTween({targets:i,delay:s,y:globalObjects.player.getY()-170+10*Math.random()-.5*i.width,ease:"Quad.easeIn",duration:t,rotation:3*(Math.random()-.5),onStart:()=>{this.addDelay(()=>{i.depth=3},.9*t)},onComplete:()=>{var e=280-40*Math.sqrt(l),t=.004*e,a=1+r/800;let s=this.addSprite(i.x,i.y,"spells","timeRed1.png").setRotation(3*(Math.random()-.5)).setScale(.35*a).setDepth(195);this.addTween({targets:s,scaleX:.7*a,scaleY:.7*a,ease:"Cubic.easeOut",duration:e,onComplete:()=>{s.destroy()}}),this.addTween({targets:s,rotation:"-="+t,alpha:0,duration:e}),1.1<i.scaleX&&playSound("body_slam",.5),Math.random()<.6?playSound("time_strike_hit"):playSound("time_strike_hit_2"),messageBus.publish("selfTakeDamage",h,void 0,i.x+20),n&&setTimeout(()=>{messageBus.publish("selfTakeDamage",h,void 0,i.x-20)},50),i.destroy()}}),this.addTween({targets:i,delay:s,x:.92*gameConsts.halfWidth+.15*i.x,ease:"Back.easeIn",easeParams:[3],duration:t})}}update(t){if(super.update(t),this.lifeOne)for(let e=0;e<this.timeFallObjs.length;e++){var a,s=this.timeFallObjs[e];s.y+=.4*t,s.rotation+=t*s.rotSpeed*.004,s.y>gameConsts.height+75&&(s.y=-75,a="temporal"+Math.floor(10*Math.random())+".png",s.setFrame(a).setRotation(6*Math.random()),a=.3+.55*Math.random(),s.setScale(a),s.rotSpeed=(1+Math.random())*(Math.random<.5?1:-1),s.setScale(s.scaleX),s.setAlpha(.5*s.scaleX-.05),s.x=gameConsts.width*((this.availableIndicies[this.lastPlacedIndex]+.5)/5),this.lastPlacedIndex=(this.lastPlacedIndex+1)%this.availableIndicies.length)}}initTemporalObjects(){this.timeFallObjs=[],this.lastPlacedIndex=0,this.availableIndicies=[0,3,1,4,2,0,1,3,2,4,1,0,3,2,4,3,0,2,4,1,3,1,0,4,2,1,4,3,2,0];for(let e=0;e<15;e++){var t=.3+.55*Math.random(),a="temporal"+Math.floor(10*Math.random())+".png",a=this.addSprite(0,e*gameConsts.height/13-70,"lowq",a).setRotation(6*Math.random()).setScale(t).setDepth(-1);a.setAlpha(0),this.addTween({targets:a,alpha:.34*a.scaleX,duration:500}),a.rotSpeed=(1+Math.random())*(Math.random<.5?1:-1),this.timeFallObjs.push(a),a.x=gameConsts.width*((this.availableIndicies[this.lastPlacedIndex]+.5)/5),this.lastPlacedIndex=(this.lastPlacedIndex+1)%this.availableIndicies.length}}}class Statue extends Enemy{constructor(e,t,a,s){super(e,t,a,s),this.initSprite("palm.png",.96,0,0),this.sprite.startScale=.96,this.defaultRotation=-.045,this.sprite.setAlpha(.2),this.initMisc(),this.initBird(),globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),this.addTimeout(()=>{this.initTutorial()},10),this.popupTimeout=this.addTimeout(()=>{this.tutorialButton=createTutorialBtn(this.level),this.addToDestructibles(this.tutorialButton)},3e3)}initSpriteAnim(e){this.sprite.y-=23,this.sprite.setRotation(0).setScale(.864),this.addTween({targets:this.sprite,alpha:.965,duration:300,ease:"Quad.easeOut"}),this.addTween({targets:this.sprite,y:"+=23",scaleX:.96,scaleY:.96,duration:250,ease:"Cubic.easeIn",onComplete:()=>{playSound("stomp",.4).detune=-400,this.addTween({targets:this.sprite,rotation:this.defaultRotation,duration:100,ease:"Cubic.easeOut"})}})}initStatsCustom(){this.health=gameVars.isHardMode?300:270,this.isAsleep=!0,this.attackScale=1,this.pullbackScale=1,this.damageCanEmit=!0,this.shieldAmts=0,this.shieldTextFont="void",this.shieldTextOffsetY=-95,this.shieldTextSize=58}initTutorial(){this.bgMusic=playMusic("wind",.01,!0),fadeInSound(this.bgMusic,.7,2e3)}initBird(){this.bird=this.addImage(this.x-87,this.y-194,"enemies","bird_1.png").setAlpha(0).setDepth(-1),this.bird.scaleX=-1,this.addTween({delay:150,targets:[this.bird],alpha:1,ease:"Quad.easeIn",duration:500,onStart:()=>{this.addTween({delay:350,targets:[this.bird],scaleY:1.27,ease:"Quad.easeIn",duration:300,onComplete:()=>{playSound("chirp1",.4).detune=50,this.addTween({targets:[this.bird],scaleY:1,ease:"Back.easeOut",duration:300})}})}})}initMisc(){this.shieldExtraText=this.addBitmapText(gameConsts.halfWidth,this.y+this.shieldTextOffsetY+24,"void","SHIELDED",52).setOrigin(.5).setDepth(18).setVisible(!1),this.handShieldBack=this.addImage(this.x+4,this.y-84,"blurry","handshield_back.png").setScale(2).setDepth(-1).setAlpha(0),this.handShieldBack.startScale=this.handShieldBack.scaleX,this.handShield=this.addSprite(this.x+4,this.y-84,"shields","handshield3.png").setScale(3).setDepth(3).setAlpha(0),this.handShield.startScale=this.handShield.scaleX,this.statueSubscribe=messageBus.subscribe("lift_statue",()=>{this.statueSubscribe.unsubscribe(),this.addTween({targets:this.sprite,rotation:0,y:"-=9",easeParams:[2],ease:"Back.easeOut",duration:400,completeDelay:250,onComplete:()=>{playSound("matter_enhance_2",.3).detune=-750,playSound("whoosh"),this.addTween({targets:this.sprite,scaleX:.8,scaleY:.8,alpha:0,y:"-=300",ease:"Quart.easeIn",duration:1200})}})})}showTimeStrike(){this.addDelay(()=>{globalObjects.textPopupManager.setInfoText(gameConsts.width,gameConsts.halfHeight-126,getLangText("time_strike_info"),"right");var e=globalObjects.textPopupManager.getBoxBottomPos(),t=globalObjects.textPopupManager.getCenterPos(),a=globalObjects.textPopupManager.getDepth()+1;this.rune3=this.addImage(t-31,e+16,"circle","bright_rune_time.png").setDepth(a).setScale(.78,.78).setAlpha(0),this.rune4=this.addImage(t+33,e+16,"circle","bright_rune_strike.png").setDepth(a).setScale(.78,.78).setAlpha(0),this.addTween({targets:[this.rune3,this.rune4],scaleX:1,scaleY:1,ease:"Quart.easeOut",duration:500,onComplete:()=>{this.addTween({targets:[this.rune3,this.rune4],scaleX:.8,scaleY:.8,ease:"Back.easeOut",duration:300})}}),this.addTween({targets:[this.rune3,this.rune4],alpha:1,duration:200,completeDelay:1e3,onComplete:()=>{this.playerSpellCastSub=messageBus.subscribe("playerCastedSpell",()=>{this.playerSpellCastSub.unsubscribe(),this.addTimeout(()=>{this.addTween({targets:[this.rune3,this.rune4],alpha:0,duration:300,onComplete:()=>{this.rune3.visible=!1,this.rune4.visible=!1}}),globalObjects.textPopupManager.hideInfoText()},300)})}})},700)}shakeShieldText(){this.shieldAmts<=0&&(this.shieldText.visible=!1),this.shieldText.setAlpha(1),this.shieldText.setText(this.shieldAmts);let e=Math.random()<.5;this.scene.tweens.add({targets:this.shieldText,scaleX:this.shieldText.startScale+1,scaleY:this.shieldText.startScale+1,y:"-=3",x:e?"-=6":"+=6",duration:60*gameVars.gameManualSlowSpeedInverse,ease:"Quint.easeOut",onComplete:()=>{this.scene.tweens.add({targets:this.shieldText,scaleX:this.shieldText.startScale,scaleY:this.shieldText.startScale,y:"+=3",duration:500*gameVars.gameManualSlowSpeedInverse,ease:"Quart.easeOut"}),this.scene.tweens.add({targets:this.shieldText,x:e?"+=13":"-=13",duration:100*gameVars.gameManualSlowSpeedInverse,ease:"Quint.easeInOut",onComplete:()=>{this.shieldText.setDepth(8),this.scene.tweens.add({targets:this.shieldText,x:this.shieldText.startX,duration:400*gameVars.gameManualSlowSpeedInverse,ease:"Bounce.easeOut"}),this.scene.tweens.add({delay:1e3,targets:this.shieldText,alpha:.75,duration:1500})}})}})}damageHandShield(){var e;this.shieldAmts--,this.shakeShieldText(),this.shieldAmts<=0?(messageBus.publish("animateBlockNum",gameConsts.halfWidth,this.sprite.y-15,"-=BROKE=-",1.8,{y:"+=1",ease:"Cubic.easeIn"},{alpha:0,scaleX:1.7,scaleY:1.7,ease:"Back.easeOut"}),playSound("rock_crumble",.35).detune=200,this.clearHandShield(!0)):((2===this.shieldAmts||this.canShowEarlyInfo&&this.shieldAmts<=(gameVars.isHardMode?8:6))&&!this.shownInfo&&(this.shownInfo=!0,2===this.shieldAmts?globalObjects.bannerTextManager.setDialog([getLangText("statue_info_a2"),getLangText("statue_info_b2")]):globalObjects.bannerTextManager.setDialog([getLangText("statue_info_a"),getLangText("statue_info_b")]),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.height-130,0),globalObjects.bannerTextManager.showBanner(.5),globalObjects.bannerTextManager.setOnFinishFunc(()=>{this.showTimeStrike()})),e=9<=this.shieldAmts?400:200,messageBus.publish("animateBlockNum",gameConsts.halfWidth+75-150*Math.random(),this.sprite.y-20-90*Math.random(),"NEGATED",1.02,{alpha:.95,completeDelay:e},{alpha:0}),this.handShield.setAlpha(1),this.handShield.play("handShieldFast"),this.addTween({targets:[this.handShieldBack],alpha:.9,duration:500}),this.handShield.setScale(this.handShield.startScale),this.handShield.once("animationcomplete",()=>{this.shieldAmts<=2?(this.handShield.setFrame("handshieldbroke.png"),this.handShield.setScale(1.6*this.handShield.startScale/3)):(this.handShield.setFrame("handshield10.png"),this.handShield.setScale(.333*this.handShield.startScale))}),this.handShieldBack.setAlpha(.6),this.addTween({targets:[this.handShieldBack],alpha:.35,duration:500})),this.shieldText.setText(this.shieldAmts)}handleSpecialDamageAbsorption(e){return 0}setHealth(e,t){0<this.shieldAmts&&!t?(this.damageHandShield(),super.setHealth(this.health)):(super.setHealth(e),this.prevHealth,this.healthMax,0!=(t=this.health/this.healthMax)&&t<.99999&&!this.gainedShield&&(this.gainedShield=!0,this.birdFalls(),this.flash=this.addSprite(this.x+3,this.y-75,"blurry","flash.webp").setOrigin(.5,.5).setScale(.8).setDepth(-1).setRotation(.2),this.addTween({targets:this.flash,scaleX:3.5*this.sprite.startScale,scaleY:.05*this.sprite.startScale,duration:300}),this.addTween({targets:this.flash,duration:300,ease:"Quad.easeIn",alpha:0,onComplete:()=>{this.flash.destroy()}}),this.setAwake()))}birdFalls(){playSound("clunk",.3).detune=500,this.bird.setDepth(20),this.bird.y-=2,this.addTween({targets:[this.bird],x:"-=40",rotation:"-=5.9",duration:1250}),this.addTween({targets:[this.bird],y:"+=140",duration:1250,ease:"Back.easeIn",onComplete:()=>{playSound("chirp1",.75).detune=-300,this.bird.setFrame("bird_2.png"),this.bird.setRotation(-.4),this.addTween({targets:[this.bird],y:-40,duration:1e3,easeParams:[1.4],ease:"Back.easeIn"}),this.addTween({targets:[this.bird],x:"-=360",rotation:0,duration:1e3,ease:"Quad.easeIn",onComplete:()=>{this.bird.destroy()}})}})}animateCreateHandShield(){this.handShieldTemp=this.addSprite(this.x,this.y-72,"enemies","palm_glow.png").setScale(1.355*this.sprite.startScale).setDepth(3).setAlpha(0).setOrigin(.5,.373),this.handShieldTemp.startScale=this.handShieldTemp.scaleX,this.handShieldTemp.currAnim=this.addTween({targets:this.handShieldTemp,alpha:1,ease:"Quad.easeOut",duration:1850}),this.addDelayIfAlive(()=>{playSound("ringknell"),this.secondTempShield=this.addSprite(this.handShieldTemp.x,this.handShieldTemp.y+99,"enemies","palm_glow.png").setScale(1.2*this.handShieldTemp.startScale,1.15*this.handShieldTemp.startScale).setDepth(3).setAlpha(0).setOrigin(.5,.55),this.addTween({targets:this.secondTempShield,alpha:.8,duration:660,ease:"Cubic.easeOut"}),this.addTween({targets:this.secondTempShield,scaleX:1.8*this.handShieldTemp.startScale,scaleY:1.7*this.handShieldTemp.startScale,duration:550,ease:"Quart.easeOut",onComplete:()=>{this.addTween({targets:this.secondTempShield,scaleX:this.handShieldTemp.scaleX,scaleY:this.handShieldTemp.scaleX,duration:320,ease:"Quint.easeIn",onComplete:()=>{screenShake(7),playSound("stomp",.85),playSound("rock_crumble",.35),this.handShieldTemp.currAnim.stop(),this.handShieldTemp.alpha=1,this.createHandShield(gameVars.isHardMode?10:8),this.addTween({delay:400,targets:[this.handShieldTemp,this.secondTempShield],alpha:0,duration:1300,ease:"Quart.easeOut",onComplete:()=>{this.secondTempShield.destroy()}})}})}})},900)}createHandShield(e){this.shieldExtraText.setVisible(!0).setScale(.4).setAlpha(1),this.addTween({targets:this.shieldExtraText,scaleX:1,scaleY:1,ease:"Back.easeOut",duration:150,completeDelay:1800,onComplete:()=>{this.addTween({targets:this.shieldExtraText,scaleX:.2,scaleY:.25,alpha:0,ease:"Quart.easeIn",duration:400})}});var t=getBackgroundBlackout();t.setDepth(-3).setAlpha(.45),this.spaceBG=this.addImage(gameConsts.halfWidth,gameConsts.halfHeight,"backgrounds","star.png").setDepth(-3).setAlpha(.95).setScale(1.2),this.scene.tweens.add({targets:[this.spaceBG,t],alpha:0,ease:"Cubic.easeOut",duration:2600,completeDelay:650,onComplete:()=>{this.canShowEarlyInfo=!0}}),this.addDelayIfAlive(()=>{this.shieldSettedUp=!0,this.bgMusic=playMusic("but_never_forgotten",.7,!0)},300),this.shieldText.visible=!0,this.shieldText.setText(e),this.shieldText.setScale(.1),this.shieldText.startX=this.shieldText.x,this.shieldText.startScale=.82,this.scene.tweens.add({targets:this.shieldText,scaleX:this.shieldText.startScale,scaleY:this.shieldText.startScale,ease:"Back.easeOut",duration:250*gameVars.gameManualSlowSpeedInverse}),this.handShieldBack.setScale(.85*this.handShieldBack.startScale),this.handShield.setScale(.85*this.handShield.startScale),this.handShield.play("handShieldFull"),this.handShield.once("animationcomplete",()=>{this.handShield.setFrame("handshield10.png"),this.handShield.setScale(.333*this.handShield.startScale)}),this.scene.tweens.add({targets:this.handShieldBack,scaleX:this.handShieldBack.startScale,scaleY:this.handShieldBack.startScale,alpha:1,easeParams:[2.5],ease:"Back.easeOut",duration:200,onComplete:()=>{this.addTween({targets:[this.handShieldBack],alpha:.35,duration:500})}}),this.scene.tweens.add({targets:this.handShield,scaleX:this.handShield.startScale,scaleY:this.handShield.startScale,alpha:1,easeParams:[2.5],ease:"Back.easeOut",duration:200}),this.shieldAmts=e}clearHandShield(e=!1){this.shieldText.setVisible(!1),0===this.shieldAmts&&!e||(this.handShield.setFrame("handshieldbroke.png"),this.handShield.setScale(1.7).setAlpha(1),this.addTween({targets:this.handShield,scaleX:1.9,scaleY:1.9,ease:"Cubic.easeOut",duration:250}),this.handShield.currAnim=this.addTween({targets:[this.handShield,this.handShieldBack],alpha:0,duration:600}),this.shieldAmts=0)}destroy(){super.destroy(),this.statueSubscribe&&this.statueSubscribe.unsubscribe()}die(){this.dead||(this.handShield.destroy(),this.handShieldTemp&&this.handShieldTemp.destroy(),this.secondTempShield&&this.secondTempShield.destroy(),super.die(),gameVars.latestLevel=this.level,sdkSetItem("latestLevel",gameVars.latestLevel.toString()),gameVars.maxLevel=Math.max(gameVars.maxLevel,this.level),sdkSetItem("maxLevel",gameVars.maxLevel.toString()),playSound("rock_crumble",.4).detune=-300,playSound("shield_break",.6).detune=-800,globalObjects.textPopupManager.hideInfoText(),this.sprite.setScale(this.sprite.startScale).setRotation(0),this.clearHandShield(),swirlInReaperFog(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton(),globalObjects.magicCircle.disableMovement(),this.addTween({targets:[this.sprite],scaleX:.9,scaleY:.9,alpha:.98,rotation:-.24,ease:"Cubic.easeOut",duration:450,completeDelay:2500,onComplete:()=>{this.customVictory()}}))}customVictory(){sdkGameplayStop(),playReaperPassiveAnim(this,()=>{clearDeathFog(),this.addDelay(()=>{this.addDelay(()=>{let e=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-35,"misc","victory_banner.png").setScale(100,1.2).setDepth(9998).setAlpha(0),t=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-44,"misc","complete.png").setScale(.95).setDepth(9998).setAlpha(0),a=this.scene.add.text(gameConsts.halfWidth,gameConsts.halfHeight+2,getLangText("cont_ui"),{fontFamily:"Verdana",color:"#F0F0F0",fontSize:18}).setAlpha(0).setOrigin(.5,.5).setAlign("right").setDepth(9998);PhaserScene.tweens.add({targets:e,alpha:.75,duration:500}),PhaserScene.tweens.add({targets:[t],alpha:1,ease:"Quad.easeOut",duration:500}),playSound("victory"),this.addTimeout(()=>{a.alpha=1},1e3),PhaserScene.tweens.add({targets:t,scaleX:1,scaleY:1,duration:800,onComplete:()=>{globalObjects.player.isDead()||(this.dieClickBlocker=createGlobalClickBlocker(!1),canvas&&(canvas.style.cursor="pointer"),this.dieClickBlocker.setOnMouseUpFunc(()=>{canvas&&(canvas.style.cursor="default"),hideGlobalClickBlocker(),a.destroy(),PhaserScene.tweens.add({targets:[t,e],alpha:0,duration:800,completeDelay:350,onComplete:()=>{t.destroy(),e.destroy(),gameVars.ignoreNextAd=!0,beginPreLevel(this.level+1),this.destroy()}})}))}})},1100)},1200)})}initAttacks(){var e=gameVars.isHardMode?-40:10;this.attacks=[[{name:gameVars.isHardMode?"VOID SHIELD? #10":"VOID SHIELD? #8",chargeAmt:888,chargeMult:20,finishDelay:2300,damage:-1,finaleFunction:()=>{fadeAwaySound(this.bgMusic,1500),this.animateCreateHandShield(),this.currentAttackSetIndex=1,this.nextAttackIndex=0}}],[{name:"BOOTING UP...",chargeAmt:gameVars.isHardMode?350:600,damage:0},{name:"}3x2}",chargeAmt:500+e,finishDelay:1e3,damage:-1,startFunction:()=>{},attackFinishFunction:()=>{this.fireVoidAttacks(3,1)}},{name:"}3x4}",chargeAmt:550+e,finishDelay:1600,damage:-1,startFunction:()=>{},attackFinishFunction:()=>{this.fireVoidAttacks(3,2)}},{name:"}3x6}",chargeAmt:600+e,finishDelay:2200,damage:-1,startFunction:()=>{},attackFinishFunction:()=>{this.fireVoidAttacks(3,3)}},{name:"}}3x8}}",chargeAmt:650+e,finishDelay:2800,damage:-1,startFunction:()=>{},attackFinishFunction:()=>{this.fireVoidAttacks(3,4)}},{name:"}}3x10}}",chargeAmt:700+e,finishDelay:3200,damage:-1,startFunction:()=>{},attackFinishFunction:()=>{this.fireVoidAttacks(3,5)}},{name:"}}3x12}}",chargeAmt:750+e,finishDelay:3700,damage:-1,startFunction:()=>{},attackFinishFunction:()=>{this.fireVoidAttacks(3,6)}},{name:"}}}3x14}}}",chargeAmt:800+e,finishDelay:4150,isBigMove:!0,damage:-1,startFunction:()=>{},attackFinishFunction:()=>{this.fireVoidAttacks(3,7)}},{name:"}}}3x16}}}",chargeAmt:850+e,finishDelay:4500,isBigMove:!0,damage:-1,startFunction:()=>{},attackFinishFunction:()=>{this.fireVoidAttacks(3,8)}},{name:"}}}3x18}}}",chargeAmt:950+e,finishDelay:4800,isBigMove:!0,damage:-1,startFunction:()=>{},attackFinishFunction:()=>{this.fireVoidAttacks(3,8)}},{name:";40",chargeAmt:700,finishDelay:3500,isBigMove:!0,damage:-1,startFunction:()=>{},attackFinishFunction:()=>{this.fireBigAttack(40)}},{name:"DEACTIVATING...",chargeAmt:888,chargeMult:20,finishDelay:1500,damage:0,finaleFunction:()=>{this.bgMusic=playMusic("wind",.01,!0),fadeInSound(this.bgMusic,.7,2e3),this.setAsleep(),this.interruptCurrentAttack()}}]]}fireVoidAttacks(i=3,h=3){this.prepAttack(),this.handShieldTemp.currAnim=this.addTween({targets:this.handShieldTemp,alpha:1,duration:1300}),this.addDelay(()=>{playSound("ringknell")},500);for(let s=0;s<h;s++)this.addDelayIfAlive(()=>{0==s&&(this.handShieldTemp.currAnim.stop(),this.addTween({targets:this.handShieldTemp,alpha:0,ease:"Quad.easeOut",duration:500}));var e=getTempPoolObject("blurry","pulser.png","pulser",825);e.setAlpha(0).setScale(.65).setPosition(this.x,this.y-60).setDepth(10),this.addTween({targets:e,scaleX:9,scaleY:9,ease:"Quint.easeIn",duration:800}),this.addTween({targets:e,alpha:1,duration:250}),this.addDelayIfAlive(()=>{messageBus.publish("selfTakeDamage",i);var e=getTempPoolObject("spells","damageEffect3.png","damageEffect3",200),e=(e.play("damageEffectShort"),e.setPosition(gameConsts.halfWidth+20*(Math.random()-.5),globalObjects.player.getY()-195).setDepth(998).setScale(1.25),this.addTimeout(()=>{messageBus.publish("selfTakeDamage",i);playSound("body_slam",a).detune=50+Math.floor(100*Math.random());var e=getTempPoolObject("spells","damageEffect3.png","damageEffect3",200);e.play("damageEffect"),e.setPosition(gameConsts.halfWidth+25*(Math.random()-.5),globalObjects.player.getY()-180).setDepth(998).setScale(1.35)},150),s==h-1),t=getBackgroundBlackout();t.setDepth(-3).setAlpha(e?.33+.04*h:.3),this.addTween({targets:t,alpha:0,ease:"Cubic.easeOut",duration:e?800:400});let a=.4;s%2==1&&(a=.6),e&&(a=.7),playSound("body_slam",a).detune=-100-Math.floor(100*Math.random())},590)},s*(600-h*(40-s))+1100)}fireBigAttack(e){this.prepAttack(),fadeAwaySound(this.bgMusic,2200),this.handShieldTemp.currAnim=this.addTween({targets:this.handShieldTemp,alpha:1,duration:2e3,onComplete:()=>{this.handShieldTemp.currAnim.stop(),this.addTween({targets:this.handShieldTemp,alpha:0,ease:"Quad.easeOut",duration:500,onComplete:()=>{playSound("death_cast",.65),this.addDelay(()=>{playSound("death_cast",.35)},3e3)}}),playSound("death_attack",.95),zoomTemp(1.02),screenShakeLong(3),this.shoutSprite=this.addImage(this.x,this.y-60,"misc","black_circle.png").setDepth(11).setScale(.15),this.spaceBG&&(this.spaceBG.setAlpha(1.1),this.scene.tweens.add({targets:[this.spaceBG],alpha:0,ease:"Cubic.easeIn",duration:3e3})),this.shoutSprite.setScale(.15).setAlpha(1),this.addTween({targets:[this.shoutSprite],scaleX:9,scaleY:9,duration:900,ease:"Quad.easeOut"}),this.addTween({targets:[this.shoutSprite],alpha:0,duration:1e3}),this.addDelayIfAlive(()=>{messageBus.publish("selfTakeDamage",e)},250)}}),this.addDelay(()=>{playSound("ringknell")},500)}prepAttack(){this.flashPic||(this.darkBlur=this.addImage(this.x,this.y-55,"blurry","dark_blur.png").setDepth(-1).setScale(7).setAlpha(0),this.flashPic=this.addImage(this.x,this.y-65,"blurry","flash.webp").setDepth(-1)),this.flashPic.setScale(.1).setRotation(-.05),this.addTween({targets:this.darkBlur,alpha:.45,ease:"Quad.easeOut",duration:570,onComplete:()=>{this.addTween({targets:this.darkBlur,alpha:0,duration:1e3})}}),this.addTween({targets:this.flashPic,rotation:.05,scaleX:3,scaleY:2.2,ease:"Cubic.easeIn",duration:570,onComplete:()=>{this.addTween({targets:this.flashPic,rotation:.15,scaleX:0,scaleY:0,ease:"Cubic.easeOut",duration:570})}})}}class Tree extends Enemy{constructor(e,t,a,s){super(e,t,a,s),this.initSprite("tree.png",.875),this.sprite.setOrigin(.52,.88),this.shieldAdded=!1,this.bgMusic=playMusic("echos_of_time",.9,!0),playSound("tree_rustle",.35),this.popupTimeout=this.addTimeout(()=>{this.tutorialButton=createTutorialBtn(this.level),this.addToDestructibles(this.tutorialButton)},3e3)}initStatsCustom(){this.health=gameVars.isHardMode?250:230,this.isAsleep=!0,this.leafObjects=[],this.pullbackScale=.99,this.attackScale=1.03}takeEffect(e){!this.sprite||"mindStrike"!=e.name||this.dead||this.hasTimbered||(this.breatheTween&&this.breatheTween.stop(),this.sprite.setVisible(!1),this.tempOverlaySprite||(this.tempOverlaySprite=this.addSprite(this.x,this.y,"enemies","tree_shock1.png").setScale(2.1).setDepth(7)),this.tempOverlaySprite.setFrame("tree_shock1.png").setVisible(!0),this.tempOverlaySprite.x=this.x+10,this.addTween({targets:this.tempOverlaySprite,x:this.x,duration:250,ease:"Bounce.easeOut"}),this.preparingTimber?this.tempOverlaySprite.setOrigin(.52,.7):this.tempOverlaySprite.setOrigin(.52,.88),this.addDelay(()=>{this.tempOverlaySprite.setFrame("tree_shock2.png"),this.tempOverlaySprite.setScale(2.1),this.preparingTimber?this.tempOverlaySprite.setOrigin(.52,.7):this.tempOverlaySprite.setOrigin(.52,.88),this.addDelay(()=>{this.setSpriteIfNotInactive(this.defaultSprite),this.repeatTweenBreathe(),this.tempOverlaySprite.setVisible(!1),this.sprite.setVisible(!0)},110)},110)),super.takeEffect(e)}setHealth(e){super.setHealth(e);this.prevHealth,this.healthMax;var e=this.health/this.healthMax,a=this.prevHealth-this.health;if(0!=e){if(30<=a?this.dropLeavesMany():20<=a&&this.dropLeaves(),this.isAsleep){this.breatheTween&&(this.breatheTween.stop(),this.sprite.setScale(this.sprite.startScale)),setTimeout(()=>{playSound("chirpmany",.3).detune=-50},500),this.setAwake();var a=this.x+130*this.sprite.startScale,s=this.y-68.5*this.sprite.startScale;let e=this.addImage(this.x,this.y,"enemies","tree_open.png").setDepth(1).setOrigin(this.sprite.originX,this.sprite.originY).setScale(this.sprite.startScale).setAlpha(0),t=(this.addExtraSprite(e),this.addImage(a,s,"enemies","tree_eye.png").setDepth(10).setOrigin(.5,.5).setRotation(-.13).setScale(0,this.sprite.startScale));this.thorns1=this.addImage(this.x-4,this.y-95,"enemies","thorns.png").setDepth(8).setRotation(4.7115).setOrigin(.5,-.6).setScale(.7,.5),this.thorns2=this.addImage(this.x-4,this.y-95,"enemies","thorns.png").setDepth(8).setRotation(1.57).setOrigin(.5,-.6).setScale(.7,.5),this.thorns1.alpha=0,this.thorns2.alpha=0,this.greenGlow=this.addImage(this.x-4,this.y-265,"blurry","green_star.webp").setDepth(-1).setOrigin(.5,.48).setAlpha(0),this.addExtraSprite(t,3.5,-84),this.addTween({targets:e,alpha:.95,duration:1200}),this.addTween({targets:t,scaleX:.6*this.sprite.startScale,ease:"Back.easeOut",easeParams:[1.5],rotation:-.08,duration:450,onComplete:()=>{this.addTween({delay:500,targets:t,rotation:0,scaleX:1.2*this.sprite.startScale,ease:"Cubic.easeIn",duration:350,onStart:()=>{playSound("meat_click_left",.36),playSound("meat_click_right",.36)},onComplete:()=>{this.addTween({targets:t,scaleX:this.sprite.startScale,ease:"Cubic.easeOut",duration:300,onComplete:()=>{e.destroy(),this.setDefaultSprite("tree_open.png",this.sprite.startScale),this.removeExtraSprite(t),t.destroy()}})}})}})}e<.667&&!this.hasCrushed?(this.crushBirdFall||(this.dropBird(),setTimeout(()=>{playSound("chirp1").pan=-.2},900),this.crushBirdFall=!0),this.setNextAttack(3,0)):this.health<=70&&!this.hasTimbered&&(this.setNextAttack(5,0),this.hasPreparedFinal||(this.dropBird(),setTimeout(()=>{playSound("chirp1").detune=-40},900),this.addTimeout(()=>{this.dropBird(),setTimeout(()=>{playSound("chirp1").detune=60},1100)},150),this.hasPreparedFinal=!0))}}initSpriteAnim(e){this.sprite.setScale(.99*e,1.02*e),this.addTween({targets:this.sprite,duration:1500,scaleX:e,scaleY:e,ease:"Cubic.easeOut",alpha:1,onComplete:()=>{this.repeatTweenBreathe()}}),this.addTween({targets:this.sprite,duration:1e3,alpha:1})}repeatTweenBreathe(e=2500){this.breatheTween&&this.breatheTween.stop(),this.breatheTween=this.addTween({targets:this.sprite,duration:e,scaleY:"+=0.01",ease:"Quart.easeOut",onComplete:()=>{this.addTween({targets:this.sprite,duration:.8*e,scaleY:"-=0.01",ease:"Cubic.easeInOut",onComplete:()=>{this.repeatTweenBreathe()}})}})}dropLeaves(){let e=getTempPoolObject("enemies","falling_leaves.png","fallingLeaves",1500);var t=Math.random()<.5;e.setFrame("falling_leaves.png").setScale(t?1:-1,1).setDepth(10),e.setPosition(this.x+300*(Math.random()-.5),this.y-250+25*Math.random()).setAlpha(.5),this.addTween({targets:e,duration:1400,y:"+=90"}),this.addTween({targets:e,duration:300,alpha:1,ease:"Cubic.easeOut",scaleX:t?1.25:-1.25,scaleY:1.33,onComplete:()=>{this.addTween({targets:e,duration:1e3,alpha:0})}})}dropLeavesMany(){var e=Math.random()<.5;let t=getTempPoolObject("enemies","falling_leaves_2.png","fallingLeaves",2e3),a=(t.setFrame("falling_leaves_2.png").setScale(e?1:-1,1).setDepth(10),t.setPosition(this.x+300*(Math.random()-.5),this.y-255+25*Math.random()).setAlpha(1),getTempPoolObject("enemies","falling_leaves_3.png","fallingLeaves",2e3));a.setFrame("falling_leaves_3.png").setScale(e?1:-1,1).setDepth(10),a.setPosition(this.x+250*(Math.random()-.5),this.y-240+25*Math.random()).setAlpha(1).setRotation(6*Math.random()),this.addTween({targets:[t,a],duration:1500,y:"+=100"});var s=.5<Math.random()?1:-1;this.addTween({targets:[a],duration:1500,rotation:"+="+s}),this.addTween({targets:[t,a],duration:300,alpha:1,ease:"Cubic.easeOut",scaleX:e?1.25:-1.25,scaleY:1.33,onComplete:()=>{this.addTween({targets:[t,a],duration:1100,alpha:0})}})}glowGreen(){this.addTween({targets:this.greenGlow,duration:500,alpha:.6,scaleX:2.5,scaleY:2.5,ease:"Quad.easeIn",onComplete:()=>{this.addTween({targets:this.greenGlow,duration:1500,alpha:0,scaleX:1.5,scaleY:1.5,ease:"Cubic.easeIn"})}})}startHealing(a=10){if(!this.statuses[0]){let e=this.addImage(gameConsts.halfWidth,this.y-70,"misc","heal.png").setDepth(999).setAlpha(0),t={};t={animObj:e,amt:a,duration:1001,onUpdate:()=>{t.duration%6==0&&(t.amt<=0?t.cleanUp():(this.heal(t.amt),this.healText.setText("+"+t.amt),--t.amt,this.healText.alpha=1,this.healText.y=this.healText.startY,this.addTween({targets:this.healText,scaleX:1,scaleY:1,y:"-=13",ease:"Quart.easeOut",duration:3e3}),this.addTween({delay:2500,targets:this.healText,alpha:0,ease:"Quad.easeIn",duration:1e3}),e.alpha=1,e.y=this.y-85,e.scaleX=-1*e.scaleX,this.addTween({targets:e,y:"-=50",duration:1200}),this.addTween({delay:200,targets:e,alpha:0,ease:"Quad.easeIn",duration:1e3})))},cleanUp:()=>{e.destroy(),this.statuses[0]=null}},this.statuses[0]=t}}stopHealing(){this.statuses[0]&&(this.statuses[0].cleanUp(),this.statuses[0]=null)}createLeafObject(e,t,a,s=0){e=this.addImage(t,a,"enemies",e).setRotation(3*(Math.random()-.5)).setScale(0).setDepth(110),this.leafObjects.push(e),t=gameConsts.halfWidth-t,a=globalObjects.player.getY()-175-a,a=Math.atan2(a,t)-1.57;this.addTween({delay:s,targets:e,scaleX:1,scaleY:1,ease:"Back.easeOut",easeParams:[2],duration:300}),this.addTween({delay:s,targets:e,ease:"Cubic.easeOut",rotation:a,duration:500})}fireObjects(s=10){let i=this.leafObjects.length;var e=550-Math.floor(50*Math.sqrt(i));let t=0;for(;0<this.leafObjects.length;){let a=this.leafObjects.shift();var h=100*t;this.addTween({delay:h,targets:a,scaleX:.85,scaleY:1.2,ease:"Cubic.easeIn",duration:e}),t++,this.addTween({targets:a,delay:h,y:globalObjects.player.getY()-190,x:.9*gameConsts.halfWidth+.1*a.x,ease:"Quad.easeIn",duration:e,onStart:()=>{a.setScale(1)},onComplete:()=>{var e=280-40*Math.sqrt(i);let t=this.addImage(a.x-10+20*Math.random(),a.y+8*Math.random(),"spells","damageEffect3.png").setScale(.95).setRotation(Math.random()).setDepth(195);this.addTween({targets:t,scaleX:1,scaleY:1,ease:"Cubic.easeOut",duration:e,onComplete:()=>{t.destroy()}}),this.addTween({targets:t,alpha:0,duration:e}),playSound("razor_leaf",.75),messageBus.publish("selfTakeDamage",s,void 0,a.x),a.destroy()}})}}attackWithBranch(a=12){let s;this.treeBranch?this.treeBranch.setPosition(gameConsts.halfWidth-75+150*Math.random(),-50).setRotation(-.7+Math.random()).setAlpha(1):this.treeBranch=this.addImage(gameConsts.halfWidth-35+100*Math.random(),-50,"enemies","tree_branch.webp").setRotation(-.7+Math.random()).setDepth(110).setOrigin(.6,.6),s=this.treeBranch,this.glowGreen(),this.addTween({targets:s,rotation:-.2,duration:700}),this.addTween({delay:75,targets:s,x:.2*gameConsts.halfWidth+.8*s.x,y:gameConsts.height-320,ease:"Quart.easeIn",duration:1e3,onComplete:()=>{playSound("tree_hit"),messageBus.publish("selfTakeDamage",a);var e=.5*gameConsts.halfWidth+.5*s.x;let t=this.addSprite(e,s.y+8*Math.random(),"spells").play("damageEffectShort").setRotation(3*(Math.random()-.5)).setScale(1.5).setDepth(195);this.addTween({targets:t,scaleX:1.25,scaleY:1.25,ease:"Cubic.easeOut",duration:170,onComplete:()=>{t.destroy()}}),this.addTween({targets:t,alpha:0,ease:"Quad.easeIn",duration:170});e=s.x-gameConsts.halfWidth;this.addTween({targets:s,alpha:0,x:"+="+4*e,rotation:.05*e,duration:600}),this.addTween({targets:s,y:"-=120",duration:600,ease:"Cubic.easeOut"})}})}clearThorns(){this.thornsTween&&this.thornsTween.stop(),this.hasThorns=!1,this.addTween({targets:[this.thorns1,this.thorns2],scaleX:.8,scaleY:.8,alpha:0,ease:"Cubic.easeOut",duration:300})}playThornsAnim(){this.thorns1.setScale(.5,.7),this.thorns2.setScale(.5,.7),this.addTween({targets:[this.thorns1,this.thorns2],scaleX:1.1,scaleY:1.1,alpha:1,ease:"Quart.easeOut",duration:500,onComplete:()=>{this.addTween({targets:[this.thorns1,this.thorns2],scaleX:1,scaleY:1,ease:"Cubic.easeOut",alpha:.85,duration:700})}});let e=this.addImage(gameConsts.halfWidth,this.y-150,"spells","brickPattern1.png").setScale(.75).setDepth(0).setAlpha(0).setRotation(-3);this.addTween({delay:300,targets:[e],rotation:0,scaleX:1.05,scaleY:1.05,ease:"Quad.easeOut",alpha:.9,duration:200,onComplete:()=>{playSound("matter_body");messageBus.publish("animateArmorNum",gameConsts.halfWidth,this.y-60,"+2 THORNS",1,{duration:400,ease:"Quad.easeOut",y:"-=1",scaleX:1,scaleY:1},{alpha:0,duration:1600,scaleX:.95,scaleY:.95}),this.addTween({targets:[e],scaleX:1,scaleY:1,ease:"Cubic.easeIn",alpha:.7,duration:400,onComplete:()=>{globalObjects.bannerTextManager.setDialog([getLangText("tree_a"),getLangText("tree_b")]),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.halfHeight+10,0),globalObjects.bannerTextManager.showBanner(.5),this.setDefense(2),this.hasThorns=!0,this.addTween({targets:[e],ease:"Cubic.easeIn",alpha:0,duration:1e3,onComplete:()=>{e.destroy()}})}})}})}playRegrowthAnim(e){}initAttacks(){gameVars.isHardMode;this.attacks=[[{name:"}8 ",announceName:"BRANCH ATTACK",desc:"The tree swipes a branch at you",chargeAmt:410,damage:-1,startFunction:()=>{},attackStartFunction:()=>{this.attackWithBranch(8)},attackFinishFunction:()=>{this.health/this.healthMax<=.6&&!this.hasCrushed?this.setNextAttack(3,0):this.setNextAttack(1,0)}}],[{name:"THORNS {2",announceName:"THORNS",desc:"The tree creates protective thorns!",chargeAmt:400,chargeMult:gameVars.isHardMode?2:1,isPassive:!0,damage:-1,attackStartFunction:()=>{},attackFinishFunction:()=>{this.playThornsAnim(),this.health/this.healthMax<=.6&&!this.hasCrushed?this.setNextAttack(3,0):this.setNextAttack(2,0)}}],[{name:" STARE...",chargeAmt:350,isPassive:!0,attackStartFunction:()=>{},finaleFunction:()=>{this.health/this.healthMax<=.6&&!this.hasCrushed&&(this.currentAttackSetIndex=3,this.nextAttackIndex=0)}},{name:"|10 ",announceName:"BRANCH ATTACK",desc:"The tree swipes a branch at you",chargeAmt:600,damage:-1,attackStartFunction:()=>{this.attackWithBranch(10)},attackFinishFunction:()=>{this.health/this.healthMax<=.6&&!this.hasCrushed&&(this.currentAttackSetIndex=3,this.nextAttackIndex=0)}},{name:" STARE...",chargeAmt:350,damage:-1,isPassive:!0,attackStartFunction:()=>{},attackFinishFunction:()=>{this.health/this.healthMax<=.6&&!this.hasCrushed&&(this.currentAttackSetIndex=3,this.nextAttackIndex=0)}},{name:"|2x5 ",announceName:"LEAF SHOWER",desc:"The tree showers you with sharp leaves",chargeAmt:550,damage:0,attackStartFunction:()=>{playSound("tree_sfx")},attackFinishFunction:()=>{this.glowGreen();for(let e=0;e<5;e++){var t=gameConsts.halfWidth+-200+100*e,a=75+40*Math.random();this.createLeafObject("tree_leaf.webp",t,a,25*e)}this.addTimeout(()=>{this.fireObjects(2)},250)}}],[{name:gameVars.isHardMode?";32":";30",announceName:"CRUSH",desc:"The tree tries to crush you",chargeAmt:gameVars.isHardMode?1e3:1100,finishDelay:3e3,chargeMult:1.5,damage:-1,isBigMove:!0,startFunction:()=>{this.addTimeout(()=>{this.dead||(globalObjects.textPopupManager.setInfoText(gameConsts.width,gameConsts.halfHeight-130,getLangText("level2_tut_a"),"right",!0),setTimeout(()=>{globalObjects.textPopupManager.hideInfoText()},9800))},1900)},attackStartFunction:()=>{this.glowGreen(),playSound("tree_sfx"),playSound("magic"),globalObjects.textPopupManager.hideInfoText(),this.hasCrushed=!0,this.createCrushAttack(gameVars.isHardMode?32:30)},attackFinishFunction:()=>{this.pullbackScale=.99,this.attackScale=1.03;this.health,this.healthMax;70<this.health?(this.currentAttackSetIndex=4,this.nextAttackIndex=0):this.hasTimbered||(this.currentAttackSetIndex=5,this.nextAttackIndex=0)}}],[{name:" STARE...",chargeAmt:gameVars.isHardMode?300:350,damage:-1,isPassive:!0,attackStartFunction:()=>{},attackFinishFunction:()=>{this.health/this.healthMax<=.6&&!this.hasCrushed&&(this.currentAttackSetIndex=3,this.nextAttackIndex=0)}},{name:"|2x5 ",announceName:"LEAF STORM",desc:"The tree showers you with sharp leaves",chargeAmt:gameVars.isHardMode?500:550,damage:0,attackStartFunction:()=>{playSound("tree_sfx")},attackFinishFunction:()=>{this.glowGreen();for(let e=0;e<5;e++){var t=gameConsts.halfWidth+-200+100*e,a=75+40*Math.random();this.createLeafObject("tree_leaf.webp",t,a,25*e)}this.addTimeout(()=>{this.fireObjects(2)},300)}},{name:"|10 ",announceName:"BRANCH ATTACK",desc:"The tree swipes a branch at you",chargeAmt:600,damage:-1,attackStartFunction:()=>{this.attackWithBranch(10)}}],[{name:gameVars.isHardMode?"TIMBER!;44":"TIMBER!;40",announceName:"TIMBER!!!",desc:"The tree tries to crush you",chargeAmt:1250,chargeMult:2.5,damage:gameVars.isHardMode?44:40,isBigMove:!0,startFunction:()=>{this.attackSlownessMult=1.8,this.glowBG||(this.glowBG=this.addImage(this.sprite.x,this.sprite.y,"blurry","explod.webp").setDepth(-1).setAlpha(.01).setScale(9).setBlendMode(Phaser.BlendModes.MULTIPLY)),this.finalGlowTween=this.addTween({targets:this.glowBG,scaleX:15,scaleY:15,alpha:.5,ease:"Quad.easeOut",duration:15e3}),this.sprite.setOrigin(.52,.7),this.sprite.y-=.125*this.sprite.height,this.preparingTimber=!0,fadeAwaySound(this.bgMusic,3e3),this.addTimeout(()=>{this.dead||(this.bgMusic=playMusic("echos_of_time_finale"))},3200);let e=this.addImage(this.sprite.x,this.sprite.y,"lowq","green_spike.png").setDepth(20).setScale(5).setRotation(-3).setAlpha(0);this.addTween({targets:e,ease:"Cubic.easeIn",rotation:0,scaleX:.8,scaleY:.8,alpha:1.2,duration:800,onComplete:()=>{e.setScale(1),this.addTween({targets:e,ease:"Cubic.easeOut",alpha:0,scaleX:.4,scaleY:.4,duration:800,onComplete:()=>{e.destroy()}})}})},attackStartFunction:()=>{this.finalGlowTween&&this.finalGlowTween.stop(),playSound("tree_timber"),this.pullbackScale=.97,this.attackScale=1.75,this.hasTimbered=!0,this.addTween({targets:this.glowBG,scaleX:13,scaleY:13,alpha:1,ease:"Quad.easeIn",duration:1e3});let e=this.addImage(this.sprite.x,this.sprite.y,"lowq","green_spike.png").setDepth(20).setScale(.1).setRotation(.25*Math.PI);this.addTween({targets:e,ease:"Quad.easeOut",scaleX:3,scaleY:3,alpha:0,duration:800,onComplete:()=>{e.destroy()}})},attackFinishFunction:()=>{this.addTween({targets:this.glowBG,scaleX:15,scaleY:15,alpha:0,ease:"Cubic.easeOut",duration:1e3,onComplete:()=>{this.glowBG.destroy()}}),this.pullbackScale=.99,this.attackScale=1.01,this.currentAttackSetIndex=6,this.nextAttackIndex=0,this.triggerFallen(),playSound("body_slam");let e=poolManager.getItemFromPool("brickPattern2");(e=e||this.addImage(gameConsts.halfWidth,globalObjects.player.getY()-120,"spells","brickPattern2.png").setDepth(998).setScale(.75)).setDepth(998).setScale(.85).setAlpha(1),this.addTween({targets:e,rotation:1,alpha:0,duration:800,onComplete:()=>{poolManager.returnItemToPool(e,"brickPattern2")}})}}],[{name:"STUMPED...",desc:"The tree is stumped",chargeAmt:600,damage:0,startFunction:()=>{this.addTween({targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,duration:2e3,ease:"Cubic.easeInOut"})}}]]}die(){this.dead||(super.die(),this.triggerFallen(),this.currAnim&&this.currAnim.stop(),this.finalGlowTween&&(this.finalGlowTween.stop(),this.addTween({targets:this.glowBG,alpha:0,duration:2e3})),this.clearThorns(),globalObjects.bannerTextManager.closeBanner(),globalObjects.textPopupManager.hideInfoText(),this.addTween({targets:[this.rune1],alpha:0,duration:200}),this.dieClickBlocker=new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:gameConsts.halfHeight,alpha:.001,scaleX:1e3,scaleY:1e3},onMouseUp:()=>{}}),this.addTimeout(()=>{this.showFlash(this.x,this.y-25);let e=this.addImage(this.x,this.y-10,"tutorial","rune_reinforce_large.png").setScale(.5).setDepth(9999);playSound("victory_2"),this.addTween({targets:e,x:gameConsts.halfWidth,y:gameConsts.halfHeight-170,scaleX:1,scaleY:1,ease:"Cubic.easeOut",duration:1500,onComplete:()=>{this.showVictory(e)}})},2800))}triggerFallen(){if(!this.fallen){this.attackAnim&&this.attackAnim.stop(),this.fallen=!0;var t=this.sprite.scaleX;let e=this.addImage(this.sprite.x+10,this.sprite.y,"enemies","tree_top.png");this.clearThorns(),e.setScale(this.sprite.scaleX,this.sprite.scaleY).setOrigin(this.sprite.originX,this.sprite.originY).setDepth(this.sprite.depth-1),this.setDefaultSprite("tree_stumped.png",this.sprite.startScale,!0),this.sprite.setScale(t),this.addTween({targets:this.sprite,scaleX:this.sprite.startScale,scaleY:this.sprite.startScale,duration:2e3,ease:"Quad.easeOut"}),this.addTween({targets:e,alpha:0,rotation:-.1,scaleX:this.sprite.scaleX+.1,scaleY:this.sprite.scaleX+.1,duration:2e3,onComplete:()=>{e.destroy()}})}}createCrushAttack(t=30){let a=this.addImage(this.sprite.x,this.sprite.y-200,"lowq","green_spike.png").setDepth(20).setScale(0),s=this.addImage(this.sprite.x,this.sprite.y-200,"blurry","spike_glow_yellow.png").setDepth(20).setRotation(10).setScale(.2),i=this.addImage(this.sprite.x,this.sprite.y-200,"blurry","spike_glow_yellow.png").setDepth(20).setAlpha(0),h=this.addImage(this.sprite.x,this.sprite.y-200,"lowq","star_black.png").setDepth(20).setRotation(10).setScale(.2),r=this.addImage(this.sprite.x,this.sprite.y-200,"lowq","star_black.png").setDepth(20).setAlpha(0);this.addTween({targets:[s,h],scaleX:1.4,scaleY:1.4,ease:"Quart.easeIn",duration:1400,onComplete:()=>{this.addTween({targets:[s,h],scaleX:.9,scaleY:.9,ease:"Cubic.easeOut",duration:600})}}),this.glowBG=this.addImage(s.x,s.y,"blurry","explod.webp").setDepth(-1).setAlpha(.01).setScale(9).setBlendMode(Phaser.BlendModes.MULTIPLY),this.addTween({targets:[this.glowBG],scaleX:16,scaleY:16,alpha:.25,ease:"Quad.easeInOut",duration:2e3}),this.addTween({targets:[s,h,this.glowBG],rotation:.25*Math.PI,ease:"Quad.easeInOut",y:this.y-70,duration:2e3,onComplete:()=>{this.addTween({targets:[this.glowBG],scaleX:12,scaleY:12,alpha:.75,duration:990});let e=playSound("robot_laser");e.detune=-500,a.setPosition(s.x,s.y),a.setRotation(.25*Math.PI),i.y=s.y,r.y=h.y,i.rotation=0,i.alpha=1,r.alpha=1,r.rotation=0,this.addTween({targets:[r,i],scaleX:1.4,scaleY:1.4,easeParams:[4],ease:"Back.easeOut",duration:500,onComplete:()=>{this.addTween({targets:[r,i],scaleX:1.6,scaleY:1.6,duration:500})}}),this.addTween({targets:[h,s],scaleX:1.55,scaleY:1.55,duration:1e3}),this.addTween({targets:[a],scaleX:6,scaleY:6,alpha:0,duration:450}),this.addTween({targets:[s,i,h,r,a,this.glowBG],rotation:"+=6",ease:"Quad.easeIn",y:globalObjects.player.getY()-200,duration:1e3,onComplete:()=>{playSound("body_slam",.7),playSound("fizzle"),messageBus.publish("selfTakeDamage",t),a.destroy(),this.addTween({targets:[s,i,h,r],scaleX:1.75,scaleY:1.75,duration:10,onComplete:()=>{this.glowBG.alpha=1,this.addTween({targets:[s,i,h,r,this.glowBG],duration:500,alpha:0,onComplete:()=>{s.destroy(),i.destroy(),h.destroy(),r.destroy(),e.detune=0}})}})}})}})}dropBird(){let e=!!this.birdFlipped,t=this.birdFlipped?-1:1,a=this.addSprite(gameConsts.halfWidth-130*t,this.y-(e?220:200),"enemies","bird_1.png").setDepth(999);this.addTween({targets:a,x:e?"-=50":"+=50",rotation:e?"-=4.5":"+=4.5",duration:1500}),this.addTween({targets:a,y:"+=145",ease:"Back.easeIn",duration:1500,onComplete:()=>{a.setFrame("bird_2.png"),e&&(a.scaleX=-1),a.setRotation(.2*t),this.addTween({targets:a,x:e?"-=400":"+=400",rotation:-.1*t,ease:"Quad.easeIn",duration:1500}),this.addTween({targets:a,y:"-=300",ease:"Back.easeIn",duration:1500,onComplete:()=>{a.destroy()}})}}),this.birdFlipped=!this.birdFlipped}adjustDamageTaken(e,t,a){if(t&&this.hasThorns&&!this.dead){let e=getTempPoolObject("enemies","glowSpike.png","glowSpike",1800),t=Math.random()<.5;e.setScale(.5).setAlpha(1).setPosition(gameConsts.halfWidth+(t?-50:50),this.y-150).setDepth(999).setRotation(t?-8:8),this.addTween({targets:e,x:gameConsts.halfWidth+(t?-80:80),ease:"Cubic.easeOut",duration:300,rotation:0,onComplete:()=>{this.addTween({rotation:t?10:-10,targets:e,ease:"Cubic.easeIn",x:gameConsts.halfWidth,duration:1100})}}),this.addTween({targets:e,ease:"Quart.easeIn",scaleX:2.6,scaleY:2.6,duration:300,onComplete:()=>{playSound("matter_body"),this.addTween({targets:e,ease:"Cubic.easeOut",scaleX:1.05,scaleY:1.05,duration:1100,onComplete:()=>{e.setScale(1.15)}})}}),this.addTween({targets:e,y:globalObjects.player.getY()-270,alpha:1.2,duration:1300,easeParams:[2.5],ease:"Back.easeIn",onComplete:()=>{e.setDepth(20),this.addTween({targets:e,y:globalObjects.player.getY()-205,duration:100,onComplete:()=>{messageBus.publish("selfTakeDamage",2,!1,e.x),playSound("razor_leaf",.75),this.addTween({targets:e,alpha:0,ease:"Cubic.easeIn",duration:300})}})}}),this.thorns1.setScale(1.24).setAlpha(1),this.thorns2.setScale(1.24).setAlpha(1),this.thornsTween=this.addTween({targets:[this.thorns1,this.thorns2],scaleX:1,scaleY:1,alpha:.85,ease:"Cubic.easeOut",duration:400})}return super.adjustDamageTaken(e,t,a)}}
function showYesNoPopup(e,t,a="...",s="...",i=()=>{},n=!1){let l=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setScale(500).setDepth(110900).setAlpha(0),r=new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:gameConsts.halfHeight,alpha:.001,scaleX:1e3,scaleY:1e3},onMouseUp:()=>{}}),o=(PhaserScene.tweens.add({targets:l,alpha:.75,ease:"Cubic.easeOut",duration:n?.2:50}),PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight-40,"ui","paper_half.png").setDepth(111e3).setScale(.7,.58)),h=PhaserScene.add.text(gameConsts.halfWidth,o.y-75,a,{fontFamily:"germania",fontSize:30,color:"#000000",align:"center"}).setOrigin(.5,.5).setDepth(111e3).setAlpha(.1),c=PhaserScene.add.text(gameConsts.halfWidth,o.y-17,s,{fontFamily:"germania",fontSize:24,color:"#000000",align:"center"}).setOrigin(.5,.5).setDepth(111e3).setAlpha(.1);PhaserScene.tweens.add({targets:[h,c],alpha:1,ease:"Cubic.easeOut",duration:n?.7:200}),PhaserScene.tweens.add({targets:o,scaleX:.72,scaleY:.6,ease:"Back.easeOut",duration:n?.7:200});let g,d,u=new Button({normal:{ref:"menu_btn_normal.png",atlas:"buttons",x:gameConsts.halfWidth+128,y:o.y+55},hover:{ref:"menu_btn_hover.png",atlas:"buttons"},press:{ref:"menu_btn_hover.png",atlas:"buttons"},disable:{alpha:0},onHover:()=>{canvas&&(playSound("click").detune=50,canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{g&&g.destroy(),d&&d.destroy(),u.destroy(),l.destroy(),r.destroy(),o.destroy(),h.destroy(),c.destroy(),i()}}),p=(u.setOrigin(.5,.5),u.addText(e,{fontFamily:"germania",fontSize:28,color:"#000000",align:"center"}),u.setDepth(111e3),u.setScale(.7),(d=new Button({normal:{atlas:"buttons",ref:"closebtn.png",alpha:.95,x:gameConsts.halfWidth+190,y:o.y-95},hover:{alpha:1,atlas:"buttons",ref:"closebtn_hover.png"},press:{atlas:"buttons",ref:"closebtn_press.png",alpha:1},disable:{atlas:"buttons",ref:"closebtn.png",alpha:0},onHover:()=>{canvas&&(playSound("click").detune=-50,canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{d.destroy(),g.destroy(),u.destroy(),l.destroy(),r.destroy(),h.destroy(),c.destroy(),o.destroy()}})).setOrigin(.5,.5),d.setDepth(111e3),[]);return g=new Button({normal:{ref:"menu_btn2_normal.png",atlas:"buttons",x:gameConsts.halfWidth-128,y:o.y+55},hover:{ref:"menu_btn2_hover.png",atlas:"buttons"},press:{ref:"menu_btn2_hover.png",atlas:"buttons"},disable:{alpha:0},onHover:()=>{canvas&&(playSound("click").detune=-100,canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{for(var e in p)p[e].destroy();p=[]}}),p=[d,g,u,l,r,h,c,o],g.setOrigin(.5,.5),g.addText(t,{fontFamily:"germania",fontSize:28,color:"#000000",align:"center"}),g.setDepth(111e3),g.setScale(.7),p}class SpellManager{constructor(e){this.scene=e,this.particlesRock=[],messageBus.subscribe("castSpell",this.handleSpell.bind(this)),this.initializePoolStuff()}initializePoolStuff(){var e=this.scene.add.image(0,0,"spells","rock.png");poolManager.returnItemToPool(e,"rock")}handleSpell(e,t,a,s=0){switch(e.runeName){case RUNE_MATTER:switch(t.runeName){case RUNE_STRIKE:this.castMatterStrike();break;case RUNE_REINFORCE:this.castMatterReinforce();break;case RUNE_ENHANCE:this.castMatterEnhance();break;case RUNE_PROTECT:this.castMatterProtect(a,s);break;case"rune_superprotect":this.castMatterProtect(a,s,!0);break;case RUNE_UNLOAD:this.castMatterUltimate()}break;case RUNE_TIME:switch(t.runeName){case RUNE_STRIKE:this.castTimeStrike();break;case RUNE_REINFORCE:this.castTimeReinforce();break;case RUNE_ENHANCE:this.castTimeEnhance();break;case RUNE_PROTECT:this.castTimeProtect(a,s);break;case RUNE_UNLOAD:this.castTimeUltimate()}break;case RUNE_MIND:switch(t.runeName){case RUNE_STRIKE:this.castMindStrike();break;case RUNE_REINFORCE:this.castMindReinforce();break;case RUNE_ENHANCE:this.castMindEnhance();break;case RUNE_PROTECT:this.castMindProtect(a,s);break;case RUNE_UNLOAD:this.castMindUltimate()}break;case RUNE_VOID:switch(t.runeName){case RUNE_STRIKE:this.castVoidStrike();break;case RUNE_REINFORCE:this.castVoidReinforce(e,t);break;case RUNE_ENHANCE:this.castVoidEnhance();break;case RUNE_PROTECT:this.castVoidProtect(a,s);break;case RUNE_UNLOAD:this.castVoidUltimate()}}}createDamageEffect(e,t,a,s=null,i={},n){let l,r=0,o=!1;return null===s?((l=getTempPoolObject("spells","damageEffect3.png","damageEffect3",300)).setPosition(e,t).setAlpha(1),l.play("damageEffect"),l.setRotation(.35*(Math.random()-.5)),o=!0):n?(l=this.scene.add.sprite(e,t,"spells").play(s),r=150):l=this.scene.add.sprite(e,t,"spells",s),l.setDepth(a),o||(n={targets:l,scaleY:1.005,duration:150+r,ease:"Cubic.easeOut",onComplete:()=>{l.destroy()}},e=Object.assign({},n,i),this.scene.tweens.add(e)),l}castMatterStrike(){let n=[],t=globalObjects.player.attackEnhanceMultiplier(),l=globalObjects.player.attackDamageAdder();var e=globalObjects.player.trueDamageAdder();let r=6<=l,i=getTempPoolObject("spells","rockCircle.png","rockCircle",800);i.setPosition(gameConsts.halfWidth,globalObjects.player.getY()-240);var o=.025*Math.sqrt(l);let h=5*o,c=77<t*(12+l+e),g=(i.setDepth(100).setAlpha(0).setScale(.7+o).setRotation(3*Math.random()),this.scene.tweens.add({targets:i,duration:300,scaleX:0,scaleY:0}),this.scene.tweens.add({targets:i,duration:300,alpha:1,ease:"Cubic.easeOut"}),Math.random()<.6),d=.65+.0013*l,u=Math.floor(Math.sqrt(.75*l));for(let s=0;s<t;s++){var p=gameConsts.halfWidth+-25*(t-1)+50*s,m=.5*(t-1),m=globalObjects.player.getY()-240+10*Math.abs(m-s);let a=poolManager.getItemFromPool("rock");a||((a=this.scene.add.image(p,m,"spells","rock.png")).bg=this.scene.add.image(p,m,"spells","rock_bg.png")),a.bg||(a.bg=this.scene.add.image(p,m,"spells","rock_bg.png")),a.bg.alpha=isMobile?.59:.4,a.bg.alpha+=Math.min(.24,.04*t),a.bg.visible=!0,a.setPosition(p,m).setDepth(40),a.bg.setPosition(p,m).setDepth(39),a.rotation=Math.random()-.5,n.push(a),a.setScale(0),a.bg.setScale(0);p=(isMobile?.56:.5)+o+(r?-.05:0);this.scene.tweens.add({targets:[a,a.bg],delay:150,duration:400+Math.floor(1.5*l),scaleX:p,scaleY:p,ease:"Back.easeOut",onStart:()=>{let e=u*(r?-10:-30)-75+150*Math.random();2<=t?(playSound("matter_strike_alt",.55*d).detune=e-150,setTimeout(()=>{playSound("matter_strike",d).detune=50+e},100)):playSound(g?"matter_strike":"matter_strike_alt",d).detune=e},onComplete:()=>{if(r){var t;0===s&&(t=playSound("matter_strike_heavy",d),12<=l&&zoomTempSlow(1.004),t.detune=-100*u);let e=getTempPoolObject("spells","rockglow.png","rockglow",400);e.setScale(a.scaleX).setPosition(a.x,a.y).setRotation(a.rotation).setAlpha(0).setDepth(a.depth+1),this.scene.tweens.add({targets:[a,e,a.bg],delay:110,duration:40,scaleX:.65+h,scaleY:.65+h,ease:"Back.easeOut",onStart:()=>{this.scene.tweens.add({targets:e,duration:40,alpha:Math.min(1,.45+.045*Math.sqrt(l)),ease:"Cubic.easeIn",onComplete:()=>{this.scene.tweens.add({targets:e,duration:500,alpha:0,ease:"Cubic.easeOut"})}})},onComplete:()=>{this.scene.tweens.add({targets:[a,e,a.bg],duration:150,scaleX:.5+h,scaleY:.5+h,ease:"Cubic.easeOut"})}}),i.setAlpha(.1).setScale(.8+h).setRotation(3*Math.random()),this.scene.tweens.add({targets:i,duration:250,scaleX:0,scaleY:0}),this.scene.tweens.add({targets:i,duration:250,alpha:1,ease:"Cubic.easeOut"})}}}),this.scene.tweens.add({targets:[a,a.bg],delay:150,duration:450+Math.floor(1.5*l),rotation:3*(Math.random()-.5),ease:"Quart.easeOut"})}for(let i=0;i<n.length;i++){let s=n[i];var a=600+i*(220-12*i)+2*l+(r?325:0),b=500+4*l,f=(isMobile?.37:.35)+.68*o;this.scene.tweens.add({targets:[s,s.bg],delay:a,x:gameConsts.halfWidth+20*(Math.random()-.5),y:165+15*(Math.random()-.5)-Math.floor(2*Math.sqrt(l)),duration:b,scaleX:f,scaleY:f,rotation:2*(Math.random()-.5),ease:"Quad.easeIn",onStart:()=>{},onComplete:()=>{var e=-80*Math.floor(Math.sqrt(.65*l)),t=.005*l;if(globalObjects.currentEnemy&&(globalObjects.currentEnemy.immune||globalObjects.currentEnemy.invincible)?playSound("swish",1.4).detune=-600:(0===i?(a=Math.random())<.3?playSound("matter_strike_hit",.8+t).detune=e:a<.6?playSound("matter_strike_hit_alt",.8+t).detune=e:playSound("matter_strike_hit_alt_2",.85+t).detune=e:2<n.length&&i===n.length-1?Math.random()<.5?playSound("matter_strike_hit",.7+t).detune=e:playSound("matter_strike_hit_alt",.7+t).detune=e:i%2==1?playSound("matter_strike_hit2",.95+t).detune=e:i%2==0&&(playSound("matter_strike_hit2",.6+t).detune=e),this.createDamageEffect(s.x,s.y,s.depth)),r){var a=getTempPoolObject("blurry","rock_rush.png","rockRush",300);if(a.setVisible(!0).setAlpha(.9+.003*l).setScale(.25+.0025*l).setRotation(6*Math.random()),a.setDepth(s.depth-1).setPosition(s.x,s.y),this.scene.tweens.add({targets:a,duration:250,alpha:0,scaleX:.5+.008*l,scaleY:.5+.008*l}),this.scene.tweens.add({targets:a,duration:250,y:"+=20",ease:"Cubic.easeIn"}),c&&i===n.length-1){let e=getTempPoolObject("tutorial","rune_matter_large.png","specialAttack",1300);e.setAlpha(.05).setDepth(999).setScale(5.2).setPosition(s.x,s.y),playSound("rock_crumble"),this.scene.tweens.add({targets:e,duration:110,alpha:1,onComplete:()=>{zoomTemp(1.06),screenShake(6),messageBus.publish("tempPause",250,.05)}}),this.scene.tweens.add({targets:e,duration:125,y:"+=16",scaleX:3.3,scaleY:3.3,ease:"Quint.easeIn",onComplete:()=>{messageBus.publish("setSlowMult",.25,15),this.scene.tweens.add({delay:200,targets:e,duration:900,alpha:0,ease:"Cubic.easeOut"}),this.scene.tweens.add({delay:200,targets:e,duration:900,scaleX:3.8,scaleY:3.8,ease:"Cubic.easeIn"})}})}else c||(zoomTempSlow(1.003+1e-4*l),screenShake(.5+.001*l))}t=gameVars.matterPlus?14:12;messageBus.publish("enemyTakeDamage",t+l,!0,void 0,"matter"),messageBus.publish("setPauseDur",r?24:14),s.bg.visible=!1,poolManager.returnItemToPool(s,"rock")}})}e=getBasicText("rune_matter_rune_strike");this.postAttackCast("matterStrike",0,e,l,t)}castMatterReinforce(){let t="matterReinforce",a,e;var s=globalObjects.player.getStatuses()[t];let i,n=(s?(a=s.animObj[0],e=s.animObj[1],i=s.statusObj):(this.cleanseForms(),e=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"spells","brickPattern2.png"),a=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"spells","brickPattern1.png")),globalObjects.player.spellMultiplier());a.rotation=-1-.75*n,a.setDepth(10),e.setDepth(10),a.setOrigin(.5,.5),e.setOrigin(.5,.5),a.alpha=.02,e.alpha=.02,a.setScale(.8),e.setScale(1.25+.05*Math.sqrt(n)),e.origScale=.8;var s=400+50*n,s=(PhaserScene.time.delayedCall(s-175,()=>{playSound("matter_body")}),this.scene.tweens.add({targets:a,duration:400+50*n,scaleX:1.075+.016*n,scaleY:1.075+.016*n,alpha:.8,rotation:0,ease:"Cubic.easeIn",onComplete:()=>{a.alpha=1,this.scene.tweens.add({targets:a,delay:500,duration:1e3,alpha:.7,ease:"Quad.easeOut"});var e=1.01+.0075*Math.sqrt(n);a.origScale=e,this.scene.tweens.add({targets:a,scaleX:e,scaleY:e,duration:500,ease:"Cubic.easeOut"})}}),this.scene.tweens.add({targets:e,duration:300,scaleX:.8,scaleY:.8,alpha:1.1,ease:"Quart.easeIn",onComplete:()=>{e.setScale(.8),e.visible=!1}}),+n),l=1.15+.05*s,r={duration:400,ease:"Quad.easeOut",y:"-=1",scaleX:l,scaleY:l},o={alpha:0,duration:1600,scaleX:.96*l,scaleY:.96*l};messageBus.publish("animateArmorNum",gameConsts.halfWidth,globalObjects.player.getY()-50,"+"+s+" THORNS",l,r,o),messageBus.publish("selfTakeEffect",{name:t,spellID:t,animObj:[a,e],protection:s,damage:+n,spriteSrc1:"rune_reinforce_glow.png",spriteSrc2:"rune_matter_glow.png",displayAmt:s,statusObj:i,cleanUp:e=>{e[t]&&!e[t].currentAnim&&(e[t].currentAnim=this.scene.tweens.add({targets:e[t].animObj,duration:300,scaleX:.55,scaleY:.55,alpha:.6,ease:"Back.easeIn",onComplete:()=>{for(;e[t]&&0<e[t].animObj.length;)e[t].animObj.pop().destroy(),0===e[t].animObj.length&&(e[t]=null)}}))}});let h=getBasicText("rune_matter_rune_reinforce");3<=n&&(h=h+" x"+n),this.postNonAttackCast(t,h)}castMatterEnhance(){let a="matterEnhance",t=[],s=0,e;var i=globalObjects.player.getStatuses()[a];i&&(e=i.statusObj,s=i.multiplier,t=i.animObj);let n=[];for(let e=0;e<globalObjects.player.spellMultiplier();e++){var l=this.scene.add.sprite(gameConsts.halfWidth,globalObjects.player.getY(),"spells","matter_boost.png").setDepth(9),r=s+e;l.rotation=.6+.18*r,l.setScale(-1,.75),n.push(l),t.push(l)}for(let t=0;t<n.length;t++)this.scene.tweens.add({targets:n[t],delay:n.length*Math.random()*5+20*t,duration:325+200*Math.random(),ease:"Back.easeOut",scaleY:.98+.1*Math.random(),onStart:()=>{var e;0===t?(e=playSound("matter_enhance",.9),Math.random()<.55?e.detune=-60:e.detune=60,e.detune+=Math.floor(120*Math.random())-60):t===n.length-1&&(n.length<4?PhaserScene.time.delayedCall(50,()=>{var e=playSound("matter_enhance_2",1);Math.random()<.25?e.detune=-70:e.detune=0}):playSound("matter_enhance_2",1).detune=0)}});messageBus.publish("selfTakeEffect",{ignoreBuff:!0,name:a,spellID:a,animObj:t,multiplier:t.length,statusObj:e,cleanUp:e=>{if(e[a]&&!e[a].currentAnim){let t=e[a].animObj;for(let e=0;e<t.length;e++)this.scene.tweens.add({delay:60*e,targets:t[e],duration:300,scaleY:"+=0.14",ease:"Quart.easeOut",onStart:()=>{setTimeout(()=>{t[e].setFrame("matter_boost_glow.png")},100)},onComplete:()=>{t[e].scaleX*=1.08,this.scene.tweens.add({targets:t[e],duration:300,scaleY:.6,ease:"Quart.easeIn",onComplete:()=>{t[e].destroy()}})}})}}});i=getBasicText("rune_matter_rune_enhance")+"\n+"+globalObjects.player.attackDamageAdder();this.postNonAttackCast(a,i)}castMatterProtect(t,e,a){this.cleanUpExistingShield(t);let s=globalObjects.player.spellMultiplier(),i=this.scene.add.sprite(gameConsts.halfWidth,MAGIC_CIRCLE_HEIGHT-225,"spells","impact.png"),n=(i.startX=i.x,i.startY=i.y,i.setDepth(1),i.setOrigin(.5,1),i.rotation=0,i.visible=!1,i.rotateOffset=0,1.1<s?"stoneShieldTriple.png":"stoneShield.png"),l=(a&&(n="stoneShieldTriple.png"),this.scene.add.image(gameConsts.halfWidth,MAGIC_CIRCLE_HEIGHT,"spells",n)),r=(l.setDepth(1),l.setOrigin(.5,1),l.setScale(.75),l.origScaleX=.97+.025*s,l.rotation=0,this.scene.add.bitmapText(gameConsts.halfWidth,MAGIC_CIRCLE_HEIGHT-222,"armor","0",32,1));r.startX=r.x,r.startY=r.y,r.setOrigin(.5,.5),r.setDepth(123),r.setScale(0);for(let t=0;t<s;t++){let e=this.scene.add.image(gameConsts.halfWidth,MAGIC_CIRCLE_HEIGHT-200,"spells","rockCircle.png");e.setDepth(120),e.setScale(.75+.3*t),e.setAlpha(0),e.rotation=6.28*Math.random(),this.scene.tweens.add({delay:150*t-150,targets:e,duration:250,scaleX:0,scaleY:0,y:"-=30",alpha:1,onStart:()=>{0===t&&(playSound("matter_shield").detune=200-Math.floor(300*Math.random()))},onComplete:()=>{e.destroy()}})}let o=(gameVars.matterPlus?14:12)*s,h=(a&&(o=80),r.setText(o),messageBus.publish("setTempRotObjs",[l],e),this.scene.tweens.add({targets:r,delay:200,duration:400,scaleX:1,scaleY:1,ease:"Cubic.easeOut"}),l.currAnim&&l.currAnim.stop(),this.scene.tweens.add({targets:l,duration:100,alpha:1,onComplete:()=>{messageBus.publish("selfTakeEffect",{name:t,spellID:t,type:"matter",animObj:[l,r,i],spriteSrc1:"rune_protect_glow.png",spriteSrc2:"rune_matter_glow.png",shakeAmt:0,impactVisibleTime:0,multiplier:s,health:o,displayAmt:o,lockRotation:e,active:!0,ignoreBuff:!0,cleanUp:e=>{e[t]&&!e[t].currentAnim&&(i.setDepth(1),l.setDepth(1),e[t].currentAnim=this.scene.tweens.add({targets:l,duration:175,scaleX:"-=0.2",scaleY:"-=0.2",alpha:0,ease:"Quad.easeIn",onComplete:()=>{l.destroy(),i.destroy(),r.destroy()}}),messageBus.publish("selfClearEffect",t,!0),e[t]=null)}})}}),this.scene.tweens.add({targets:l,duration:215,scaleX:1.1,scaleY:1.1,ease:"Cubic.easeOut",onComplete:()=>{i.setDepth(122),l.setDepth(122),l.currAnim=this.scene.tweens.add({targets:l,duration:330,scaleX:1,scaleY:1,ease:"Quart.easeIn",onComplete:()=>{l.currAnim=null}})}}),getBasicText("rune_matter_rune_protect")),c=0;3<=s&&(h=h+" X"+s,c=.1),a&&(h="SUPER STONE SHIELD",c=.1),this.postNonAttackCast("matterProtect",h,c)}castMatterUltimate(){let t="matterUnload";var e=globalObjects.player.spellMultiplier(),a=(messageBus.publish("addStalagmites",e),globalObjects.player.getStatuses()[t]);let s,i,n;a?(s=a.animObj[0],i=a.animObj[1],n=a.statusObj,this.scene.tweens.add({targets:s,alpha:.5,scaleX:.61,scaleY:.61,duration:200})):((s=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"spells","stoneCircle.png")).setAlpha(.5).setScale(.9).setRotation(-.3),(i=this.scene.add.bitmapText(gameConsts.halfWidth,globalObjects.player.getY()-46,"armor","0",48,1)).startX=i.x,i.startY=i.y),i.setDepth(125).setOrigin(.5,.5).setScale(0).setPosition(gameConsts.halfWidth,globalObjects.player.getY()-46),s.setDepth(10);let l=20*e;this.scene.tweens.add({targets:s,delay:100,scaleX:1.04,scaleY:1.04,alpha:1,rotation:0,duration:250,ease:"Cubic.easeOut",onStart:()=>{playSound("matter_ultimate",.35),playSound("matter_shield",.95).detune=-250,playSound("matter_enhance",.35).detune=-1e3,s.setAlpha(.5),i.setText(l),this.scene.tweens.add({targets:i,duration:250,scaleX:1,scaleY:1,ease:"Quad.easeIn"})},onComplete:()=>{s.setDepth(118),this.scene.tweens.add({targets:s,scaleX:1,scaleY:1,duration:300,ease:"Cubic.easeIn"})}}),messageBus.publish("selfTakeEffect",{name:t,spellID:t,type:"matter",animObj:[s,i],spriteSrc1:"rune_unload_glow.png",spriteSrc2:"rune_matter_glow.png",multiplier:e,health:l,displayAmt:l,statusObj:n,shakeAmt:0,impactVisibleTime:0,duration:10,active:!0,cleanUp:e=>{e[t]&&!e[t].currentAnim&&(s.setDepth(0),e[t].currentAnim=this.scene.tweens.add({targets:[s,i],duration:240,y:"+=10",scaleX:"-=0.24",scaleY:"-=0.24",ease:"Quad.easeIn",onComplete:()=>{s.destroy(),i.destroy()}}),this.scene.tweens.add({targets:[s,i],duration:240,alpha:0,ease:"Quad.easeOut"}),messageBus.publish("selfClearEffect",t,!0),e[t]=null)}});a=getBasicText("rune_matter_rune_unload");messageBus.publish("clearSpellMultiplier"),this.postNonAttackCast(t,a)}castMatterUltimatex(){let t="matterUnload",a=[];var s=globalObjects.player.attackEnhanceMultiplier();let n=globalObjects.player.attackDamageAdder();var e=globalObjects.player.spellMultiplier(),i=Math.max(5,30-s);let l=.007*n,r=.0025*n,o=74<s*(24+n);for(let e=0;e<s;e++){var h=gameConsts.halfWidth+(s-1)*-i+2*i*e,c=gameConsts.halfHeight+30+10*Math.abs(.5*(s-1)-e),h=this.scene.add.sprite(h,c,"spells","stalagmite5.png");h.setDepth(9),h.rotation=0,a.push(h),h.setScale(.8+l,0)}var g=Math.max(5,15-s),d=globalObjects.player.getStatuses()[t];let u,p,m,b=(d?(u=d.animObj[0],p=d.animObj[1],m=d.statusObj,this.scene.tweens.add({targets:u,alpha:.5,scaleX:.61,scaleY:.61,duration:200})):((u=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"spells","stoneCircle.png")).setAlpha(.5).setScale(.9).setRotation(-.3),(p=this.scene.add.bitmapText(gameConsts.halfWidth,globalObjects.player.getY()-46,"armor","0",48,1)).startX=p.x,p.startY=p.y),p.setDepth(125).setOrigin(.5,.5).setScale(0).setPosition(gameConsts.halfWidth,globalObjects.player.getY()-46),u.setDepth(10),24*e);this.scene.tweens.add({targets:u,delay:250,scaleX:1.04,scaleY:1.04,alpha:1,rotation:0,duration:300,ease:"Cubic.easeOut",onStart:()=>{playSound("matter_ultimate",1.4),u.setAlpha(.5),p.setText(b),this.scene.tweens.add({targets:p,duration:250,scaleX:1,scaleY:1,ease:"Quad.easeIn"})},onComplete:()=>{u.setDepth(118),this.scene.tweens.add({targets:u,scaleX:1,scaleY:1,duration:300,ease:"Cubic.easeIn"})}}),messageBus.publish("selfTakeEffect",{name:t,spellID:t,type:"matter",animObj:[u,p],spriteSrc1:"rune_unload_glow.png",spriteSrc2:"rune_matter_glow.png",multiplier:e,health:b,displayAmt:b,statusObj:m,shakeAmt:0,impactVisibleTime:0,duration:6,active:!0,cleanUp:e=>{e[t]&&!e[t].currentAnim&&(u.setDepth(0),e[t].currentAnim=this.scene.tweens.add({targets:[u,p],duration:240,y:"+=10",scaleX:"-=0.24",scaleY:"-=0.24",ease:"Quad.easeIn",onComplete:()=>{u.destroy(),p.destroy()}}),this.scene.tweens.add({targets:[u,p],duration:240,alpha:0,ease:"Quad.easeOut"}),messageBus.publish("selfClearEffect",t,!0),e[t]=null)}});for(let e=0;e<a.length;e++){let i=a[e];this.scene.tweens.add({targets:i,delay:275+e*(180-e*g),scaleY:.68+r,scaleX:.85+l,duration:200,ease:"Quint.easeIn",onStart:()=>{PhaserScene.time.delayedCall(50,()=>{for(let e=0;e<6;e++){var t=Math.random()-.5,a=-.05-.2*Math.random(),s=250+500*Math.random();this.createRockParticle(i.x+25*(Math.random()-.5),i.y-5*Math.random(),t,a,s)}})},onComplete:()=>{if(messageBus.publish("enemyTakeDamage",24+n,!0,void 0,"matter"),screenShake(5),zoomTemp(1.01+25e-5*n),this.createDamageEffect(gameConsts.halfWidth,140,i.depth),o&&e===a.length-1){let e=getTempPoolObject("tutorial","rune_matter_large.png","specialAttack",1300);e.setAlpha(.05).setDepth(999).setScale(5.2).setPosition(gameConsts.halfWidth,190),playSound("rock_crumble"),this.scene.tweens.add({targets:e,duration:110,alpha:1,onComplete:()=>{zoomTemp(1.06),screenShake(7),messageBus.publish("tempPause",250,.05)}}),this.scene.tweens.add({targets:e,duration:125,y:"+=16",scaleX:3.3,scaleY:3.3,ease:"Quint.easeIn",onComplete:()=>{messageBus.publish("setSlowMult",.25,15),this.scene.tweens.add({delay:200,targets:e,duration:900,alpha:0,ease:"Cubic.easeOut"}),this.scene.tweens.add({delay:200,targets:e,duration:900,scaleX:3.8,scaleY:3.8,ease:"Cubic.easeIn"})}})}else o||(zoomTempSlow(1.002+1e-4*n),screenShake(.35+.001*n));this.scene.tweens.add({targets:i,scaleY:.65+r,scaleX:.8+l,duration:250,ease:"Cubic.easeOut",onComplete:()=>{this.scene.tweens.add({targets:i,delay:300,scaleY:0,duration:300,alpha:0,ease:"Cubic.easeIn",onComplete:()=>{i.destroy()}})}})}})}d=getBasicText("rune_matter_rune_unload");messageBus.publish("clearSpellMultiplier"),this.postAttackCast(t,300,d,n,s)}castTimeStrike(){let h=globalObjects.player.attackDamageAdder();var e=globalObjects.player.trueDamageAdder();let t=6<=h,i=14<=h;var n=globalObjects.player.attackEnhanceMultiplier();let c=80<n*(1.5*(6+h+e)),g=[],l=.5+.075*Math.sqrt(h)+.02*h,d=.4+.05*Math.sqrt(h)+.015*h,u=(i||(playSound("time_strike_buff",t?.7:.9).detune=Math.floor(50*Math.random())+375),[]),p=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-225,"spells","clock_attack_bg.png").setDepth(-1).setAlpha(0).setTint(16729156).setScale(.5),m=this.scene.add.sprite(gameConsts.halfWidth,p.y,"spells","clock_attack_bg.png").setDepth(30).setAlpha(0).setTint(14483456).setScale(.5);for(let s=0;s<n;s++){var r=gameConsts.halfWidth+-25*(n-1)+50*s,o=.5*(n-1),o=globalObjects.player.getY()-238+10*Math.abs(o-s);let a=poolManager.getItemFromPool("clock");(a=a||this.scene.add.sprite(r,o,"spells","clock.png")).setDepth(10).setVisible(!0).setAlpha(1).setPosition(r,o).setFrame("clock.png"),a.rotation=Math.random()-.5,a.setScale(0),g.push(a),this.scene.tweens.add({targets:a,duration:150,scaleX:.5,scaleY:.5,rotation:"-=0.8",easeParams:[2],ease:"Back.easeOut",onComplete:()=>{if(t){let t=1.1+.5*Math.random();0===s&&i&&(playSound("time_strike_buff",.7).detune=Math.floor(50*Math.random())-100),this.scene.tweens.add({delay:200,targets:a,duration:250,rotation:"+="+t,scaleX:.65,scaleY:.65,easeParams:[3],ease:"Back.easeOut",onStart:()=>{0!==s||i||setTimeout(()=>{playSound("time_strike_buff",.9).detune=Math.floor(50*Math.random())-100},100)},onComplete:()=>{var e;i&&(0===s&&(zoomTempSlow(1.005),screenShake(.3+8e-4*h),playSound("time_strike_buff",1).detune=-Math.floor(50*Math.random())-375),e=1.8*t,this.scene.tweens.add({delay:200,targets:a,duration:250,rotation:"-="+e,scaleX:l,scaleY:l,easeParams:[3],ease:"Back.easeOut",onComplete:()=>{0===s&&(playSound("time_strike_buff",1.2).detune=-Math.floor(50*Math.random())-775)}}))}})}}})}let b=6+h,f=Math.ceil(.5*b),a=0,S=(t&&(a+=470,i)&&(a+=470),[]);for(let o in g){let n="0"===o,l=o==g.length-1,r=g[o];r.finalRot=.2-.4*Math.random();var s=270+150*o+a,O=200*(Math.random()-.5),y=(O<0?4:-4)+2*(Math.random()-.5)-.02*O;this.scene.tweens.add({delay:s,targets:[r],duration:550,rotation:y,onStart:()=>{var e=Math.floor(400*Math.random())-200;S.push(e),playSound("time_strike").detune=e}});let e=gameConsts.halfWidth+O,t=gameConsts.halfWidth+Math.random()-2.5;y=150+10*(Math.random()-.5);this.scene.tweens.add({delay:s,targets:r,y:y,duration:550,scaleX:d,scaleY:d,ease:"Back.easeOut",easeParams:[.25],onStart:()=>{this.scene.tweens.add({targets:r,x:e,duration:200,ease:"Quad.easeOut",onComplete:()=>{this.scene.tweens.add({targets:r,x:.8*gameConsts.halfWidth+.2*e,duration:200,ease:"Quad.easeIn",onComplete:()=>{this.scene.tweens.add({targets:r,x:t,duration:150,easeParams:[.5],ease:"Back.easeOut"})}})}})},onComplete:()=>{n&&(p.setAlpha(.5),m.setAlpha(.5));var e=Math.sqrt(.7+.1*o+.014*h)-.3;p.setScale(e),m.setScale(e);let t=poolManager.getItemFromPool("clockhand");(t=t||this.scene.add.sprite(p.x,p.y,"spells","clock_stab.png").setDepth(33)).setVisible(!0).setAlpha(1.25).setFrame("clock_stab.png").setScale(.9*p.scaleX).setOrigin(.12,.5),t.rotation=2.4*Math.random()-1.2,Math.random()<.5&&(t.rotation=-t.rotation);for(let e=0;e<u.length;e++){var a=u[e];Math.abs(a.rotation-t.rotation)<.2&&(t.rotation=.7+1.7*Math.random(),Math.random()<.5)&&(t.rotation=-t.rotation)}for(let e=0;e<u.length;e++){var s=u[e];Math.abs(s.rotation-t.rotation)<.1&&(t.rotation=.7+1.7*Math.random(),Math.random()<.5)&&(t.rotation=-t.rotation)}this.scene.tweens.add({targets:t,duration:200,scaleX:.78*p.scaleX,scaleY:.78*p.scaleX,ease:"Back.easeOut",alpha:.7}),u.push(t),r.rotation=r.finalRot,this.scene.tweens.add({targets:r,duration:200+2*h,scaleX:.24+d,scaleY:.24+d,alpha:0,onComplete:()=>{poolManager.returnItemToPool(r,"clock"),l&&this.scene.time.delayedCall(150,()=>{this.scene.tweens.add({targets:[p,m],alpha:.8,ease:"Cubic.easeIn",duration:150});var e=u.length;let n=0;for(;0<u.length;){let t=e==u.length,a=e-u.length,s=u.pop(),i=1.1*p.scaleX+.1;var l=150*u.length;this.scene.tweens.add({delay:l,targets:s,scaleX:1.12*i+.28,scaleY:1.25*i+.34,ease:"Quart.easeIn",duration:60,onStart:()=>{s.setAlpha(1.1);let e=getTempPoolObject("lowq","sharpflashred.webp","sharpflashred",250);e.setPosition(s.x,s.y).setScale(.75*i,2*i).setDepth(s.depth-1).setAlpha(.75),e.setOrigin(.5,.78),e.rotation=s.rotation+.5*Math.PI,this.scene.tweens.add({targets:e,scaleX:5*i,scaleY:12.5*i,ease:"Quart.easeIn",alpha:1.2,duration:65,oncomplete:()=>{this.scene.tweens.add({targets:e,scaleX:.85*i,scaleY:2.25*i,ease:"Cubic.easeOut",duration:150,onComplete:()=>{e.setOrigin(.5,.5)}}),this.scene.tweens.add({targets:e,ease:"Quad.easeIn",alpha:0,duration:110})}})},onComplete:()=>{let e=0;if(0===S.length?e=400*Math.random()-200:(e=S[n%S.length],n++),globalObjects.currentEnemy&&(globalObjects.currentEnemy.immune||globalObjects.currentEnemy.invincible)?playSound("swish",1).detune=250*Math.random():0==a?playSound("time_strike_hit",.92).detune=e:2<g.length&&a==g.length-1?playSound("time_strike_hit",.85).detune=e:a%2==1?playSound("time_strike_hit_2",1).detune=e:a%2==0&&(playSound("time_strike_hit_2",.75).detune=e),messageBus.publish("enemyTakeDamage",f,!0,void 0,"time"),messageBus.publish("setPauseDur",15),t&&c){let e=getTempPoolObject("tutorial","rune_time_large.png","specialAttack",1300);e.setAlpha(.05).setDepth(999).setScale(5).setPosition(gameConsts.halfWidth,r.y+33),playSound("time_hard"),this.scene.tweens.add({targets:e,duration:110,alpha:1,onComplete:()=>{zoomTemp(1.06),screenShake(6),messageBus.publish("tempPause",250,.05)}}),this.scene.tweens.add({targets:e,duration:125,scaleX:3.15,scaleY:3.15,ease:"Quint.easeIn",onComplete:()=>{messageBus.publish("setSlowMult",.25,15),this.scene.tweens.add({delay:200,targets:e,duration:900,alpha:0,ease:"Cubic.easeOut"}),this.scene.tweens.add({delay:200,targets:e,duration:900,scaleX:3.8,scaleY:3.8,ease:"Cubic.easeIn"})}})}this.scene.tweens.add({delay:20,targets:s,scaleX:i,scaleY:i,alpha:.85,ease:"Back.easeOut",duration:240,completeDelay:40,onComplete:()=>{this.scene.tweens.add({targets:s,alpha:0,scaleX:.95*i,scaleY:.95*i,ease:"Quad.easeOut",duration:200,onStart:()=>{t&&this.scene.tweens.add({delay:100,targets:[p,m],alpha:0,scaleX:p.scaleX+.1,scaleY:p.scaleX+.1,ease:"Cubic.easeOut",duration:300,onComplete:()=>{p.destroy(),m.destroy()}})},onComplete:()=>{poolManager.returnItemToPool(s,"clockhand")}})}})}})}})}});var i,e=parseInt(o);globalObjects.currentEnemy&&(globalObjects.currentEnemy.immune||globalObjects.currentEnemy.invincible)?playSound("time_strike_buff",.5).detune=250*Math.random()-500:(0===e?(i=Math.floor(150*Math.random())-75,playSound("time_strike_buff",.92).detune=i,playSound("time_strike_hit",.54).detune=i-250):2<g.length&&e===g.length-1?(playSound("time_strike_buff",.85),playSound("time_strike_hit_2",.45).detune=-250):e%2==1?(playSound("time_strike_buff",1).detune=-200,playSound("time_strike_hit",.54).detune=200):e%2==0&&(playSound("time_strike_buff",.75).detune=-200),zoomTempSlow(1.002+1e-4*h),screenShake(.35+.001*h)),messageBus.publish("enemyTakeDamage",b,!0,void 0,"time"),messageBus.publish("setPauseDur",20)}})}e=getBasicText("rune_time_rune_strike");this.postAttackCast("timeStrike",300,e,h,n)}castTimeReinforce(){var e=globalObjects.player.spellMultiplier();let t=1-.5**e;var a=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"spells","clock_back_large.png"),s=(this.cleanseForms(),playSound("time_body"),a.setDepth(120).setScale(1.05),a.alpha=0,this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"spells","clock_arm_large.png"));s.setDepth(120).setScale(1.2),s.setOrigin(.01,.5),s.alpha=0,s.rotation=.5*-Math.PI,this.scene.tweens.add({targets:[a],duration:300,alpha:.4+.1*e,scaleX:.97,scaleY:.97,ease:"Cubic.easeOut",onComplete:()=>{messageBus.publish("selfHealRecent",t)}}),this.scene.tweens.add({targets:[s],duration:400,alpha:.55+.12*e,scaleX:.94,scaleY:.94,ease:"Cubic.easeOut"}),this.scene.tweens.add({targets:[s],duration:1200,rotation:.5*-Math.PI-2*Math.PI*t,ease:"Cubic.easeInOut"}),this.scene.tweens.add({targets:[a],duration:1200,rotation:.05,ease:"Cubic.easeInOut"}),this.scene.tweens.add({targets:[a,s],delay:900,duration:500,scaleX:1.12,scaleY:1.12,alpha:0});let i=getBasicText("rune_time_rune_reinforce");1<e&&(i+=" X"+e),this.postNonAttackCast("timeReinforce",i)}castTimeEnhance(){let t="timeEnhance";var e=globalObjects.player.getStatuses()[t];let a=[];e&&(a=e.animObj);var e=globalObjects.player.spellMultiplier(),s=Math.round(.5*a.length),i=e;let n=s+e;if(0<a.length)for(let e=0;e<a.length;e+=2){var l=gameConsts.halfWidth+-25*(n-1)+25*e,r=.5*(n-1),r=globalObjects.player.getY()-240+10*Math.abs(r-.5*e);this.scene.tweens.add({targets:[a[e],a[e+1]],duration:300,x:l,y:r,ease:"Cubic.easeOut"})}else e++,n=s+e;for(let e=s;e<n;e++){var o=gameConsts.halfWidth+-25*(n-1)+50*e,h=.5*(n-1),h=globalObjects.player.getY()-240+10*Math.abs(h-e),c=this.scene.add.image(o,h,"spells","timeEffect.png"),o=this.scene.add.image(o,h,"spells","timeEffect2.png");c.setDepth(11),c.rotation=Math.random()-.5,c.setScale(0),o.setDepth(10),o.rotation=10*(Math.random()-.5),o.setScale(0),a.push(c),a.push(o),this.scene.tweens.add({targets:[c,o],duration:300,scaleX:1,scaleY:1,ease:"Cubic.easeOut"}),this.scene.tweens.add({targets:c,duration:5200,rotation:"+=6.283",repeat:-1}),this.scene.tweens.add({targets:o,duration:5200,rotation:"-=3.14",repeat:-1})}playSound("time_enhance"),this.scene.tweens.add({targets:a[0],duration:300,alpha:.99,onComplete:()=>{messageBus.publish("selfTakeEffect",{name:t,spellID:t,animObj:a,multiplier:Math.round(.5*a.length),ignoreBuff:!0,cleanUp:e=>{e[t]&&!e[t].currentAnim&&(e[t].currentAnim=this.scene.tweens.add({targets:a,delay:25,duration:200,scaleX:0,scaleY:0,ease:"Quad.easeOut",onStart:()=>{e[t]=null},onComplete:()=>{for(let e=0;e<a.length;e++)a[e].destroy()}}))}})}});e=getBasicText("rune_time_rune_enhance")+" +"+i;this.postNonAttackCast(t,e)}castTimeProtect(t,e){var a="timeProtect";this.cleanUpExistingShield(t);let s;var i=globalObjects.player.getStatuses()[a];i&&(s=i.statusObj);let n=globalObjects.player.spellMultiplier(),l="clockShield.png",r=(2<=n&&(l="clockShieldTriple.png"),this.scene.add.image(gameConsts.halfWidth,MAGIC_CIRCLE_HEIGHT,"spells",l)),o=(r.setDepth(118),r.setOrigin(.5,1),r.setScale(.75),r.origScaleX=.95,r.rotation=e,"blank.png"),h=(2<=n&&(o="clockShieldTripleSatellite.png"),this.scene.add.image(gameConsts.halfWidth,MAGIC_CIRCLE_HEIGHT,"spells",o));h.setDepth(118),h.setOrigin(.5,1),h.setScale(.75),h.origScaleX=.95,h.rotation=e,playSound("time_shield"),messageBus.publish("setTempRotObjs",[r,h],e),this.scene.tweens.add({targets:[r,h],duration:400,ease:"Cubic.easeOut",scaleX:.95,scaleY:.965,onStart:()=>{messageBus.publish("selfTakeEffect",{ignoreBuff:!0,name:t,spellID:t,type:"time",animObj:[r,h],lockRotation:e,spriteSrc1:"rune_protect_glow.png",spriteSrc2:"rune_time_glow.png",displayAmt:0,active:!0,maxAmt:60*n,multiplier:n,statusObj:s,cleanUp:e=>{e[t]&&!e[t].currentAnim&&(e[t].currentAnim=this.scene.tweens.add({targets:[r,h],duration:250,scaleX:.55,scaleY:.55,alpha:0,ease:"Quad.easeOut",onComplete:()=>{r.destroy(),h.destroy()}}),messageBus.publish("selfClearEffect",t,!0),e[t]=null)}})}});let c=getBasicText("rune_time_rune_protect");1.1<n&&(c=c+" X"+n),this.postNonAttackCast(a,c,0)}castTimeUltimate(){this.castTimeStrike()}castMindStrike(){let r="mindStrike",i=[];var t=globalObjects.player.attackEnhanceMultiplier();let n=globalObjects.player.attackDamageAdder();var e=globalObjects.player.trueDamageAdder();let o=70<t*(1+2*(n+e));for(let e=0;e<t;e++){var a=gameConsts.halfWidth+-25*(t-1)+50*e,s=.5*(t-1),s=globalObjects.player.getY()-225+10*Math.abs(s-e)+n,a=this.scene.add.sprite(a,s,"spells","lightningBolt1.png");a.play("lightningbolt"),a.setDepth(10),a.rotation=Math.random()-.5,i.push(a),a.setScale(0),a.setOrigin(.5,.1)}for(let s=0;s<i.length;s++){let l=i[s];var h=50+s*(190-6*i.length);this.scene.tweens.add({targets:l,delay:h,duration:200,scaleX:.7+.006*n,scaleY:.8+.007*n,rotation:1.57-Math.atan2(195,gameConsts.halfWidth-l.x),ease:"Cubic.easeOut"}),this.scene.tweens.add({targets:l,delay:h,x:gameConsts.halfWidth,y:195,ease:"Quad.easeIn",duration:400+3*n,onStart:()=>{playSound("mind_strike")},onComplete:()=>{var e=getTempPoolObject("spells","blackPulse.png","blackPulse",310).setDepth(l.depth).setScale(.5).setAlpha(.6).setPosition(l.x,l.y-12),t=getTempPoolObject("spells","shockEffect1.png","shockEffect",310).play("shockEffect").setPosition(l.x,l.y-12).setDepth(l.depth).setScale(.5).setRotation(6*Math.random()),a=1.3+.1*Math.random(),t=(globalObjects.currentEnemy&&globalObjects.currentEnemy.invincible?(playSound("clunk",.4).detune=200*Math.random(),playSound("fizzle",1).detune=200*Math.random()):playSound("mind_strike_hit"),this.scene.tweens.add({targets:[e],alpha:0,duration:480}),this.scene.tweens.add({targets:[t,e],scaleX:a,scaleY:a,duration:460,ease:"Quart.easeOut"}),1+n);if(messageBus.publish("enemyTakeTrueDamage",t,!0,void 0,!0,"mind"),o&&s===i.length-1){let e=getTempPoolObject("tutorial","rune_energy_large.png","specialAttack",1300);e.setAlpha(.05).setDepth(999).setScale(3.9,2.5).setPosition(l.x,l.y-80),playSound("thunder"),this.scene.tweens.add({targets:e,duration:110,alpha:1,onComplete:()=>{zoomTemp(1.06),screenShake(6),messageBus.publish("tempPause",250,.05)}}),this.scene.tweens.add({targets:e,duration:300,y:"+=76",ease:"Back.easeOut"}),this.scene.tweens.add({targets:e,duration:125,scaleX:3.5,scaleY:4.2,ease:"Quint.easeIn",onComplete:()=>{messageBus.publish("setSlowMult",.25,15),this.scene.tweens.add({targets:e,duration:100,scaleY:3.5,ease:"Cubic.easeOut"}),this.scene.tweens.add({delay:200,targets:e,duration:900,alpha:0,ease:"Cubic.easeOut"}),this.scene.tweens.add({delay:200,targets:e,duration:900,scaleX:4,scaleY:4,ease:"Cubic.easeIn"})}})}else 12<=n&&screenShake(.25+.0025*n);if(globalObjects.currentEnemy&&!globalObjects.currentEnemy.dead&&!globalObjects.currentEnemy.invincible&&!globalObjects.player.dead){let n=this.scene.add.sprite(l.x,gameConsts.halfHeight-215,"spells","energyTarget7.png").play("energyTarget").setAlpha(1).setScale(.96);n.setDepth(30),n.setOrigin(.5,.5),this.scene.tweens.add({targets:[n],duration:500,alpha:.58,scaleX:.9,scaleY:.9,ease:"Quad.easeOut"}),messageBus.publish("animateTrueDamageNum",l.x+12-24*Math.random(),l.y-30-5*Math.random(),"VULNERABLE",isMobile?.82:.75),messageBus.publish("enemyTakeEffect",{name:r,x:n.x,y:n.y,damage:t,cleanUp:(e,t,a)=>{var s,i;e[r]&&!e[r].currentAnim&&(globalObjects.currentEnemy.isDestroyed||((s=getTempPoolObject("lowq","circle_blue4.png","circle_blue",1800).setDepth(100).setScale(.65).setAlpha(.85+.025*Math.sqrt(t)).setPosition(l.x,l.y-14)).playReverse("circleBlast"),i=.67+.12*Math.sqrt(t),this.scene.tweens.add({targets:s,duration:500+10*t,scaleX:i,scaleY:i,ease:"Cubic.easeOut"}),this.scene.tweens.add({targets:s,duration:500+10*t,alpha:0}),a&&(n.setScale(1.2),n.stop(),n.alpha=1,n.play("energyTargetExplode"))),i=a?100:0,this.scene.tweens.add({targets:[n],duration:200+i,scaleX:a?1.1:1.15,scaleY:a?1.1:1.15,ease:"Cubic.easeOut"}),e[r].currentAnim=this.scene.tweens.add({targets:[n],duration:200+i,alpha:0,ease:a?"Quad.easeIn":"",onComplete:()=>{n.destroy()}}),e[r]=null)}})}this.scene.tweens.add({targets:l,alpha:0,scaleX:"-=0.2",scaleY:"-=0.1",duration:120,onComplete:()=>{l.destroy()}})}})}e=getBasicText("rune_mind_rune_strike");this.postAttackCast(r,0,e,n,t)}castMindReinforce(){let t="mindReinforce",e=globalObjects.player.spellMultiplier();var a=globalObjects.player.getStatuses()[t];let s,i,n,l,r=(a?(l=a.animObj[0],i=a.animObj[1],n=a.animObj[2],s=a.statusObj):(this.cleanseForms(),i=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"circle","energy_body.png").setScale(.9).setAlpha(.75).setDepth(104),n=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"circle","energy_body.png").setScale(.8).setAlpha(.25).setRotation(Math.PI/8).setDepth(104),l=this.scene.add.sprite(gameConsts.halfWidth,globalObjects.player.getY(),"spells").play("powerEffectRepeat").setScale(1.5).setDepth(117)),this.scene.add.sprite(gameConsts.halfWidth,globalObjects.player.getY(),"spells").play("powerEffect").setScale(3.4).setDepth(117)),o=this.scene.add.sprite(gameConsts.halfWidth,globalObjects.player.getY(),"shields","ring_flash0.png").setAlpha(.5).setDepth(130).setScale(1.2),h=(o.setTint(65535),o.playReverse("ring_flash"),this.scene.tweens.add({targets:o,alpha:1,ease:"Cubic.easeOut",duration:125,scaleX:1.37,scaleY:1.37,completeDelay:300,onComplete:()=>{o.destroy()}}),playSound("power_surge"),globalObjects.magicCircle.resetElements(),this.scene.tweens.add({targets:i,duration:125,scaleX:1.11+.02*e,scaleY:1.11+.02*e,alpha:1,ease:"Cubic.easeOut",onComplete:()=>{playSound("mind_shield_retaliate",.7+.05*e),this.scene.tweens.add({targets:i,duration:400,scaleX:.975+.01*e,scaleY:.975+.01*e,ease:"Back.easeOut",onComplete:()=>{this.scene.tweens.add({targets:i,duration:750,alpha:.6})}})}}),this.scene.tweens.add({targets:n,duration:225,scaleX:1.13+.02*e,scaleY:1.13+.02*e,alpha:1,ease:"Cubic.easeOut",onComplete:()=>{this.scene.tweens.add({targets:n,duration:450,scaleX:1+.012*e,scaleY:1+.012*e,ease:"Back.easeOut",onComplete:()=>{this.scene.tweens.add({targets:n,duration:750,alpha:.6})}})}}),this.scene.tweens.add({targets:l,duration:400,scaleX:1.9,scaleY:1.9,alpha:.8,ease:"Cubic.easeOut",completeDelay:250,onComplete:()=>{l.setScale(1.57)}}),this.scene.tweens.add({targets:r,duration:500,scaleX:3.55,scaleY:3.55,ease:"Cubic.easeOut",onComplete:()=>{r.destroy()}}),3);1<e&&(h=3*e);messageBus.publish("animateTrueDamageNum",gameConsts.halfWidth,globalObjects.player.getY()-25,"+"+h+" ALL\nDAMAGE",.9+.15*Math.sqrt(h),{duration:1650},{alpha:0,scaleX:1,scaleY:1}),messageBus.publish("selfTakeEffect",{name:t,spellID:t,animObj:[l,i,n],multiplier:e,spriteSrc1:"rune_reinforce_glow.png",spriteSrc2:"rune_mind_glow.png",displayAmt:h,statusObj:s,cleanUp:e=>{e[t]&&!e[t].currentAnim&&(e[t].currentAnim=this.scene.tweens.add({targets:e[t].animObj,duration:300,scaleX:1,scaleY:1,alpha:0,ease:"Back.easeIn",onComplete:()=>{for(;e[t]&&0<e[t].animObj.length;)e[t].animObj.pop().destroy(),0==e[t].animObj.length&&(e[t]=null)}}))}});let c=getBasicText("rune_mind_rune_reinforce");2<=e&&(c+=" X"+e),this.postNonAttackCast(t,c)}castMindEnhance(){let t="mindEnhance";var e,a=globalObjects.player.getStatuses()[t];let s=globalObjects.player.spellMultiplier(),i;a?(e=.25+.1*(s+=a.multiplier),i=a.animObj,this.scene.tweens.add({targets:i,duration:300,ease:"back.easeOut",scaleX:e,scaleY:e})):i=this.scene.add.sprite(gameConsts.halfWidth+205,gameConsts.height-295,"spells").play("mindBurnSlow").setDepth(11).setScale(0),playSound("mind_enhance");a=.25+.1*s;this.scene.tweens.add({targets:i,duration:250,ease:"back.easeOut",scaleX:a,scaleY:a}),messageBus.publish("selfTakeEffect",{ignoreBuff:!0,name:t,spellID:t,animObj:i,multiplier:s,cleanUp:e=>{e[t]&&!e[t].currentAnim&&(i.setScale(1.1*i.scaleX),e[t].currentAnim=this.scene.tweens.add({targets:i,duration:150,scaleX:1.7*i.scaleX,scaleY:1.7*i.scaleX,alpha:0,ease:"Quad.easeOut",onComplete:()=>{i.destroy()}}),e[t]=null)}});let n=getBasicText("rune_mind_rune_enhance");1<s&&(n+=" X"+s),this.postNonAttackCast(t,n)}castMindProtect(t,e){this.cleanUpExistingShield(t);let a=globalObjects.player.spellMultiplier(),s="eyeShield.png",i=(3.1<a?s="eyeShieldQuint.png":1.1<a&&(s="eyeShieldTriple.png"),this.scene.add.image(gameConsts.halfWidth,MAGIC_CIRCLE_HEIGHT,"spells",s)),n=(i.setDepth(110),i.setOrigin(.5,1),i.setScale(.85),i.origScaleX=.95+.05*a,i.rotation=0,i.alpha=0,i.startY=i.y,this.scene.add.sprite(gameConsts.halfWidth,175,"spells","reticle.png").setScale(.95)),l=(n.setDepth(110),n.origScale=n.scaleX,n.alpha=.3,n.visible=!1,this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY()-225,"spells","weakenLines_00.png")),r=(l.startX=l.x,l.startY=l.y,l.setDepth(9999),l.setOrigin(.5,1),l.rotation=0,l.alpha=0,l.rotateOffset=0,this.scene.add.bitmapText(gameConsts.halfWidth,n.y,"bonus","",48,1)),o=(r.setOrigin(.5,.5),r.setDepth(n.depth),r.setScale(.5),messageBus.publish("setTempRotObjs",[i],e),playSound("mind_shield"),this.scene.tweens.add({targets:i,duration:350,scaleX:1,scaleY:1,alpha:.5,ease:"Cubic.easeIn",onComplete:()=>{messageBus.publish("selfTakeEffect",{ignoreBuff:!0,name:t,spellID:t,type:"mind",animObj:[i,n,l],textObj:r,storedDamage:0,multiplier:a,spriteSrc1:"rune_protect_glow.png",spriteSrc2:"rune_mind_glow.png",lockRotation:e,cleanUp:e=>{e[t]&&!e[t].currentAnim&&(r.visible=!1,e[t].currentAnim=this.scene.tweens.add({delay:100,targets:[i,n],duration:150,alpha:0,ease:"Quad.easeIn",onComplete:()=>{i.destroy(),n.destroy(),l.destroy(),r.destroy()}}),e[t].eyeBlastAnim&&e[t].eyeBlastAnim.stop(),messageBus.publish("selfClearEffect",t,!0),e[t]=null)}})}}),getBasicText("rune_mind_rune_protect")),h=0;2<=a&&(o=o+" X"+a,h=.15),this.postNonAttackCast("mindProtect",o,h)}castMindUltimate(){let s="mindUnload",a=globalObjects.player.getStatuses()[s],i=1,n=[];a&&(i=a.multiplier,n=a.animObj);let e,l=3;1<i?(playSound("mind_ultimate_2",.95),l=i+2,e=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"spells","mind_boost_2.png").setDepth(40),PhaserScene.tweens.add({targets:PhaserScene.cameras.main,zoom:.95,ease:"Cubic.easeOut",duration:850,onComplete:()=>{PhaserScene.tweens.add({targets:PhaserScene.cameras.main,zoom:1,ease:"Quart.easeIn",duration:450})}})):(playSound("mind_ultimate_1",.7),e=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"spells","mind_boost.png").setDepth(40),PhaserScene.tweens.add({targets:PhaserScene.cameras.main,zoom:.988,ease:"Cubic.easeOut",duration:550,onComplete:()=>{PhaserScene.tweens.add({targets:PhaserScene.cameras.main,zoom:1,ease:"Cubic.easeIn",duration:200})}})),e.setDepth(0),e.setScale(.95),e.setAlpha(.25),n.push(e),globalObjects.magicCircle.setAuraAlpha(.4+.05*l),this.scene.tweens.add({targets:e,duration:500,alpha:.75,ease:"Cubic.easeOut",scaleX:1.25,scaleY:1.25,onStart:()=>{a&&a.soundObj&&a.soundObj.stop();let e=null;var t=playSound("mind_ultimate_loop_1",.4,!0);1.01<i&&(e=playSound("mind_ultimate_loop_2",.8,!0)),messageBus.publish("selfTakeEffect",{ignoreBuff:!0,name:s,spellID:s,animObj:n,soundObj:t,soundObj2:e,multiplier:l,cleanUp:a=>{if(a[s]&&!a[s].currentAnim){playSound("mind_ultimate_cast");let e=a[s].soundObj,t=null;a[s].soundObj2&&(t=a[s].soundObj2),a[s].currentAnim=this.scene.tweens.add({targets:n,duration:180,alpha:0,ease:"Quad.easeOut",onComplete:()=>{fadeAwaySound(e),t&&fadeAwaySound(t),a[s]=null;for(let e=0;e<n.length;e++)n[e].destroy()}})}}})}}),this.scene.tweens.add({targets:e,duration:7e4,rotation:"+=6.28318",repeat:-1});var t=l-1,t=getBasicText("rune_mind_rune_unload")+" +"+t+"00%";let r=.15;4<l?r=.25:2<l&&(r=.2),messageBus.publish("messageAllSpell",s),messageBus.publish("recordSpell",s,t,r)}castVoidStrike(){this.castMatterStrike()}castVoidReinforce(e,t){this.castMatterReinforce(e,t)}castVoidEnhance(){let t="voidEnhance";var e=globalObjects.player.getStatuses()[t];let s=globalObjects.player.spellMultiplier();playSound("void_enhance",.55);let a,i=2*s;e&&(a=e.statusObj,i+=e.multiplier),this.pulseCircle||(this.pulseCircle=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"blurry","voidcirclelarge.png")),this.voidSpikeOutButton||(this.voidSpikeOutOuter=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"blurry","void_spike_out.png"),this.voidSpikeOutInner=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"blurry","void_spike_out.png"),this.voidSpikeOutButton=this.scene.add.image(gameConsts.halfWidth,globalObjects.player.getY(),"blurry","void_spike_out.png")),this.pulseCircle.setScale(1.5).setDepth(210).setAlpha(.05).setPosition(gameConsts.halfWidth,globalObjects.player.getY()).setRotation(6*Math.random()),this.voidSpikeOutOuter.currAnim&&this.voidSpikeOutOuter.currAnim.stop(),this.voidSpikeOutOuter.setScale(1.6).setDepth(99).setRotation(6*Math.random()).setVisible(!0),this.voidSpikeOutInner.setScale(1.2).setDepth(101).setRotation(this.voidSpikeOutOuter.rotation+.15).setVisible(!0),this.voidSpikeOutButton.setScale(.6).setDepth(104).setRotation(this.voidSpikeOutOuter.rotation+.3).setVisible(!0),PhaserScene.tweens.add({targets:[this.pulseCircle],scaleX:.5,scaleY:.5,duration:500,ease:"Cubic.easeInOut"}),PhaserScene.tweens.add({targets:[this.pulseCircle],duration:200,ease:"Cubic.easeOut",alpha:1,onComplete:()=>{var e=3*s,t=Math.ceil(globalObjects.player.getHealthMax()-e),e=globalObjects.player.getHealth()-e;globalObjects.player.setHealth(e),globalObjects.player.setHealthMaxTemp(t),PhaserScene.tweens.add({targets:[this.pulseCircle],duration:300,alpha:0});let a=200+Math.floor(20*Math.sqrt(s));PhaserScene.tweens.add({targets:[this.voidSpikeOutButton],duration:160,scaleX:.95+.04*s,scaleY:.95+.04*s,ease:"Back.easeOut",onComplete:()=>{PhaserScene.tweens.add({targets:[this.voidSpikeOutButton],delay:a,duration:400,scaleX:.6,scaleY:.6,ease:"Quad.easeIn"})}}),PhaserScene.tweens.add({delay:10,targets:[this.voidSpikeOutInner],duration:160,scaleX:1.55+.06*s,scaleY:1.55+.06*s,ease:"Back.easeOut",completeDelay:90,onComplete:()=>{PhaserScene.tweens.add({targets:[this.voidSpikeOutInner],delay:a,duration:400,scaleX:1.2,scaleY:1.2,ease:"Quad.easeIn"})}}),this.voidSpikeOutOuter.currAnim=PhaserScene.tweens.add({delay:20,targets:[this.voidSpikeOutOuter],duration:160,scaleX:1.95+.08*s,scaleY:1.95+.08*s,ease:"Back.easeOut",completeDelay:180,onComplete:()=>{this.voidSpikeOutOuter.curranim=PhaserScene.tweens.add({targets:[this.voidSpikeOutOuter],delay:a,duration:400,scaleX:1.56,scaleY:1.56,ease:"Quad.easeIn",onComplete:()=>{this.voidSpikeOutOuter.visible=!1,this.voidSpikeOutInner.visible=!1,this.voidSpikeOutButton.visible=!1}})}})}});messageBus.publish("animateVoidNum",gameConsts.halfWidth,globalObjects.player.getY()-40,"+"+i+" ATK\nDAMAGE",1+.18*Math.sqrt(i),{duration:1650},{alpha:0,scaleX:1,scaleY:1}),messageBus.publish("selfTakeEffect",{name:t,spellID:t,multiplier:i,statusObj:a,spriteSrc1:"rune_enhance_glow.png",spriteSrc2:"rune_void_glow.png",displayAmt:i,cleanUp:e=>{e[t]=null}});let n=getBasicText("rune_void_rune_enhance");1<s&&(n+=" X"+s),this.postNonAttackCast(t,n)}castVoidProtect(e,t){this.castMatterProtect(e,t)}castVoidUltimate(){this.castMindStrike()}createRockParticle(e,t,a,s,i){let n=this.particlesRock.pop();n||(n=this.scene.add.image(e,t,"spells","rock_chip.png")).setDepth(15),n.setScale(1.25),n.visible=!0,n.rotation=3.14*Math.random();e=s*i;this.scene.tweens.add({targets:n,x:"+="+a*i,y:"+="+e,duration:i,rotation:10*(Math.random()-.5)}),this.scene.tweens.add({targets:n,y:"+="+e,duration:i,easeParams:[4],ease:"Back.easeOut"}),this.scene.tweens.add({targets:n,ease:"Cubic.easeIn",scaleX:0,scaleY:0,duration:i-150,completeDelay:150,onComplete:()=>{this.recycleRockParticle(n)}})}recycleRockParticle(e){e.visible=!1,this.particlesRock.push(e)}postAttackCast(a,e=0,t="UNNAMED ATTACK",s,i){PhaserScene.time.delayedCall(e,()=>{messageBus.publish("attackLaunched",a);let e=globalObjects.player.getStatuses().mindEnhance;var t;e&&(t=e.animObj,this.scene.tweens.add({targets:t,y:140,duration:400,onComplete:()=>{messageBus.publish("applyMindBurn",5,e.multiplier),e.cleanUp(globalObjects.player.getStatuses())}}),this.scene.tweens.add({targets:t,ease:"Cubic.easeIn",x:gameConsts.halfWidth-10,duration:400}))}),messageBus.publish("recordSpellAttack",a,t,void 0,s,i),messageBus.publish("messageAllSpell",a,t),messageBus.publish("clearAttackMultiplier"),messageBus.publish("clearDamageAdder")}postNonAttackCast(e,t="UNNAMED SPELL"){messageBus.publish("recordSpell",e,t),messageBus.publish("messageAllSpell",e,t),messageBus.publish("clearSpellMultiplier")}cleanUpExistingShield(e){globalObjects.player.getStatuses()[e]&&messageBus.publish("selfClearEffect",e)}cleanseForms(){var e,t=globalObjects.player.getStatuses().mindReinforce,a=globalObjects.player.getStatuses().matterReinforce;t&&(messageBus.publish("selfClearStatuses","mindReinforce"),t={duration:800,ease:"Cubic.easeOut",alpha:.9,y:"+=4"},e={duration:1e3,ease:"Quad.easeIn",alpha:0},messageBus.publish("animateBlockNum",gameConsts.halfWidth,globalObjects.player.getY()+24,"-DAMAGE",.75,t,e)),a&&(messageBus.publish("selfClearStatuses","matterReinforce"),t={duration:800,ease:"Cubic.easeOut",alpha:.9,y:"+=4"},e={duration:1e3,ease:"Quad.easeIn",alpha:0},messageBus.publish("animateBlockNum",gameConsts.halfWidth,globalObjects.player.getY()+30,"-THORNS",.75,t,e))}}class StatusManager{constructor(e){this.scene=e,this.enemyStatusDisplay=[],this.playerStatusDisplayStack=[],this.listOfFreeStatuses=[],this.lastUpdateTime=0,this.subscriptions=[messageBus.subscribe("selfTakeEffect",this.manualUpdateSelf.bind(this)),messageBus.subscribe("enemyTakeEffect",this.manualUpdateEnemy.bind(this)),messageBus.subscribe("selfClearStatuses",this.clearPlayerStatuses.bind(this)),messageBus.subscribe("enemyHasDied",this.clearPlayerStatuses.bind(this))],updateManager.addFunction(this.update.bind(this))}manualUpdateSelf(t){if(!t.ignoreBuff){var a=t.spriteSrc1,s=t.spriteSrc2,i=t.displayAmt,n=t.spellID;let e;if(t.statusObj)e=t.statusObj;else{let t=-1;for(let e=0;e<this.playerStatusDisplayStack.length;e++)if(null===this.playerStatusDisplayStack[e]){t=e;break}-1===t?(t=this.playerStatusDisplayStack.length,e=this.createStatusObj(n,this.getPlayerStatusXPos(),this.getPlayerStatusYPos(t),a,s,i),this.playerStatusDisplayStack.push(e)):(e=this.createStatusObj(n,this.getPlayerStatusXPos(),this.getPlayerStatusYPos(t),a,s,i),this.playerStatusDisplayStack[t]=e)}e.setAmtText(t.displayAmt),e.setDurationText(t.duration),(e.statusOrig=t).statusObj=e}}manualUpdateEnemy(){}getPlayerStatusXPos(){return 30}getPlayerStatusYPos(e){return gameConsts.height-40-45*e}createStatusObj(e,t,a,s,i,n){let l=this.listOfFreeStatuses.pop();return l?l.init(e,t,a,s,i,n):l=new StatusObj(this.scene,e,t,a,s,i,n),l}recycleStatusObj(t){for(let e=0;e<this.playerStatusDisplayStack.length;e++)if(this.playerStatusDisplayStack[e]==t){this.playerStatusDisplayStack[e]=null;break}t.clear(),t.statusOrig=null,this.listOfFreeStatuses.push(t)}update(e){this.lastUpdateTime+=e*gameVars.timeSlowRatio,60<=this.lastUpdateTime&&(this.lastUpdateTime-=60,this.tickPlayerStatuses())}tickPlayerStatuses(){for(var e in this.playerStatusDisplayStack){var t,a,e=this.playerStatusDisplayStack[e];null!==e&&(null!=(t=e.statusOrig)&&void 0!==t.duration&&(--t.duration,void 0!==t.displayAmt&&t.displayAmt.toString()!=e.amtText.text&&e.setAmtText(t.displayAmt),t.onUpdate&&t.onUpdate(),e.setDurationText(t.duration),t.duration<=0))&&(a=globalObjects.player.getStatuses(),t.cleanUp&&t.cleanUp(a),this.recycleStatusObj(e))}messageBus.publish("statusesTicked")}clearPlayerStatuses(e=null,t=!1){for(var a in this.playerStatusDisplayStack){var s,i,a=this.playerStatusDisplayStack[a];null==a||null==(s=a.statusOrig)||null!==e&&e!=s.spellID||(i=globalObjects.player.getStatuses(),this.recycleStatusObj(a),s.cleanUp&&!t&&s.cleanUp(i))}}}class TextPopupManager{constructor(e){this.scene=e,this.damageNums=[],this.damageNum=this.scene.add.bitmapText(gameConsts.halfWidth,170,"damage","",isMobile?34:32).setDepth(9991).setOrigin(.5,.65),this.damageNum.startY=this.damageNum.y,this.damageTween=null,this.damageNumber=0,this.bonusNums=[],this.healNums=[],this.blockNums=[],this.armorNums=[],this.voidNums=[],this.infoBlur=this.scene.add.image(0,0,"blurry","display_backglow.png").setAlpha(0).setDepth(9990),this.infoBox=this.scene.add.image(0,0,"blackPixel").setAlpha(0).setDepth(9990),this.infoText=this.scene.add.text(0,0,"WELCOME",{fontFamily:"Arial",fontSize:isMobile?23:22,color:"#FFFFFF",align:"center"}).setAlpha(0).setOrigin(.5,.5).setDepth(9990),this.infoText.setFontStyle("bold"),this.infoBorderTop=this.scene.add.image(0,0,"blurry","box_length.png").setAlpha(0).setDepth(9990),this.infoBorderBot=this.scene.add.image(0,0,"blurry","box_length.png").setAlpha(0).setDepth(9990),this.infoWhiteFlashLeft=this.scene.add.image(0,0,"pixels","white_pixel.png").setDepth(9990).setOrigin(0,.5).setScale(0).setAlpha(.7),messageBus.subscribe("animateDamageNum",this.animateDamageNum.bind(this)),messageBus.subscribe("animateDamageNumAccumulate",this.animateDamageNumAccumulate.bind(this)),messageBus.subscribe("animateTrueDamageNum",this.animateTrueDamageNum.bind(this)),messageBus.subscribe("animateHealNum",this.animateHealNum.bind(this)),messageBus.subscribe("animateBlockNum",this.animateBlockNum.bind(this)),messageBus.subscribe("animateArmorNum",this.animateArmorNum.bind(this)),messageBus.subscribe("animateVoidNum",this.animateVoidNum.bind(this))}getBoxTopPos(){return this.infoBox.y-this.infoBox.scaleY}getBoxCenterPos(){return this.infoBox.y}getBoxBottomPos(){return this.infoBox.y+this.infoBox.scaleY}getCenterPos(){return this.infoBox.x-this.infoBox.scaleX*(this.infoBox.originX-.5)*2}getDepth(){return this.infoBox.depth}setInfoText(e,t,a,s="center",i){this.infoText.x=e,this.infoText.y=t,this.infoText.setAlpha(0),this.infoBox.setAlpha(0),this.infoBlur.setAlpha(0),this.infoBorderTop.setAlpha(0),this.infoBorderBot.setAlpha(0),this.infoText.setAlign("left"),this.infoBox.x=e,this.infoBox.y=t+2,this.infoBlur.y=this.infoBox.y,"left"==s?(this.infoText.x+=3,this.infoText.setOrigin(0,.5),this.infoBox.setOrigin(0,.5)):"center"==s?(this.infoText.setAlign("center"),this.infoText.setOrigin(.5,.5),this.infoBox.setOrigin(.5,.5),this.infoBlur.x=this.infoBox.x):"right"==s&&(this.infoText.setOrigin(1,.5),this.infoText.x-=6,this.infoBox.setOrigin(1,.5)),this.infoBorderTop.setAlpha(0),this.infoBorderBot.setAlpha(0),this.infoText.setText(a);e=i?.9:1,this.infoText.setScale(e),t=.5*this.infoText.width+8,a=.5*this.infoText.height+10,50<a&&(this.infoText.y+=1),this.infoBox.setScale(t*e,a*e),this.infoWhiteFlashLeft.setScale(1,this.infoBox.scaleY),this.infoWhiteFlashLeft.x=this.infoBox.x-2*this.infoBox.scaleX*this.infoBox.originX,this.infoWhiteFlashLeft.y=this.infoBox.y,this.infoBlur.setScale(.021*this.infoBox.scaleX,.025*this.infoBox.scaleY),this.infoBlur.x=this.getCenterPos(),i=t*e*.02;this.infoBorderTop.setScale(.1*i,.5).setPosition(this.getCenterPos(),this.infoBox.y-(a-2)*e),this.infoBorderBot.setScale(.1*i,-.5).setPosition(this.getCenterPos(),this.infoBox.y+(a-2)*e),this.currAnim=this.scene.tweens.add({targets:[this.infoText,this.infoBorderTop,this.infoBorderBot],alpha:1,duration:300}),this.currAnim3=this.scene.tweens.add({targets:[this.infoBorderTop,this.infoBorderBot],scaleX:i,ease:"Quart.easeInOut",duration:1e3,onComplete:()=>{this.currAnim=this.scene.tweens.add({targets:[this.infoBorderTop,this.infoBorderBot],alpha:.78,duration:1e3})}}),this.currAnim2=this.scene.tweens.add({targets:[this.infoBox,this.infoBlur],alpha:.7,duration:300}),this.currAnim4=this.scene.tweens.add({delay:50,targets:[this.infoWhiteFlashLeft],scaleX:this.infoBox.scaleX,ease:"Quint.easeIn",duration:550,alpha:1,onComplete:()=>{let e=this.infoBox.x+this.infoBox.scaleX;"left"==s?e+=this.infoBox.scaleX:"right"==s&&(e-=this.infoBox.scaleX),this.currAnim4=this.scene.tweens.add({targets:[this.infoWhiteFlashLeft],x:e,scaleX:0,ease:"Quint.easeOut",duration:550,alpha:.7})}})}getWidth(){return 2*this.infoBox.scaleX}hideInfoText(){this.currAnim&&(this.currAnim.stop(),this.currAnim2.stop(),this.currAnim3.stop()),this.scene.tweens.add({targets:[this.infoText,this.infoBox,this.infoBorderTop,this.infoBorderBot,this.infoBlur],alpha:0,duration:300})}animateDamageNum(e,t,a,s,i){e=this.getTextObjFromArray(e,t,a,this.damageNums,"damage"),t=isMobile?1.15:1;e.setScale(s*t).setAlpha(1),this.animateNum(e,this.damageNums,i)}animateDamageNumAccumulate(e,t=0){this.damageTween&&this.damageTween.stop(),this.damageNum.scaleX<.1&&(this.damageNumber=0);let a=0,s=(this.damageNumber+=e,a=0===this.damageNumber?.05:this.damageNumber<15?.5:this.damageNumber<40?.8:this.damageNumber<100?1:this.damageNumber<160?1.15:1.2,this.damageNum.setText("-"+this.damageNumber),.8+.15*Math.sqrt(this.damageNumber)),i=(isMobile&&(s+=.1),this.damageNum.setScale(.98*s),this.damageNum.y=this.damageNum.startY+t,this.damageNum.alpha=1,Math.floor(a*a*36));e={targets:this.damageNum,scaleX:s*(1+a),scaleY:s*(1+a),rotation:.075*a*(Math.random()<.5?1:-1),duration:150+i,ease:"Cubic.easeOut",onComplete:()=>{this.damageTween=this.scene.tweens.add({targets:this.damageNum,scaleX:s,scaleY:s,rotation:0,duration:300+i,ease:"Bounce.easeOut",onComplete:()=>{this.damageTween=this.scene.tweens.add({delay:850+Math.floor(this.damageNumber),targets:this.damageNum,scaleX:0,scaleY:0,alpha:0,duration:250,ease:"Quart.easeIn"})}})}};this.damageTween=this.scene.tweens.add(e)}animateTrueDamageNum(e,t,a,s,i,n){e=this.getTextObjFromArray(e,t,a,this.bonusNums,"bonus"),e.depth=9992,t=isMobile?1.15:1;e.setScale(s*t).setAlpha(1),this.animateNum(e,this.bonusNums,i,n)}animateHealNum(e,t,a,s,i={},n){var a=this.getTextObjFromArray(e,t,a,this.healNums,"heal"),l=isMobile?1.15:1;a.setScale(s*l).setAlpha(1),i.duration=i.duration?i.duration+300:1e3,this.animateNum(a,this.healNums,i,n),this.healVisual||(this.healVisual=this.scene.add.image(e,t+30,"misc","heal.png").setDepth(99999)),this.healVisual.setAlpha(1).setPosition(e,t+15).setScale(Math.sqrt(.8*s)),Math.random()<.5&&(this.healVisual.scaleX*=-1),this.scene.tweens.add({targets:this.healVisual,y:"-=30",duration:1e3}),this.scene.tweens.add({targets:this.healVisual,alpha:0,duration:1e3,ease:"Cubic.easeIn"})}animateBlockNum(e,t,a,s,i,n){e=this.getTextObjFromArray(e,t,a,this.blockNums,"block"),t=isMobile?1.15:1;e.setScale(s*t).setAlpha(1),this.animateNum(e,this.blockNums,i,n)}animateArmorNum(e,t,a,s,i,n){e=this.getTextObjFromArray(e,t,a,this.armorNums,"armor"),t=isMobile?1.15:1;e.setScale(s*t).setAlpha(1),this.animateNum(e,this.armorNums,i,n)}animateVoidNum(e,t,a,s,i,n){e=this.getTextObjFromArray(e,t,a,this.voidNums,"void"),t=isMobile?1.15:1;e.setScale(s*t).setAlpha(1),this.animateNum(e,this.voidNums,i,n)}getTextObjFromArray(e,t,a,s,i="block"){let n=s.pop();return n||((n=this.scene.add.bitmapText(e,t,i,a,32)).setDepth(9981),n.setOrigin(.5,.5),n.setCenterAlign()),n.setPosition(e,t),n.setText(a),n.visible=!0,n}animateNum(t,a,e={},s={}){e={...{targets:t,y:"-=18",duration:700,ease:"Cubic.easeOut",onComplete:()=>{var e={...{targets:t,scaleX:.4*t.scaleX,scaleY:.4*t.scaleY,alpha:0,duration:350,ease:"Quart.easeIn",onComplete:()=>{t.visible=!1,a.push(t)}},...s};this.scene.tweens.add(e)}},...e};this.scene.tweens.add(e)}}class CombatTextManager{constructor(e){this.scene=e,this.bg=this.scene.add.image(gameConsts.halfWidth,240,"misc","battletext_bg.png").setDepth(200).setAlpha(0).setScale(5),this.bg.startY=this.bg.y,this.bgBorderTop=this.scene.add.image(gameConsts.halfWidth,this.bg.y-5*this.bg.scaleY,"misc","battletext_border_top.png").setDepth(200).setAlpha(0).setOrigin(.5,0),this.bgBorderBot=this.scene.add.image(gameConsts.halfWidth,this.bg.y+5*this.bg.scaleY,"misc","battletext_border_bot.png").setDepth(200).setAlpha(0).setOrigin(.5,1),this.text=this.scene.add.text(gameConsts.halfWidth,this.bg.y,"...",{fontFamily:"garamondmax",fontSize:isMobile?28:26,color:"#FFFFFF",align:"center"}).setAlpha(0).setOrigin(.5,.5).setDepth(201),messageBus.subscribe("showCombatText",this.showCombatText.bind(this)),messageBus.subscribe("closeCombatText",this.closeCombatText.bind(this))}setDialog(e){this.dialog=e}setText(e){this.text.setText(e)}showCombatText(e,t=0,a,s=.92){this.isShowing=!0,this.setText(e),this.setPosition(this.bg.x,this.bg.startY+t),370<this.text.width?this.bg.scaleX=.01*(this.text.width+30):this.bg.scaleX=4,this.bgBorderTop.scaleX=.25*this.bg.scaleX,this.bgBorderBot.scaleX=.25*this.bg.scaleX,50<this.text.height?this.bg.scaleY=7.6:this.bg.scaleY=4.8,this.bgBorderTop.y=this.bg.y-4.8*this.bg.scaleY-1,this.bgBorderBot.y=this.bg.y+4.8*this.bg.scaleY+1,this.currAnim&&this.currAnim.stop(),this.text.alpha=0,this.onFinishFunc=a,PhaserScene.tweens.add({targets:[this.bg],alpha:s,scaleX:5,duration:300,ease:"Cubic.easeOut"}),PhaserScene.tweens.add({targets:[this.bgBorderTop,this.bgBorderBot],alpha:1,duration:350}),this.currAnim=PhaserScene.tweens.add({delay:100,targets:[this.text],alpha:1,duration:300})}closeCombatText(){this.isShowing&&(this.isShowing=!1,this.currAnim&&this.currAnim.stop(),this.onFinishFunc&&(this.onFinishFunc(),this.onFinishFunc=null),PhaserScene.tweens.add({targets:[this.bgBorderTop,this.bgBorderBot,this.bg,this.text],alpha:0,duration:400}))}setPosition(e,t,a=0){this.bg.setPosition(e,t),this.bgBorderTop.setPosition(e,t-5*this.bg.scaleY),this.bgBorderBot.setPosition(e,t+5*this.bg.scaleY),this.text.setPosition(e,t+a)}setOnFinishFunc(e,t=0){this.onFinishFunc=e}}class BannerTextManager{constructor(e){this.scene=e,this.dialog=["..."],this.funcArray=[],this.dialogIndex=0,this.darkenBG=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setDepth(100002).setAlpha(0).setScale(500,500),this.textBG=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+25,"misc","victory_banner.png").setScale(100,1).setDepth(100002).setAlpha(0),this.text=this.scene.add.text(gameConsts.halfWidth,this.textBG.y,"...",{fontFamily:"garamondmax",fontSize:32,color:"#FFFFFF",align:"center"}).setAlpha(0).setOrigin(.5,.57).setDepth(100002),messageBus.subscribe("continueDialog",this.continueDialog.bind(this))}setDialog(e){this.dialog=e}setDialogFunc(e=[]){this.funcArray=e}setText(e){this.text.setText(e),this.text.width>gameConsts.width-80?this.text.setFontSize(30):this.text.setFontSize(32)}getDepth(){return this.darkenBG.depth}showBanner(e=.5,t=!1,a){this.isShowing=!0,this.dialogIndex=0,this.setText(this.dialog[this.dialogIndex]),this.funcArray[this.dialogIndex]&&this.funcArray[this.dialogIndex](),e&&PhaserScene.tweens.add({targets:[this.darkenBG],alpha:e,duration:350}),PhaserScene.tweens.add({targets:[this.textBG],alpha:1,duration:250}),PhaserScene.tweens.add({delay:100,targets:[this.text],alpha:1,duration:300}),t?this.text.setScale(.95):this.text.setScale(1),this.dialogButton||(this.dialogButton=new Button({normal:{ref:"blackPixel",alpha:1e-5,x:gameConsts.halfWidth,y:gameConsts.halfHeight,scaleX:500,scaleY:500},disable:{alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{}}),setTimeout(()=>{this.dialogButton&&this.dialogButton.setOnMouseUpFunc(()=>{this.continueDialog()})},650))}closeBanner(){this.isShowing=!1,this.dialogButton&&(this.dialogButton.destroy(),this.dialogButton=null),this.currAnim&&this.currAnim.stop(),this.onFinishFunc&&(this.onFinishFunc(),this.onFinishFunc=null),PhaserScene.tweens.add({targets:[this.darkenBG,this.textBG,this.text],alpha:0,duration:500}),this.dialog=["..."],this.funcArray=[],this.dialogIndex=0}setPosition(e,t,a=-4){this.textBG.setPosition(e,t),this.text.setPosition(e,t+a)}setOnFinishFunc(e,t=0){this.onFinishFunc=e}setForcePause(e=!0){this.pauseForced=e}speedUpText(){this.speedUpNextText=!0}continueDialog(){if(this.pauseForced||this.continuePause||!this.isShowing)return!1;if(this.continuePause=!0,this.dialogIndex++,this.currAnim&&this.currAnim.stop(),this.dialog[this.dialogIndex]){let e=1;this.speedUpNextText&&(e=.001,this.speedUpNextText=!1),this.currAnim=PhaserScene.tweens.add({targets:[this.text],alpha:0,duration:250*e,onComplete:()=>{this.setText(this.dialog[this.dialogIndex]),this.funcArray[this.dialogIndex]&&this.funcArray[this.dialogIndex](),e<.1&&(this.text.setScale(1.04),PhaserScene.tweens.add({targets:this.text,scaleX:1,scaleY:1,duration:250,ease:"Cubic.easeOut"})),this.currAnim=PhaserScene.tweens.add({targets:[this.text],alpha:1,duration:250*e,completeDelay:200,onComplete:()=>{this.continuePause=!1}}),PhaserScene.tweens.add({targets:[this.text],rotation:0,duration:175})}})}else this.continuePause=!1,this.closeBanner();return!0}}function showVictoryScreen(){globalObjects.player.getPlayerCastSpellsCount()}function swirlInReaperFog(e=1.66,t=0,a=-5){var s=getFogSwirlGlow(t),t=getFogSwirl(t);s.setDepth(a),t.setDepth(a),t.currAnimScale=PhaserScene.tweens.add({targets:[t,s],scaleX:e,scaleY:e,alpha:.5,ease:"Cubic.easeOut",duration:12e3}),t.currAnim=PhaserScene.tweens.add({targets:[t,s],rotation:"+=6.283",duration:67018,repeat:-1})}function clearDeathFog(){globalObjects.fogSwirl&&(globalObjects.fogSwirl.currAnim&&globalObjects.fogSwirl.currAnim.stop(),globalObjects.fogSwirl.currAnimScale&&globalObjects.fogSwirl.currAnimScale.stop(),console.log("clear death fog"),PhaserScene.tweens.add({targets:[globalObjects.fogSwirl],scaleX:2.25,scaleY:2.25,alpha:0,ease:"Quad.easeIn",duration:550}),PhaserScene.tweens.add({targets:[globalObjects.fogSwirlGlow],scaleX:2,scaleY:2,alpha:0,ease:"Cubic.easeIn",duration:600}))}function getFogSlice(){return globalObjects.fogSlice||(globalObjects.fogSlice=PhaserScene.add.image(gameConsts.halfWidth+8,-44,"backgrounds","fog_slice.png").setDepth(-2).setOrigin(.68,.29)),globalObjects.fogSlice.setAlpha(.2).setScale(1.01).setRotation(-.8).setPosition(gameConsts.halfWidth+8,-45),globalObjects.fogSlice}function getFogSliceDarken(){return globalObjects.fogSliceDarken||(globalObjects.fogSliceDarken=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setDepth(-3).setScale(500,500)),globalObjects.fogSliceDarken.setAlpha(1).setPosition(gameConsts.halfWidth,gameConsts.halfHeight),globalObjects.fogSliceDarken}function getFogSwirl(e){return globalObjects.fogSwirl||(globalObjects.fogSwirl=PhaserScene.add.image(gameConsts.halfWidth,240,"backgrounds","fog_swirl.png").setDepth(-3).setScale(2.2).setRotation(-1).setAlpha(0),globalObjects.fogSwirl.scrollFactorX=.25,globalObjects.fogSwirl.scrollFactorY=.25),0==globalObjects.fogSwirl.alpha&&globalObjects.fogSwirl.setScale(2.25).setRotation(-1),globalObjects.fogSwirl.setPosition(gameConsts.halfWidth,240+e),globalObjects.fogSwirl}function tweenObjectRotationTo(e,t,a=250,s,i){return PhaserScene.tweens.add({targets:e,rotation:t,duration:a,ease:s,onComplete:i})}function hideHandsTemp(){globalObjects.deathLeftHand.setOrigin(0,1e3),globalObjects.deathRightHand.setOrigin(0,1e3)}function showHandsTemp(){globalObjects.deathLeftHand.setOrigin(.5,.5),globalObjects.deathRightHand.setOrigin(.5,.5)}function getFloatingDeath(){return globalObjects.floatingDeath||(globalObjects.floatingDeath=PhaserScene.add.image(gameConsts.halfWidth,95,"enemies","max_death_1a.png").setDepth(-1),globalObjects.floatingDeath.setAlpha(.4),globalObjects.floatingDeath2=PhaserScene.add.image(gameConsts.halfWidth,95,"enemies","max_death_1b.png").setDepth(-1).setVisible(!1),leftHandOffsetY=26,rightHandOffsetY=-50,globalObjects.deathLeftHand=PhaserScene.add.image(gameConsts.halfWidth+-114,globalObjects.floatingDeath.y+leftHandOffsetY,"enemies","max_death_left_arm.png"),globalObjects.deathRightHand=PhaserScene.add.image(gameConsts.halfWidth+189,globalObjects.floatingDeath.y+rightHandOffsetY,"enemies","max_death_right_hand.png"),globalObjects.deathLeftHand.startY=globalObjects.deathLeftHand.y,globalObjects.deathRightHand.startY=globalObjects.deathRightHand.y,globalObjects.deathLeftHand.offsetX=-114,globalObjects.deathLeftHand.offsetY=leftHandOffsetY,globalObjects.deathRightHand.offsetX=189,globalObjects.deathRightHand.offsetY=rightHandOffsetY,setFloatingDeathScale(.32)),!1===globalObjects.floatingDeath.visible&&(globalObjects.floatingDeath.setVisible(!0).setAlpha(.05).setScale(.35).setDepth(-1),globalObjects.floatingDeath2.setVisible(!1),globalObjects.deathLeftHand.setAlpha(.05),globalObjects.deathRightHand.setAlpha(.05),setFloatingDeathScale(.32)),globalObjects.deathLeftHand.setDepth(globalObjects.floatingDeath.depth+1),globalObjects.deathRightHand.setDepth(globalObjects.floatingDeath.depth+1),tweenObjectRotationTo(globalObjects.deathLeftHand,-.35,10),tweenObjectRotationTo(globalObjects.deathRightHand,.3,10),globalObjects.deathLeftHand.fakeAlpha=0,globalObjects.deathRightHand.fakeAlpha=0,globalObjects.floatingDeath.fakeAlpha=globalObjects.floatingDeath.alpha,globalObjects.floatingDeath2.fakeAlpha=globalObjects.floatingDeath.alpha,globalObjects.floatingDeath}function getFogSwirlGlow(e){return globalObjects.fogSwirlGlow||(globalObjects.fogSwirlGlow=PhaserScene.add.image(gameConsts.halfWidth,225,"backgrounds","fog_swirl_glow.png").setDepth(-3).setAlpha(0),globalObjects.fogSwirlGlow.scrollFactorX=.25,globalObjects.fogSwirlGlow.scrollFactorY=.25),0==globalObjects.fogSwirlGlow.alpha&&globalObjects.fogSwirlGlow.setScale(2).setRotation(-1),globalObjects.fogSwirlGlow.setPosition(gameConsts.halfWidth,225+e),globalObjects.fogSwirlGlow}function setFloatingDeathScale(e){globalObjects.floatingDeath.setScale(e),globalObjects.floatingDeath2.setScale(e),globalObjects.deathLeftHand.setScale(e),globalObjects.deathLeftHand.setPosition(globalObjects.floatingDeath.x+globalObjects.deathLeftHand.offsetX*e,globalObjects.floatingDeath.y+globalObjects.deathLeftHand.offsetY*e),globalObjects.deathRightHand.setScale(e),globalObjects.deathRightHand.setPosition(globalObjects.floatingDeath.x+globalObjects.deathRightHand.offsetX*e,globalObjects.floatingDeath.y+globalObjects.deathRightHand.offsetY*e)}function stopFloatingDeathTween(){globalObjects.floatingDeath.currAnim1&&(globalObjects.floatingDeath.currAnim1.stop(),globalObjects.floatingDeath.currAnim2.stop(),globalObjects.floatingDeath.currAnim3.stop())}function tweenFloatingDeath(e=.75,t=1,a=1200,s="Cubic.easeInOut",i){var n=t<.15?t-.15:t;stopFloatingDeathTween(),setFloatingDeathVisible(!0),globalObjects.floatingDeath.currAnim1=PhaserScene.tweens.add({targets:[globalObjects.floatingDeath,globalObjects.floatingDeath2,globalObjects.deathLeftHand,globalObjects.deathRightHand],scaleX:e,scaleY:e,ease:s,fakeAlpha:n,duration:a,onComplete:i}),globalObjects.floatingDeath.currAnim2=PhaserScene.tweens.add({targets:[globalObjects.deathLeftHand],x:globalObjects.floatingDeath.x+globalObjects.deathLeftHand.offsetX*e,y:globalObjects.floatingDeath.y+globalObjects.deathLeftHand.offsetY*e,ease:s,alpha:t,duration:a}),globalObjects.floatingDeath.currAnim3=PhaserScene.tweens.add({targets:[globalObjects.deathRightHand],x:globalObjects.floatingDeath.x+globalObjects.deathRightHand.offsetX*e,y:globalObjects.floatingDeath.y+globalObjects.deathRightHand.offsetY*e,ease:s,alpha:t,duration:a})}function setFloatingDeathDepth(e){globalObjects.floatingDeath.setDepth(e),globalObjects.floatingDeath2.setDepth(e),globalObjects.deathLeftHand.setDepth(e+1),globalObjects.deathRightHand.setDepth(e+1)}function repeatDeathHandsRotate(){globalObjects.deathLeftHand.currAnim=tweenObjectRotationTo(globalObjects.deathLeftHand,.03,2500,"Cubic.easeInOut"),globalObjects.deathRightHand.currAnim=tweenObjectRotationTo(globalObjects.deathRightHand,-.03,2500,"Cubic.easeInOut",()=>{globalObjects.deathLeftHand.currAnim=tweenObjectRotationTo(globalObjects.deathLeftHand,-.05,2500,"Cubic.easeInOut"),globalObjects.deathRightHand.currAnim=tweenObjectRotationTo(globalObjects.deathRightHand,.05,2500,"Cubic.easeInOut",()=>{repeatDeathHandsRotate()})})}function setFloatingDeathVisible(e,t=!1){globalObjects.floatingDeath.visible=e,globalObjects.floatingDeath2.visible=e,t?(globalObjects.deathLeftHand.visible=!1,globalObjects.deathRightHand.visible=!1):(globalObjects.deathLeftHand.visible=e,globalObjects.deathRightHand.visible=e)}function playReaperAnim(l,r,e=!0){let o=l.getLevel();e?(playSound("whoosh").detune=-500,globalObjects.reaperDarkFlashTop||(globalObjects.reaperDarkFlashBot=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel"),globalObjects.reaperDarkFlashTop=PhaserScene.add.image(-150,gameConsts.halfHeight,"pixels","black_blue_pixel.png").setOrigin(1,.5).setDepth(60),globalObjects.reaperDarkFlashTop2=PhaserScene.add.image(-150,gameConsts.halfHeight,"pixels","black_blue_pixel.png").setOrigin(1,.5).setDepth(60),globalObjects.reaperDarkFlashTop3=PhaserScene.add.image(-150,gameConsts.halfHeight,"pixels","black_blue_pixel.png").setOrigin(1,.5).setDepth(60)),globalObjects.reaperDarkFlashBot.setScale(700).setAlpha(0).setVisible(!0),globalObjects.reaperDarkFlashTop.setScale(500,750).setRotation(.38).setPosition(-160,gameConsts.halfHeight).setAlpha(.05).setVisible(!0),globalObjects.reaperDarkFlashTop2.setScale(50+80*Math.random(),700).setRotation(.3).setPosition(-140,gameConsts.halfHeight).setAlpha(.65).setVisible(!0),globalObjects.reaperDarkFlashTop3.setScale(500,750).setRotation(.26).setPosition(-120,gameConsts.halfHeight).setAlpha(.3).setVisible(!0),e=Math.floor(50*Math.random()),PhaserScene.tweens.add({targets:globalObjects.reaperDarkFlashTop,scaleY:750,duration:350+e,onComplete:()=>{setupReaperArrival(),tweenFloatingDeath(.75,1,1200,"Cubic.easeInOut",()=>{gameVars.deathFlutterDelay=450;let n=PhaserScene.add.sprite(gameConsts.halfWidth,140,"misc","scythe1.png").setDepth(999).setAlpha(0).setScale(.65).setRotation(-1.5);n.play("scytheFlash"),PhaserScene.tweens.add({targets:n,alpha:1,duration:450}),PhaserScene.tweens.add({targets:n,y:75,scaleX:.8,scaleY:.8,rotation:-1.35,ease:"Quart.easeIn",duration:400,onComplete:()=>{l.customBgMusic&&fadeAwaySound(l.customBgMusic,1e3,""),PhaserScene.time.delayedCall(820,()=>{tweenObjectRotationTo(globalObjects.deathLeftHand,-.2,500,"Cubic.easeOut"),tweenObjectRotationTo(globalObjects.deathRightHand,.1,500,"Cubic.easeOut")}),PhaserScene.tweens.add({targets:n,scaleX:.9,scaleY:.9,y:65,ease:"Cubic.easeInOut",duration:900}),PhaserScene.tweens.add({targets:n,rotation:-.5,ease:"Quart.easeOut",duration:900,completeDelay:200,onComplete:()=>{n.play("scytheReap"),PhaserScene.tweens.add({targets:n,rotation:"-=1.5",ease:"Quint.easeIn",duration:50,onComplete:()=>{l.customBgMusic&&l.customBgMusic.stop();let e=getFogSlice(),t=getFogSliceDarken(),a=(PhaserScene.tweens.add({targets:t,alpha:.75,ease:"Cubic.easeOut",duration:500}),globalObjects.fogSwirl?globalObjects.fogSwirl.alpha:1);var s;PhaserScene.tweens.add({targets:globalObjects.fogSwirl,alpha:.25,ease:"Cubic.easeIn",duration:300,onComplete:()=>{PhaserScene.tweens.add({delay:100,targets:globalObjects.fogSwirl,ease:"Cubic.easeInOut",alpha:a,duration:1e3})}}),PhaserScene.tweens.add({delay:50,targets:[e],alpha:1,ease:"Quad.easeOut",duration:200,onComplete:()=>{PhaserScene.tweens.add({delay:200,targets:[e,t],ease:"Quart.easeIn",alpha:0,duration:1400})}}),PhaserScene.tweens.add({delay:50,targets:[e],scaleX:1.08,scaleY:1.08,ease:"Quint.easeOut",duration:300,onComplete:()=>{PhaserScene.tweens.add({targets:[e],scaleX:1.1,scaleY:1.1,duration:1500})}}),PhaserScene.tweens.add({delay:50,targets:e,rotation:-.85,ease:"Quad.easeOut",duration:1500}),l&&(s=l.sprite,PhaserScene.tweens.add({targets:s,scaleX:1.2*s.scaleX,scaleY:1.2*s.scaleX,alpha:0,duration:750})),setTimeout(()=>{playSound(globalObjects.reapSound||"death_attack").detune=0,messageBus.publish("reapedEnemyGong"),messageBus.publish("showCircleShadow",.4),globalObjects.reapSound=null,messageBus.publish("tempPause",70,.1)},100);let i=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setScale(500).setDepth(980).setAlpha(1);this.scytheBlur||(this.scytheBlur=PhaserScene.add.image(gameConsts.halfWidth,n.y,"blurry","scytheblur.png").setDepth(1002).setBlendMode(Phaser.BlendModes.LIGHTEN)),this.scytheBlur.setAlpha(1).setScale(.82).setRotation(-.15),PhaserScene.tweens.add({targets:[i],alpha:0,duration:1500,ease:"Quad.easeOut",onComplete:()=>{i.destroy()}}),PhaserScene.tweens.add({targets:[this.scytheBlur],alpha:0,ease:"Cubic.easeOut",duration:700}),PhaserScene.tweens.add({targets:n,rotation:-3.5,x:"-=10",ease:"Quint.easeOut",duration:500,onComplete:()=>{repeatDeathHandsRotate(),PhaserScene.tweens.add({delay:200,targets:n,rotation:"+=0.1",x:"-=12",ease:"Quart.easeInOut",duration:2e3}),PhaserScene.tweens.add({targets:n,alpha:0,delay:1e3,scaleX:.6,scaleY:.6,ease:"Cubic.easeIn",duration:600,onComplete:()=>{n.destroy(),l.destroy(),setFloatingDeathDepth(100010),handleReaperDialog(o,()=>{gameVars.deathFlutterDelay=10,repeatDeathFlutterAnimation(-.25),clearReaper(),globalObjects.postFightScreen.startGloom(),PhaserScene.tweens.add({targets:[n],scaleX:.5,scaleY:.5,alpha:0,ease:"Cubic.easeIn",duration:1100,completeDelay:200,onComplete:()=>{PhaserScene.tweens.add({targets:[globalObjects.fogSliceDarken],alpha:0,duration:1e3,onComplete:()=>{globalObjects.fogSliceDarken.destroy()}}),r?r():setTimeout(()=>{globalObjects.magicCircle.enableMovement(),globalObjects.postFightScreen.createWinScreen(o)},200)}})})}})}})}})}})}})}),globalObjects.reaperDarkFlashTop2.visible&&setFloatingDeathVisible(!1)}}),PhaserScene.tweens.add({targets:globalObjects.reaperDarkFlashTop3,duration:320+Math.floor(30*Math.random()),rotation:.12,ease:"Quad.easeIn",x:gameConsts.width+160,onComplete:()=>{globalObjects.reaperDarkFlashTop3.visible=!1}}),PhaserScene.tweens.add({targets:globalObjects.reaperDarkFlashTop3,alpha:1,duration:450,ease:"Cubic.easeIn"}),PhaserScene.tweens.add({delay:10,targets:globalObjects.reaperDarkFlashTop2,alpha:1,duration:465+30*Math.random(),ease:"Quad.easeIn",rotation:.23,x:gameConsts.width+140,completeDelay:30,onComplete:()=>{globalObjects.reaperDarkFlashTop2.visible=!1}}),PhaserScene.tweens.add({targets:globalObjects.reaperDarkFlashTop2,alpha:1,duration:480,ease:"Cubic.easeIn",scaleX:40}),e=570+e,PhaserScene.tweens.add({delay:10,targets:globalObjects.reaperDarkFlashTop,alpha:1,duration:e,ease:"Quint.easeIn"}),PhaserScene.tweens.add({delay:20,targets:globalObjects.reaperDarkFlashTop,duration:e,ease:"Cubic.easeIn",rotation:.32,x:gameConsts.width+180,completeDelay:100,onComplete:()=>{setFloatingDeathVisible(!0),globalObjects.reaperDarkFlashTop.setAlpha(1),globalObjects.reaperDarkFlashBot.setAlpha(1),PhaserScene.tweens.add({targets:globalObjects.reaperDarkFlashBot,alpha:0,duration:1500,ease:"Cubic.easeOut",onComplete:()=>{globalObjects.reaperDarkFlashBot.visible=!1}}),globalObjects.reaperDarkFlashBot.setRotation(.15),PhaserScene.tweens.add({targets:globalObjects.reaperDarkFlashTop,scaleX:0,alpha:0,duration:500,ease:"Cubic.easeOut",onComplete:()=>{globalObjects.reaperDarkFlashTop2.visible=!1}})}})):(setupReaperArrival(),tweenFloatingDeath(.75,1,1200,"Cubic.easeInOut",()=>{gameVars.deathFlutterDelay=450;let n=PhaserScene.add.sprite(gameConsts.halfWidth,140,"misc","scythe1.png").setDepth(999).setAlpha(0).setScale(.65).setRotation(-1.5);n.play("scytheFlash"),PhaserScene.tweens.add({targets:n,alpha:1,duration:450}),PhaserScene.tweens.add({targets:n,y:75,scaleX:.8,scaleY:.8,rotation:-1.35,ease:"Quart.easeIn",duration:400,onComplete:()=>{l.customBgMusic&&fadeAwaySound(l.customBgMusic,1e3,""),PhaserScene.time.delayedCall(820,()=>{tweenObjectRotationTo(globalObjects.deathLeftHand,-.2,500,"Cubic.easeOut"),tweenObjectRotationTo(globalObjects.deathRightHand,.1,500,"Cubic.easeOut")}),PhaserScene.tweens.add({targets:n,scaleX:.9,scaleY:.9,y:65,ease:"Cubic.easeInOut",duration:900}),PhaserScene.tweens.add({targets:n,rotation:-.5,ease:"Quart.easeOut",duration:900,completeDelay:200,onComplete:()=>{n.play("scytheReap"),PhaserScene.tweens.add({targets:n,rotation:"-=1.5",ease:"Quint.easeIn",duration:50,onComplete:()=>{l.customBgMusic&&l.customBgMusic.stop();let e=getFogSlice(),t=getFogSliceDarken(),a=(PhaserScene.tweens.add({targets:t,alpha:.75,ease:"Cubic.easeOut",duration:500}),globalObjects.fogSwirl?globalObjects.fogSwirl.alpha:1);var s;PhaserScene.tweens.add({targets:globalObjects.fogSwirl,alpha:.25,ease:"Cubic.easeIn",duration:300,onComplete:()=>{PhaserScene.tweens.add({delay:100,targets:globalObjects.fogSwirl,ease:"Cubic.easeInOut",alpha:a,duration:1e3})}}),PhaserScene.tweens.add({delay:50,targets:[e],alpha:1,ease:"Quad.easeOut",duration:200,onComplete:()=>{PhaserScene.tweens.add({delay:200,targets:[e,t],ease:"Quart.easeIn",alpha:0,duration:1400})}}),PhaserScene.tweens.add({delay:50,targets:[e],scaleX:1.08,scaleY:1.08,ease:"Quint.easeOut",duration:300,onComplete:()=>{PhaserScene.tweens.add({targets:[e],scaleX:1.09,scaleY:1.09,duration:1500})}}),PhaserScene.tweens.add({delay:50,targets:e,rotation:-.85,ease:"Quad.easeOut",duration:1500}),l&&(s=l.sprite,PhaserScene.tweens.add({targets:s,scaleX:1.2*s.scaleX,scaleY:1.2*s.scaleX,alpha:0,duration:750})),setTimeout(()=>{playSound(globalObjects.reapSound||"death_attack").detune=0,messageBus.publish("reapedEnemyGong"),messageBus.publish("showCircleShadow",.4),globalObjects.reapSound=null,messageBus.publish("tempPause",70,.1)},100);let i=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setScale(500).setDepth(980).setAlpha(1);this.scytheBlur||(this.scytheBlur=PhaserScene.add.image(gameConsts.halfWidth,n.y,"blurry","scytheblur.png").setDepth(1002).setBlendMode(Phaser.BlendModes.LIGHTEN)),this.scytheBlur.setAlpha(1).setScale(.82).setRotation(-.15),PhaserScene.tweens.add({targets:[i],alpha:0,duration:1500,ease:"Quad.easeOut",onComplete:()=>{i.destroy()}}),PhaserScene.tweens.add({targets:[this.scytheBlur],alpha:0,ease:"Cubic.easeOut",duration:700}),PhaserScene.tweens.add({targets:n,rotation:-3.5,x:"-=10",ease:"Quint.easeOut",duration:500,onComplete:()=>{repeatDeathHandsRotate(),PhaserScene.tweens.add({delay:200,targets:n,rotation:"+=0.1",x:"-=12",ease:"Quart.easeInOut",duration:2e3}),PhaserScene.tweens.add({targets:n,alpha:0,delay:1e3,scaleX:.6,scaleY:.6,ease:"Cubic.easeIn",duration:600,onComplete:()=>{n.destroy(),l.destroy(),setFloatingDeathDepth(100010),handleReaperDialog(o,()=>{gameVars.deathFlutterDelay=10,repeatDeathFlutterAnimation(-.25),clearReaper(),globalObjects.postFightScreen.startGloom(),PhaserScene.tweens.add({targets:[n],scaleX:.5,scaleY:.5,alpha:0,ease:"Cubic.easeIn",duration:1100,completeDelay:200,onComplete:()=>{PhaserScene.tweens.add({targets:[globalObjects.fogSliceDarken],alpha:0,duration:1e3,onComplete:()=>{globalObjects.fogSliceDarken.destroy()}}),r?r():setTimeout(()=>{globalObjects.magicCircle.enableMovement(),globalObjects.postFightScreen.createWinScreen(o)},200)}})})}})}})}})}})}})}))}function playReaperPassiveAnim(e,t,a=!0){let s=e.getLevel();a?(playSound("whoosh").detune=-500,globalObjects.reaperDarkFlashTop||(globalObjects.reaperDarkFlashBot=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel"),globalObjects.reaperDarkFlashTop=PhaserScene.add.image(-150,gameConsts.halfHeight,"pixels","black_blue_pixel.png").setOrigin(1,.5).setDepth(60),globalObjects.reaperDarkFlashTop2=PhaserScene.add.image(-150,gameConsts.halfHeight,"pixels","black_blue_pixel.png").setOrigin(1,.5).setDepth(60),globalObjects.reaperDarkFlashTop3=PhaserScene.add.image(-150,gameConsts.halfHeight,"pixels","black_blue_pixel.png").setOrigin(1,.5).setDepth(60)),globalObjects.reaperDarkFlashBot.setScale(700).setAlpha(0).setVisible(!0),globalObjects.reaperDarkFlashTop.setScale(500,750).setRotation(.38).setPosition(-160,gameConsts.halfHeight).setAlpha(.05).setVisible(!0),globalObjects.reaperDarkFlashTop2.setScale(50+80*Math.random(),700).setRotation(.3).setPosition(-140,gameConsts.halfHeight).setAlpha(.65).setVisible(!0),globalObjects.reaperDarkFlashTop3.setScale(500,750).setRotation(.26).setPosition(-120,gameConsts.halfHeight).setAlpha(.3).setVisible(!0),e=Math.floor(50*Math.random()),PhaserScene.tweens.add({targets:globalObjects.reaperDarkFlashTop,scaleY:750,duration:495+e,onComplete:()=>{setupReaperArrival(),setFloatingDeathDepth(100010),tweenFloatingDeath(.75,1,1350,"Cubic.easeOut",()=>{gameVars.deathFlutterDelay=450,repeatDeathHandsRotate(),setFloatingDeathDepth(100010),repeatDeathFlutterAnimation(-.25),handleReaperDialog(s,()=>{gameVars.deathFlutterDelay=10,clearReaper(),PhaserScene.tweens.add({targets:[globalObjects.fogSliceDarken],alpha:0,duration:1e3,onComplete:()=>{globalObjects.fogSliceDarken.destroy()}}),t&&t()})}),globalObjects.reaperDarkFlashTop2.visible&&setFloatingDeathVisible(!1)}}),PhaserScene.tweens.add({targets:globalObjects.reaperDarkFlashTop3,duration:335+Math.floor(30*Math.random()),rotation:.12,ease:"Quad.easeIn",x:gameConsts.width+160,onComplete:()=>{globalObjects.reaperDarkFlashTop3.visible=!1}}),PhaserScene.tweens.add({targets:globalObjects.reaperDarkFlashTop3,alpha:1,duration:460,ease:"Cubic.easeIn"}),PhaserScene.tweens.add({delay:10,targets:globalObjects.reaperDarkFlashTop2,alpha:1,duration:465+30*Math.random(),ease:"Quad.easeIn",rotation:.23,x:gameConsts.width+140,completeDelay:30,onComplete:()=>{globalObjects.reaperDarkFlashTop2.visible=!1}}),PhaserScene.tweens.add({targets:globalObjects.reaperDarkFlashTop2,alpha:1,duration:480,ease:"Cubic.easeIn",scaleX:40}),a=580+e,PhaserScene.tweens.add({delay:10,targets:globalObjects.reaperDarkFlashTop,alpha:1,duration:a,ease:"Quint.easeIn"}),PhaserScene.tweens.add({delay:20,targets:globalObjects.reaperDarkFlashTop,duration:a,ease:"Cubic.easeIn",rotation:.32,x:gameConsts.width+180,completeDelay:100,onComplete:()=>{setFloatingDeathVisible(!0),globalObjects.reaperDarkFlashTop.setAlpha(1),globalObjects.reaperDarkFlashBot.setAlpha(1),PhaserScene.tweens.add({targets:globalObjects.reaperDarkFlashBot,alpha:0,duration:1500,ease:"Cubic.easeOut",onComplete:()=>{globalObjects.reaperDarkFlashBot.visible=!1}}),globalObjects.reaperDarkFlashBot.setRotation(.15),PhaserScene.tweens.add({targets:globalObjects.reaperDarkFlashTop,scaleX:0,alpha:0,duration:500,ease:"Cubic.easeOut",onComplete:()=>{globalObjects.reaperDarkFlashTop2.visible=!1}})}})):(setupReaperArrival(),setFloatingDeathDepth(100010),tweenFloatingDeath(.75,1,1200,"Cubic.easeInOut",()=>{gameVars.deathFlutterDelay=450,repeatDeathHandsRotate(),setFloatingDeathDepth(100010),repeatDeathFlutterAnimation(-.25),handleReaperDialog(s,()=>{gameVars.deathFlutterDelay=10,clearReaper(),PhaserScene.tweens.add({targets:[globalObjects.fogSliceDarken],alpha:0,duration:1e3,onComplete:()=>{globalObjects.fogSliceDarken.destroy()}}),t&&t()})}))}function setupReaperArrival(){if(playSound("sound_of_death"),messageBus.publish("reapedEnemyGong"),globalObjects.magicCircle.disableMovement(),getFloatingDeath(),showHandsTemp(),globalObjects.fogSwirl){globalObjects.fogSwirl.currAnim.stop(),globalObjects.fogSwirl.currAnimScale.stop(),globalObjects.fogSwirl.currAnim=PhaserScene.tweens.add({targets:[globalObjects.fogSwirl,globalObjects.fogSwirlGlow],scaleX:1.15,scaleY:1.15,alpha:.9,ease:"Cubic.easeInOut",rotation:"+=1.5",duration:1600});let e=PhaserScene.tweens.add({delay:1400,targets:[globalObjects.fogSwirl,globalObjects.fogSwirlGlow],rotation:"+=6.283",duration:45e3,repeat:-1,onStart:()=>{PhaserScene.tweens.add({targets:[globalObjects.fogSwirl,globalObjects.fogSwirlGlow],scaleX:1.17,scaleY:1.17,alpha:.92,ease:"Quad.easeOut",duration:1e3}),globalObjects.fogSwirl.currAnim.stop(),globalObjects.fogSwirl.currAnim=e}})}startDeathFlutterAnim(),globalObjects.floatingDeath.fakeAlpha=globalObjects.floatingDeath.alpha,globalObjects.floatingDeath2.fakeAlpha=globalObjects.floatingDeath.alpha,globalObjects.deathLeftHand.setRotation(-.55),globalObjects.deathRightHand.setRotation(.45),tweenObjectRotationTo(globalObjects.deathLeftHand,.2,2400,"Cubic.easeInOut"),tweenObjectRotationTo(globalObjects.deathRightHand,-.1,2400,"Cubic.easeInOut")}function clearReaper(){globalObjects.deathLeftHand.currAnim&&(globalObjects.deathLeftHand.currAnim.stop(),globalObjects.deathRightHand.currAnim.stop()),globalObjects.floatingDeath.visible=!0,globalObjects.floatingDeath2.visible=!0,tweenObjectRotationTo(globalObjects.deathLeftHand,-.38,1100,"Cubic.easeIn"),tweenObjectRotationTo(globalObjects.deathRightHand,.32,1100,"Cubic.easeIn"),globalObjects.deathLeftHand.alpha=3,globalObjects.deathRightHand.alpha=3,tweenFloatingDeath(.5,.1,1100,"Quad.easeIn",()=>{globalObjects.floatingDeath.flutterAnim.stop(),globalObjects.floatingDeath.visible=!0,globalObjects.floatingDeath2.visible=!1,globalObjects.floatingDeath.alpha=.1,PhaserScene.tweens.add({targets:[globalObjects.floatingDeath,globalObjects.deathLeftHand,globalObjects.deathRightHand],alpha:0,fakeAlpha:0,scaleX:.3,scaleY:.3,duration:400,ease:"Quad.easeOut",onComplete:()=>{globalObjects.floatingDeath.visible=!1,globalObjects.deathLeftHand.visible=!0,globalObjects.deathRightHand.visible=!0,globalObjects.floatingDeath.setFrame("max_death_1a.png"),globalObjects.floatingDeath2.setFrame("max_death_1b.png")}})})}function stopDeathFlutterAnim(){globalObjects.floatingDeath.flutterAnim&&globalObjects.floatingDeath.flutterAnim.stop()}function startDeathFlutterAnim(e){globalObjects.floatingDeath2.setVisible(!0).setScale(globalObjects.floatingDeath.scaleX).setDepth(globalObjects.floatingDeath.depth),gameVars.deathFlutterDelay=0,repeatDeathFlutterAnimation(e)}function repeatDeathFlutterAnimation(e=0){stopDeathFlutterAnim(),globalObjects.floatingDeath2.alpha=0,globalObjects.floatingDeath.alpha=1,globalObjects.floatingDeath.flutterAnim=PhaserScene.tweens.add({targets:globalObjects.floatingDeath2,alpha:globalObjects.floatingDeath2.fakeAlpha+e,duration:70+gameVars.deathFlutterDelay,ease:"Cubic.easeIn",onComplete:()=>{globalObjects.floatingDeath.flutterAnim=PhaserScene.tweens.add({targets:globalObjects.floatingDeath,alpha:0,duration:20+gameVars.deathFlutterDelay,ease:"Cubic.easeOut",completeDelay:100+2*gameVars.deathFlutterDelay,onComplete:()=>{globalObjects.floatingDeath2.setDepth(globalObjects.floatingDeath.depth-1),globalObjects.floatingDeath.flutterAnim=PhaserScene.tweens.add({targets:globalObjects.floatingDeath,alpha:globalObjects.floatingDeath.fakeAlpha+e,duration:70+gameVars.deathFlutterDelay,ease:"Cubic.easeIn",onComplete:()=>{globalObjects.floatingDeath.flutterAnim=PhaserScene.tweens.add({targets:globalObjects.floatingDeath2,alpha:0,duration:20+gameVars.deathFlutterDelay,ease:"Cubic.easeOut",completeDelay:100+2*gameVars.deathFlutterDelay,onComplete:()=>{globalObjects.floatingDeath2.setDepth(globalObjects.floatingDeath.depth+1),repeatDeathFlutterAnimation()}})}})}})}})}function handleReaperDialog(e=0,t){let a=[],s=[];switch(e){case 1:return void(t&&t());case 2:case 3:a=[getLangText("death2a"),getLangText("death2b"),getLangText("death2c")];break;case 4:a=[getLangText("death3a"),getLangText("death3b"),getLangText("death3c")];break;case 5:a=[getLangText("death4b"),getLangText("death4c"),getLangText("death4d")],s=[void 0,()=>{stopDeathFlutterAnim(),tweenFloatingDeath(.75,0,200,"Quad.easeOut",()=>{hideHandsTemp(),globalObjects.floatingDeath.visible=!0,globalObjects.floatingDeath2.visible=!0,globalObjects.deathLeftHand.visible=!1,globalObjects.deathRightHand.visible=!1,globalObjects.floatingDeath.alpha=.15,globalObjects.floatingDeath2.alpha=.15,globalObjects.floatingDeath.setFrame("max_death_1a_angry.png"),globalObjects.floatingDeath2.setFrame("max_death_1b_angry.png"),globalObjects.floatingDeath.fakeAlpha=1,globalObjects.floatingDeath2.fakeAlpha=1,gameVars.deathFlutterDelay=350,repeatDeathFlutterAnimation(0)})},void 0];break;case 6:a=[getLangText("death_statue1"),getLangText("death_statue2"),getLangText("death_statue3")],s=[null,null,()=>{messageBus.publish("lift_statue")}];break;case 7:a=[getLangText("death5demoa"),getLangText("death5demob"),getLangText("death5democ"),getLangText("death5demod")];break;case 8:a=[getLangText("death6a"),getLangText("death6b")],s=[()=>{stopDeathFlutterAnim(),tweenFloatingDeath(.75,0,400,"Quad.easeOut",()=>{hideHandsTemp(),globalObjects.floatingDeath.visible=!0,globalObjects.floatingDeath2.visible=!0,globalObjects.deathLeftHand.visible=!1,globalObjects.deathRightHand.visible=!1,globalObjects.floatingDeath.alpha=.15,globalObjects.floatingDeath2.alpha=.15,globalObjects.floatingDeath.fakeAlpha=1,globalObjects.floatingDeath2.fakeAlpha=1,gameVars.deathFlutterDelay=350,repeatDeathFlutterAnimation(0)})},void 0];break;case 9:a=[getLangText("death7a"),getLangText("death7b"),getLangText("death7c"),getLangText("death7d"),getLangText("death7e"),getLangText("death7f")],s=[()=>{globalObjects.bannerTextManager.speedUpText()},()=>{playSound("slice_in",.4),playSound("enemy_attack",.68);var e=getBackgroundBlackout();e.setDepth(100).setAlpha(.5).setVisible(!0),screenShakeLong(2),PhaserScene.tweens.add({targets:e,alpha:0,duration:3e3,ease:"Quart.easeOut"}),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.height-160)},()=>{playSound("enemy_attack_2",.68)},()=>{var e=getBackgroundBlackout();e.setDepth(100).setAlpha(.4).setVisible(!0),PhaserScene.tweens.add({targets:e,alpha:0,duration:4e3}),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.halfHeight+10)}];break;case 10:a=[getLangText("death8a"),getLangText("death8b")];break;default:return void(t&&t())}playReaperDialog(a,s,t)}function playReaperDialog(e,t,a){globalObjects.bannerTextManager.setDialog(e),globalObjects.bannerTextManager.setDialogFunc(t);e=getFogSliceDarken();PhaserScene.tweens.add({targets:e,alpha:.5,ease:"Cubic.easeOut",duration:500}),globalObjects.bannerTextManager.showBanner(),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.halfHeight),globalObjects.bannerTextManager.setOnFinishFunc(a,100)}let CURRENT_LEVEL=null,levelTimeoutID=null;function beginPreLevel(a){if(2<a||1<a&&gameVars.maxLevel){let e,t=!1;sdkShowMidgameAd(()=>{e=createGlobalClickBlocker(!1),setTimeout(()=>{t||(t=!0,hideGlobalClickBlocker(),beginPreLevelTrue(a))},15e3)},()=>{t||(t=!0,hideGlobalClickBlocker(),beginPreLevelTrue(a))},()=>{t||(t=!0,hideGlobalClickBlocker(),beginPreLevelTrue(a))})}else beginPreLevelTrue(a)}function beginPreLevelTrue(i){gameVars.isInMainMenu=!1,gameVars.hasCheated=isUsingCheats(),updateCheatsDisplay(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton();let e,n,l,r,o,h,c;var g,d;let u;switch(0!==i&&switchLevelBackground(i),i){case 0:globalObjects.magicCircle.setWheelTint(),gameVars.latestLevel=0;var p=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setDepth(-1).setAlpha(0).setScale(500);e=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight-110,"ui","paper_half.png").setDepth(99999).setAlpha(0),u=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"ui","newgame_paper.png").setDepth(99999).setAlpha(0).setBlendMode(Phaser.BlendModes.MULTIPLY),(n=PhaserScene.add.text(gameConsts.halfWidth-253,gameConsts.halfHeight-288,getLangText("pre_fight_0a"),{fontFamily:"germania",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),(r=PhaserScene.add.text(gameConsts.halfWidth+137,gameConsts.halfHeight-185,getLangText("pre_fight_0c"),{fontFamily:"germania",fontSize:26,color:"#200000",align:"right"})).setDepth(99999).setAlpha(0).setOrigin(1,1),(o=PhaserScene.add.text(gameConsts.halfWidth+140,gameConsts.halfHeight-124,getLangText("pre_fight_0d"),{fontFamily:"germania",fontSize:26,color:"#200000",align:"right"})).setDepth(99999).setAlpha(0).setOrigin(1,1),(h=PhaserScene.add.text(r.x+10,r.y+1,getLangText("pre_fight_0e"),{fontFamily:"germania",fontSize:20,color:"#200000",align:"right"})).setDepth(99999).setAlpha(0).setOrigin(1,1).setVisible(!1),(c=PhaserScene.add.text(o.x+7,o.y,getLangText("pre_fight_0f"),{fontFamily:"germania",fontSize:18,color:"#200000",align:"right"})).setDepth(99999).setAlpha(0).setOrigin(1,.85).setVisible(!1),(g=PhaserScene.add.text(gameConsts.halfWidth+220,gameConsts.halfHeight-98,getLangText("pre_fight_0g"),{fontFamily:"germania",fontSize:26,color:"#200000",align:"right"})).setDepth(99999).setAlpha(0).setOrigin(1,0),(d=PhaserScene.add.text(gameConsts.halfWidth,gameConsts.halfHeight+238,getLangText("pre_fight_0i"),{fontFamily:"germania",fontSize:26,color:"#200000",align:"center"})).setDepth(99999).setAlpha(0).setOrigin(.5,0);let t=new Button({normal:{ref:"tut_btn.png",atlas:"buttons",x:gameConsts.halfWidth+81,y:r.y-84,alpha:.3},hover:{ref:"tut_btn_hover.png",atlas:"buttons",alpha:.6},press:{ref:"tut_btn_hover.png",atlas:"buttons",alpha:.6},disable:{alpha:0},onHover:()=>{PhaserScene.tweens.add({targets:r,alpha:0,duration:0}),h.visible=!0,h.alpha=0,PhaserScene.tweens.add({targets:h,alpha:.65,duration:0})},onHoverOut:()=>{r.locked||(r.visible=!0,PhaserScene.tweens.add({targets:r,alpha:.65,duration:150}),PhaserScene.tweens.add({targets:h,alpha:0,duration:150}))},onMouseUp:()=>{r.locked&&gameVars.wasTouch&&(h.visible=!h.visible,r.visible=!h.visible,PhaserScene.tweens.add({targets:r,alpha:r.visible?.65:0,duration:100}),PhaserScene.tweens.add({targets:h,alpha:h.visible?.65:0,duration:100})),r.locked=!0,t.setVisible(!1)}}),a=(t.setOrigin(.5,.5),t.setDepth(99999),t.setState(DISABLE),new Button({normal:{ref:"tut_btn.png",atlas:"buttons",x:gameConsts.halfWidth+81,y:o.y-84,alpha:.3},hover:{ref:"tut_btn_hover.png",atlas:"buttons",alpha:.6},press:{ref:"tut_btn_hover.png",atlas:"buttons",alpha:.6},disable:{alpha:0},onHover:()=>{o.alpha=0,c.visible=!0,c.alpha=.65},onHoverOut:()=>{o.locked||(o.visible=!0,PhaserScene.tweens.add({targets:o,alpha:.65,duration:0}),PhaserScene.tweens.add({targets:c,alpha:0,duration:0}))},onMouseUp:()=>{o.locked&&gameVars.wasTouch&&(c.visible=!c.visible,o.visible=!c.visible,PhaserScene.tweens.add({targets:o,alpha:o.visible?.65:0,duration:100}),PhaserScene.tweens.add({targets:c,alpha:c.visible?.65:0,duration:100})),o.locked=!0,a.setVisible(!1)}})),s=(a.setOrigin(.5,.5),a.setDepth(99999),a.setState(DISABLE),texts=[p,n,r,o,h,c,g,d,t,a],playSound("flip2"),PhaserScene.tweens.add({targets:texts,duration:500,ease:"Cubic.easeOut",y:"-=60"}),PhaserScene.tweens.add({targets:texts,alpha:.65,duration:650,onComplete:()=>{t.setState(NORMAL),a.setState(NORMAL)}}),[e,u]);PhaserScene.tweens.add({targets:e,alpha:1,duration:500,scaleX:1,scaleY:1.1,ease:"Cubic.easeOut",y:"-=60",onComplete:()=>{var e=texts.concat(s);createLvlCloseButton(i,e,20,-342,[t,a])}}),PhaserScene.tweens.add({targets:u,alpha:1,duration:500,scaleX:1,scaleY:1,ease:"Cubic.easeOut",y:"-=60"});break;case 2:globalObjects.magicCircle.setWheelTint(.1,.05,"usage_tint_b.png"),e=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","paper.png").setDepth(99999).setAlpha(0),u=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight,"ui","water_paper.png").setDepth(99999).setAlpha(0).setBlendMode(Phaser.BlendModes.MULTIPLY),(n=PhaserScene.add.text(gameConsts.halfWidth-246,gameConsts.halfHeight+110,getLangText("pre_fight_water"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),createGlobalClickBlocker(),fadeInPreFightStuff(i,[n],[e,u]);break;case 3:globalObjects.magicCircle.setWheelTint(.09,.02,"usage_tint_b.png"),e=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","paper.png").setDepth(99999).setAlpha(0),u=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","gobbo_paper.png").setDepth(99999).setAlpha(0).setBlendMode(Phaser.BlendModes.MULTIPLY),(n=PhaserScene.add.text(gameConsts.halfWidth-40,gameConsts.halfHeight-205,getLangText("pre_fight_1a"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),(r=PhaserScene.add.text(gameConsts.halfWidth-240,gameConsts.halfHeight+100,getLangText("pre_fight_1b"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setAlpha(0).setOrigin(0,0),createGlobalClickBlocker(),fadeInPreFightStuff(i,[n,r],[e,u]);break;case 4:globalObjects.magicCircle.setWheelTint(.08,.07,"usage_tint_b.png"),e=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","paper.png").setDepth(99999).setAlpha(0),u=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","tree_paper.png").setDepth(99999).setAlpha(0).setBlendMode(Phaser.BlendModes.MULTIPLY),(n=PhaserScene.add.text(gameConsts.halfWidth-246,gameConsts.halfHeight+165,getLangText("pre_fight_2a"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),createGlobalClickBlocker(),fadeInPreFightStuff(i,[n],[e,u]);break;case 5:globalObjects.magicCircle.setWheelTint(.06,.03,"usage_tint_b.png"),e=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","paper.png").setDepth(99999).setAlpha(0),u=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+40,"ui","magician_paper.png").setDepth(99999).setAlpha(0).setBlendMode(Phaser.BlendModes.MULTIPLY),(n=PhaserScene.add.text(gameConsts.halfWidth-248,gameConsts.halfHeight-180,getLangText("pre_fight_3a"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),(l=PhaserScene.add.text(gameConsts.halfWidth-36,gameConsts.halfHeight+80,getLangText("pre_fight_3b"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),createGlobalClickBlocker(),fadeInPreFightStuff(i,[n,l],[e,u]);break;case 6:globalObjects.magicCircle.setWheelTint(),e=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","paper.png").setDepth(99999).setAlpha(0),u=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","statue_paper.png").setDepth(99999).setAlpha(0).setBlendMode(Phaser.BlendModes.MULTIPLY),(n=PhaserScene.add.text(gameConsts.halfWidth-246,gameConsts.halfHeight+120,getLangText("pre_fight_3_5a"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),createGlobalClickBlocker(),fadeInPreFightStuff(i,[n],[e,u]);break;case 7:globalObjects.magicCircle.setWheelTint(.07,.05),e=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","paper.png").setDepth(99999).setAlpha(0),u=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","knight_paper.png").setDepth(99999).setAlpha(0).setBlendMode(Phaser.BlendModes.MULTIPLY),(n=PhaserScene.add.text(gameConsts.halfWidth-246,gameConsts.halfHeight+115,getLangText("pre_fight_4a"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),(l=PhaserScene.add.text(gameConsts.halfWidth-246,gameConsts.halfHeight+200,getLangText("pre_fight_4c"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),createGlobalClickBlocker(),fadeInPreFightStuff(i,[n,l],[e,u],!0);break;case 8:globalObjects.magicCircle.setWheelTint(),e=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","paper.png").setDepth(99999).setAlpha(0),u=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","wall_paper.png").setDepth(99999).setAlpha(0).setBlendMode(Phaser.BlendModes.MULTIPLY),(n=PhaserScene.add.text(gameConsts.halfWidth-246,gameConsts.halfHeight+55,getLangText("pre_fight_5a"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),(l=PhaserScene.add.text(gameConsts.halfWidth-246,gameConsts.halfHeight+160,getLangText("pre_fight_5b"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),createGlobalClickBlocker(),fadeInPreFightStuff(i,[n,l],[e,u]);break;case 9:globalObjects.magicCircle.setWheelTint(),beginLevel(i);break;case 10:globalObjects.magicCircle.setWheelTint(.07,.05),e=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","paper.png").setDepth(99999).setAlpha(0),u=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","mantis_paper.png").setDepth(99999).setAlpha(0).setBlendMode(Phaser.BlendModes.MULTIPLY),(n=PhaserScene.add.text(gameConsts.halfWidth-246,gameConsts.halfHeight+65,getLangText("pre_fight_7a"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),(l=PhaserScene.add.text(gameConsts.halfWidth-246,gameConsts.halfHeight+140,getLangText("pre_fight_7b"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),createGlobalClickBlocker(),fadeInPreFightStuff(i,[n,l],[e,u]);break;case 11:globalObjects.magicCircle.setWheelTint(.03,.08,"usage_tint_r.png"),e=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","paper.png").setDepth(99999).setAlpha(0),u=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+35,"ui","robot_paper.png").setDepth(99999).setAlpha(0).setBlendMode(Phaser.BlendModes.MULTIPLY),(n=PhaserScene.add.text(gameConsts.halfWidth-246,gameConsts.halfHeight+140,getLangText("pre_fight_8a"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),(l=PhaserScene.add.text(gameConsts.halfWidth-246,gameConsts.halfHeight+220,getLangText("pre_fight_8b"),{fontFamily:"garamondbold",fontSize:26,color:"#200000",align:"left"})).setDepth(99999).setOrigin(0,0).setAlpha(0),createGlobalClickBlocker(),fadeInPreFightStuff(i,[n,l],[e,u]);break;default:beginLevel(i)}}function fadeInPreFightStuff(t,a,s,i){playSound("flip2"),PhaserScene.tweens.add({targets:a,duration:500,ease:"Cubic.easeOut",y:"-=60"}),PhaserScene.tweens.add({delay:200,targets:a,alpha:.65,duration:450}),PhaserScene.tweens.add({targets:s,alpha:1,duration:500,scaleX:1,scaleY:1,ease:"Cubic.easeOut",y:"-=60",onComplete:()=>{var e=a.concat(s);createLvlCloseButton(t,e,void 0,void 0,void 0,i),createMenuCloseButton(e)}})}function createLvlCloseButton(e,t,a=0,s=0,i=[],n=!1){let l=new Button({normal:{ref:"menu_btn_normal.png",atlas:"buttons",x:gameConsts.halfWidth+130+a,y:gameConsts.height-110+s},hover:{ref:"menu_btn_hover.png",atlas:"buttons"},press:{ref:"menu_btn_press.png",atlas:"buttons"},disable:{alpha:0},onHover:()=>{playSound("click"),canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{playSound("button_click"),canvas&&(canvas.style.cursor="default");for(let e=0;e<i.length;e++)i[e].destroy();PhaserScene.tweens.add({targets:t,alpha:0,duration:400,ease:"Quad.easeOut",y:"+=40",onComplete:()=>{for(let e=0;e<t.length;e++)t[e].destroy()}}),l.destroy(),globalObjects.menuCloseButton&&globalObjects.menuCloseButton.destroy(),hideGlobalClickBlocker(),beginLevel(e),n&&globalObjects.magicCircle.disableMovement()}});return l.setOrigin(.5,.5),l.addText(getLangText("cont_ui"),{fontFamily:"germania",fontSize:28,color:"#000000",align:"left"}),l.setScale(.78),l.setDepth(99999),l.level=e,globalObjects.lvlCloseButton=l}function createMenuCloseButton(t){let e=new Button({normal:{ref:"menu_btn_normal.png",atlas:"buttons",x:gameConsts.halfWidth-130,y:gameConsts.height-110},hover:{ref:"menu_btn_hover.png",atlas:"buttons"},press:{ref:"menu_btn_hover.png",atlas:"buttons"},disable:{alpha:0},onHover:()=>{playSound("button_hover").detune=30-Math.floor(60*Math.random()),canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{playSound("button_click"),canvas&&(canvas.style.cursor="default"),PhaserScene.tweens.add({targets:t,alpha:0,duration:400,ease:"Quad.easeOut",y:"+=40",onComplete:()=>{for(let e=0;e<t.length;e++)t[e].destroy()}}),e.destroy(),globalObjects.lvlCloseButton&&globalObjects.lvlCloseButton.destroy(),gotoMainMenu(),hideGlobalClickBlocker()}});return e.setOrigin(.5,.5),e.addText(getLangText("menu"),{fontFamily:"germania",fontSize:28,color:"#000000",align:"left"}),e.setScale(.78),e.setDepth(99999),globalObjects.menuCloseButton=e}function switchLevelBackground(e){switch(e){case-99:let e=fadeInBackgroundAtlas("backgrounds","menu_back_battle.png",100,globalObjects.menuBack.scaleX,1.19*globalObjects.menuBack.startScale,1.2*globalObjects.menuBack.startScale,"Quint.easeInOut",0,!1,0,!0);e.setOrigin(.5,.5).setPosition(globalObjects.menuBack.x,globalObjects.menuBack.y).setScale(globalObjects.menuBack.scaleX,globalObjects.menuBack.scaleY).setDepth(-8),minorZoomMenu(),globalObjects.menuTop.setDepth(-7),PhaserScene.tweens.add({targets:e,scaleX:1.19*globalObjects.menuBack.startScale,scaleY:1.2*globalObjects.menuBack.startScale,y:gameConsts.halfHeight-110,ease:"Quint.easeInOut",alpha:1,duration:1500,onComplete:()=>{globalObjects.menuTop.setDepth(-9),globalObjects.menuBack.setFrame("menu_back_battle.png"),e.visible=!1}});break;case-8:switchBackground("grass_bg.webp"),fadeInBackgroundAtlas("backgrounds","menu_back_battle.png",1500,1,.935,.935,"Quart.easeIn",0,!0,-1);break;case-7:switchBackground("grave_bg.webp"),fadeInBackgroundAtlas("backgrounds","background8.webp",1500,1.01,1,1,"Quart.easeIn",0,!1,1);break;case-6:case-5:switchBackground("clock_bg.webp"),fadeInBackgroundAtlas("backgrounds","background4.png",1500,1,1,1,"Quart.easeIn",0,!1);break;case-4:switchBackground("forest_bg.webp"),fadeInBackgroundAtlas("backgrounds","background5.webp",1500,.95,.95,.95,"Quart.easeIn",0,!1,-10);break;case-3:switchBackground("forest_bg.webp"),fadeInBackgroundAtlas("backgrounds","background6.webp",1500,1.05,1.05,1.05,"Quart.easeIn",0,!1,-65);break;case-2:case-1:switchBackground("forest_bg.webp"),fadeInBackgroundAtlas("backgrounds","background6.webp",1500,1.05,1.05,1.05,"Quart.easeOut",0,!1,-12);break;case 0:let t=fadeInBackgroundAtlas("backgrounds","menu_back_battle.png",100,globalObjects.menuBack.scaleX,1.19*globalObjects.menuBack.startScale,1.2*globalObjects.menuBack.startScale,"Quint.easeInOut",0,!1,0,!0);t.setOrigin(.5,.5).setPosition(globalObjects.menuBack.x,globalObjects.menuBack.y).setScale(globalObjects.menuBack.scaleX,globalObjects.menuBack.scaleY).setDepth(-8),minorZoomMenu(),globalObjects.menuTop.setDepth(-7),PhaserScene.tweens.add({targets:t,scaleX:1.19*globalObjects.menuBack.startScale,scaleY:1.2*globalObjects.menuBack.startScale,y:gameConsts.halfHeight-110,ease:"Quint.easeInOut",alpha:1,duration:1500,onComplete:()=>{globalObjects.menuTop.setDepth(-9),globalObjects.menuBack.setFrame("menu_back_battle.png"),t.visible=!1}});break;case 1:clearOnlyMenuBack(),fadeInBackgroundAtlas("backgrounds","path.png",1500,.92,.91,.91,"Quart.easeOut",0,!1,0);break;case 2:switchBackground("forest_bg.webp"),fadeInBackgroundAtlas("backgrounds","backgroundwater.webp",1500,.92,.92,.92,"Quart.easeIn",0,!1,-10);break;case 3:switchBackground("forest_bg.webp"),fadeInBackgroundAtlas("backgrounds","background6.webp",1500,1.03,1.045,1.045,"Quart.easeIn",0,!1,-65);break;case 4:switchBackground("forest_bg.webp"),fadeInBackgroundAtlas("backgrounds","background5.webp",1500,.95,.95,.95,"Quart.easeIn",0,!1,-10);break;case 5:switchBackground("clock_bg.webp"),fadeInBackgroundAtlas("backgrounds","background4.png",1500,1,1,1,"Quart.easeIn",0,!1);break;case 6:switchBackground("grass_bg.webp"),fadeInBackgroundAtlas("backgrounds","menu_back_battle.png",1500,1,1,1,"Quart.easeIn",0,!1,1);break;case 7:switchBackground("grave_bg.webp"),fadeInBackgroundAtlas("backgrounds","background7.webp",1500,1.2,1.25,1.25,"Quart.easeIn",0,!1,1);break;case 8:switchBackground("grass_bg.webp"),fadeInBackgroundAtlas("backgrounds","menu_back_battle.png",1500,-1,-.94,.94,"Quart.easeIn",0,!1);break;case 9:switchBackground("grass_bg.webp"),fadeInBackgroundAtlas("backgrounds","menu_back_battle.png",1100,.935,.935,.935,"Quart.easeIn",0,!0,-1);break;case 10:switchBackground("grave_bg.webp"),fadeInBackgroundAtlas("backgrounds","background8.webp",1500,1,1,1,"Quart.easeIn",0,!1);break;case 11:switchBackground("tunnel.webp"),fadeInBackgroundAtlas("backgrounds","tunnel.png",1500,1,1,1,"Quart.easeIn",0,!1);break;case 12:switchBackground("clock_bg.webp"),globalObjects.magicCircle.setWheelTint(.03,.06,"usage_tint_b.png"),fadeInBackgroundAtlas("backgrounds","background4.png",2500,1,1,1,"Quart.easeIn",0,!1);break;case 13:case 14:case 15:break;default:switchBackground("clock_bg.webp")}}function beginLevel(e,t=!1){updateSpellState(CURRENT_LEVEL=e),globalObjects.player.resetStats(),messageBus.publish("manualResetElements",void 0,!0),messageBus.publish("manualResetEmbodiments",void 0,!0),globalObjects.magicCircle.buildRunes(),e<=1?switchLevelBackground(e):13===e?globalObjects.magicCircle.setWheelTint(.05,.06,"usage_tint_r.png"):14===e?globalObjects.magicCircle.setWheelTint(.05,.02,"usage_tint_b.png"):15<=e&&globalObjects.magicCircle.setWheelTint(.05,.04,"usage_tint_b.png"),playSound("whoosh"),(t?createEnemy:createEnemyAfterDelay)(e)}function createEnemyAfterDelay(e){let t=0!==e&&-99!==e?1200:0;levelTimeoutID=setTimeout(()=>{e===CURRENT_LEVEL&&(globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),createEnemy(e))},t)}function createTutorialBtn(e){switch(playSound("flip3"),globalObjects.runeHighlight||(globalObjects.runeHighlight=PhaserScene.add.sprite(0,0,"tutorial","rune_highlight8.png").setDepth(10001).setVisible(!1),globalObjects.runeHighlightRune=PhaserScene.add.sprite(gameConsts.halfWidth-206,gameConsts.halfHeight-200,"tutorial","rune_highlight8.png").setDepth(10001).setVisible(!1).setAlpha(.76),globalObjects.runeHighlightTemp=PhaserScene.add.image(0,0,"tutorial","rune_highlight8.png").setDepth(10002).setAlpha(0),globalObjects.runePictureFrame=PhaserScene.add.image(gameConsts.halfWidth-210,gameConsts.halfHeight-40,"tutorial","tut_border.png").setDepth(10002).setVisible(!1).setRotation(-.08),globalObjects.runePicture=PhaserScene.add.sprite(gameConsts.halfWidth-210,gameConsts.halfHeight-40,"tutorial","blank.png").setDepth(10002).setVisible(!1).setRotation(-.08).setScale(.856)),e){case 0:break;case 1:return buildTutorialButton("rune_matter_large.png",buildTutorialMatter);case 2:return buildTutorialButton("rune_energy_large.png",buildTutorialMind);case 4:return buildTutorialButton("rune_protect_large.png",buildTutorialProtect);case 5:return buildTutorialButton("rune_reinforce_large.png",buildTutorialReinforce);case 6:return buildTutorialButton("rune_time_large.png",buildTutorialTime);case 8:return buildTutorialButton("rune_void_large.png",buildTutorialVoid);case 9:return buildTutorialButton("rune_unload_large.png",buildTutorialUnload)}}function buildTutorialButton(e="rune_matter_large.png",t){var a=gameConsts.width-45,s=isMobile?140:130;let i=PhaserScene.add.sprite(90+a,s,"buttons","btn_small.png").setScale(.5,1).setDepth(130).setOrigin(.5,.5),n=PhaserScene.add.sprite(a,s,"blurry","icon_glow.png").setScale(.1).setDepth(130).setAlpha(0);e=PhaserScene.add.sprite(a,s,"tutorial",e).setScale(.05).setDepth(130);let l=PhaserScene.tweens.add({targets:[n],rotation:"+=6.283",duration:4e3,repeat:40,onComplete:()=>{PhaserScene.tweens.add({targets:[n],alpha:0,duration:4e3})}}),r;return(r=new Button({normal:{atlas:"buttons",ref:"btn_small.png",alpha:1,x:55+a,y:s},hover:{atlas:"buttons",ref:"btn_small_hover.png",alpha:1},press:{atlas:"buttons",ref:"btn_small_press.png",alpha:1},disable:{alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{showTutorialImage(),r.destroy(),n.destroy(),l.stop(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton(),t()}})).setDepth(129),r.setState(DISABLE),r.setOrigin(.5,.5),PhaserScene.tweens.add({targets:[i,n],scaleX:1,scaleY:1,alpha:1,easeParams:[5],ease:"Back.easeOut",duration:900,onComplete:()=>{r.isDestroyed||(r.setState(NORMAL),i.destroy())}}),PhaserScene.tweens.add({targets:[i],x:55+a,easeParams:[4],ease:"Back.easeOut",duration:900}),PhaserScene.tweens.add({targets:e,scaleX:.5,scaleY:.5,easeParams:[4],ease:"Back.easeOut",duration:1100}),r.addToDestructibles(e),r.addToDestructibles(i),r.addToDestructibles(n),r}function showTutorialImage(){playSound("flip2")}function buildTutorialBasic(e,t){messageBus.publish("pauseGame",.002),globalObjects.magicCircle.disableMovement();let a=PhaserScene.add.sprite(gameConsts.halfWidth-138,gameConsts.halfHeight-285,"tutorial","title.png").setDepth(1e4),s=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-100,"tutorial","popupTutorial.png").setScale(1).setAlpha(.5).setDepth(1e4),i=PhaserScene.add.sprite(gameConsts.halfWidth-124,gameConsts.halfHeight-193,"tutorial","plus_symbol.png").setScale(.96).setAlpha(.5).setDepth(1e4),n;(n=new Button({normal:{atlas:"buttons",ref:"btn_small.png",x:gameConsts.halfWidth+180,y:gameConsts.halfHeight+70,alpha:1,scaleX:1,scaleY:1},hover:{atlas:"buttons",ref:"btn_small_hover.png"},press:{atlas:"buttons",ref:"btn_small_press.png"},onMouseUp:()=>{messageBus.publish("unpauseGame"),globalObjects.magicCircle.enableMovement(),n.destroy(),globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),cleanupTutorialElements([a,s,i]),cleanupTutorialElements(e),cleanupTutorialElements(t,!0),globalObjects.runeHighlight.setVisible(!1).setScale(.96),globalObjects.runeHighlightTemp.setAlpha(0),globalObjects.runeHighlightRune.setAlpha(0),globalObjects.runePicture.setAlpha(0),globalObjects.runePictureFrame.setAlpha(0),PhaserScene.tweens.add({targets:[globalObjects.runePicture,globalObjects.runeHighlightTemp,globalObjects.runeHighlightRune],alpha:0,duration:1})}})).addText(getLangText("got_it"),{fontFamily:"germania",fontSize:30,color:"#000000",align:"center"}),n.setDepth(10002),PhaserScene.tweens.add({targets:[s,i],scaleX:1.02,scaleY:1.01,alpha:1,ease:"Back.easeOut",duration:1}),PhaserScene.tweens.add({targets:e,scaleX:1,scaleY:1,alpha:1,ease:"Back.easeOut",duration:1})}function buildRuneclicker(e,t,a){return new Button({normal:{ref:"blackPixel",x:e,y:t,alpha:.001,scaleX:50,scaleY:50},onHover:()=>{canvas&&(canvas.style.cursor="pointer"),globalObjects.runeHighlightTemp.setPosition(e,t).setAlpha(.25)},onHoverOut:()=>{canvas&&(canvas.style.cursor="default"),globalObjects.runeHighlightTemp.setAlpha(0)},onMouseUp:()=>{a(),globalObjects.runeHighlight.setPosition(e,t),globalObjects.runeHighlight.play("runeHighlight"),globalObjects.runeHighlight.alpha=1,globalObjects.runeHighlightRune.alpha=1,PhaserScene.tweens.add({delay:1,targets:globalObjects.runeHighlight,alpha:.85,duration:1}),PhaserScene.tweens.add({delay:1,targets:globalObjects.runeHighlight,alpha:.76,duration:1}),playSound(.5<Math.random()?"flip1":"flip2")}})}function buildClickblocker(){return new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:gameConsts.halfHeight,alpha:.3,scaleX:1e3,scaleY:1e3},onMouseUp:()=>{}})}function cleanupTutorialElements(t,e){if(e)for(let e=0;e<t.length;e++)t[e].destroy();else PhaserScene.tweens.add({targets:t,x:gameConsts.width-120,y:70,scaleX:.25,scaleY:.25,duration:600,ease:"Cubic.easeOut",alpha:0,onComplete:()=>{for(let e=0;e<t.length;e++)t[e].destroy()}})}function initRuneHighlight(e,t){globalObjects.runeHighlightRune.setVisible(!0).setScale(1),globalObjects.runeHighlight.setVisible(!0).setScale(1).setPosition(e,t),globalObjects.runeHighlight.play("runeHighlight"),globalObjects.runeHighlight.alpha=1,PhaserScene.tweens.add({delay:1,targets:globalObjects.runeHighlight,alpha:.9,duration:1})}function buildTutorialMatter(){var e=buildClickblocker();let t=getLangText("matter_tut_desc"),a=getLangText("matter_tut_strike_desc"),s=getLangText("matter_tut_enhance_desc"),i="rune_matter_large.png",n=PhaserScene.add.text(gameConsts.halfWidth-120,gameConsts.halfHeight-75,t,{fontFamily:"Verdana",fontSize:22,color:"#2A1122",align:"left"}).setDepth(10001).setOrigin(0,.34);globalObjects.runePicture.setVisible(!0).setAlpha(0).setScale(.96),globalObjects.runePictureFrame.setVisible(!0).setAlpha(0).setScale(.96),PhaserScene.tweens.add({delay:.25,targets:[n,globalObjects.runePictureFrame],alpha:1,scaleX:1,scaleY:1,duration:.5}),PhaserScene.tweens.add({delay:.25,targets:[globalObjects.runePicture],alpha:1,scaleX:.856,scaleY:.856,duration:.5}),globalObjects.runePicture.setFrame(i);var l=PhaserScene.add.text(gameConsts.halfWidth-143,gameConsts.halfHeight-285,"MATTER RUNE SPELLS",{fontFamily:"Verdana",fontSize:23,color:"#2A1122",align:"left"}).setScale(1).setDepth(10001).setOrigin(.5,.5),r=PhaserScene.add.sprite(gameConsts.halfWidth-205,gameConsts.halfHeight-200,"tutorial",i).setScale(.96).setAlpha(.5).setDepth(10001),o=buildRuneclicker(r.x,r.y,()=>{n.setText(t),globalObjects.runePicture.setFrame(i)}),h=PhaserScene.add.sprite(+gameConsts.halfWidth,gameConsts.halfHeight-200,"tutorial","rune_strike_large.png").setScale(.96).setAlpha(.5).setDepth(10001),c=buildRuneclicker(h.x,h.y,()=>{n.setText(a),globalObjects.runePicture.setFrame("tut_matter_strike.png").setRotation(-.08).setScale(.856)}),g=(initRuneHighlight(h.x,h.y),n.setText(a),globalObjects.runePicture.setFrame("tut_matter_strike.png").setRotation(-.08).setScale(.856),PhaserScene.add.sprite(gameConsts.halfWidth+150,gameConsts.halfHeight-200,"tutorial","rune_enhance_large.png").setScale(.96).setAlpha(.5).setDepth(10001)),d=buildRuneclicker(g.x,g.y,()=>{n.setText(s),globalObjects.runePicture.setFrame("tut_matter_enhance.png").setRotation(-.08).setScale(.856)});buildTutorialBasic([l,r,h,g,n],[o,c,d,e])}function buildTutorialMind(){var e=buildClickblocker();let t=getLangText("mind_tut_desc_sh"),a=getLangText("mind_tut_strike_desc"),s=getLangText("mind_tut_enhance_desc"),i="rune_energy_large.png",n=PhaserScene.add.text(gameConsts.halfWidth-120,gameConsts.halfHeight-75,t,{fontFamily:"Verdana",fontSize:22,color:"#2A1122",align:"left"}).setDepth(10001).setOrigin(0,.34);globalObjects.runePicture.setVisible(!0).setAlpha(0).setScale(.96),globalObjects.runePictureFrame.setVisible(!0).setAlpha(0).setScale(.96),PhaserScene.tweens.add({delay:.25,targets:[n,globalObjects.runePictureFrame],alpha:1,scaleX:1,scaleY:1,duration:.5}),PhaserScene.tweens.add({delay:.25,targets:[globalObjects.runePicture],alpha:1,scaleX:.856,scaleY:.856,duration:.5}),globalObjects.runePicture.setFrame(i);var l=PhaserScene.add.text(gameConsts.halfWidth-143,gameConsts.halfHeight-285,getLangText("energy_rune_spells"),{fontFamily:"germania",fontSize:26,color:"#2A1122",align:"left"}).setScale(1).setDepth(10001).setOrigin(.5,.5),r=PhaserScene.add.sprite(gameConsts.halfWidth-205,gameConsts.halfHeight-200,"tutorial",i).setScale(.96).setAlpha(.5).setDepth(10001),o=buildRuneclicker(r.x,r.y,()=>{n.setText(t),globalObjects.runePicture.setFrame(i)}),h=(n.setText(a),globalObjects.runePicture.setFrame("tut_mind_strike.png").setRotation(-.08).setScale(.856),PhaserScene.add.sprite(+gameConsts.halfWidth,gameConsts.halfHeight-200,"tutorial","rune_strike_large.png").setScale(.96).setAlpha(.5).setDepth(10001)),c=(initRuneHighlight(h.x,h.y),buildRuneclicker(h.x,h.y,()=>{n.setText(a),globalObjects.runePicture.setFrame("tut_mind_strike.png").setRotation(-.08).setScale(.856)})),g=PhaserScene.add.sprite(gameConsts.halfWidth+150,gameConsts.halfHeight-200,"tutorial","rune_enhance_large.png").setScale(.96).setAlpha(.5).setDepth(10001),d=buildRuneclicker(g.x,g.y,()=>{n.setText(s),globalObjects.runePicture.setFrame("tut_mind_enhance.png").setRotation(-.08).setScale(.856)});buildTutorialBasic([l,r,h,g,n],[o,c,d,e])}function buildTutorialTime(){var e=buildClickblocker();let t=getLangText("time_tut_desc_sh"),a=getLangText("time_tut_strike_desc"),s=getLangText("time_tut_enhance_desc"),i=getLangText("time_tut_protect_desc"),n=getLangText("time_tut_reinforce_desc"),l="rune_time_large.png",r=PhaserScene.add.text(gameConsts.halfWidth-120,gameConsts.halfHeight-75,t,{fontFamily:"Verdana",fontSize:22,color:"#2A1122",align:"left"}).setDepth(10001).setOrigin(0,.34);globalObjects.runePicture.setVisible(!0).setAlpha(0).setScale(.96),globalObjects.runePictureFrame.setVisible(!0).setAlpha(0).setScale(.96),PhaserScene.tweens.add({delay:.25,targets:[r,globalObjects.runePictureFrame],alpha:1,scaleX:1,scaleY:1,duration:.5}),PhaserScene.tweens.add({delay:.25,targets:[globalObjects.runePicture],alpha:1,scaleX:.856,scaleY:.856,duration:.5}),globalObjects.runePicture.setFrame(l);var o=PhaserScene.add.text(gameConsts.halfWidth-143,gameConsts.halfHeight-285,getLangText("time_rune_spells"),{fontFamily:"germania",fontSize:26,color:"#2A1122",align:"left"}).setScale(1).setDepth(10001).setOrigin(.5,.5),h=PhaserScene.add.sprite(gameConsts.halfWidth-205,gameConsts.halfHeight-200,"tutorial",l).setScale(.96).setAlpha(.5).setDepth(10001),c=buildRuneclicker(h.x,h.y,()=>{r.setText(t),globalObjects.runePicture.setFrame(l)}),g=PhaserScene.add.sprite(gameConsts.halfWidth-60,gameConsts.halfHeight-200,"tutorial","rune_strike_large.png").setScale(.96).setAlpha(.5).setDepth(10001),d=buildRuneclicker(g.x,g.y,()=>{r.setText(a),globalObjects.runePicture.setFrame("tut_time_strike.png").setRotation(-.08).setScale(.856)}),u=(initRuneHighlight(g.x,g.y),r.setText(a),globalObjects.runePicture.setFrame("tut_time_strike.png").setRotation(-.08).setScale(.856),PhaserScene.add.sprite(gameConsts.halfWidth+30,gameConsts.halfHeight-200,"tutorial","rune_enhance_large.png").setScale(.96).setAlpha(.5).setDepth(10001)),p=buildRuneclicker(u.x,u.y,()=>{r.setText(s),globalObjects.runePicture.setFrame("tut_time_enhance.png").setRotation(-.08).setScale(.856)}),m=PhaserScene.add.sprite(gameConsts.halfWidth+120,gameConsts.halfHeight-200,"tutorial","rune_protect_large.png").setScale(.96).setAlpha(.5).setDepth(10001),b=buildRuneclicker(m.x,m.y,()=>{r.setText(i),globalObjects.runePicture.setFrame("tut_time_shield.png").setRotation(-.08).setScale(.856)}),f=PhaserScene.add.sprite(gameConsts.halfWidth+210,gameConsts.halfHeight-200,"tutorial","rune_reinforce_large.png").setScale(.96).setAlpha(.5).setDepth(10001),S=buildRuneclicker(f.x,f.y,()=>{r.setText(n),globalObjects.runePicture.setFrame("tut_time_reinforce.png").setRotation(-.08).setScale(.856)});buildTutorialBasic([o,h,g,u,m,f,r],[c,d,p,b,S,e])}function buildTutorialVoid(){var e=buildClickblocker();let t=getLangText("void_tut_desc_sh"),a=getLangText("void_tut_strike_desc"),s=getLangText("void_tut_enhance_desc"),i=getLangText("void_tut_protect_desc"),n=getLangText("void_tut_reinforce_desc"),l="rune_void_large.png",r=PhaserScene.add.text(gameConsts.halfWidth-120,gameConsts.halfHeight-75,t,{fontFamily:"Verdana",fontSize:22,color:"#2A1122",align:"left"}).setDepth(10001).setOrigin(0,.34);globalObjects.runePicture.setVisible(!0).setAlpha(0).setScale(.96),globalObjects.runePictureFrame.setVisible(!0).setAlpha(0).setScale(.96),PhaserScene.tweens.add({delay:.25,targets:[r,globalObjects.runePictureFrame],alpha:1,scaleX:1,scaleY:1,duration:.5}),PhaserScene.tweens.add({delay:.25,targets:[globalObjects.runePicture],alpha:1,scaleX:.856,scaleY:.856,duration:.5}),globalObjects.runePicture.setFrame(l);var o=PhaserScene.add.text(gameConsts.halfWidth-143,gameConsts.halfHeight-285,getLangText("void_rune_spells"),{fontFamily:"germania",fontSize:26,color:"#2A1122",align:"left"}).setScale(1).setDepth(10001).setOrigin(.5,.5),h=PhaserScene.add.sprite(gameConsts.halfWidth-205,gameConsts.halfHeight-200,"tutorial",l).setScale(.96).setAlpha(.5).setDepth(10001),c=buildRuneclicker(h.x,h.y,()=>{r.setText(t),globalObjects.runePicture.setFrame(l)}),g=PhaserScene.add.sprite(gameConsts.halfWidth-60,gameConsts.halfHeight-200,"tutorial","rune_strike_large.png").setScale(.96).setAlpha(.5).setDepth(10001),d=buildRuneclicker(g.x,g.y,()=>{r.setText(a),globalObjects.runePicture.setFrame("tut_void_strike.png").setRotation(-.08).setScale(.856)}),u=(initRuneHighlight(g.x,g.y),r.setText(a),globalObjects.runePicture.setFrame("tut_void_strike.png").setRotation(-.08).setScale(.856),PhaserScene.add.sprite(gameConsts.halfWidth+30,gameConsts.halfHeight-200,"tutorial","rune_enhance_large.png").setScale(.96).setAlpha(.5).setDepth(10001)),p=buildRuneclicker(u.x,u.y,()=>{r.setText(s),globalObjects.runePicture.setFrame("tut_void_enhance.png").setRotation(-.08).setScale(.856)}),m=PhaserScene.add.sprite(gameConsts.halfWidth+120,gameConsts.halfHeight-200,"tutorial","rune_protect_large.png").setScale(.96).setAlpha(.5).setDepth(10001),b=buildRuneclicker(m.x,m.y,()=>{r.setText(i),globalObjects.runePicture.setFrame("tut_void_protect.png").setRotation(-.08).setScale(.856)}),f=PhaserScene.add.sprite(gameConsts.halfWidth+210,gameConsts.halfHeight-200,"tutorial","rune_reinforce_large.png").setScale(.96).setAlpha(.5).setDepth(10001),S=buildRuneclicker(f.x,f.y,()=>{r.setText(n),globalObjects.runePicture.setFrame("tut_void_reinforce.png").setRotation(-.08).setScale(.856)});buildTutorialBasic([o,h,g,u,m,f,r],[c,d,p,b,S,e])}function buildTutorialProtect(){var e=buildClickblocker();let t=getLangText("protect_tut_desc"),a=getLangText("matter_tut_protect_desc"),s=getLangText("mind_tut_protect_desc"),i=PhaserScene.add.text(gameConsts.halfWidth-120,gameConsts.halfHeight-75,t,{fontFamily:"Verdana",fontSize:22,color:"#2A1122",align:"left"}).setDepth(10001).setOrigin(0,.34).setAlpha(.5),n=(globalObjects.runePicture.setVisible(!0).setAlpha(.5).setScale(.96),globalObjects.runePictureFrame.setVisible(!0).setAlpha(0).setScale(.96),PhaserScene.tweens.add({targets:[i,globalObjects.runePicture,globalObjects.runePictureFrame],alpha:1,scaleX:1,scaleY:1,duration:.5}),"rune_protect_large.png");globalObjects.runePicture.setFrame(n);var l=PhaserScene.add.text(gameConsts.halfWidth-143,gameConsts.halfHeight-285,getLangText("shield_rune_spells"),{fontFamily:"germania",fontSize:26,color:"#2A1122",align:"left"}).setScale(1).setDepth(10001).setOrigin(.5,.5),r=PhaserScene.add.sprite(gameConsts.halfWidth-205,gameConsts.halfHeight-200,"tutorial",n).setScale(.96).setAlpha(.5).setDepth(10001),o=buildRuneclicker(r.x,r.y,()=>{i.setText(t),globalObjects.runePicture.setFrame(n)}),h=PhaserScene.add.sprite(+gameConsts.halfWidth,gameConsts.halfHeight-200,"tutorial","rune_matter_large.png").setScale(.96).setAlpha(.5).setDepth(10001),c=buildRuneclicker(h.x,h.y,()=>{i.setText(a),globalObjects.runePicture.setFrame("tut_matter_shield.png").setRotation(-.08).setScale(.856)}),g=(initRuneHighlight(h.x,h.y),i.setText(a),globalObjects.runePicture.setFrame("tut_matter_shield.png").setRotation(-.08).setScale(.856),PhaserScene.add.sprite(gameConsts.halfWidth+150,gameConsts.halfHeight-200,"tutorial","rune_energy_large.png").setScale(.96).setAlpha(.5).setDepth(10001)),d=buildRuneclicker(g.x,g.y,()=>{i.setText(s),globalObjects.runePicture.setFrame("tut_mind_shield.png").setRotation(-.08).setScale(.856)});buildTutorialBasic([l,r,h,g,i],[o,c,d,e])}function buildTutorialReinforce(){var e=buildClickblocker();let t=getLangText("reinforce_tut_desc_sh"),a=getLangText("matter_tut_reinforce_desc"),s=getLangText("mind_tut_reinforce_desc"),i=PhaserScene.add.text(gameConsts.halfWidth-120,gameConsts.halfHeight-75,t,{fontFamily:"Verdana",fontSize:22,color:"#2A1122",align:"left"}).setDepth(10001).setOrigin(0,.34),n=(globalObjects.runePicture.setVisible(!0).setAlpha(0).setScale(.96),globalObjects.runePictureFrame.setVisible(!0).setAlpha(0).setScale(.96),PhaserScene.tweens.add({delay:.25,targets:[i,globalObjects.runePictureFrame],alpha:1,scaleX:1,scaleY:1,duration:.5}),PhaserScene.tweens.add({delay:.25,targets:[globalObjects.runePicture],alpha:1,scaleX:.856,scaleY:.856,duration:.5}),"rune_reinforce_large.png");globalObjects.runePicture.setFrame(n);var l=PhaserScene.add.text(gameConsts.halfWidth-143,gameConsts.halfHeight-285,getLangText("body_rune_spells"),{fontFamily:"germania",fontSize:26,color:"#2A1122",align:"left"}).setScale(1).setDepth(10001).setOrigin(.5,.5),r=PhaserScene.add.sprite(gameConsts.halfWidth-205,gameConsts.halfHeight-200,"tutorial",n).setScale(.96).setAlpha(.5).setDepth(10001),o=buildRuneclicker(r.x,r.y,()=>{i.setText(t),globalObjects.runePicture.setFrame(n)}),h=PhaserScene.add.sprite(+gameConsts.halfWidth,gameConsts.halfHeight-200,"tutorial","rune_matter_large.png").setScale(.96).setAlpha(.5).setDepth(10001),c=buildRuneclicker(h.x,h.y,()=>{i.setText(a),globalObjects.runePicture.setFrame("tut_matter_reinforce.png").setRotation(-.08).setScale(.856)}),g=(initRuneHighlight(h.x,h.y),i.setText(a),globalObjects.runePicture.setFrame("tut_matter_reinforce.png").setRotation(-.08).setScale(.856),PhaserScene.add.sprite(gameConsts.halfWidth+150,gameConsts.halfHeight-200,"tutorial","rune_energy_large.png").setScale(.96).setAlpha(.5).setDepth(10001)),d=buildRuneclicker(g.x,g.y,()=>{i.setText(s),globalObjects.runePicture.setFrame("tut_mind_reinforce.png").setRotation(-.08).setScale(.856)});buildTutorialBasic([l,r,h,g,i],[o,c,d,e])}function buildTutorialUnload(){var e=buildClickblocker();let t=getLangText("unload_tut_desc"),a=getLangText("matter_tut_unload_desc"),s=getLangText("mind_tut_unload_desc"),i=getLangText("time_tut_unload_desc"),n=getLangText("void_tut_unload_desc"),l=PhaserScene.add.text(gameConsts.halfWidth-120,gameConsts.halfHeight-75,t,{fontFamily:"Verdana",fontSize:22,color:"#2A1122",align:"left"}).setDepth(10001).setOrigin(0,.34),r=(globalObjects.runePicture.setVisible(!0).setAlpha(0).setScale(.96),globalObjects.runePictureFrame.setVisible(!0).setAlpha(0).setScale(.96),PhaserScene.tweens.add({delay:.25,targets:[l,globalObjects.runePictureFrame],alpha:1,scaleX:1,scaleY:1,duration:.5}),PhaserScene.tweens.add({delay:.25,targets:[globalObjects.runePicture],alpha:1,scaleX:.856,scaleY:.856,duration:.5}),"rune_unload_large.png");globalObjects.runePicture.setFrame(r);var o=PhaserScene.add.text(gameConsts.halfWidth-143,gameConsts.halfHeight-285,getLangText("ultimate_rune_spells"),{fontFamily:"germania",fontSize:26,color:"#2A1122",align:"center"}).setScale(1).setDepth(10001).setOrigin(.5,.5),h=PhaserScene.add.sprite(gameConsts.halfWidth-205,gameConsts.halfHeight-200,"tutorial",r).setScale(.96).setAlpha(.5).setDepth(10001),c=buildRuneclicker(h.x,h.y,()=>{l.setText(t),globalObjects.runePicture.setFrame(r)}),g=PhaserScene.add.sprite(gameConsts.halfWidth-50,gameConsts.halfHeight-200,"tutorial","rune_matter_large.png").setScale(.96).setAlpha(.5).setDepth(10001),d=buildRuneclicker(g.x,g.y,()=>{l.setText(a),globalObjects.runePicture.setFrame("tut_matter_unload.png").setRotation(-.08).setScale(.856)}),u=(initRuneHighlight(g.x,g.y),l.setText(a),globalObjects.runePicture.setFrame("tut_matter_unload.png").setRotation(-.08).setScale(.856),PhaserScene.add.sprite(gameConsts.halfWidth+30,gameConsts.halfHeight-200,"tutorial","rune_energy_large.png").setScale(.96).setAlpha(.5).setDepth(10001)),p=buildRuneclicker(u.x,u.y,()=>{l.setText(s),globalObjects.runePicture.setFrame("tut_mind_unload.png").setRotation(-.08).setScale(.856)}),m=PhaserScene.add.sprite(gameConsts.halfWidth+110,gameConsts.halfHeight-200,"tutorial","rune_time_large.png").setScale(.96).setAlpha(.5).setDepth(10001),b=buildRuneclicker(m.x,m.y,()=>{l.setText(i),globalObjects.runePicture.setFrame("tut_time_unload.png").setRotation(-.08).setScale(.856)}),f=PhaserScene.add.sprite(gameConsts.halfWidth+190,gameConsts.halfHeight-200,"tutorial","rune_void_large.png").setScale(.96).setAlpha(.5).setDepth(10001),S=buildRuneclicker(f.x,f.y,()=>{l.setText(n),globalObjects.runePicture.setFrame("tut_void_unload.png").setRotation(-.08).setScale(.856)});buildTutorialBasic([o,h,g,u,m,f,l],[c,d,p,b,S,e])}class BgHandler{constructor(){this.goalX=gameConsts.halfWidth}}let useFirstBG=!0;function fadeInBackground(e,t=15e3,a=1){e=PhaserScene.add.image(gameConsts.halfWidth,.7*gameConsts.halfHeight,e).setDepth(-10).setScale(1.1).setAlpha(0).setOrigin(.5,.35);return e.setScale(a),PhaserScene.tweens.add({targets:e,alpha:1,duration:t}),useFirstBG?(globalObjects.background1&&globalObjects.background1.destroy(),globalObjects.background1=e,globalObjects.background1.velX=0):(globalObjects.background2&&globalObjects.background2.destroy(),globalObjects.background2=e,globalObjects.background2.velX=0),useFirstBG=!useFirstBG,e}function fadeInBackgroundAtlas(e,t,a=15e3,s=1.1,i,n,l,r,o,h=0,c=!1){let g=PhaserScene.add.image(gameConsts.halfWidth,.7*gameConsts.halfHeight+h,e,t).setDepth(-10).setScale(s,Math.abs(s)).setAlpha(0).setOrigin(.5,.35);return c||(PhaserScene.tweens.add({delay:r,targets:g,alpha:1,ease:l,duration:a}),void 0!==i&&PhaserScene.tweens.add({delay:r,targets:g,scaleX:o?i+.1:i,scaleY:o?n+.1:n,ease:l||"Cubic.easeOut",duration:a+1e3,onComplete:()=>{PhaserScene.tweens.add({targets:g,scaleX:i,scaleY:n,ease:"Cubic.easeOut",duration:500})}})),useFirstBG?(globalObjects.background2&&globalObjects.background2.setDepth(-11),globalObjects.background1&&globalObjects.background1.destroy(),globalObjects.background1=g):(globalObjects.background1&&globalObjects.background1.setDepth(-11),globalObjects.background2&&globalObjects.background2.destroy(),globalObjects.background2=g),useFirstBG=!useFirstBG,g}function zoomInCurrBackground(e,t,a){let s;s=useFirstBG?globalObjects.background2:globalObjects.background1,PhaserScene.tweens.add({targets:s,scaleX:t,scaleY:t,ease:a,duration:e})}let RUNE_TIME="rune_time",RUNE_MIND="rune_mind",RUNE_MATTER="rune_matter",RUNE_VOID="rune_void",RUNE_ENHANCE="rune_enhance",RUNE_PROTECT="rune_protect",RUNE_REINFORCE="rune_reinforce",RUNE_STRIKE="rune_strike",RUNE_UNLOAD="rune_unload",highestLevel=0,ELEMENT_ARRAY=[RUNE_MATTER,RUNE_MATTER,null,null,null,null,null],EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,null,null,null,null,null,null,null,null];function updateSpellState(e){if(cheats.fullArsenal)EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,RUNE_PROTECT,RUNE_ENHANCE,RUNE_UNLOAD,RUNE_REINFORCE,RUNE_ENHANCE,RUNE_PROTECT,RUNE_STRIKE],ELEMENT_ARRAY=[RUNE_MATTER,RUNE_MIND,RUNE_TIME,RUNE_VOID,RUNE_MATTER,RUNE_MIND,RUNE_TIME];else switch(highestLevel=e,gameVars.matterPlus=!1,gameVars.mindPlus=!1,e){case-7:EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,RUNE_PROTECT,RUNE_ENHANCE,null,RUNE_ENHANCE,RUNE_REINFORCE,RUNE_ENHANCE,RUNE_STRIKE],ELEMENT_ARRAY=[RUNE_VOID,RUNE_VOID,RUNE_MATTER,null,null,RUNE_VOID,RUNE_VOID];break;case-6:case-5:EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,RUNE_PROTECT,RUNE_ENHANCE,null,RUNE_ENHANCE,RUNE_ENHANCE,RUNE_REINFORCE,RUNE_STRIKE],ELEMENT_ARRAY=[RUNE_TIME,RUNE_TIME,RUNE_TIME,RUNE_TIME,RUNE_MATTER,null,null];break;case-4:EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,RUNE_REINFORCE,null,null,null,null,null,RUNE_REINFORCE],ELEMENT_ARRAY=[RUNE_MATTER,RUNE_MIND,null,null,null,null,null];break;case-3:EMBODIMENT_ARRAY=[null,RUNE_PROTECT,null,RUNE_PROTECT,null,null,RUNE_PROTECT,null,RUNE_PROTECT],ELEMENT_ARRAY=[RUNE_MIND,RUNE_MIND,null,null,null,RUNE_MATTER,RUNE_MATTER];break;case-2:case-1:EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,RUNE_ENHANCE,null,null,null,null,RUNE_ENHANCE,RUNE_STRIKE],ELEMENT_ARRAY=[RUNE_MATTER,RUNE_MIND,null,null,null,null,RUNE_MIND];break;case 0:EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,null,null,null,null,null,null,null],ELEMENT_ARRAY=[RUNE_MATTER,RUNE_MATTER,null,null,null,null,null];break;case 1:EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,RUNE_ENHANCE,null,null,null,null,null,RUNE_ENHANCE],ELEMENT_ARRAY=[RUNE_MATTER,RUNE_MATTER,RUNE_MATTER,null,null,null,null];break;case 2:EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,RUNE_ENHANCE,null,null,null,null,RUNE_ENHANCE,RUNE_STRIKE],ELEMENT_ARRAY=[RUNE_MATTER,RUNE_MIND,null,null,null,null,RUNE_MIND];break;case 3:EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,RUNE_ENHANCE,null,null,null,null,RUNE_ENHANCE,RUNE_STRIKE],ELEMENT_ARRAY=[RUNE_MATTER,RUNE_MIND,RUNE_MATTER,null,null,null,RUNE_MIND];break;case 4:EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,RUNE_PROTECT,RUNE_ENHANCE,null,null,RUNE_ENHANCE,RUNE_PROTECT,RUNE_STRIKE],ELEMENT_ARRAY=[RUNE_MATTER,RUNE_MIND,RUNE_MATTER,null,null,RUNE_MATTER,RUNE_MIND];break;case 5:EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,RUNE_PROTECT,RUNE_ENHANCE,null,RUNE_REINFORCE,RUNE_ENHANCE,RUNE_PROTECT,RUNE_STRIKE],ELEMENT_ARRAY=[RUNE_MATTER,RUNE_MIND,RUNE_MATTER,null,null,RUNE_MATTER,RUNE_MIND];break;case 6:case 7:EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,RUNE_PROTECT,RUNE_ENHANCE,null,RUNE_REINFORCE,RUNE_ENHANCE,RUNE_PROTECT,RUNE_STRIKE],ELEMENT_ARRAY=[RUNE_MATTER,RUNE_MIND,RUNE_TIME,null,RUNE_MATTER,RUNE_MIND,RUNE_TIME];break;case 8:case-8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:EMBODIMENT_ARRAY=[RUNE_STRIKE,RUNE_STRIKE,RUNE_PROTECT,RUNE_ENHANCE,null,RUNE_REINFORCE,RUNE_ENHANCE,RUNE_PROTECT,RUNE_STRIKE],ELEMENT_ARRAY=[RUNE_MATTER,RUNE_MIND,RUNE_TIME,null,RUNE_MATTER,RUNE_MIND,RUNE_TIME]}cheats.extraUlt&&(EMBODIMENT_ARRAY[0]=RUNE_UNLOAD)}function createAnimations(e){e.anims.create({key:"dummyblink",frames:e.anims.generateFrameNames("enemies",{prefix:"lesser_dummy_eyes",suffix:".png",start:1,end:7,zeroPad:0}),frameRate:20}),e.anims.create({key:"dummylook",frames:e.anims.generateFrameNames("enemies",{prefix:"lesser_dummy_eyes",suffix:".png",start:4,end:9,zeroPad:0}),frameRate:15}),e.anims.create({key:"dummysmile",frames:e.anims.generateFrameNames("enemies",{prefix:"lesser_dummy_mouth",suffix:".png",start:1,end:9,zeroPad:0}),frameRate:30}),e.anims.create({key:"exclamation",frames:e.anims.generateFrameNames("misc",{prefix:"exclamation",suffix:".png",start:1,end:2,zeroPad:0}),frameRate:3,repeat:-1}),e.anims.create({key:"gobboshield",frames:e.anims.generateFrameNames("enemies",{prefix:"gobboshield",suffix:".png",start:1,end:2,zeroPad:0}),frameRate:2,repeat:-1}),e.anims.create({key:"gobboshock",frames:e.anims.generateFrameNames("enemies",{prefix:"gobbo_elec",suffix:".png",start:1,end:2,zeroPad:0}),repeat:1,frameRate:12}),e.anims.create({key:"gobboextinguish",frames:e.anims.generateFrameNames("enemies",{prefix:"gobbo_extinguish",suffix:".png",start:1,end:2,zeroPad:0}),frameRate:5,repeat:2}),e.anims.create({key:"gobboshieldfire",frames:e.anims.generateFrameNames("enemies",{prefix:"gobbo_fire",suffix:".png",start:1,end:2,zeroPad:0}),frameRate:5,repeat:-1}),e.anims.create({key:"gobboknock2",frames:e.anims.generateFrameNames("enemies",{prefix:"gobbo_knock",suffix:".png",start:1,end:2,zeroPad:0}),frameRate:6}),e.anims.create({key:"gobboknock3",frames:e.anims.generateFrameNames("enemies",{prefix:"gobbo_knock",suffix:".png",start:1,end:3,zeroPad:0}),frameRate:8}),e.anims.create({key:"gobboknock4",frames:e.anims.generateFrameNames("enemies",{prefix:"gobbo_knock",suffix:".png",start:1,end:4,zeroPad:0}),frameRate:10}),e.anims.create({key:"waterhole",frames:e.anims.generateFrameNames("water",{prefix:"water_hole",suffix:".png",start:1,end:2,zeroPad:1}),repeat:0,frameRate:20}),e.anims.create({key:"waterhole2",frames:e.anims.generateFrameNames("water",{prefix:"water_hole",suffix:".png",start:2,end:3,zeroPad:1}),repeat:0,frameRate:15}),e.anims.create({key:"wateremerge",frames:e.anims.generateFrameNames("water",{prefix:"water_emerge",suffix:".png",start:1,end:3,zeroPad:0}),repeat:0,frameRate:12}),e.anims.create({key:"wateranim",frames:e.anims.generateFrameNames("water",{prefix:"frame",suffix:".png",start:0,end:30,zeroPad:4}),repeat:-1,frameRate:10}),e.anims.create({key:"wateranimfast",frames:e.anims.generateFrameNames("water",{prefix:"frame",suffix:".png",start:0,end:30,zeroPad:4}),repeat:-1,frameRate:30}),e.anims.create({key:"waterelec",frames:e.anims.generateFrameNames("water",{prefix:"water_elec",suffix:".png",start:0,end:4,zeroPad:0}),repeat:0,frameRate:16}),e.anims.create({key:"waterelecsmall",frames:e.anims.generateFrameNames("water",{prefix:"water_elec",suffix:".png",start:4,end:5,zeroPad:0}),repeat:0,frameRate:7}),e.anims.create({key:"lightningbolt",frames:e.anims.generateFrameNames("spells",{prefix:"lightningBolt",suffix:".png",start:1,end:2,zeroPad:0}),frameRate:10,repeat:-1}),e.anims.create({key:"angry",frames:e.anims.generateFrameNames("misc",{prefix:"angry",suffix:".png",start:1,end:2,zeroPad:0}),frameRate:3,repeat:-1}),e.anims.create({key:"angrybone",frames:e.anims.generateFrameNames("misc",{prefix:"bone",suffix:".png",start:1,end:2,zeroPad:0}),frameRate:2,repeat:-1}),e.anims.create({key:"mindBurn",frames:e.anims.generateFrameNames("spells",{prefix:"mindBurn",suffix:".png",start:1,end:6,zeroPad:0}),frameRate:15,repeat:-1}),e.anims.create({key:"mindBurnSlow",frames:e.anims.generateFrameNames("spells",{prefix:"mindBurn",suffix:".png",start:1,end:6,zeroPad:0,yoyo:!0}),frameRate:6,repeat:-1}),e.anims.create({key:"damageEffect",frames:e.anims.generateFrameNames("spells",{prefix:"damageEffect",suffix:".png",start:0,end:9,zeroPad:0}),frameRate:60}),e.anims.create({key:"damageEffectShort",frames:e.anims.generateFrameNames("spells",{prefix:"damageEffectShort",suffix:".png",start:0,end:4,zeroPad:0}),frameRate:45}),e.anims.create({key:"shockEffect",frames:e.anims.generateFrameNames("spells",{prefix:"shockEffect",suffix:".png",start:1,end:10,zeroPad:0}),frameRate:30}),e.anims.create({key:"shieldHit",frames:e.anims.generateFrameNames("shields",{prefix:"shield",suffix:".png",start:2,end:10,zeroPad:0}),frameRate:30}),e.anims.create({key:"shieldFlash",frames:e.anims.generateFrameNames("shields",{prefix:"shield",suffix:".png",start:1,end:10,zeroPad:0}),frameRate:20}),e.anims.create({key:"disco",frames:e.anims.generateFrameNames("shields",{prefix:"frame",suffix:".png",start:0,end:25,zeroPad:4}),repeat:-1,frameRate:30}),e.anims.create({key:"btnFlash",frames:e.anims.generateFrameNames("shields",{prefix:"btnFlash",suffix:".png",start:1,end:13,zeroPad:0}),frameRate:24}),e.anims.create({key:"handShieldFull",frames:e.anims.generateFrameNames("shields",{prefix:"handshield",suffix:".png",start:3,end:9,zeroPad:0}),frameRate:30}),e.anims.create({key:"handShieldFast",frames:e.anims.generateFrameNames("shields",{prefix:"handshield",suffix:".png",start:4,end:9,zeroPad:0}),frameRate:30}),e.anims.create({key:"ring_flash",frames:e.anims.generateFrameNames("shields",{prefix:"ring_flash",suffix:".png",start:0,end:12,zeroPad:0}),frameRate:30}),e.anims.create({key:"circleEffect",frames:e.anims.generateFrameNames("circle",{prefix:"circleEffect",suffix:".png",start:1,end:10,zeroPad:0}),frameRate:10}),e.anims.create({key:"circleBlast",frames:e.anims.generateFrameNames("lowq",{prefix:"circle_blue",suffix:".png",start:0,end:4,zeroPad:0}),frameRate:5}),e.anims.create({key:"circleEffectSmall",frames:e.anims.generateFrameNames("circle",{prefix:"circleEffect",suffix:".png",start:4,end:10,zeroPad:0}),frameRate:10}),e.anims.create({key:"blastEffect",frames:e.anims.generateFrameNames("circle",{prefix:"blastEffect",suffix:".png",start:0,end:6,zeroPad:0}),frameRate:24}),e.anims.create({key:"powerEffect",frames:e.anims.generateFrameNames("spells",{prefix:"shockEffect",suffix:".png",start:1,end:10,zeroPad:0}),frameRate:20}),e.anims.create({key:"powerEffectRepeat",frames:e.anims.generateFrameNames("spells",{prefix:"shockEffect",suffix:".png",start:5,end:10,zeroPad:0}),frameRate:20,repeat:-1,repeatDelay:1e3}),e.anims.create({key:"scytheFlash",frames:e.anims.generateFrameNames("misc",{prefix:"scytheflash",suffix:".png",start:1,end:7,zeroPad:0}),frameRate:10}),e.anims.create({key:"scythePause",frames:e.anims.generateFrameNames("misc",{prefix:"scythe",suffix:".png",start:1,end:5,zeroPad:0}),frameRate:15}),e.anims.create({key:"scytheResume",frames:e.anims.generateFrameNames("misc",{prefix:"scythe",suffix:".png",start:5,end:8,zeroPad:0}),frameRate:15}),e.anims.create({key:"scytheReap",frames:e.anims.generateFrameNames("misc",{prefix:"scythe",suffix:".png",start:1,end:8,zeroPad:0}),frameRate:15}),e.anims.create({key:"weaken",frames:e.anims.generateFrameNames("spells",{prefix:"weakenLines_",suffix:".png",start:0,end:1,zeroPad:2}),frameRate:3,repeat:-1}),e.anims.create({key:"energyTarget",frames:e.anims.generateFrameNames("spells",{prefix:"energyTarget",suffix:".png",start:7,end:8,zeroPad:1}),frameRate:2,repeat:-1}),e.anims.create({key:"energyTargetExplode",frames:e.anims.generateFrameNames("spells",{prefix:"energyTarget",suffix:".png",start:5,end:8,zeroPad:1}),frameRate:20}),e.anims.create({key:"runeHighlight",frames:e.anims.generateFrameNames("tutorial",{prefix:"rune_highlight",suffix:".png",start:1,end:8,zeroPad:1}),frameRate:15e3})}let loadObjects={},castButton,loadingIcons=[],loadingIconsFlash=[],icons=[],canFinishLoading=!1,loadLevel=0,MAGIC_CIRCLE_HEIGHT=0,canvas;function setupLoadingBar(a){PhaserScene.cameras.main.setZoom(.98);var e=gameConsts.height-(isMobile?108:100),e=(loadObjects.version=a.add.text(4,gameConsts.height-4,gameVersion).setOrigin(0,1).setAlpha(.7),loadObjects.loadingSpinner=a.add.image(gameConsts.halfWidth,e,"loadingSpinner"),loadObjects.castButton=a.add.image(gameConsts.halfWidth,e,"castNormal"),loadObjects.castButton.scrollFactorX=.35,loadObjects.castButton.scrollFactorY=.35,loadObjects.loadingSpinner.scrollFactorX=.35,loadObjects.loadingSpinner.scrollFactorY=.35,loadObjects.version.scrollFactorX=0,loadObjects.version.scrollFactorY=0,loadObjects.introLocket=a.add.image(gameConsts.halfWidth,gameConsts.halfHeight-115,"introLocket").setScale(.75).setAlpha(0).setDepth(1001).setOrigin(.5,.65),loadObjects.introLocket.currAnim=PhaserScene.tweens.add({targets:loadObjects.introLocket,alpha:1,scaleX:.5,scaleY:.5,ease:"Cubic.easeOut",duration:1500}),icons.push(a.add.image(gameConsts.halfWidth,e,"runeMatterPre")),icons.push(a.add.image(gameConsts.halfWidth,e,"runeMindPre")),icons.push(a.add.image(gameConsts.halfWidth,e,"runeTimePre")),icons.push(a.add.image(gameConsts.halfWidth,e,"runeVoidPre")),icons.push(a.add.image(gameConsts.halfWidth,e,"runeStrikePre")),icons.push(a.add.image(gameConsts.halfWidth,e,"runeEnhancePre")),icons.push(a.add.image(gameConsts.halfWidth,e,"runeProtectPre")),icons.push(a.add.image(gameConsts.halfWidth,e,"runeReinforcePre")),icons.push(a.add.image(gameConsts.halfWidth,e,"runeUnloadPre")),gameConsts.halfHeight+20);loadingIcons.push(a.add.image(gameConsts.halfWidth-160,e,"runeMatterPre")),loadingIcons.push(a.add.image(gameConsts.halfWidth-120,e,"runeMindPre")),loadingIcons.push(a.add.image(gameConsts.halfWidth-80,e,"runeTimePre")),loadingIcons.push(a.add.image(gameConsts.halfWidth-40,e,"runeVoidPre")),loadingIcons.push(a.add.image(gameConsts.halfWidth,e,"runeStrikePre")),loadingIcons.push(a.add.image(gameConsts.halfWidth+40,e,"runeEnhancePre")),loadingIcons.push(a.add.image(gameConsts.halfWidth+80,e,"runeProtectPre")),loadingIcons.push(a.add.image(gameConsts.halfWidth+120,e,"runeReinforcePre")),loadingIcons.push(a.add.image(gameConsts.halfWidth+160,e,"runeUnloadPre"));for(let e=0;e<loadingIcons.length;e++){var t=loadingIcons[e],s=a.add.image(t.x,t.y,t.texture.key);loadingIconsFlash.push(s),t.setOrigin(.5,.123),s.setOrigin(.5,.123),s.alpha=0,t.alpha=0}for(let e=0;e<icons.length;e++)icons[e].alpha=0,icons[e].setDepth(201),icons[e].setOrigin(.5,.85),icons[e].setScale(1.25,1.75),icons[e].rotation=e/icons.length*Math.PI*2,icons[e].startRotation=icons[e].rotation,icons[e].scrollFactorX=.3,icons[e].scrollFactorY=.3;loadObjects.loadingText=a.add.text(gameConsts.halfWidth,gameConsts.height-(isMobile?342:328),"Loading...",{fontFamily:"germania",fontSize:36,color:"#FFFFFF",align:"center"}).setDepth(1001),loadObjects.loadingText.setScale(.6).setAlpha(.93),loadObjects.loadingText.setAlign("center"),loadObjects.loadingText.setOrigin(.5,0),loadObjects.loadingText.scrollFactorX=.3,loadObjects.loadingText.scrollFactorY=.3;var e=[getLangText("Matter_rune_short"),getLangText("Strike_rune_short"),getLangText("Enhance_rune_short"),getLangText("Energy_rune_short"),getLangText("Shield_rune_short"),getLangText("Body_rune_short"),getLangText("Time_rune_short"),getLangText("Void_rune_short"),getLangText("Ultimate_rune_short"),getLangText("Strike_rune_short")],i=["runeMatterPre","runeStrikePre","runeEnhancePre","runeMindPre","runeProtectPre","runeReinforcePre","runeTimePre","runeVoidPre","runeUnloadPre","runeStrikePre"],n=Math.min(e.length-1,gameVars.maxLevel)+1,n=Math.floor(Math.random()*n);loadObjects.loadingText.setText(e[n]),loadObjects.loadingIcon=a.add.image(loadObjects.loadingText.x,loadObjects.loadingText.y+45,i[n]).setOrigin(.5,.25).setAlpha(0),loadObjects.loadingIcon2=a.add.image(loadObjects.loadingText.x,loadObjects.loadingText.y+45,i[n]).setOrigin(.5,.25).setAlpha(0),loadObjects.loadingIcon.x=loadObjects.loadingText.x-.25*loadObjects.loadingText.width-60,loadObjects.loadingIcon2.x=loadObjects.loadingText.x+.25*loadObjects.loadingText.width+60,loadObjects.loadingIcon.y=loadObjects.loadingText.y+.4*loadObjects.loadingText.height+9,loadObjects.loadingIcon2.y=loadObjects.loadingIcon.y,PhaserScene.tweens.add({targets:[loadObjects.loadingIcon,loadObjects.loadingIcon2],alpha:1,duration:300}),loadObjects.loadingSpinner.setDepth(200),loadObjects.castButton.setDepth(200),a.load.on("progress",function(e){for(;loadLevel<=8.85*e;){loadObjects.loadingSpinner.goalRot=loadLevel*-Math.PI/4.5;let e=icons[loadLevel];var a=loadingIcons[loadLevel];let t=loadingIconsFlash[loadLevel];PhaserScene.tweens.add({targets:e,alpha:1,ease:"Quint.easeOut",duration:200,onComplete:()=>{PhaserScene.tweens.add({targets:e,alpha:.8,ease:"Quint.easeInOut",duration:300})}}),PhaserScene.tweens.add({targets:e,ease:"Cubic.easeOut",scaleX:1,scaleY:1,duration:250}),a.alpha=1.05,a.setScale(.75),t.alpha=1,PhaserScene.tweens.add({targets:a,ease:"Back.easeOut",scaleX:.75,scaleY:.75,alpha:.75,duration:200}),PhaserScene.tweens.add({targets:t,ease:"Cubic.easeOut",scaleX:2.2,scaleY:2.2,duration:500}),PhaserScene.tweens.add({targets:t,ease:"Quad.easeOut",alpha:0,duration:500,onComplete:()=>{t&&t.destroy()}}),loadLevel++}}),a.load.on("complete",()=>{onLoadComplete(a),updateManager.addFunction(tempLoadFinFunc);for(let t=0;t<loadingIcons.length;t++){let e=loadingIcons[t];a.tweens.add({targets:e,alpha:0,x:.5*gameConsts.halfWidth+.5*e.x,y:.75*gameConsts.height,duration:800,ease:"Cubic.easeInOut",onComplete:()=>{e.destroy()}})}loadObjects.gloom=a.add.image(gameConsts.halfWidth,loadObjects.introLocket.y,"blurry","gloom.webp").setScale(5).setBlendMode(Phaser.BlendModes.MULTIPLY).setDepth(201).setAlpha(0),a.tweens.add({targets:loadObjects.gloom,alpha:.3,duration:800}),loadObjects.flash=a.add.image(gameConsts.halfWidth-30,loadObjects.introLocket.y-25,"blurry","flash.webp").setScale(0).setRotation(-.1).setDepth(1002),loadObjects.flash.currAnim=a.tweens.add({targets:loadObjects.flash,scaleX:.85,scaleY:.85,ease:"Cubic.easeIn",duration:350,onComplete:()=>{loadObjects.flash.currAnim=a.tweens.add({targets:loadObjects.flash,scaleX:0,scaleY:0,ease:"Cubic.easeOut",rotation:"+=0.1",duration:700,onComplete:()=>{}})}}),setTimeout(()=>{var e,t;loadObjects.introLocketOpen||(e=loadObjects.introLocket.x,t=loadObjects.introLocket.y,loadObjects.introLocket.destroy(),loadObjects.introLocketOpen=a.add.image(e,t,"misc","locket2.png").setScale(.83).setDepth(1001).setOrigin(.5,.65),loadObjects.introLocketOpen.scrollFactorX=0,loadObjects.introLocketOpen.scrollFactorY=0,a.tweens.add({targets:loadObjects.introLocketOpen,scaleX:.75,scaleY:.75,ease:"Back.easeOut",duration:400}))},100),loadObjects.fadeBG=a.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setScale(1e3).setAlpha(0).setDepth(-5),a.tweens.add({targets:loadObjects.fadeBG,alpha:.65,duration:1100});let e=createGlobalClickBlocker(!0);e.setOnMouseUpFunc(()=>{gameVars.runningIntro||(this.clickIntro(),setTimeout(()=>{a.tweens.add({targets:loadObjects.skipIntroText,alpha:.5,duration:1250}),e.setOnMouseUpFunc(()=>{this.skipIntro()})},150))}),swirlInReaperFog(1.15,75,1e3),gameVars.runningIntro||(gameOptions.skipIntroFull=!0,this.clickIntro()),a.tweens.add({targets:[loadObjects.loadingText],rotation:0,duration:200,onComplete:()=>{a.tweens.add({targets:[loadObjects.loadingText],alpha:0,ease:"Quad.easeInOut",duration:500}),gameOptions.skipIntroFull||(loadObjects.loadingText.setText(getLangText("start")).setScale(1).setPosition(loadObjects.loadingText.x,loadObjects.loadingText.y-20),loadObjects.loadingText2=a.add.text(loadObjects.loadingText.x,loadObjects.loadingText.y,getLangText("start"),{fontFamily:"germania",fontSize:42,color:"#FFFFFF",align:"center"}).setDepth(1001),loadObjects.loadingText2.setScale(1).setAlign("center").setOrigin(.5,0),loadObjects.loadingText3=a.add.text(loadObjects.loadingText.x,loadObjects.loadingText.y,getLangText("start"),{fontFamily:"germania",fontSize:42,color:"#FFFFFF",align:"center"}).setDepth(1001),loadObjects.loadingText3.setScale(1).setAlign("center").setOrigin(.5,0),this.animateStart(),loadObjects.introLocket.currAnim.stop(),a.tweens.add({targets:[loadObjects.introLocket],scaleX:.55,scaleY:.55,y:gameConsts.halfHeight-55,duration:600,ease:"Cubic.easeOut",onComplete:()=>{}}))}})})}function tempLoadFinFunc(){var e=.024*(gameVars.mouseposx-gameConsts.halfWidth),t=.01*(gameVars.mouseposy-gameConsts.halfHeight);PhaserScene.cameras.main.scrollX=.08*e+.92*PhaserScene.cameras.main.scrollX,PhaserScene.cameras.main.scrollY=.08*t+.92*PhaserScene.cameras.main.scrollY,loadObjects.introLocketOpen&&(PhaserScene.cameras.main.scrollX<0?loadObjects.introLocketOpen.rotation=.015*-Math.sqrt(-.1*PhaserScene.cameras.main.scrollX):loadObjects.introLocketOpen.rotation=.015*Math.sqrt(.1*PhaserScene.cameras.main.scrollX))}function animateStart(){var e=loadObjects.loadingText.x-20+40*Math.random(),t=loadObjects.loadingText.y-5+45*Math.random(),e=(loadObjects.loadingText2.alpha=.7,loadObjects.loadingText2.setPosition(loadObjects.loadingText.x,loadObjects.loadingText.y),loadObjects.loadingText2.currAnim=PhaserScene.tweens.add({targets:loadObjects.loadingText2,alpha:0,x:e,duration:1500,completeDelay:150,onComplete:()=>{gameVars.runningIntro||this.animateStart()}}),PhaserScene.tweens.add({targets:loadObjects.loadingText2,ease:"Quad.easeIn",y:t,duration:1500}),loadObjects.loadingText.x-20+40*Math.random()),t=loadObjects.loadingText.y-5+45*Math.random();loadObjects.loadingText3.currAnim=PhaserScene.tweens.add({delay:750,targets:loadObjects.loadingText3,x:e,alpha:0,duration:1500,onStart:()=>{loadObjects.loadingText3.alpha=.7,loadObjects.loadingText3.setPosition(loadObjects.loadingText.x,loadObjects.loadingText.y)}}),PhaserScene.tweens.add({delay:750,targets:loadObjects.loadingText3,y:t,ease:"Quad.easeIn",duration:1500})}function recursiveCreateIntroText(n=150,l=180){if(!(l<=0||gameVars.introFinished)){let e=Math.random()*gameConsts.width,t=Math.random()*gameConsts.height,a=3;for(;0<a;)Math.abs(e-gameConsts.halfWidth)<120&&t>gameConsts.height-150?(e=Math.random()*gameConsts.width,t=Math.random()*gameConsts.height):a=0;var r=.6-.0038*n;let s=PhaserScene.add.text(e,t,generateRandIntroText(),{fontFamily:"germania",fontSize:28,color:"#EEEEEE",align:"center"}).setDepth(100).setAlpha(.25*Math.random()-.15).setOrigin(.5,.5).setScale(+Math.random()+1);PhaserScene.tweens.add({targets:s,alpha:Math.max(.1,s.alpha+r),duration:400,onComplete:()=>{PhaserScene.tweens.add({delay:100,targets:s,alpha:0,duration:1200,onComplete:()=>{}})}});var r=20*(Math.random()-.5),o=20*(Math.random()-.5);PhaserScene.tweens.add({targets:s,scaleX:.9*s.scaleX,scaleY:.9*s.scaleX,x:"+="+r,y:"+="+o,duration:1600}),globalObjects.tempIntroText.push(s);let i=Math.ceil(.85*n+1);PhaserScene.time.delayedCall(n,()=>{recursiveCreateIntroText(i,l-1)})}}function clickIntro(){clearDeathFog(),playSound("locket_open",.7),playSound("water_drop",.16),globalObjects.tempIntroText=[],gameVars.runningIntro=!0,loadObjects.flash.currAnim.stop(),loadObjects.introLocket.destroy(),loadObjects.flash.currAnim=PhaserScene.tweens.add({targets:loadObjects.flash,scaleX:0,scaleY:0,alpha:0,y:Math.min(loadObjects.flash.y+70,gameConsts.halfHeight-85),ease:"Quad.easeOut",duration:400}),updateManager.removeFunction(tempLoadFinFunc),PhaserScene.tweens.add({targets:PhaserScene.cameras.main,scrollX:0,scrollY:0,duration:750,ease:"Cubic.easeOut"}),loadObjects.loadingText2&&loadObjects.loadingText2.currAnim&&(loadObjects.loadingText2.currAnim.stop(),loadObjects.loadingText3.currAnim.stop()),PhaserScene.tweens.add({targets:[loadObjects.loadingText2,loadObjects.loadingText3],alpha:0,duration:800,ease:"Quad.easeOut"}),loadObjects.glowBG=PhaserScene.add.image(loadObjects.introLocket.x,loadObjects.introLocket.y,"blurry","circle.webp").setDepth(2e3).setAlpha(.5).setScale(0),loadObjects.glowStar=PhaserScene.add.image(loadObjects.introLocket.x,loadObjects.introLocket.y-50,"blurry","flash_bg.webp").setDepth(1e3).setAlpha(.5).setScale(.3),loadObjects.sharpStar=PhaserScene.add.image(loadObjects.introLocket.x,loadObjects.introLocket.y-53,"blurry","star_blur_sharp.png").setDepth(1e3).setAlpha(.75).setScale(.6,.05),loadObjects.sharpStar2=PhaserScene.add.image(loadObjects.introLocket.x,loadObjects.introLocket.y-48,"blurry","star_blur_sharp.png").setDepth(1e3).setAlpha(.75).setScale(.1,.15),loadObjects.sharpStar.setRotation(.01),loadObjects.sharpStar2.setRotation(-.02),PhaserScene.tweens.add({targets:loadObjects.glowStar,alpha:1.05,scaleX:1.45,scaleY:1.45,ease:"Quad.easeIn",duration:300,onComplete:()=>{PhaserScene.tweens.add({targets:loadObjects.glowStar,alpha:.6,scaleX:.7,scaleY:.7,ease:"Cubic.easeOut",duration:150,onComplete:()=>{PhaserScene.tweens.add({targets:loadObjects.glowStar,alpha:1.1,scaleX:3.7,scaleY:3.7,ease:"Quart.easeIn",duration:1450,onComplete:()=>{}})}})}}),PhaserScene.tweens.add({targets:loadObjects.sharpStar,alpha:.9,scaleX:1.1,scaleY:.18,duration:50,rotation:.02,ease:"Cubic.easeOut",onComplete:()=>{PhaserScene.tweens.add({targets:loadObjects.sharpStar,alpha:.4,scaleX:.12,scaleY:.18,duration:250,rotation:.03,ease:"Cubic.easeOut"})}}),PhaserScene.tweens.add({targets:loadObjects.sharpStar2,alpha:.9,scaleX:1.95,scaleY:.58,duration:200,rotation:-.03,ease:"Cubic.easeOut",onComplete:()=>{PhaserScene.tweens.add({targets:loadObjects.sharpStar2,alpha:.4,scaleX:.12,scaleY:.24,duration:550,ease:"Cubic.easeOut"})}}),gameOptions.skipIntroFull?(loadObjects.glowBG.alpha=0,PhaserScene.tweens.add({targets:loadObjects.glowBG,alpha:1,duration:900,ease:"Quart.easeIn",onComplete:()=>{this.skipIntro()}}),loadObjects.glowBG.setScale(14)):PhaserScene.tweens.add({delay:1500,targets:loadObjects.glowBG,alpha:1.25,scaleX:14,scaleY:14,duration:500,ease:"Quart.easeIn",onComplete:()=>{cleanupIntro(PhaserScene)}}),loadObjects.skipIntroText=PhaserScene.add.text(gameConsts.width-5,gameConsts.height-5,getLangText("click_to_skip"),{fontFamily:"verdana",fontSize:18,color:"#FFFFFF",align:"right"}).setDepth(1005).setAlpha(0).setOrigin(1,1),loadObjects.whiteOverall=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"whitePixel").setDepth(2e3).setAlpha(0).setScale(1e3),PhaserScene.tweens.add({targets:loadObjects.whiteOverall,alpha:.75,ease:"Quad.easeIn",duration:2100}),loadObjects.introLocketOpen?loadObjects.introLocketOpen.setFrame("locket3.png").setOrigin(.5,.65):(loadObjects.introLocketOpen=PhaserScene.add.image(loadObjects.introLocket.x,loadObjects.introLocket.y,"misc","locket3.png").setDepth(1001).setOrigin(.5,.65),loadObjects.introLocketOpen.scrollFactorX=0,loadObjects.introLocketOpen.scrollFactorY=0),loadObjects.introLocketOpen.setScale(.8),loadObjects.introLocketOpenBg=PhaserScene.add.image(loadObjects.introLocketOpen.x,loadObjects.introLocketOpen.y,"misc","locket2.png"),loadObjects.introLocketOpenBg.setDepth(loadObjects.introLocketOpen.depth-1).setOrigin(.5,.65).setScale(.8),loadObjects.introLocketOpenBg.scrollFactorX=0,loadObjects.introLocketOpenBg.scrollFactorY=0,PhaserScene.tweens.add({targets:[loadObjects.introLocketOpenBg],alpha:0,duration:300}),PhaserScene.tweens.add({targets:[loadObjects.introLocketOpen,loadObjects.introLocketOpenBg],rotation:0,scrollY:0,ease:"Cubic.easeOut",duration:750,onComplete:()=>{playSound("whoosh")}}),PhaserScene.tweens.add({targets:[loadObjects.introLocketOpen,loadObjects.introLocketOpenBg],scaleX:.75,scaleY:.75,y:gameConsts.halfHeight-100,ease:"Cubic.easeOut",duration:1e3})}function skipIntro(){gameVars.introSkipped=!0,setTimeout(()=>{cleanupIntro()},0)}function cleanupIntro(){if(!gameVars.introFinished){gameVars.introFinished=!0,tempBG=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"whitePixel").setScale(1e3).setAlpha(.85).setDepth(1002),PhaserScene.tweens.add({targets:tempBG,alpha:0,duration:750,onComplete:()=>{tempBG.destroy()}}),hideGlobalClickBlocker();for(let e=0;e<icons.length;e++)icons[e].destroy();for(var e in globalObjects.tempBG.alpha=0,loadObjects)loadObjects[e].destroy();for(var t in globalObjects.tempIntroText)globalObjects.tempIntroText[t].destroy();setupPlayer(),1<=gameVars.maxLevel&&gameOptions.skipIntro?gotoMainMenu():(globalObjects.magicCircle.disableMovement(),gotoMainMenuNoButtons(),showLocket(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton()),handleGlobalKeyPresses()}}function locketFlash(){var e=.02*(gameVars.mouseposx-gameConsts.halfWidth),t=3e-4*(gameVars.mouseposy-gameConsts.height);let a=0;a=.015*Math.sqrt(Math.abs(e)),e<0&&(a=-a),globalObjects.gameLocketOpen.scaleY=t<0?.95-t*t:.95;e=.2*(gameConsts.halfWidth-400*a)+.8*globalObjects.gameLocketOpen.x;globalObjects.gameLocketOpen.shakey?(globalObjects.gameLocketOpen.x=.2*e+.8*globalObjects.gameLocketOpen.x+2.5*(Math.random()-.5),globalObjects.gameLocketOpen.y=.2*globalObjects.gameLocketOpen.origY+.8*globalObjects.gameLocketOpen.y+(Math.random()-.5)):globalObjects.gameLocketOpen.x=e,globalObjects.gameLocketOpen.rotation=.05*(-a+.5*t)+.95*globalObjects.gameLocketOpen.rotation,globalObjects.gameLocketOpenLight.rotation=globalObjects.gameLocketOpen.rotation,globalObjects.gameLocketOpenLight.alpha=12*-globalObjects.gameLocketOpenLight.rotation-.1-1.18*t,globalObjects.gameLocketOpenLight.x=globalObjects.gameLocketOpen.x,globalObjects.gameLocketOpenLight.scaleY=globalObjects.gameLocketOpen.scaleY}function showLocket(){globalObjects.gameLocketOpen=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight-129,"misc","locket3.png").setScale(.69,.75).setDepth(100003),globalObjects.gameLocketOpenLight=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight-129,"misc","locketwhite.png").setScale(.69,.75).setDepth(100003).setAlpha(0);let e=PhaserScene.add.text(gameConsts.halfWidth,gameConsts.halfHeight+105,"Put away locket",{fontFamily:"garamondmax",fontSize:32,color:"#FFFFFF",align:"center"}).setDepth(100003).setOrigin(.5,0).setAlpha(0),t=(PhaserScene.tweens.add({targets:[globalObjects.gameLocketOpen,globalObjects.gameLocketOpenLight],y:"+=35",ease:"Quart.easeOut",scaleX:.95,scaleY:.95,duration:900}),updateManager.addFunction(locketFlash),!1);setTimeout(()=>{t||(e.currAnim=PhaserScene.tweens.add({targets:e,alpha:.9,ease:"Quad.easeOut",duration:1e3}))},500),globalObjects.bannerTextManager.setDialog([getLangText("beginLocket1")]),globalObjects.bannerTextManager.setPosition(gameConsts.halfWidth,gameConsts.height+230,0),globalObjects.bannerTextManager.showBanner(.75),globalObjects.bannerTextManager.setOnFinishFunc(()=>{if(t=!0,updateManager.removeFunction(locketFlash),globalObjects.gameLocketOpenLight.destroy(),playSound("locket_close"),e.currAnim&&e.currAnim.stop(),PhaserScene.tweens.add({targets:[e],alpha:0,duration:300,onComplete:()=>{e.destroy()}}),1<gameVars.latestLevel&&.4<Math.random()){let e=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight-90,"ending","ending2_a.png").setAlpha(.2).setDepth(200).setScale(.5);PhaserScene.tweens.add({targets:e,ease:"Cubic.easeOut",alpha:.55,duration:300,onComplete:()=>{PhaserScene.tweens.add({targets:e,ease:"Quad.easeOut",alpha:0,duration:900})}}),PhaserScene.tweens.add({targets:e,ease:"Quad.easeOut",scaleX:.46,scaleY:.46,duration:1200}),setTimeout(()=>{fadeOutLocketDisplay()},400)}else fadeOutLocketDisplay()})}function fadeOutLocketDisplay(){globalObjects.magicCircle.enableMovement(),globalObjects.gameLocketOpen.setFrame("locket4.png"),globalObjects.gameLocketOpen.setScale(.98).setRotation(.1),PhaserScene.tweens.add({targets:[globalObjects.gameLocketOpen],rotation:0,ease:"Back.easeOut",duration:250}),PhaserScene.tweens.add({targets:[globalObjects.gameLocketOpen],scaleX:.8,scaleY:.8,ease:"Cubic.easeOut",duration:250,onComplete:()=>{globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),showMainMenuButtons(),PhaserScene.tweens.add({delay:150,targets:globalObjects.gameLocketOpen,y:"+=150",alpha:0,scaleX:.65,scaleY:.65,ease:"Quart.easeIn",duration:600,onStart:()=>{playNewGameFlash()},onComplete:()=>{globalObjects.gameLocketOpen.destroy()}})}})}function resetGame(){for(var e in globalObjects)globalObjects[e].destroy()}function setupGame(){canvas=game.canvas,gameVars.started||(gameVars.started=!0,createAnimations(PhaserScene),globalObjects.gameStats=new GameStats,globalObjects.hoverTextManager=new InternalHoverTextManager(PhaserScene),globalObjects.textPopupManager=new TextPopupManager(PhaserScene),globalObjects.combatDialogManager=new CombatTextManager(PhaserScene),globalObjects.spellManager=new SpellManager(PhaserScene),globalObjects.spellRecorder=new SpellRecorder(PhaserScene),globalObjects.bannerTextManager=new BannerTextManager(PhaserScene),globalObjects.statusManager=new StatusManager(PhaserScene),globalObjects.postFightScreen=new PostFightScreen(PhaserScene),globalObjects.confirmPopup=new ConfirmPopup(PhaserScene),globalObjects.bgHandler=new BgHandler,globalObjects.unlocks=new Unlocks)}function setupPlayer(){MAGIC_CIRCLE_HEIGHT=gameConsts.height-(isMobile?134:123),PhaserScene.tweens.add({targets:PhaserScene.cameras.main,zoom:1,ease:"Quint.easeInOut",duration:900}),globalObjects.magicCircle=new MagicCircle(PhaserScene,gameConsts.halfWidth,MAGIC_CIRCLE_HEIGHT),globalObjects.player=new Player(PhaserScene,gameConsts.halfWidth,MAGIC_CIRCLE_HEIGHT);var e=isMobile?gameConsts.width-27:gameConsts.width-73,t=isMobile?77:27;globalObjects.encyclopedia=new Encyclopedia(PhaserScene,e,t),globalObjects.options=new Options(PhaserScene,gameConsts.width-27,27)}function handleGlobalKeyPresses(){globalObjects.currentOpenedPopups=[],messageBus.subscribe("toggleCancelScreen",()=>{0<globalObjects.currentOpenedPopups.length?(0,globalObjects.currentOpenedPopups[globalObjects.currentOpenedPopups.length-1])(!1)&&globalObjects.currentOpenedPopups.pop():globalObjects.options.showOptions()})}function addPopup(e){globalObjects.currentOpenedPopups.push(e),4===globalObjects.length&&console.warn("unexpected number of popups")}function removePopup(){globalObjects.currentOpenedPopups.pop()}class GameStats{constructor(){this.reset(),messageBus.subscribe("tempPause",this.setTempPause.bind(this)),messageBus.subscribe("pauseGame",this.setPermPause.bind(this)),messageBus.subscribe("setGameSlow",this.setGameSlow.bind(this)),messageBus.subscribe("clearGameSlow",this.clearGameSlow.bind(this)),messageBus.subscribe("unpauseGame",this.setUnpause.bind(this))}setTempPause(e,t){gameVars.timeScale=t||.5,PhaserScene.tweens.timeScale=t||.6,PhaserScene.time.timeScale=t||.5,PhaserScene.anims.globalTimeScale=t||.6,this.currTimeoutAmt&&gameVars.timeScale>this.currTimeoutAmt||(this.currTimeoutAmt=gameVars.timeScale,this.currTimeoutPause&&clearTimeout(this.currTimeoutPause),this.currTimeoutPause=setTimeout(()=>{gameVars.timeScale=gameVars.gameManualSlowSpeed||1,PhaserScene.tweens.timeScale=gameVars.gameManualSlowSpeed||1,PhaserScene.time.timeScale=gameVars.gameManualSlowSpeed||1,PhaserScene.anims.globalTimeScale=gameVars.gameManualSlowSpeed||1,this.currTimeoutAmt=null},e))}setPermPause(e=.002){gameVars.permTimeScale=e,gameVars.timeScale=e,PhaserScene.tweens.timeScale=e,PhaserScene.time.timeScale=e,PhaserScene.anims.globalTimeScale=e,globalObjects.currentEnemy&&!globalObjects.currentEnemy.dead&&sdkGameplayStop()}setUnpause(){gameVars.timeScale=gameVars.gameManualSlowSpeed||1,gameVars.permTimeScale=gameVars.timeScale,PhaserScene.tweens.timeScale=gameVars.gameManualSlowSpeed||1,PhaserScene.time.timeScale=gameVars.gameManualSlowSpeed||1,PhaserScene.anims.globalTimeScale=gameVars.gameManualSlowSpeed||1,globalObjects.currentEnemy&&!globalObjects.currentEnemy.dead&&sdkGameplayStart()}setGameSlow(e){gameVars.gameManualSlowSpeed=e,gameVars.gameManualSlowSpeedInverse=1/gameVars.gameManualSlowSpeed,gameVars.timeScale=gameVars.gameManualSlowSpeed,PhaserScene.tweens.timeScale=gameVars.gameManualSlowSpeed,PhaserScene.time.timeScale=gameVars.gameManualSlowSpeed,PhaserScene.anims.globalTimeScale=gameVars.gameManualSlowSpeed}clearGameSlow(){gameVars.gameManualSlowSpeed=1,gameVars.gameManualSlowSpeedInverse=1,gameVars.timeScale=gameVars.gameManualSlowSpeed,PhaserScene.tweens.timeScale=gameVars.gameManualSlowSpeed,PhaserScene.time.timeScale=gameVars.gameManualSlowSpeed,PhaserScene.anims.globalTimeScale=gameVars.gameManualSlowSpeed}reset(){}}class StatusObj{constructor(e,t,a,s,i,n,l){this.scene=e,this.setup(a,s),this.init(t,a,s,i,n,l)}setup(e,t){this.active=!0,this.sprite=this.scene.add.sprite(e,t,"circle","rune_void_glow.png").setAlpha(.75),this.sprite2=this.scene.add.sprite(e-11,t+16,"circle","rune_void_glow.png"),this.sprite2.setScale(.6,.6),this.sprite2.visible=!1,this.amtText=this.scene.add.bitmapText(e+9,t+28,"normalStroke","0",isMobile?24:22,0),this.amtText.visible=!1,this.amtText.setOrigin(isMobile?.2:.26,.5),this.timeLeftText=this.scene.add.bitmapText(e+27,t,"normalStroke","99",isMobile?30:28,0),this.timeLeftText.setOrigin(0,.5),this.sprite.setDepth(9999),this.sprite2.setDepth(9999),this.timeLeftText.setDepth(9999),this.amtText.setDepth(9999)}setPosition(e,t){this.sprite.setPosition(e,t),this.sprite2.setPosition(e-11,t+16),this.timeLeftText.setPosition(e+27,t),this.amtText.setPosition(e+9,t+28)}init(e,t,a,s="rune_void_glow.png",i,n){this.spellID=e,this.active=!0,this.sprite.setFrame(s);let l=0;if(50<this.sprite.height&&(l=.5*this.sprite.height-25),this.sprite.setPosition(t,a+l),this.timeLeftText.setPosition(t+27,a),this.timeLeftText.setVisible(!0),this.sprite.visible=!0,i){this.sprite2.visible=!0,this.sprite2.setFrame(i);let e=0;50<this.sprite2.height&&(e=.5*this.sprite2.height-25,e*=this.sprite2.scaleY),this.sprite2.setPosition(t-11,a+16+e)}n&&(this.amtText.setText(n),this.amtText.setPosition(t+9,a+28)),this.amtText.visible=!0}setDurationText(e=" "){this.timeLeftText.setText(e)}setAmtText(e=" "){this.amtText.setText(e)}clear(){this.sprite.setVisible(!1),this.sprite2.setVisible(!1),this.timeLeftText.setVisible(!1),this.amtText.setVisible(!1),this.active=!1}}class SpellRecorder{constructor(e){this.scene=e,messageBus.subscribe("recordSpell",this.handleRecordNonAttack.bind(this)),messageBus.subscribe("recordSpellAttack",this.handleRecordAttack.bind(this)),this.castHistory=[],this.castCount={},this.spellAnnounceBG=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-17,"misc","announceBg.png"),this.spellAnnounceBG.setOrigin(.5),this.spellAnnounceBG.setDepth(9991),this.spellAnnounceBG.alpha=0,this.spellAnnounceBG.setScale(2,1.1),this.spellAnnounceText=this.scene.add.bitmapText(gameConsts.halfWidth,gameConsts.halfHeight-11,"bonus","dfbfdb",32,1),this.spellAnnounceText.setOrigin(.5,.5),this.spellAnnounceText.setDepth(9991),this.spellAnnounceText.alpha=0,this.attackAnnounceText=this.scene.add.bitmapText(gameConsts.halfWidth,gameConsts.halfHeight-16,"damage","dfbfdb",36,1),this.attackAnnounceText.setOrigin(.5,.5),this.attackAnnounceText.setDepth(9991),this.attackAnnounceText.alpha=0,this.attackBonusText=this.scene.add.bitmapText(gameConsts.halfWidth,this.attackAnnounceText.y+19,"damage","dfbfdb",33,1),this.attackBonusText.setOrigin(.5,0),this.attackBonusText.setDepth(9991),this.attackBonusText.alpha=0,this.attackMultText=this.scene.add.bitmapText(gameConsts.halfWidth,this.attackAnnounceText.y+19,"damage","dfbfdb",31,1),this.attackMultText.setOrigin(.5,0),this.attackMultText.setDepth(9991),this.attackMultText.alpha=0}handleRecordAttack(e,t,a=0,s,i){let n,l;s&&(n="+"+s),i&&1.01<i&&(l="X"+i),this.handleRecordSpell(this.attackAnnounceText,e,t,a,n,l,!0)}handleRecordNonAttack(e,t,a=0){this.handleRecordSpell(this.spellAnnounceText,e,t,a)}handleRecordSpell(e,t,a,s=0,i,n,l=!1){e.setText(a);var r=s,o=i||n,s=900*s+(o?220:0),h=(l?e.setScale(1.05+1.01*r):e.setScale(.8+r,.82+r),this.spellAnnounceBG.setScale(e.width/350+.1,.5+.25*r),this.spellAnnounceBG.scaleX);e.setAlpha(l?.75:.45),o?e.setOrigin(.5,.75):e.setOrigin(.5,.5),this.spellAnnounceBG.setAlpha(.7),this.currAnim&&(this.currAnim.stop(),this.currAnimObj!==e)&&(o=[this.currAnimObj],i||o.push(this.attackBonusText),n||o.push(this.attackMultText),this.scene.tweens.add({targets:o,ease:"Cubic.easeOut",alpha:0,scaleY:.95,duration:290})),this.scene.tweens.add({targets:this.spellAnnounceBG,scaleX:1.25*h,scaleY:.6+.25*r,alpha:.8,duration:300,ease:"Quad.easeOut"}),l?(this.scene.tweens.add({targets:e,scaleX:.9+r,scaleY:.9+r,duration:220,ease:"Back.easeOut"}),this.scene.tweens.add({targets:e,alpha:1,duration:180,ease:"Cubic.easeOut"})):this.scene.tweens.add({targets:e,scaleX:.9+r,scaleY:.9+r,alpha:1,duration:280,easeParams:[3],ease:"Back.easeOut"}),this.animateBonusText(i,n,r),this.currAnim=this.scene.tweens.add({delay:760+20*a.length+s,targets:[e,this.spellAnnounceBG,this.attackBonusText,this.attackMultText],ease:"Cubic.easeIn",alpha:0,scaleY:.95,duration:350}),this.currAnimObj=e,this.castCount[t]?this.castCount[t]+=1:this.castCount[t]=1}animateBonusText(e,t,a){e&&t?(this.attackBonusText.setText(e),this.attackBonusText.x=gameConsts.halfWidth-.5*this.attackBonusText.width-2,this.attackBonusText.setOrigin(.55,.5),this.attackBonusText.setAlpha(0).setRotation(-.2).setScale(1.75+1.25*a,1.75+1.25*a),this.attackMultText.setText(t),this.attackMultText.x=gameConsts.halfWidth+.5*this.attackMultText.width+2,this.attackMultText.setOrigin(.45,.5),this.attackMultText.setAlpha(0).setRotation(.25).setScale(1.75+1.25*a,1.75+1.25*a),this.scene.tweens.add({targets:this.attackBonusText,delay:300,scaleX:1+a,scaleY:1+a,alpha:1,rotation:0,duration:300,easeParams:[2],ease:"Back.easeIn",onStart:()=>{this.attackBonusText.setAlpha(1)}}),this.scene.tweens.add({targets:this.attackMultText,delay:600,scaleX:1+a,scaleY:1+a,alpha:1,rotation:0,duration:300,easeParams:[2.5],ease:"Back.easeIn",onStart:()=>{this.attackMultText.setAlpha(1)}})):e?(this.attackBonusText.setText(e),this.attackBonusText.x=gameConsts.halfWidth,this.attackBonusText.setOrigin(.5,.5),this.attackBonusText.setAlpha(0).setRotation(-.2).setScale(1.5+a,1.5+a),this.scene.tweens.add({targets:this.attackBonusText,delay:400,scaleX:1+a,scaleY:1+a,alpha:1,rotation:0,duration:400,easeParams:[3],ease:"Back.easeOut",onStart:()=>{this.attackBonusText.setAlpha(1)}})):t&&(this.attackMultText.setText(t),this.attackMultText.x=gameConsts.halfWidth,this.attackMultText.setOrigin(.5,.5),this.attackMultText.setAlpha(0).setRotation(-.2).setScale(1.5+a,1.5+a),this.scene.tweens.add({targets:this.attackMultText,delay:400,scaleX:1+a,scaleY:1+a,alpha:1,rotation:0,duration:400,easeParams:[3],ease:"Back.easeOut",onStart:()=>{this.attackMultText.setAlpha(1)}}))}}let DECAY=46e-6,STATIC=.0057,MIN_VEL=1e-4,ENABLE_KEYBOARD=!0;class MagicCircle{constructor(e,t,a){this.scene=e,this.reset(t,a),this.buildCircles(t,a,e),this.createTimeStopObjs(),ENABLE_KEYBOARD&&this.setupKeyPresses(e),this.castDisabled=!1,this.bufferedCastAvailable=!1,this.forcingAlignment=!1,this.outerDragDisabled=!1,this.innerDragDisabled=!1,this.disableSpellDescDisplay=!1,this.elementsAnimArray=[],this.embodimentsAnimArray=[],this.stalagmites=[],this.tempRotObjs=[],this.pillarFireDelay=0,this.tempLockRot=0,this.stalagIdx=0,this.lastDragTime=0,this.prevDragAngleDiff=null,this.storedDragAngleDiff=0,this.dScaleAccumulate=0,this.draggedDuration=0,this.preventRotDecay=0,this.lastPlayedClickTime=0,this.subscriptions=[messageBus.subscribe("attackLaunched",this.attackLaunched.bind(this)),messageBus.subscribe("manualSetTimeSlowRatio",this.manualSetTimeSlowRatio.bind(this)),messageBus.subscribe("statusesTicked",this.handleStatusesTicked.bind(this)),messageBus.subscribe("playerAddDelayedDamage",this.addDelayedDamage.bind(this)),messageBus.subscribe("playerReduceDelayedDamage",this.reduceDelayedDamage.bind(this)),messageBus.subscribe("enableVoidArm",this.enableVoidArm.bind(this)),messageBus.subscribe("setTempRotObjs",this.setTempRotObjs.bind(this)),messageBus.subscribe("manualResetElements",this.manualResetElements.bind(this)),messageBus.subscribe("manualResetEmbodiments",this.manualResetEmbodiments.bind(this)),messageBus.subscribe("inflictVoidBurn",this.applyVoidBurn.bind(this)),messageBus.subscribe("startVoidForm",this.handleVoidForm.bind(this)),messageBus.subscribe("stopVoidForm",this.clearVoidForm.bind(this)),messageBus.subscribe("selfClearEffect",this.clearMindForm.bind(this)),messageBus.subscribe("enemyHasDied",this.clearEffects.bind(this)),messageBus.subscribe("enemyHasDied",this.cancelTimeSlow.bind(this)),messageBus.subscribe("selfClearStatuses",this.clearEffects.bind(this)),messageBus.subscribe("applyMindBurn",this.applyMindBurn.bind(this)),messageBus.subscribe("playerDied",this.playerDied.bind(this)),messageBus.subscribe("playerRevived",this.playerRevived.bind(this)),messageBus.subscribe("highlightRunes",this.highlightRunes.bind(this)),messageBus.subscribe("unhighlightRunes",this.unhighlightRunes.bind(this)),messageBus.subscribe("showCircleShadow",this.showCircleShadow.bind(this)),messageBus.subscribe("setCircleShadow",this.setCircleShadow.bind(this)),messageBus.subscribe("refreshHoverDisplay",this.refreshHoverText.bind(this)),messageBus.subscribe("addStalagmites",this.addStalagmites.bind(this))],updateManager.addFunction(this.update.bind(this))}setupKeyPresses(e){this.keyW=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),this.keyA=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),this.keyS=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.keyD=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D),this.keyQ=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q),this.keyE=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E),this.keyP=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.P),this.keyLeft=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.LEFT),this.keyRight=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.RIGHT),this.keyUp=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.UP),this.keyDown=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.DOWN),this.keyEnter=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER),this.keySpace=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.keyEscape=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ESC)}update(e){15<this.lastDragTime?gameVars.playerNotMoved=!0:gameVars.playerNotMoved=!1,this.handleTimeSlow(e),this.lastDragTime+=e;var t=gameVars.mouseposx-this.x,a=gameVars.mouseposy-this.y,s=Math.sqrt(t*t+a*a);if(this.setFrameLazy(this.castButton,this.altString+"cast_normal.png"),globalObjects.player.setCastTextAlpha(.65),this.setFrameLazy(this.innerCircle,this.altString+"element_normal.png"),this.setFrameLazy(this.outerCircle,this.altString+"usage_normal.png"),this.manualDisabled&&(this.dragArrow.visible=!1,this.dragCircle.visible=!1),this.delayedDamage>this.delayedDamageBase?(i=Math.sqrt(6*Math.max(0,this.delayedDamage-this.delayedDamageBase)),this.delayedDamage>1.25*this.delayedDamageBase&&(this.delayDamageSandFull.x+=Math.random()*i*.03),this.delayDamageSandFull.x=this.delayDamageSandFull.origX+.75*(this.delayDamageSandFull.origX-this.delayDamageSandFull.x),this.delayDamageSandFull.x+=Math.random()*(.12*i+.5)):this.delayDamageSandFull.x=this.delayDamageSandFull.origX,this.delayDamageHourglass.x=this.delayDamageSandFull.x,!this.recentSkipped&&(this.keyEnter.isDown||this.keySpace.isDown||this.keyEscape.isDown)){let e=globalObjects.bannerTextManager.continueDialog();globalObjects.currentEnemy&&globalObjects.currentEnemy.dieClickBlocker&&!globalObjects.currentEnemy.dieClickBlocker.isDestroyed&&globalObjects.currentEnemy.dieClickBlocker.onMouseUpFunc&&(globalObjects.currentEnemy.dieClickBlocker.clickMouseUp(),e=!0),globalObjects.lvlCloseButton&&!globalObjects.lvlCloseButton.isDestroyed&&globalObjects.lvlCloseButton.onMouseUpFunc&&0!==globalObjects.lvlCloseButton.level&&(globalObjects.lvlCloseButton.clickMouseUp(),e=!0),this.recentSkipped=!0,this.keyEscape.isDown&&(globalObjects.encyclopedia.canClose&&(e=!0,messageBus.publish("cancelScreen")),globalObjects.options.canClose||e?messageBus.publish("cancelScreen"):messageBus.publish("toggleCancelScreen"))}else!this.recentSkipped&&this.keyP.isDown?(this.recentSkipped=!0,messageBus.publish("toggleCancelScreen")):!this.recentSkipped||this.keyEnter.isDown||this.keySpace.isDown||this.keyEscape.isDown||this.keyP.isDown||(this.recentSkipped=!1);if(!ENABLE_KEYBOARD||this.outerDragDisabled||this.innerDragDisabled||this.manualDisabled||(this.keyA.isDown||this.keyDown.isDown?-1e-4<this.keyboardRotateInner?(this.keyboardRotateInner=-1.46,this.keyboardRotateInnerDeadTime=this.defaultDeadTime,this.innerCircle.rotVel=Math.max(0,this.innerCircle.rotVel)):0<this.keyboardRotateInnerDeadTime?(this.keyboardRotateInnerDeadTime-=e,this.keyboardRotateInner=-.001):this.keyboardRotateInner=-1:this.keyD.isDown||this.keyUp.isDown?this.keyboardRotateInner<1e-4?(this.keyboardRotateInner=1.46,this.keyboardRotateInnerDeadTime=this.defaultDeadTime,this.innerCircle.rotVel=Math.min(0,this.innerCircle.rotVel)):0<this.keyboardRotateInnerDeadTime?(this.keyboardRotateInnerDeadTime-=e,this.keyboardRotateInner=.001):this.keyboardRotateInner=1:this.keyboardRotateInner=0,this.keyW.isDown||this.keyRight.isDown||this.keyE.isDown?this.keyboardRotateOuter<1e-4?(this.keyboardRotateOuter=1.35,this.outerCircle.rotVel=Math.max(0,this.outerCircle.rotVel),this.keyboardRotateOuterDeadTime=this.defaultDeadTime):0<this.keyboardRotateOuterDeadTime?(this.keyboardRotateOuterDeadTime-=e,this.keyboardRotateOuter=.001):this.keyboardRotateOuter=1:this.keyS.isDown||this.keyLeft.isDown||this.keyQ.isDown?-1e-4<this.keyboardRotateOuter?(this.keyboardRotateOuter=-1.35,this.keyboardRotateOuterDeadTime=this.defaultDeadTime,this.outerCircle.rotVel=Math.min(0,this.outerCircle.rotVel)):0<this.keyboardRotateOuterDeadTime?(this.keyboardRotateOuterDeadTime-=e,this.keyboardRotateOuter=-.001):this.keyboardRotateOuter=-1:this.keyboardRotateOuter=0,this.keyboardCasted=!1,this.keyboardCastRestricted||!this.keyEnter.isDown&&!this.keySpace.isDown?this.keyEnter.isDown||this.keySpace.isDown||(this.keyboardCastRestricted=!1):(this.keyboardCasted=!0,this.keyboardCastRestricted=!0),this.keyboardCasted&&(this.castDisabled||this.recharging?this.bufferedCastAvailable&&!this.recharging&&(this.bufferedCastAvailable=!1,this.useBufferedSpellCast=!0):(this.castSpell(),this.keyboardCasted=!1))),s<=this.size&&!this.manualDisabled&&(gameVars.mouseJustDowned?(this.draggedDuration=0,s<this.castButtonSize?(this.draggedObj=this.castButton,this.setFrameLazy(this.castButton,this.altString+"cast_press.png"),globalObjects.player.setCastTextAlpha(.65)):s<this.innerCircleSize&&!this.innerDragDisabled?(this.draggedObj=this.innerCircle,this.dragPointDist=s,this.dragPointAngle=Math.atan2(a,t),this.dragPointAngleVisual=this.dragPointAngle,this.setFrameLazy(this.innerCircle,this.altString+"element_drag.png")):this.outerDragDisabled||(this.draggedObj=this.outerCircle,this.dragPointDist=Math.min(s,this.trueSize),this.dragPointAngle=Math.atan2(a,t),this.dragPointAngleVisual=this.dragPointAngle,this.setFrameLazy(this.outerCircle,this.altString+"usage_drag.png"))):gameVars.mouseJustUpped?(this.draggedDuration<11&&(this.preventRotDecay=.4*(11-this.draggedDuration)),s<this.castButtonSize&&this.draggedObj===this.castButton&&(this.castDisabled||this.recharging?this.bufferedCastAvailable&&!this.recharging&&(this.bufferedCastAvailable=!1,this.useBufferedSpellCast=!0):(this.castSpell(),this.keyboardCasted=!1))):gameVars.mousedown?(this.draggedDuration+=e,s<this.castButtonSize&&this.draggedObj===this.castButton&&(this.setFrameLazy(this.castButton,this.altString+"cast_press.png"),globalObjects.player.setCastTextAlpha(.6))):(canvas.style.cursor="default",s<this.castButtonSize?(this.setFrameLazy(this.castButton,this.altString+"cast_hover.png"),globalObjects.player.setCastTextAlpha(.7),this.innerDragDisabled||this.outerDragDisabled||this.recharging||this.castDisabled||!canvas||(canvas.style.cursor="pointer")):!this.innerDragDisabled&&s<this.innerCircleSize?this.setFrameLazy(this.innerCircle,this.altString+"element_hover.png"):this.outerDragDisabled||this.setFrameLazy(this.outerCircle,this.altString+"usage_hover.png"))),gameVars.mousedown||(this.draggedObj=null),this.innerDragDisabled&&this.innerCircle===this.draggedObj&&(this.draggedObj=null),this.outerDragDisabled&&this.outerCircle===this.draggedObj&&(this.draggedObj=null),1.1<(e=.9<e&&e<1.14?1:e))for(this.dScaleAccumulate+=e;1<this.dScaleAccumulate;)--this.dScaleAccumulate,this.updateInterval(1,t,a);else this.updateInterval(e,t,a);var i=0<this.voidArm2.alpha?.35:.05;0<this.voidArm.alpha&&(this.voidArm.bonusRotation+=.05*(Math.random()-.5),this.voidArm.bonusRotation*=.98,this.voidArm.rotation=this.voidArm.bonusRotation+i-.1,.92<this.voidArm.alpha)&&(this.voidArm.alpha=.92+.08*Math.random()),0<this.voidArm2.alpha&&(this.voidArm2.bonusRotation+=.05*(Math.random()-.5),this.voidArm2.bonusRotation*=.97,this.voidArm2.rotation=.5*Math.PI+this.voidArm2.bonusRotation+i-.1,.92<this.voidArm2.alpha)&&(this.voidArm2.alpha=.92+.08*Math.random()),0===this.innerCircle.rotVel&&0===this.outerCircle.rotVel&&null===this.draggedObj||(this.lastDragTime=Math.min(this.lastDragTime,0)),this.updateShields(e),this.updateFramesLazy()}updateInterval(i,n,l){if(this.draggedObj&&this.draggedObj!==this.castButton){for(this.dragArrow.visible=!0,this.dragCircle.visible=!0;this.dragPointAngle>2*Math.PI;)this.dragPointAngle-=2*Math.PI;for(;this.dragPointAngle<-2*Math.PI;)this.dragPointAngle+=2*Math.PI;let e=Math.atan2(l,n)-this.dragPointAngle;e>Math.PI?e-=2*Math.PI:e<-Math.PI&&(e+=2*Math.PI),this.prevDragAngleDiff||(this.prevDragAngleDiff=e),this.storedDragAngleDiff=e;var r=Math.cos(this.dragPointAngle)*this.dragPointDist,o=Math.sin(this.dragPointAngle)*this.dragPointDist,h=n-r,c=l-o,g=Math.sqrt(h*h+c*c),d=h/(g+.001),u=c/(g+.001),p=r/this.dragPointDist,m=o/this.dragPointDist;let t=0;t=g<25?Math.max(0,Math.min(1,.015*g)):Math.min(1,.25+.002*g);m=-m*d+p*u;let a=gameVars.wasTouch?.0445:.0422,s=(5<=gameVars.maxLevel?a+=.014:2<=gameVars.maxLevel&&(a+=.008),1);Math.abs(e)<.03&&(s=30*Math.abs(e)),this.draggedObj.torque=m<0?t*-Math.sqrt(-m)*a*(1+.01*i):t*Math.sqrt(m)*a*(1+.01*i),this.draggedObj.torque+=e*a-.38*this.draggedObj.rotVel,this.draggedObj.torque*=s,this.draggedObj.torqueOnReleaseOld3=this.draggedObj.torqueOnReleaseOld2,this.draggedObj.torqueOnReleaseOld2=this.draggedObj.torqueOnReleaseOld,this.draggedObj.torqueOnReleaseOld=this.draggedObj.torqueOnRelease,this.draggedObj.torqueOnRelease=2.7*this.draggedObj.torque,this.draggedObj.rotVel*e<-.01&&(this.draggedObj.rotVel*=.2);d=this.draggedObj.rotation,p=this.draggedObj.nextRotation,u=(this.calculateRotations(i),this.updateRotationVisuals(i),this.draggedObj.rotation-d),m=this.draggedObj.nextRotation-p;this.dragPointAngle+=m,this.dragPointAngleVisual+=u,h=n-(r=Math.cos(this.dragPointAngleVisual)*this.dragPointDist),c=l-(o=Math.sin(this.dragPointAngleVisual)*this.dragPointDist),this.dragArrow.setPosition(this.x+r,this.y+o),this.dragCircle.setPosition(this.x+r,this.y+o),this.dragArrow.setScale(Math.max(.08,Math.min(1,.0135*g)),1),this.dragArrow.setAlpha(Math.min(5*this.dragArrow.scaleX-2)),this.dragArrow.setRotation(Math.atan2(c,h)),this.draggedObj==this.innerCircle?this.setFrameLazy(this.innerCircle,this.altString+"element_drag.png"):this.draggedObj==this.outerCircle&&this.setFrameLazy(this.outerCircle,this.altString+"usage_drag.png"),this.prevDragAngleDiff=e}else this.prevDragAngleDiff=null,this.dragArrow.visible=!1,this.dragCircle.visible=!1,this.calculateRotations(i),this.updateRotationVisuals(i)}reset(e,t){this.x=e,this.y=t,this.trueSize=205,this.size=isMobile?259:237,this.draggedObj=null,this.dragPointAngle=0,this.dragPointAngleVisual=this.dragPointAngle,this.dragPointDist=100,this.keyboardRotateOuter=0,this.keyboardRotateInner=0,this.defaultDeadTime=11.5,this.keyboardRotateOuterDeadTime=5,this.keyboardRotateInnerDeadTime=5,this.keyboardCasted=!1,this.delayedDamage=0,this.delayedDamageBase=60,this.delayedDamageShouldTick=!1}buildCircles(e,t,a){this.aura=a.add.image(e,t,"circle","aura.png"),this.aura.setDepth(101),this.aura.setScale(.9),this.aura.rotVel=0,this.aura.alpha=0,this.voidArm=this.scene.add.sprite(gameConsts.halfWidth,210,"spells","blackHoleArms.png").setScale(1.25),this.voidArm.setDepth(15),this.voidArm.alpha=0,this.voidArm.bonusRotation=0,this.voidArm2=this.scene.add.sprite(gameConsts.halfWidth,210,"spells","blackHoleArms.png").setScale(1.25),this.voidArm2.setDepth(15),this.voidArm2.alpha=0,this.voidArm2.bonusRotation=0,this.delayDamageSandFull=a.add.sprite(e-240,t-130,"circle","delayed_damage_full.png"),this.delayDamagePartial=a.add.graphics().setDepth(101),this.delayDamagePartial.fillStyle(16711680,.7),this.delayDamagePartial.visible=!0,this.delayDamagePartial.setDepth(101),this.delayDamageHourglass=a.add.sprite(e-240,t-130,"circle","delayed_damage.png").setScale(.9),this.delayDamageHourglass.setDepth(101),this.delayDamageHourglass.alpha=0,this.delayDamageSandFull.setDepth(101),this.delayDamageSandFull.alpha=0,this.delayDamageSandFull.origX=this.delayDamageSandFull.x,this.delayDamageText=this.scene.add.bitmapText(this.delayDamageHourglass.x,this.delayDamageHourglass.y,"damage","0",48,0),this.delayDamageText.setDepth(101),this.delayDamageText.alpha=0,this.delayDamageText.setOrigin(.5,-.35),this.altString="",this.outerCircle=a.add.sprite(e,t,"circle",this.altString+"usage_normal.png").setDepth(101),this.outerCircle.torque=0,this.outerCircle.torqueDecay=0,this.outerCircle.torqueOnRelease=0,this.outerCircle.torqueOnReleaseOld=0,this.outerCircle.torqueOnReleaseOld2=0,this.outerCircle.torqueOnReleaseOld3=0,this.outerCircle.rotVel=0,this.outerCircle.nextRotation=0,this.outerCircle.prevRotation=0,this.innerCircleSize=isMobile?153:149,this.innerCircle=a.add.sprite(e,t,"circle",this.altString+"element_normal.png").setDepth(102),this.innerCircle.setOrigin(.5003,.5003),this.innerCircle.torque=0,this.innerCircle.torqueDecay=0,this.innerCircle.torqueOnRelease=0,this.innerCircle.torqueOnReleaseOld=0,this.innerCircle.torqueOnReleaseOld2=0,this.innerCircle.torqueOnReleaseOld3=0,this.innerCircle.rotVel=0,this.innerCircle.nextRotation=0,this.innerCircle.prevRotation=0,this.shadowCircle=a.add.sprite(e,t,"circle","shadow.png").setAlpha(0).setDepth(99998).setBlendMode(Phaser.BlendModes.MULTIPLY),this.focusLines=a.add.image(e,t-130,"circle","focus_lines.png").setDepth(121),this.focusLinesOn=a.add.sprite(e,t-130,"circle","focus_lines_on.png").setDepth(121),this.castButtonSize=isMobile?72:78,this.castButton=a.add.sprite(e,t,"circle",this.altString+"cast_normal.png").setDepth(121),this.castButtonSpare=a.add.sprite(e,t,"circle",this.altString+"cast_press.png").setDepth(121).setAlpha(0),this.castHoverTemp=a.add.sprite(e,t,"circle",this.altString+"cast_press.png").setDepth(121).setAlpha(0),this.castGlow=a.add.sprite(e,t,"circle","cast_glow.png").setDepth(121).setAlpha(0),this.tintDark=a.add.image(e,t,"misc","usage_tint_k.png").setDepth(121).setAlpha(.05).setBlendMode(Phaser.BlendModes.MULTIPLY),this.tintColor=a.add.sprite(e,t,"misc","usage_tint_y.png").setDepth(121).setAlpha(.02).setBlendMode(Phaser.BlendModes.MULTIPLY),this.greyedDead=a.add.sprite(e,t,"circle","greyed_dead.png").setVisible(!1).setDepth(135),this.greyed=a.add.sprite(e,t,"circle","greyed.png").setVisible(!1).setDepth(122).setVisible(!1).setScale(1.01),this.errorBoxElement=a.add.sprite(e,t-115,"circle","error_box.png"),this.errorBoxElement.setDepth(131),this.errorBoxElement.alpha=0,this.errorBoxEmbodiment=a.add.sprite(e,t-175,"circle","error_box.png"),this.errorBoxEmbodiment.setDepth(131),this.errorBoxEmbodiment.alpha=0,this.showRunes=!1,this.spellElementText=this.scene.add.bitmapText(this.x-11,this.y-283,"normal","MATTER",isMobile?30:28,1),this.spellElementText.setScale(.7),this.spellElementText.setOrigin(1,.5),this.spellElementText.setDepth(125),this.spellElementText.alpha=.55,this.spellElementText.startY=this.spellElementText.y,this.spellElementText.visible=this.showRunes,this.spellNameText=this.scene.add.bitmapText(this.x+1,this.y-283,"normal","+",isMobile?30:28,1),this.spellNameText.setScale(.7),this.spellNameText.setOrigin(.5,.5),this.spellNameText.setDepth(125),this.spellNameText.startY=this.spellNameText.y,this.spellNameText.alpha=.55,this.spellActionText=this.scene.add.bitmapText(this.x+13,this.y-283,"normal","STRIKE",isMobile?30:28,1),this.spellActionText.setScale(.7),this.spellActionText.setOrigin(0,.5),this.spellActionText.setDepth(125),this.spellActionText.alpha=.55,this.spellActionText.startY=this.spellActionText.y,this.spellActionText.visible=this.showRunes,this.voidSliceImage1=a.add.sprite(gameConsts.halfWidth-100,255,"spells","darkSlice.png").setDepth(21).setRotation(.5*-Math.PI+.6).setAlpha(0).setOrigin(.17,.5),this.voidSliceImage3=a.add.sprite(gameConsts.halfWidth+100,255,"spells","darkSlice.png").setDepth(21).setRotation(.5*-Math.PI-.6).setAlpha(0).setOrigin(.17,.5),this.mindBurnAnim=this.scene.add.sprite(gameConsts.halfWidth,150,"spells").play("mindBurn").setAlpha(0).setDepth(10).setBlendMode(Phaser.BlendModes.ADD),this.mindBurnAnimBack=this.scene.add.sprite(gameConsts.halfWidth,150,"spells").play("mindBurn").setAlpha(0).setDepth(-1),this.spellDescriptor=new HoverDisplay({x:gameConsts.halfWidth,y:0,originX:.485,originY:1,depth:200}),this.refreshHoverText(),this.dragCircle=a.add.sprite(e,t,"circle","drag_circle.png").setAlpha(isMobile?.75:.55),this.dragCircle.setDepth(100001),this.dragCircle.visible=!1,this.dragArrow=a.add.sprite(e,t,"circle","drag_arrow.png"),this.dragArrow.setDepth(100001),this.dragArrow.setOrigin(.2,.5),this.dragArrow.visible=!1,this.elementHighlight=this.scene.add.sprite(e,t,"circle","bright_rune_matter.png").setOrigin(.5,.866).setDepth(104),this.embodimentHighlight=this.scene.add.sprite(e,t,"circle","bright_rune_strike.png").setOrigin(.5,1.22).setDepth(104),this.buildRunes()}setWheelTint(e=.05,t=.02,a="usage_tint_y.png"){this.tintDark.setAlpha(e),this.tintColor.setAlpha(t),a&&this.tintColor.setFrame(a)}createTimeStopObjs(){this.gearBonusSpeed=5,this.timeStopHeavy=this.scene.add.sprite(this.x,this.y,"spells","blackCircleLarge.png").setDepth(-3),this.timeStopHeavy.alpha=0,this.timeStopHeavy.setScale(1.7),this.clockbg=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-5,"lowq","clockbg.png").setAlpha(0).setScale(1.4),this.clockbg.setDepth(-3),this.gear1=this.scene.add.sprite(-40,280,"circle","gear.png").setAlpha(0),this.gear1.setDepth(1),this.gear1.startX=this.gear1.x,this.gear1.startY=this.gear1.y,this.gear2=this.scene.add.sprite(120,442,"circle","gear_small.png").setAlpha(0),this.gear2.setDepth(1),this.gear2.rotation=-.25,this.gear2.startX=this.gear2.x,this.gear2.startY=this.gear2.y,this.gear3=this.scene.add.sprite(565,-15,"circle","gear.png").setAlpha(0),this.gear3.setDepth(1),this.gear3.startX=this.gear3.x,this.gear3.startY=this.gear3.y,this.gear4=this.scene.add.sprite(538,575,"circle","gear_small.png").setAlpha(0),this.gear4.setDepth(1),this.gear4.startX=this.gear4.x,this.gear4.startY=this.gear4.y}finishUpMindDamage(e){this.laserIsFiring=!1}handleTimeSlow(e){1===gameVars.timeSlowRatio?(this.gearBonusSpeed=Math.min(10,this.gearBonusSpeed+e),this.gearBonusSpeed<10&&(this.gear1.rotation+=.0045*e*this.gearBonusSpeed,this.gear2.rotation-=.006*e*this.gearBonusSpeed,this.gear3.rotation+=.003*e*this.gearBonusSpeed,this.gear4.rotation+=.006*e*this.gearBonusSpeed)):(this.gearBonusSpeed=Math.max(.1,Math.max(gameVars.timeSlowRatio,.985*this.gearBonusSpeed-.03*e)),this.gear1.rotation+=.0045*e*this.gearBonusSpeed,this.gear2.rotation-=.006*e*this.gearBonusSpeed,this.gear3.rotation+=.003*e*this.gearBonusSpeed,this.gear4.rotation+=.006*e*this.gearBonusSpeed)}timeSlowFromEnemy(){gameVars.timeSlowRatio=.9,this.timeStopHeavy.setScale(1.95),this.timeStopHeavy.setAlpha(1),this.timeStopHeavy.y=150,this.scene.tweens.add({targets:this.timeStopHeavy,scaleX:7,scaleY:7,alpha:.8,ease:"Cubic.easeIn",duration:280*gameVars.gameManualSlowSpeed}),this.scene.tweens.add({targets:this.clockbg,alpha:.1,scaleX:1.3,scaleY:1.3,duration:250*gameVars.gameManualSlowSpeed}),this.gear1.setPosition(gameConsts.halfWidth,190).setScale(1.13),this.gear2.setPosition(gameConsts.halfWidth,190).setScale(.88),this.gear3.setPosition(gameConsts.halfWidth,190).setScale(2.09),this.scene.tweens.add({targets:[this.gear1,this.gear2,this.gear3],ease:"Quart.easeOut",alpha:.15,duration:1e3*gameVars.gameManualSlowSpeed}),this.scene.tweens.add({targets:[this.gear4],ease:"Quart.easeOut",alpha:0,duration:1e3*gameVars.gameManualSlowSpeed})}cancelTimeSlow(){messageBus.publish("clearGameSlow"),1!==gameVars.timeSlowRatio&&(gameVars.timeSlowRatio=1,globalObjects.currentEnemy&&globalObjects.currentEnemy.bgMusic&&(globalObjects.currentEnemy.bgMusic.detune=0),this.scene.tweens.add({targets:[this.timeStopHeavy],ease:"Quint.easeOut",alpha:.01,duration:700*gameVars.gameManualSlowSpeed,onComplete:()=>{this.scene.tweens.add({targets:[this.timeStopHeavy],alpha:0,duration:500*gameVars.gameManualSlowSpeed})}}),this.scene.tweens.add({targets:[this.gear1,this.gear2,this.gear3,this.gear4,this.clockbg],ease:"Quad.easeIn",alpha:0,duration:300*gameVars.gameManualSlowSpeed}))}manualSetTimeSlowRatio(e=1,t=1){this.setTimeSlowRatio(e/t,!0),.999<e?messageBus.publish("clearGameSlow"):(gameVars.gameManualSlowSpeed=.46,gameVars.gameManualSlowSpeedInverse=1/gameVars.gameManualSlowSpeed,PhaserScene.tweens.timeScale=.46,PhaserScene.anims.globalTimeScale=.46),this.timeStopHeavy.y=this.y,this.timeStopHeavy.setScale(1.7),this.timeStopHeavy.setAlpha(1);e=Math.max(0,(t-2)/t);this.scene.tweens.add({targets:this.timeStopHeavy,scaleX:7,scaleY:7,alpha:.8+.2*e,ease:"Cubic.easeIn",duration:280*gameVars.gameManualSlowSpeed}),this.scene.tweens.add({targets:this.clockbg,alpha:.07+.025*e,scaleX:1.3,scaleY:1.3,duration:250*gameVars.gameManualSlowSpeed}),this.gear1.setPosition(this.gear1.startX,this.gear1.startY).setScale(1).setDepth(1),this.gear2.setPosition(this.gear2.startX,this.gear2.startY).setScale(1).setDepth(1),this.gear3.setPosition(this.gear3.startX,this.gear3.startY).setScale(1).setDepth(1),this.gear4.setPosition(this.gear4.startX,this.gear4.startY),this.scene.tweens.add({targets:[this.gear1,this.gear2,this.gear3,this.gear4],ease:"Quart.easeOut",alpha:.2+.11*e,duration:1e3*gameVars.gameManualSlowSpeed})}setTimeSlowRatio(e=1,t){var a=gameVars.timeSlowRatio;(gameVars.timeSlowRatio=e)<.99?(playSound("timeSlow"),globalObjects.currentEnemy&&globalObjects.currentEnemy.bgMusic&&(globalObjects.currentEnemy.bgMusic.detune=-1e3)):globalObjects.currentEnemy&&globalObjects.currentEnemy.bgMusic&&(globalObjects.currentEnemy.bgMusic.detune=0),a!=e&&(messageBus.publish("setTimeSlowRatio",e),1==e)&&(this.scene.tweens.add({targets:[this.timeStopHeavy],ease:"Quint.easeOut",alpha:.01,duration:700*gameVars.gameManualSlowSpeed,onComplete:()=>{this.scene.tweens.add({targets:[this.timeStopHeavy],alpha:0,duration:500*gameVars.gameManualSlowSpeed})}}),this.scene.tweens.add({targets:[this.gear1,this.gear2,this.gear3,this.gear4,this.clockbg],ease:"Quad.easeIn",alpha:0,duration:300*gameVars.gameManualSlowSpeed}))}attackLaunched(){var s=globalObjects.player.getStatuses().mindReinforce;if(s){let e=s.multiplier,t=s.animObj[1],a=s.animObj[1];this.scene.tweens.add({targets:t,duration:150*gameVars.gameManualSlowSpeed,scaleX:1.135+.02*e,scaleY:1.135+.02*e,alpha:1,ease:"Cubic.easeOut",onComplete:()=>{this.scene.tweens.add({targets:t,duration:400*gameVars.gameManualSlowSpeed,scaleX:.975+.01*e,scaleY:.975+.01*e,ease:"Back.easeOut",onComplete:()=>{this.scene.tweens.add({targets:t,duration:750*gameVars.gameManualSlowSpeed,alpha:.6})}})}}),this.scene.tweens.add({targets:a,duration:200*gameVars.gameManualSlowSpeed,scaleX:1.17+.02*e,scaleY:1.17+.02*e,alpha:1,ease:"Cubic.easeOut",onComplete:()=>{this.scene.tweens.add({targets:a,duration:550*gameVars.gameManualSlowSpeed,scaleX:1+.012*e,scaleY:1+.012*e,ease:"Back.easeOut",onComplete:()=>{this.scene.tweens.add({targets:a,duration:750*gameVars.gameManualSlowSpeed,alpha:.6})}})}}),this.showReadySprite(!0,1.5)}}buildRunes(){var t=this.x,a=this.y;if(this.elements)for(let e=0;e<this.elements.length;e++)this.elements[e].destroy(),this.elements[e].glow.destroy();if(this.embodiments)for(let e=0;e<this.embodiments.length;e++)this.embodiments[e].destroy(),this.embodiments[e].glow.destroy();this.elements=[],this.embodiments=[];for(let e=0;e<ELEMENT_ARRAY.length;e++)this.elements[e]=this.scene.add.sprite(t,a,"circle",ELEMENT_ARRAY[e]+".png"),this.elements[e].setOrigin(.5,.866),this.elements[e].setDepth(103),this.elements[e].rotation=2*Math.PI/ELEMENT_ARRAY.length*e,this.elements[e].startRotation=this.elements[e].rotation,this.elements[e].runeName=ELEMENT_ARRAY[e],this.elements[e].alpha=.44,this.elements[e].glow=this.scene.add.sprite(t,a,"circle",ELEMENT_ARRAY[e]+"_glow.png"),this.elements[e].glow.setOrigin(.5,.866),this.elements[e].glow.setDepth(103).setAlpha(.99),this.elements[e].glow.rotation=this.elements[e].rotation;for(let e=0;e<EMBODIMENT_ARRAY.length;e++)this.embodiments[e]=this.scene.add.sprite(t,a,"circle",EMBODIMENT_ARRAY[e]+".png"),this.embodiments[e].setOrigin(.5,1.22),this.embodiments[e].setDepth(103),this.embodiments[e].rotation=2*Math.PI/EMBODIMENT_ARRAY.length*e,this.embodiments[e].startRotation=this.embodiments[e].rotation,this.embodiments[e].runeName=EMBODIMENT_ARRAY[e],this.embodiments[e].alpha=.44,this.embodiments[e].glow=this.scene.add.sprite(t,a,"circle",EMBODIMENT_ARRAY[e]+"_glow.png"),this.embodiments[e].glow.setOrigin(.5,1.22),this.embodiments[e].glow.setDepth(103).setAlpha(.99),this.embodiments[e].glow.rotation=this.embodiments[e].rotation}setFrameLazy(e,t){e.lazyFrame=t}updateRotationVisuals(e){this.aura.rotVel+=.006*this.innerCircle.rotVel*e+.008*this.outerCircle.rotVel*e,this.aura.rotVel*=1-.07*e,this.aura.rotation+=.001*e+this.aura.rotVel,this.aura.setScale(.9+Math.abs(this.aura.rotVel));for(let e=0;e<this.elements.length;e++)this.elements[e].rotation=this.innerCircle.rotation+this.elements[e].startRotation,this.elements[e].glow.rotation=this.elements[e].rotation;for(let e=0;e<this.embodiments.length;e++)this.embodiments[e].rotation=this.outerCircle.rotation+this.embodiments[e].startRotation,this.embodiments[e].glow.rotation=this.embodiments[e].rotation;this.elementHighlight.closest&&(this.elementHighlight.rotation=this.elementHighlight.closest.rotation),this.embodimentHighlight.closest&&(this.embodimentHighlight.rotation=this.embodimentHighlight.closest.rotation)}calculateRotations(g,e=0){if(!this.innerDragDisabled&&!this.outerDragDisabled){var d=DECAY;let t=999,a=999;var u,p;let s=null,i=null;for(let e=0;e<this.elements.length;e++)u=this.getRotationDiff(this.innerCircle.nextRotation,-this.elements[e].startRotation),Math.abs(u)<Math.abs(t)&&(t=u,s=this.elements[e]);for(let e=0;e<this.embodiments.length;e++)p=this.getRotationDiff(this.outerCircle.nextRotation,-this.embodiments[e].startRotation),Math.abs(p)<Math.abs(a)&&(a=p,i=this.embodiments[e]);this.outerDragDisabled||this.castDisabled||this.manualDisabled||this.recharging?(this.elementHighlight.visible=!1,this.embodimentHighlight.visible=!1):(s.glow.visible?(this.elementHighlight.closest=s,this.elementHighlight.visible=!0,this.elementHighlight.setRotation(s.rotation).setFrame("bright_"+s.frame.name).setOrigin(.5,.866)):this.elementHighlight.visible=!1,i.glow.visible?(this.embodimentHighlight.closest=i,this.embodimentHighlight.visible=!0,this.embodimentHighlight.setRotation(i.rotation).setFrame("bright_"+i.frame.name).setOrigin(.5,1.22)):this.embodimentHighlight.visible=!1),this.recentlyUpdatedSpellHover?this.recentlyUpdatedSpellHover=!1:(this.recentlyUpdatedSpellHover=!0,this.updateSpellHover(s,i,t,a));var m=1e-5<this.innerCircle.torque*this.innerCircle.torque?.6:1,b=1e-5<this.outerCircle.torque*this.outerCircle.torque?.6:1;let e=1-d*g*1*m*((Math.abs(this.innerCircle.rotVel)+.001)/.004),n=1-d*g*.9*b*((Math.abs(this.outerCircle.rotVel)+.001)/.004),l=STATIC*g*1*m,r=STATIC*g*.84*b;0<this.stalagmites.length&&(this.outerCircle.torque*=.8,r*=2),0===this.keyboardRotateInner||this.innerDragDisabled?this.usedKeyboardInner&&(this.usedKeyboardInner=!1,this.innerCircle.rotVel*=.7):(this.usedKeyboardInner=!0,d=.005/(.005+Math.abs(this.innerCircle.rotVel)),this.innerCircle.torque=.056*this.keyboardRotateInner*d),0===this.keyboardRotateOuter||this.outerDragDisabled?this.usedKeyboardOuter&&(this.usedKeyboardOuter=!1,this.outerCircle.rotVel*=.7):(this.usedKeyboardOuter=!0,m=.005/(.005+Math.abs(this.outerCircle.rotVel)),this.outerCircle.torque=.0555*this.keyboardRotateOuter*m),.01<Math.abs(this.innerCircle.rotVel)&&(this.innerCircle.torque*=.7),.01<Math.abs(this.outerCircle.rotVel)&&(this.outerCircle.torque*=.7),this.forcingAlignment&&(this.innerCircle.torque=0,this.outerCircle.torque=0),this.innerCircle.rotVel+=this.innerCircle.torque,this.outerCircle.rotVel+=this.outerCircle.torque,0<this.preventRotDecay?this.preventRotDecay-=g*gameVars.gameManualSlowSpeedInverse:(this.innerCircle.rotVel<-MIN_VEL?(this.innerCircle!==this.draggedObj&&0===this.keyboardRotateInner&&0<t&&-.105<this.innerCircle.rotVel&&this.innerCircle.rotVel<-.028&&(l*=3.2,e*=.98),this.innerCircle.rotVel=Math.min(0,this.innerCircle.rotVel*e+l)):this.innerCircle.rotVel>MIN_VEL?(this.innerCircle!==this.draggedObj&&0===this.keyboardRotateInner&&t<0&&this.innerCircle.rotVel<.105&&.028<this.innerCircle.rotVel&&(l*=3.2,e*=.98),this.innerCircle.rotVel=Math.max(0,this.innerCircle.rotVel*e-l)):this.innerCircle.rotVel=0,this.outerCircle.rotVel<-MIN_VEL?(this.outerCircle!==this.draggedObj&&0===this.keyboardRotateOuter&&0<a&&this.outerCircle.rotVel<-.024&&-.094<this.outerCircle.rotVel&&(r*=3.55,n*=.98),this.outerCircle.rotVel=Math.min(0,this.outerCircle.rotVel*n+r)):this.outerCircle.rotVel>MIN_VEL?(this.outerCircle!==this.draggedObj&&0===this.keyboardRotateOuter&&a<0&&this.outerCircle.rotVel<.094&&.024<this.outerCircle.rotVel&&(r*=3.55,n*=.98),this.outerCircle.rotVel=Math.max(0,this.outerCircle.rotVel*n-r)):this.outerCircle.rotVel=0),.036<Math.abs(this.innerCircle.rotVel)&&(this.innerCircle.rotVel*=.98),.036<Math.abs(this.outerCircle.rotVel)&&(this.outerCircle.rotVel*=.98);0===this.innerCircle.torque&&(8e-4<(b=Math.max(Math.abs(this.innerCircle.torqueOnRelease),Math.abs(.75*this.innerCircle.torqueOnReleaseOld2),Math.abs(.35*this.innerCircle.torqueOnReleaseOld3)))&&(this.innerCircle.torqueOnRelease*this.innerCircle.rotVel<0&&this.innerCircle.torqueOnReleaseOld2*this.innerCircle.rotVel<0&&this.innerCircle.torqueOnReleaseOld*this.innerCircle.rotVel<0?this.innerCircle.rotVel*=.03:.0021<b?(d=Math.min(1.8,Math.max(1,+b/.0021)),this.innerCircle.rotVel*=d,-.05<this.innerCircle.rotVel&&this.innerCircle.rotVel<-.001?this.innerCircle.rotVel=-.045:this.innerCircle.rotVel<.05&&.001<this.innerCircle.rotVel&&(this.innerCircle.rotVel=.045),this.innerCircle.nextRotation+=this.innerCircle.rotVel):this.innerCircle.rotVel=0),this.innerCircle.torqueOnRelease=0,this.innerCircle.torqueOnReleaseOld=0,this.innerCircle.torqueOnReleaseOld2=0,this.innerCircle.torqueOnReleaseOld3=0),0===this.outerCircle.torque&&(8e-4<(m=Math.max(Math.abs(this.outerCircle.torqueOnRelease),Math.abs(.75*this.outerCircle.torqueOnReleaseOld2),Math.abs(.35*this.outerCircle.torqueOnReleaseOld3)))&&(this.outerCircle.torqueOnRelease*this.outerCircle.rotVel<0&&this.outerCircle.torqueOnReleaseOld2*this.outerCircle.rotVel<0&&this.outerCircle.torqueOnReleaseOld*this.outerCircle.rotVel<0?this.outerCircle.rotVel*=.03:.003<m?(b=Math.min(1.8,Math.max(1,+m/.003)),this.outerCircle.rotVel*=b,-.046<this.outerCircle.rotVel&&this.outerCircle.rotVel<-.001?this.outerCircle.rotVel=-.038:this.outerCircle.rotVel<.046&&.001<this.outerCircle.rotVel&&(this.outerCircle.rotVel=.038),this.outerCircle.nextRotation+=this.outerCircle.rotVel):this.outerCircle.rotVel=0),this.outerCircle.torqueOnRelease=0,this.outerCircle.torqueOnReleaseOld=0,this.outerCircle.torqueOnReleaseOld2=0,this.outerCircle.torqueOnReleaseOld3=0);d=Math.abs(this.innerCircle.rotVel)<.01?2:1,m=Math.abs(this.outerCircle.rotVel)<.01?2.25:1;let o=0,h=0;var b=g+.1,b=b*b,f=gameVars.wasTouch?.15:.08,f=(this.storedDragAngleDiff>f?this.storedDragAngleDiff=f:this.storedDragAngleDiff<-f&&(this.storedDragAngleDiff=-f),this.draggedObj===this.innerCircle?o=this.storedDragAngleDiff*(gameVars.wasTouch?.06:.05)*b:this.draggedObj===this.outerCircle&&(h=this.storedDragAngleDiff*(gameVars.wasTouch?.06:.05)*b),this.storedDragAngleDiff=0,this.innerCircle.rotVel+this.innerCircle.torque*g*5*d+o),b=this.outerCircle.rotVel+this.outerCircle.torque*g*3.5*m+h,d=1-.02*(1-gameVars.timeSlowRatio),m=this.handleSpinSnapSlowAmt(this.innerCircle,this.elements),S=this.handleSpinSnapSlowAmt(this.outerCircle,this.embodiments);let c=1;var O=globalObjects.player.spellMultiplier();1<O&&(c=.85,3<O)&&(c=.6),this.innerCircle.prevRotation=this.innerCircle.nextRotation,this.outerCircle.prevRotation=this.outerCircle.nextRotation,this.innerCircle.nextRotation+=f*d*m*c,this.outerCircle.nextRotation+=b*d*S*c,this.innerCircle.rotation=.5*(this.innerCircle.nextRotation+this.innerCircle.prevRotation),this.outerCircle.rotation=.5*(this.outerCircle.nextRotation+this.outerCircle.prevRotation),this.tintColor.rotation=this.outerCircle.rotation,this.tintDark.rotation=this.outerCircle.rotation,this.autolockRune(1),this.innerCircle.torqueDecay=this.innerCircle.torqueDecay/(1+g)+this.innerCircle.torque,this.outerCircle.torqueDecay=this.outerCircle.torqueDecay/(1+g)+this.outerCircle.torque,this.innerCircle.torque=0,this.outerCircle.torque=0}}handleSpinSnapSlowAmt(t,a){let s=999;var i;for(let e=0;e<a.length;e++)i=this.getRotationDiff(t.rotation,a[e].startRotation),Math.abs(i)<Math.abs(s)&&(s=i,a[e]);let e=1;return s<.025&&.001<s?e=Math.min(.9,.5+10*Math.abs(t.rotVel)):.15<s&&(e=1.5),e}autolockRune(e){if(this.draggedObj!==this.innerCircle){let t=999;for(let e=0;e<this.elements.length;e++){var a=this.getRotationDiff(this.innerCircle.nextRotation+2*this.innerCircle.rotVel,this.elements[e].startRotation);Math.abs(a)<Math.abs(t)&&(t=a)}var s=Math.abs(t);t<.45&&.005<s&&(s=Math.min(1,Math.max(0,1-1.8*s)),s*=s*s*s,this.innerCircle.rotation-=t*s,s=Math.max(0,1-Math.max(0,25*Math.abs(this.innerCircle.rotVel))),this.innerCircle.nextRotation-=.24*t*s)}if(this.draggedObj!==this.outerCircle){let t=999;for(let e=0;e<this.embodiments.length;e++){var i=this.getRotationDiff(this.outerCircle.nextRotation+2*this.outerCircle.rotVel,this.embodiments[e].startRotation);Math.abs(i)<Math.abs(t)&&(t=i)}var s=Math.abs(t);Math.abs(t)<.4&&.005<s&&(s=Math.min(1,Math.max(0,1-2*s)),s*=s*s*s,this.outerCircle.rotation-=t*s,s=Math.max(0,1-Math.max(0,25*Math.abs(this.outerCircle.rotVel))),this.outerCircle.nextRotation-=.2*t*s)}}updateFramesLazy(){var e="circle";this.castDisabled?this.castButton.frame.name!==this.altString+"cast_disable.png"&&(this.castGlow.alpha=.5,this.scene.tweens.add({targets:this.castGlow,duration:1e3*gameVars.gameManualSlowSpeed,ease:"Quint.easeOut",alpha:0}),this.castButton.setTexture(e,this.altString+"cast_disable.png")):this.castButton.frame.customData.filename!==this.castButton.lazyFrame&&(this.castButton.frame.customData.filename===this.altString+"cast_disable.png"&&this.castButton.lazyFrame===this.altString+"cast_normal.png"&&(this.castButtonSpare.alpha=.6,this.scene.tweens.add({targets:this.castButtonSpare,duration:400*gameVars.gameManualSlowSpeed,ease:"Cubic.easeOut",alpha:0})),this.castButton.setTexture(e,this.castButton.lazyFrame)),this.innerCircle.frame.customData.filename!==this.innerCircle.lazyFrame&&this.innerCircle.setTexture(e,this.innerCircle.lazyFrame).setOrigin(.50012,.5),this.outerCircle.lazyFrame&&this.outerCircle.frame.customData.filename!==this.outerCircle.lazyFrame&&this.outerCircle.setTexture(e,this.outerCircle.lazyFrame).setOrigin(.4999,.5000001)}updateShields(s){this.pillarFireDelay=Math.max(0,this.pillarFireDelay-100*s);var t=globalObjects.player.getStatuses(),i=[];for(let e=0;e<this.tempRotObjs.length;e++)this.tempRotObjs[e].rotation=this.tempLockRot+this.outerCircle.rotation;var e,a,n=t.matterUnload,n=(n&&(n.animObj[0].rotation=this.outerCircle.rotation),t.matterReinforce);for(a in n&&(e=n.animObj[0],n=n.animObj[1],e.rotation=this.outerCircle.rotation,n.rotation=this.outerCircle.rotation),this.stalagmites){var l=this.stalagmites[a];l.rotation=l.startRotation+this.outerCircle.rotation,l.lastRotation*l.rotation<0&&!this.recharging&&Math.abs(l.rotation)+Math.abs(l.lastRotation)<1&&l.fire(),l.lastRotation=l.rotation}for(let e=0;e<10;e++)t["shield"+e]&&i.push(t["shield"+e]);for(let e=0;e<i.length;e++){var r=i[e];r.animObj[0]===this.tempRotObjs[0]&&(this.tempRotObjs=[]);let a=0;switch(r.type){case"mind":var o,h,c=.28+.03*r.multiplier,g=r.lockRotation+this.outerCircle.rotation;r.isLocked||(r.animObj[0].rotation=g),r.isBlasting?(r.animObj[2].visible=!0,h=g+r.animObj[2].rotateOffset,r.animObj[2].rotation=h,o=Math.sin(h),h=Math.cos(h),r.animObj[2].x=r.animObj[2].startX+210*o,r.animObj[2].y=r.animObj[2].startY-210*h+220,r.textObj.x=r.animObj[2].startX+150*o,r.textObj.y=r.animObj[2].startY-150*h+175):0<r.impactVisibleTime?(r.animObj[2].visible=!0,r.impactVisibleTime=Math.max(0,r.impactVisibleTime-s),o=g+r.animObj[2].rotateOffset,r.animObj[2].rotation=o,h=Math.sin(o),g=Math.cos(o),r.animObj[2].x=r.animObj[2].startX+220*h,r.animObj[2].y=r.animObj[2].startY-220*g+220,r.textObj.x=r.animObj[2].startX+150*h,r.textObj.y=r.animObj[2].startY-150*g+175):r.animObj[2].visible&&(r.animObj[2].visible=!1),(a=Math.abs(r.animObj[0].rotation))<c?r.active||(r.active=!0,this.scene.tweens.add({targets:r.animObj[0],duration:275*gameVars.gameManualSlowSpeed,scaleX:1.05*r.animObj[0].origScaleX,easeParams:[4],scaleY:1,ease:"Back.easeOut"})):a>1.1*c&&r.active&&(r.active=!1,r.animObj[0].currAnim&&r.animObj[0].currAnim.stop(),this.scene.tweens.add({targets:r.animObj[0],duration:275*gameVars.gameManualSlowSpeed,scaleX:r.animObj[0].origScaleX-.2,scaleY:.985,ease:"Cubic.easeOut"})),r.animObj[0].alpha=r.active?.82:.5,r.animObj[1].visible=r.active;break;case"matter":var d,g=.54+.03*r.multiplier,c=r.lockRotation+this.outerCircle.rotation;r.animObj[0].rotation=c,r.animObj[1].x=r.animObj[1].startX+222*Math.sin(c),r.animObj[1].y=r.animObj[1].startY-222*Math.cos(c)+222,0<r.impactVisibleTime?(r.animObj[2].visible=!0,r.impactVisibleTime=Math.max(0,r.impactVisibleTime-s),d=c+r.animObj[2].rotateOffset,r.animObj[2].rotation=d,r.animObj[2].x=r.animObj[2].startX+225*Math.sin(d),r.animObj[2].y=r.animObj[2].startY-225*Math.cos(d)+225):r.animObj[2].visible&&(r.animObj[2].visible=!1),a=Math.abs(r.animObj[0].rotation),0<r.shakeAmt&&(d=r.shakeAmt*(Math.random()-.5),r.shakeAmt=Math.max(0,r.shakeAmt-.012*s),r.animObj[0].rotation+=d),a<g?r.active||(r.active=!0,r.animObj[0].alpha=1,r.animObj[1].alpha=1,this.scene.tweens.add({targets:r.animObj[0],duration:275*gameVars.gameManualSlowSpeed,scaleX:r.animObj[0].origScaleX,easeParams:[3],scaleY:1,ease:"Back.easeOut"})):a>1.1*g&&r.active&&(r.active=!1,r.animObj[0].alpha=.75,r.animObj[1].alpha=.75,r.animObj[0].currAnim&&r.animObj[0].currAnim.stop(),this.scene.tweens.add({targets:r.animObj[0],duration:275*gameVars.gameManualSlowSpeed,scaleX:r.animObj[0].origScaleX-.06,scaleY:.99,ease:"Cubic.easeOut"}));break;case"time":var u=.52+.03*r.multiplier,p=r.lockRotation+this.outerCircle.rotation;let e=r.animObj[1].rotation;p>e+2*Math.PI-.5?e+=2*Math.PI:p<e-2*Math.PI+.5&&(e-=2*Math.PI);var m=.5*p+.5*e;r.animObj[0].rotation=p,r.animObj[1].rotation=m,a=Math.abs(r.animObj[0].rotation),0<r.shakeAmt&&(p=r.shakeAmt*(Math.random()-.5),r.shakeAmt=Math.max(0,r.shakeAmt-.012*s),r.animObj[0].rotation+=p,r.animObj[1].rotation+=.5*p),a<u?r.active||(r.active=!0,r.animObj[0].alpha=.85,r.animObj[1].alpha=.85,this.scene.tweens.add({targets:[r.animObj[0],r.animObj[1]],duration:250*gameVars.gameManualSlowSpeed,scaleX:r.animObj[0].origScaleX,scaleY:.965,ease:"Cubic.easeOut"})):a>1.1*u&&r.active&&(r.active=!1,r.animObj[0].alpha=.5,r.animObj[1].alpha=.5,this.scene.tweens.add({targets:[r.animObj[0],r.animObj[1]],duration:250*gameVars.gameManualSlowSpeed,scaleX:r.animObj[0].origScaleX-.35,scaleY:.95,ease:"Cubic.easeOut"}));break;case"void":var b=r.lockRotation+this.outerCircle.rotation,f=r.animObj[0];let t=r.animObj[1];r.animObj[2].rotation=b,r.jiggleAmt=Math.max(0,r.jiggleAmt-.01*s);var S=(f.length-1)/2;for(let e=0;e<f.length;e++){var O=S-e,y=(O*=O,r.spreadAmt*f[e].rotationOffset);f[e].x=f[e].startX+Math.sin(b+y)*(206+-.8*O),f[e].y=f[e].startY-Math.cos(b+y)*(210+-.8*O)-10,f[e].scaleVel+=((Math.random()-.45)*(.003+.08*r.jiggleAmt)+(.95-.01*O-f[e].scaleX)*(.005+.008*r.jiggleAmt))*s,f[e].scaleVel*=1-(.03+.02*r.jiggleAmt)*s,f[e].setScale(f[e].scaleX+f[e].scaleVel)}for(let e=0;e<t.length;e++)t[e].x=t[e].startX+206*Math.sin(b+t[e].rotationOffset),t[e].y=t[e].startY-209*Math.cos(b+t[e].rotationOffset)-11,t[e].rotVel+=.02*(Math.random()-.5)*s,t[e].rotVel*=1-.02*s,t[e].rotation+=t[e].rotVel;if(Math.random()<(.003+.001*t.length)*s){let e=Math.floor(Math.random()*t.length);this.scene.tweens.add({targets:t[e],duration:150*gameVars.gameManualSlowSpeed,scaleX:.1,ease:"Cubic.easeIn",onComplete:()=>{this.scene.tweens.add({targets:t[e],duration:150*gameVars.gameManualSlowSpeed,scaleX:1,ease:"Cubic.easeOut"})}})}if((a=Math.abs(b))<.48){r.active=!0,r.spreadAmt+=.1*(1-r.spreadAmt)*s;for(let e=0;e<f.length;e++)f[e].scaleVel+=.001*s}else.528<a&&(r.active=!1,r.spreadAmt+=.1*(.8-r.spreadAmt)*s)}}}getRotationDiff(e,t){let a=e-t;for(;3.142<a;)a-=2*Math.PI;for(;a<-3.142;)a+=2*Math.PI;return a}castSpell(e=!1){if(!this.manualDisabled){this.castDisabled=!0,this.useBufferedSpellCast=!1,this.bufferedCastAvailable=!1;let a=999,s=999,i=null,n=null,l=0;e&&(this.castHoverTempAnim&&this.castHoverTempAnim.stop(),this.castHoverTemp.alpha=1,this.castHoverTempAnim=this.scene.tweens.add({targets:this.castHoverTemp,duration:500*gameVars.gameManualSlowSpeed,ease:"Cubic.easeOut",alpha:0}));for(let t=0;t<this.elements.length;t++){var o=this.getRotationDiff(this.innerCircle.rotation,this.elements[t].startRotation);if(Math.abs(o)<Math.abs(a)){a=o;let e=this.elements.length-t;0===t&&(e=0),i=this.elements[e]}}(.24<Math.abs(a)||i.burnedOut)&&(i=null);for(let t=0;t<this.embodiments.length;t++){var h=this.getRotationDiff(this.outerCircle.rotation,this.embodiments[t].startRotation);if(Math.abs(h)<Math.abs(s)){s=h;let e=this.embodiments.length-t;0===t&&(e=0),n=this.embodiments[e],l=e}}(.22<Math.abs(s)||n.burnedOut)&&(n=null,l=-1),i&&null==i.runeName&&(i=null),n&&null==n.runeName&&(n=null),null!==i&&null!==n?(cheats.infiniteAmmo||(i.glow.visible=!1,n.glow.visible=!1,i.burnedOut=!0,n.burnedOut=!0),this.forcingAlignment=!0,this.outerCircle.rotVel*=.01,this.innerCircle.rotVel*=.01,this.createElementCast(i),this.createEmbodimentCast(n,()=>{this.trueCastSpell(i,n,l,n.startRotation)}),this.spellNameTextAnim&&this.spellNameTextAnim.stop(),this.spellDescriptor.addTween({ease:"Cubic.easeIn",alpha:0,duration:400*gameVars.gameManualSlowSpeed}),this.spellNameTextAnim=this.scene.tweens.add({targets:[this.spellNameText,this.spellElementText,this.spellActionText],ease:"Cubic.easeIn",alpha:0,duration:400*gameVars.gameManualSlowSpeed}),messageBus.publish("spellClicked")):(e=this.keyboardCasted?50:0,PhaserScene.time.delayedCall(gameVars.gameManualSlowSpeed*e,()=>{this.bufferedCastAvailable=!0,PhaserScene.time.delayedCall(250*gameVars.gameManualSlowSpeed,()=>{this.castDisabled=!1,this.bufferedCastAvailable=!1,this.useBufferedSpellCast&&this.castSpell(!0)})}),null==i&&this.flashElement(this.errorBoxElement),null==n&&this.flashElement(this.errorBoxEmbodiment));let t=!1,r=!1;for(let e=0;e<this.elements.length;e++)if(!this.elements[e].burnedOut&&null!=this.elements[e].runeName){t=!0;break}for(let e=0;e<this.embodiments.length;e++)if(!this.embodiments[e].burnedOut&&null!=this.embodiments[e].runeName){r=!0;break}t&&r||this.postCastResetWheel()}}postCastResetWheel(){this.recharging||(this.elementHighlight.visible=!1,this.embodimentHighlight.visible=!1,this.innerDragDisabled=!0,this.outerDragDisabled=!0,this.castDisabled=!0,this.disableSpellDescDisplay=!0,this.recharging=!0,this.lastDragTime=-1e3,messageBus.publish("resetCircle"),this.scene.tweens.add({targets:this.innerCircle,ease:"Back.easeIn",easeParams:[1.04],onComplete:()=>{this.resetElements(),this.innerDragDisabled=!1,this.innerDragDisabled||this.outerDragDisabled||(this.castDisabled=!1,this.recharging=!1,this.bufferedCastAvailable=!1)},duration:1650*gameVars.gameManualSlowSpeed,rotation:"+=6.283"}),this.scene.tweens.add({targets:this.outerCircle,delay:0,easeParams:[1.04],ease:"Back.easeIn",onComplete:()=>{this.resetEmbodiments(),this.outerDragDisabled=!1,this.innerDragDisabled||this.outerDragDisabled||(this.castDisabled=!1,this.recharging=!1,this.bufferedCastAvailable=!1)},duration:1650*gameVars.gameManualSlowSpeed,rotation:"-=6.283"}))}manualResetElements(e,t=!1){this.innerDragDisabled||(this.manuallyResettingElements=!0,this.innerDragDisabled=!0,this.castDisabled=!0,this.recharging=!0,this.lastDragTime=-1e3,this.elementHighlight.visible=!1,this.embodimentHighlight.visible=!1,t&&(this.spellNameText.visible=!1,this.spellElementText.setText(""),this.spellActionText.setText(""),this.clearSpellDescriptorText(),this.spellDescriptor.stopNextAudio()),this.scene.tweens.add({targets:this.innerCircle,ease:"Back.easeIn",easeParams:[t?.9:1.1],onComplete:()=>{this.resetElements(e),this.innerDragDisabled=!1},duration:gameVars.gameManualSlowSpeed*t?2100:1200,rotation:t?"+=12.566":"+=6.283"}))}resetElements(t){for(let e=this.lastDragTime=0;e<this.elements.length;e++)t&&t==this.elements[e]||(this.elements[e].glow.visible=!0,this.elements[e].burnedOut=!1);this.elementHighlight.visible=!1,this.embodimentHighlight.visible=!1;let e=this.elemCircle;e||(this.elemCircle=this.scene.add.sprite(this.x,this.y,"circle","circle.png"),(e=this.elemCircle).setDepth(131)),e.setScale(.8).setAlpha(1),this.innerCircle.prevRotation=this.innerCircle.rotation,this.innerCircle.nextRotation=this.innerCircle.rotation,this.scene.tweens.add({targets:e,alpha:0,scaleX:1,scaleY:1,duration:500*gameVars.gameManualSlowSpeed})}manualResetEmbodiments(e,t=!1){this.outerDragDisabled||(this.outerDragDisabled=!0,this.castDisabled=!0,this.disableSpellDescDisplay=!0,this.recharging=!0,this.lastDragTime=-1e3,this.elementHighlight.visible=!1,this.embodimentHighlight.visible=!1,PhaserScene.time.delayedCall(250*gameVars.gameManualSlowSpeed,()=>{this.bufferedCastAvailable=!0}),this.scene.tweens.add({targets:this.outerCircle,ease:"Back.easeIn",easeParams:[t?1.1:1.25],onComplete:()=>{this.resetEmbodiments(e),this.outerDragDisabled=!1,setTimeout(()=>{var e;this.outerDragDisabled||(t&&(this.disableSpellDescDisplay=!1),this.castDisabled=!1,this.recharging=!1,this.bufferedCastAvailable=!1,this.useBufferedSpellCast&&this.castSpell(!0),this.readySprite?(this.readySprite.visible=!0,this.readySprite.play(t?"circleEffect":"circleEffectSmall"),this.readySprite.setScale(1.1)):this.readySprite=this.scene.add.sprite(this.x,this.y,"circle").play("circleEffect").setScale(1.1).setDepth(1e3),this.readySprite.setAlpha(1),e=gameVars.gameManualSlowSpeed*(t?1200:900),this.scene.tweens.add({targets:this.readySprite,scaleX:t?2.63:2.57,scaleY:t?2.63:2.57,duration:e,ease:"Cubic.easeOut",onComplete:()=>{this.readySprite.visible=!1}}),this.scene.tweens.add({targets:this.readySprite,alpha:0,duration:e,ease:"Quad.easeIn"}))},t?800:0)},duration:gameVars.gameManualSlowSpeed*t?2100:1200,rotation:t?"+=12.566":"+=6.283"}))}resetEmbodiments(t){for(let e=this.lastDragTime=0;e<this.embodiments.length;e++)t&&t==this.embodiments[e]||(this.embodiments[e].glow.visible=!0,this.embodiments[e].burnedOut=!1);this.elementHighlight.visible=!1,this.embodimentHighlight.visible=!1;let e=this.embodiCircle;e||(this.embodiCircle=this.scene.add.sprite(this.x,this.y,"circle","circle.png"),(e=this.embodiCircle).setDepth(130)),e.setAlpha(0).setScale(1.05),messageBus.publish("wheelReloaded"),this.outerCircle.prevRotation=this.outerCircle.rotation,this.outerCircle.nextRotation=this.outerCircle.rotation,this.scene.tweens.add({targets:e,alpha:0,scaleX:1.2,scaleY:1.2,duration:500*gameVars.gameManualSlowSpeed,completeDelay:500,onComplete:()=>{}})}createElementCast(e){var t,a=e.runeName;let s=this.elementsAnimArray[a],i=(s&&!1!==s.canUse||(t=s&&s.canUse,(s=this.scene.add.sprite(0,-999,"circle","bright_"+a+".png")).setOrigin(.5,.14),t||(this.elementsAnimArray[a]=s),s.setDepth(130),s.shouldDelete=t),s.canUse=!1,poolManager.getItemFromPool("castCircle"));i||(i=this.scene.add.sprite(this.x,this.y-100,"circle","cast_circle.png")).setDepth(130),i.alpha=0,i.setScale(1.25),i.rotation=0,s.setPosition(this.x+133*Math.sin(e.rotation),this.y-133*Math.cos(e.rotation)),s.setAlpha(1),i.setPosition(s.x,s.y+21),s.setScale(1.2),this.scene.tweens.add({targets:s,duration:100*gameVars.gameManualSlowSpeed,ease:"Cubic.easeOut",scaleX:isMobile?1.5:1.4,scaleY:isMobile?1.5:1.4,y:"-=6",onComplete:()=>{this.scene.tweens.add({targets:s,ease:"Cubic.easeOut",y:"+=9",duration:350*gameVars.gameManualSlowSpeed,scaleX:isMobile?1.075:1.05,scaleY:isMobile?1.075:1.05})}}),this.scene.tweens.add({targets:i,duration:250*gameVars.gameManualSlowSpeed,alpha:.95}),this.scene.tweens.add({targets:i,ease:"Cubic.easeIn",duration:220*gameVars.gameManualSlowSpeed,scaleX:1,scaleY:1,onComplete:()=>{i.alpha=1,this.scene.tweens.add({targets:i,duration:650*gameVars.gameManualSlowSpeed,delay:30,ease:"Quart.easeInOut",rotation:-1.57,alpha:.55}),this.scene.tweens.add({targets:[i],ease:"Quart.easeInOut",delay:60,duration:800*gameVars.gameManualSlowSpeed,x:this.x-28,y:this.y-246}),this.scene.tweens.add({targets:[s],ease:"Quart.easeInOut",delay:60,duration:800*gameVars.gameManualSlowSpeed,x:this.x-28,y:this.y-262,onComplete:()=>{this.scene.tweens.add({targets:[s,i],alpha:0,scaleX:1.5,scaleY:1.5,y:"-=2",x:"-=2",ease:"Cubic.easeOut",duration:600*gameVars.gameManualSlowSpeed,onComplete:()=>{poolManager.returnItemToPool(i,"castCircle"),s.shouldDelete?s.destroy():(s.setScale(1),s.canUse=!0)}})}})}})}createEmbodimentCast(e,s){let i=e.runeName,n=this.embodimentsAnimArray[i];var t;n&&!1!==n.canUse||(t=n&&n.canUse,(n=this.scene.add.sprite(0,-999,"circle","bright_"+i+".png")).setOrigin(.5,.14),t||(this.embodimentsAnimArray[i]=n),n.setDepth(130),n.shouldDelete=t);let l="rune_strike"===i,r=(n.canUse=!1,poolManager.getItemFromPool("castCircle"));r||(r=this.scene.add.sprite(this.x,this.y-100,"circle","cast_circle.png")).setDepth(130),r.alpha=0,r.setScale(1.25),r.rotation=0,n.setPosition(this.x+196*Math.sin(e.rotation),this.y-197*Math.cos(e.rotation)),n.setAlpha(1),r.setPosition(n.x,n.y+18),n.setScale(1.2),this.scene.tweens.add({targets:n,y:"-=9",duration:100*gameVars.gameManualSlowSpeed,ease:"Cubic.easeOut",scaleX:isMobile?1.55:1.44,scaleY:isMobile?1.55:1.44,completeDelay:isMobile?50:0,onComplete:()=>{this.scene.tweens.add({targets:n,ease:"Cubic.easeOut",y:"+=9",duration:350*gameVars.gameManualSlowSpeed,scaleX:isMobile?1.075:1.05,scaleY:isMobile?1.075:1.05})}}),this.scene.tweens.add({targets:r,duration:250*gameVars.gameManualSlowSpeed,alpha:.95}),this.focusLinesOn.currAnim&&this.focusLinesOn.currAnim.stop(),this.focusLinesOn.setFrame("focus_lines_glow.png"),this.focusLinesOn.alpha=1,this.scene.tweens.add({targets:this.focusLinesOn,duration:325*gameVars.gameManualSlowSpeed,ease:"Quart.easeIn",alpha:0,onComplete:()=>{this.focusLinesOn.setFrame("focus_lines_on.png")}}),this.scene.tweens.add({targets:r,ease:"Cubic.easeIn",duration:220*gameVars.gameManualSlowSpeed,scaleX:1,scaleY:1,onComplete:()=>{r.alpha=1,this.scene.tweens.add({targets:r,duration:650*gameVars.gameManualSlowSpeed,delay:30,ease:"Quart.easeInOut",rotation:1.57,alpha:.55});let t=l?100:0,a=this.keyboardCasted?100:0;PhaserScene.time.delayedCall(0*gameVars.gameManualSlowSpeed,()=>{this.forcingAlignment=!1}),this.scene.tweens.add({targets:n,delay:60,rotation:0,duration:750*gameVars.gameManualSlowSpeed,onComplete:()=>{var e=this.outerDragDisabled?650:0;this.focusLinesOn.currAnim=this.scene.tweens.add({delay:a+e+t,targets:this.focusLinesOn,duration:150*gameVars.gameManualSlowSpeed,alpha:.65,ease:"Cubic.easeIn",onComplete:()=>{this.focusLinesOn.setAlpha(1),this.focusLinesOn.currAnim=this.scene.tweens.add({targets:this.focusLinesOn,duration:200*gameVars.gameManualSlowSpeed,alpha:.94,onComplete:()=>{this.focusLinesOn.currAnim=null}})}})}}),this.scene.tweens.add({targets:[r],ease:"Quart.easeInOut",delay:60,duration:800*gameVars.gameManualSlowSpeed,x:this.x+28,y:this.y-246}),this.scene.tweens.add({targets:[n],ease:"Quart.easeInOut",delay:60,duration:800*gameVars.gameManualSlowSpeed,x:this.x+28,y:this.y-262,onComplete:()=>{s(),PhaserScene.time.delayedCall(230*gameVars.gameManualSlowSpeed,()=>{this.bufferedCastAvailable=!0}),PhaserScene.time.delayedCall(gameVars.gameManualSlowSpeed*(25+a+t),()=>{this.outerDragDisabled||(this.castDisabled=!1),"center"===gameOptions.infoBoxAlign&&(this.disableSpellDescDisplay=!0),this.spellNameTextAnim&&this.spellNameTextAnim.stop();let e=0;"rune_strike"!==i&&"rune_ultimate"!==i||(e=400),this.spellNameTextAnim=this.scene.tweens.add({targets:[this.spellNameText,this.spellActionText,this.spellElementText],delay:1e3+e,alpha:.55,duration:150*gameVars.gameManualSlowSpeed,onStart:()=>{this.disableSpellDescDisplay=!1,this.spellDescriptor.addTween({ease:"Cubic.easeInOut",alpha:"center"===gameOptions.infoBoxAlign?.9:.98,duration:150*gameVars.gameManualSlowSpeed})}}),this.bufferedCastAvailable=!1,this.useBufferedSpellCast&&this.castSpell(!0)}),this.scene.tweens.add({targets:[r],alpha:0,scaleX:1.5,scaleY:1.5,x:"+=2",y:"-=2",ease:"Cubic.easeOut",duration:600*gameVars.gameManualSlowSpeed,onComplete:()=>{poolManager.returnItemToPool(r,"castCircle"),n.shouldDelete?n.destroy():(n.setScale(1),n.canUse=!0)}}),this.scene.tweens.add({targets:[n],alpha:0,scaleX:1.5,scaleY:1.5,x:"+=2",y:"-=6",ease:"Cubic.easeOut",duration:600*gameVars.gameManualSlowSpeed,onComplete:()=>{n.shouldDelete?n.destroy():(n.setScale(1),n.canUse=!0)}})}})}})}showReadySprite(e=!0,t=1){this.readySprite&&(this.readySprite.currAnim&&this.readySprite.currAnim.stop(),this.readySprite.setAlpha(1),this.readySprite.setScale(1.15*t),this.readySprite.play(e?"circleEffect":"circleEffectSmall"),this.readySprite.visible=!0,this.readySprite.currAnim=this.scene.tweens.add({targets:this.readySprite,scaleX:t=(e?1.8:1.75)*t,scaleY:t,duration:gameVars.gameManualSlowSpeed*e?800:650,ease:"Cubic.easeOut",onComplete:()=>{this.readySprite.visible=!1}}))}trueCastSpell(e,t,a=-1,s){messageBus.publish("castSpell",e,t,-1!=a?"shield"+a:"undefinedShield",s)}setAuraAlpha(e=0){this.aura.alpha=e}flashElement(e){this.playErrorSfxCooldown||(playSound("fizzle",.8),this.playErrorSfxCooldown=!0,setTimeout(()=>{this.playErrorSfxCooldown=!1},300)),e.setAlpha(.25),e.setScale(.98),this.scene.tweens.add({targets:e,ease:"Cubic.easeIn",scaleX:1.02,scaleY:1.02,onComplete:()=>{this.scene.tweens.add({targets:e,ease:"Cubic.easeOut",duration:gameVars.gameManualSlowSpeed*isMobile?750:600,scaleX:1,scaleY:1,alpha:0})},duration:50*gameVars.gameManualSlowSpeed,alpha:isMobile?.8:.7})}getDelayedDamageClockScale(){var e=Math.max(0,Math.floor((this.delayedDamage-1)/this.delayedDamageBase));return.5+.1*(Math.sqrt(.5*e)+.2*e)}plainUpdateDelayedDamageVisual(e){this.delayDamageHourglass.setScale(e-.1);var t=Math.floor(Math.max(0,this.delayedDamage-.5)/this.delayedDamageBase)*this.delayedDamageBase,e=(0<t?(this.delayDamageSandFull.alpha=1,this.delayDamageSandFull.setScale(e-.28)):this.delayDamageSandFull.setScale(0),(this.delayedDamage-t)/this.delayedDamageBase*6.283-1.5708),t=this.delayDamageHourglass.x,a=this.delayDamageHourglass.y,s=98*this.delayDamageHourglass.scaleX;this.delayDamagePartial.visible=!0,this.delayDamagePartial.canCleanup=!0,this.delayDamagePartial.clear(),this.delayDamagePartial.slice(t,a,s,-1.5708,e,!1),this.delayDamagePartial.fillPath()}clearClock(){this.delayDamagePartial&&this.delayDamagePartial.canCleanup&&(this.delayDamagePartial.clear(),this.delayDamagePartial.canCleanup=!1),this.scene.tweens.add({delay:100,targets:[this.delayDamageHourglass,this.delayDamageSandFull,this.delayDamageText],ease:"Back.easeIn",scaleX:0,scaleY:0,duration:400*gameVars.gameManualSlowSpeed,alpha:0})}handleStatusesTicked(){var e;0<this.delayedDamage&&(this.delayedDamageRecentlyAdded?this.delayedDamageRecentlyAdded=!1:this.delayedDamageShouldTick?(this.tickDelayedDamage(),e=this.getDelayedDamageClockScale(),this.plainUpdateDelayedDamageVisual(e),this.delayedDamage<=this.delayedDamageBase&&(this.delayedDamageShouldTick=!1),this.delayedDamage<=0&&this.clearClock()):this.delayedDamageShouldTick=!0)}tickDelayedDamage(e=1){globalObjects.currentEnemy&&!globalObjects.currentEnemy.dead&&(this.delayedDamage-=e,0<globalObjects.player.recentlyTakenDelayedDamageAmt&&(globalObjects.player.recentlyTakenDelayedDamageAmt-=e,globalObjects.player.recentlyTakenDamageAmt+=e),this.delayDamageText.setText(this.delayedDamage),messageBus.publish("selfTakeTrueDamage",e))}getDelayedDamage(){return this.delayedDamage}enableVoidArm(e,t,a){var s=1.3<a,e=gameVars.gameManualSlowSpeed*e;this.voidArm.setScale(s?.95*a:1.15*a),this.scene.tweens.add({targets:this.voidArm,delay:e,duration:gameVars.gameManualSlowSpeed*(t-900),y:210,onComplete:()=>{this.scene.tweens.add({targets:this.voidArm,alpha:0,duration:400*gameVars.gameManualSlowSpeed,ease:"Cubic.easeIn"})}}),this.scene.tweens.add({targets:this.voidArm,delay:e,duration:350*gameVars.gameManualSlowSpeed,ease:s?"Back.easeOut":"Quad.easeOut",easeParams:[5],alpha:1,scaleX:a,scaleY:a}),s&&(this.voidArm2.setScale(s?.95*a:1.15*a),this.scene.tweens.add({targets:this.voidArm2,delay:e,duration:gameVars.gameManualSlowSpeed*(t-900),y:210,onComplete:()=>{this.scene.tweens.add({targets:this.voidArm2,alpha:0,duration:400*gameVars.gameManualSlowSpeed,ease:"Cubic.easeIn"})}}),this.scene.tweens.add({targets:this.voidArm2,delay:e,duration:350*gameVars.gameManualSlowSpeed,ease:"Back.easeOut",easeParams:[5],alpha:1,scaleX:a,scaleY:a}))}addDelayedDamage(e){var t,a,s,i;if(globalObjects.currentEnemy&&!globalObjects.currentEnemy.dead)return a=this.delayedDamage,this.delayedDamage+=e,this.delayedDamageRecentlyAdded=!0,globalObjects.player.canResetRecentDamage&&(globalObjects.player.canResetRecentDamage=!1,globalObjects.player.resetRecentDamage(),globalObjects.player.recentlyTakenDelayedDamageAmt=0,globalObjects.player.lastInjuryHealth=globalObjects.player.health),globalObjects.player.addRecentlyTakenDelayedDamage(e),0<this.delayedDamage&&(this.delayDamageText.setText(this.delayedDamage),e=this.getDelayedDamageClockScale(),t=.75*Math.sqrt(2*e),a<=0?(this.delayDamageHourglass.setScale(e-.4),this.delayDamageText.setScale(t-.3),this.delayDamageHourglass.setRotation(.5),this.delayDamageHourglass.setAlpha(.5),this.delayDamageText.setAlpha(.5),a=this.delayedDamage/this.delayedDamageBase*6.283-1.5708,s=this.delayDamageHourglass.x,i=this.delayDamageHourglass.y,e=98*(e-.1),this.delayDamagePartial.visible=!0,this.delayDamagePartial.clear(),this.delayDamagePartial.slice(s,i,e,-1.5708,a,!1),this.delayDamagePartial.fillPath(),this.scene.tweens.add({targets:[this.delayDamagePartial],duration:400*gameVars.gameManualSlowSpeed,alpha:1}),s=[this.delayDamageHourglass,this.delayDamageText],this.delayedDamage>this.delayedDamageBase&&(this.delayDamageSandFull.setScale(this.delayDamageHourglass.scaleX-.175),s.push(this.delayDamageSandFull)),this.scene.tweens.add({targets:s,ease:"Cubic.easeOut",rotation:0,scaleX:"+= 0.3",scaleY:"+= 0.3",duration:400*gameVars.gameManualSlowSpeed,alpha:1,onComplete:()=>{var e=this.getDelayedDamageClockScale();this.plainUpdateDelayedDamageVisual(e)}})):(this.scene.tweens.add({targets:[this.delayDamageText],ease:"Cubic.easeOut",rotation:0,scaleX:t,scaleY:t,duration:250*gameVars.gameManualSlowSpeed,alpha:1}),i=this.getDelayedDamageClockScale(),this.plainUpdateDelayedDamageVisual(i))),this.delayedDamage}reduceDelayedDamage(e){var t;this.delayedDamage=Math.max(0,this.delayedDamage-e),0<e&&(t=Math.min(1.25,.5+.2*Math.sqrt(Math.abs(e))),messageBus.publish("animateHealNum",this.delayDamageText.x-1,this.delayDamageText.y-50,"+"+e,.5+t)),this.delayedDamage<=0?this.removeDelayedDamage():(this.delayDamageText.setText(this.delayedDamage),e=this.getDelayedDamageClockScale(),this.plainUpdateDelayedDamageVisual(e))}removeDelayedDamage(){this.delayedDamage=0,this.delayDamageText.setText(this.delayedDamage),this.clearClock()}setTempRotObjs(e,t){this.tempRotObjs=e,this.tempLockRot=t}updateSpellDescriptorText(e){if(this.spellDescriptor.getText()!==e)if(this.disableSpellDescDisplay||this.manualDisabled||globalObjects.bannerTextManager.isShowing)this.clearSpellDescriptorText(),this.spellDescriptor.stopNextAudio();else{if(!this.spellDescriptor.getStopNextAudio()){let e=0,t=1;var a=Date.now()-this.lastPlayedClickTime;25<a&&(a<1e3&&(e=Math.floor(.5*(a-900-Math.floor(100*Math.random()))),t=.8+.001*e),playSound("click",t).detune=e,this.lastPlayedClickTime=Date.now())}messageBus.publish("spellNameTextUpdate",e),this.spellDescriptor.setText(e),"center"===gameOptions.infoBoxAlign&&(this.spellDescriptor.isMultiLine()?(this.spellElementText.y=this.spellElementText.startY-15,this.spellNameText.y=this.spellNameText.startY-15,this.spellActionText.y=this.spellActionText.startY-15):(this.spellElementText.y=this.spellElementText.startY,this.spellNameText.y=this.spellNameText.startY,this.spellActionText.y=this.spellActionText.startY))}}clearSpellDescriptorText(){""!==this.spellDescriptor.getText()&&(this.spellDescriptor.setText(""),this.showRunes||this.spellNameText.setText(""),"center"===gameOptions.infoBoxAlign)&&(this.spellElementText.y=this.spellElementText.startY,this.spellNameText.y=this.spellNameText.startY,this.spellActionText.y=this.spellActionText.startY)}updateSpellHover(e,t,a,s){var i=globalObjects.player.spellMultiplier();let n=!1,l=("left"===gameOptions.infoBoxAlign?(this.disableSpellDescDisplay||this.manualDisabled||globalObjects.bannerTextManager.isShowing)&&(this.clearSpellDescriptorText(),this.spellDescriptor.stopNextAudio(),n=!0):(this.castDisabled||this.disableSpellDescDisplay||this.manualDisabled||globalObjects.bannerTextManager.isShowing)&&(this.clearSpellDescriptorText(),this.spellDescriptor.stopNextAudio(),n=!0),"");if(!n)switch(t.runeName){case RUNE_STRIKE:l="STRIKE";break;case RUNE_REINFORCE:l="BODY";break;case RUNE_ENHANCE:l="ENHANCE";break;case RUNE_PROTECT:l="SHIELD";break;case RUNE_UNLOAD:l="ULTIMATE"}var r,o="center"===gameOptions.infoBoxAlign?"_long":"";let h="",c="";if(!n){switch(e.runeName){case RUNE_MATTER:switch(this.spellElementText.setText("MATTER"),t.runeName){case RUNE_STRIKE:h="|",c="|",gameVars.matterPlus?this.updateSpellDescriptorText(getLangText("matter_strike_plus_desc"+o)):this.updateSpellDescriptorText(getLangText("matter_strike_desc"+o));break;case RUNE_REINFORCE:l+=1.1<i?" X"+i:"",this.updateSpellDescriptorText(getLangText("matter_reinforce_desc"+o));break;case RUNE_ENHANCE:l+=1.1<i?" X"+i:"",this.updateSpellDescriptorText(getLangText("matter_enhance_desc"+o));break;case RUNE_PROTECT:l+=1.1<i?" X"+i:"",this.updateSpellDescriptorText(getLangText((gameVars.matterPlus?"matter_protect_plus_desc":"matter_protect_desc")+o));break;case RUNE_UNLOAD:l+=1.1<i?" X"+i:"",this.updateSpellDescriptorText(getLangText("matter_unload_desc"+o));break;default:this.clearSpellDescriptorText()}break;case RUNE_TIME:switch(this.spellElementText.setText("TIME"),t.runeName){case RUNE_STRIKE:h="|",c="|",this.updateSpellDescriptorText(getLangText("time_strike_desc"+o));break;case RUNE_REINFORCE:var g=1-.5**i,d=globalObjects.player.getSelfHealAmt(g),u=globalObjects.player.lastInjuryHealth-globalObjects.player.health,u=Math.min(u,globalObjects.player.recentlyTakenDamageAmt*g);l+=" (\\"+d+")",c=" (\\"+d+")",this.updateSpellDescriptorText(getLangText("time_reinforce_desc"+o)),1<u&&globalObjects.player.flashRecentInjury(!1,u,!0);break;case RUNE_ENHANCE:l+=1.1<i?" X"+i:"",this.updateSpellDescriptorText(getLangText("time_enhance_desc"+o));break;case RUNE_PROTECT:l+=1.1<i?" X"+i:"",this.updateSpellDescriptorText(getLangText("time_protect_desc"+o));break;case RUNE_UNLOAD:let e=0,t=i;for(;0<t;)t--,e+=Math.max(3,7-globalObjects.player.getPlayerTimeExhaustion()-t);c=" ("+e+" TURNS)",this.updateSpellDescriptorText(getLangText("time_unload_desc"+o)+e+getLangText("time_unload_desc_2"+o));break;default:this.clearSpellDescriptorText()}break;case RUNE_MIND:switch(this.spellElementText.setText("ENERGY"),t.runeName){case RUNE_STRIKE:h="}",c="}",this.updateSpellDescriptorText(getLangText("mind_strike_desc"+o));break;case RUNE_REINFORCE:l+=1.1<i?" X"+i:"",this.updateSpellDescriptorText(getLangText("mind_reinforce_desc"+o));break;case RUNE_ENHANCE:l+=1.1<i?" X"+i:"",gameVars.mindPlus?this.updateSpellDescriptorText(getLangText("mind_enhance_plus_desc"+o)):this.updateSpellDescriptorText(getLangText("mind_enhance_desc"+o));break;case RUNE_PROTECT:l+=1.1<i?" X"+i:"",this.updateSpellDescriptorText(getLangText("mind_protect_desc"+o));break;case RUNE_UNLOAD:l+="",this.updateSpellDescriptorText(getLangText("mind_unload_desc"+o));break;default:this.clearSpellDescriptorText()}break;case RUNE_VOID:switch(this.spellElementText.setText("VOID"),t.runeName){case RUNE_STRIKE:h="|",c="|",this.updateSpellDescriptorText(getLangText("void_strike_desc"+o));break;case RUNE_ENHANCE:l+=1.1<i?" X"+i:"",this.updateSpellDescriptorText(getLangText("void_enhance_desc"+o));break;case RUNE_PROTECT:l+=1.1<i?" X"+i:"",this.updateSpellDescriptorText(getLangText("void_protect_desc"+o));break;case RUNE_REINFORCE:l+=1.1<i?" X"+i:"",this.updateSpellDescriptorText(getLangText("void_reinforce_desc"+o));break;case RUNE_UNLOAD:h=";",c=";",this.updateSpellDescriptorText(getLangText("void_unload_desc"+o));break;default:this.clearSpellDescriptorText()}break;default:this.spellElementText.setText(""),this.clearSpellDescriptorText()}e.runeName&&t.runeName?(r=e.runeName+"_"+t.runeName,this.spellNameText.setText(h+getBasicText(r)+c)):this.spellNameText.setText("")}this.showRunes?""===this.spellElementText.text&&""===this.spellActionText.text?this.spellNameText.visible=!1:this.spellNameText.visible=!0:""===this.spellElementText.text||""===this.spellActionText.text?this.spellNameText.visible=!1:this.spellNameText.visible=!0,!globalObjects.currentEnemy||globalObjects.currentEnemy.isDestroyed||globalObjects.currentEnemy.dead||(this.spellNameText.visible?""!==l&&e.runeName&&("STRIKE"===l?globalObjects.currentEnemy.setPredictScale(23):"ULTIMATE"===l?e.runeName===RUNE_MATTER&&globalObjects.currentEnemy.setPredictScale(23):globalObjects.currentEnemy.setPredictScale()):globalObjects.currentEnemy.setPredictScale(0)),this.spellActionText.setText(l),(this.castDisabled||this.manualDisabled)&&(this.spellNameText.visible=!1,this.spellElementText.setText(""),this.spellActionText.setText(""))}applyMindBurn(e=5,t=1){var a;globalObjects.currentEnemy&&!globalObjects.currentEnemy.dead&&(this.mindBurnTween&&this.mindBurnTween.stop(),this.mindBurnAnim.alpha=.35,this.mindBurnAnimBack.alpha=.35,t=(gameVars.mindPlus?3:2)*t,this.mindBurnAnim.setScale(.55+.05*Math.sqrt(e)+.05*t),this.mindBurnAnimBack.setScale(this.mindBurnAnim.scaleX),this.flashBGWhite||(this.flashBGWhite=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight-200,"blurry","circle.webp").setDepth(-1).setAlpha(0)),this.flashBGWhite.setScale(a=2+.02*e),this.scene.tweens.add({targets:this.flashBGWhite,alpha:.005*e-.02,scaleX:1.2*a,scaleY:1.2*a,duration:120*gameVars.gameManualSlowSpeed,ease:"Cubic.easeOut",onComplete:()=>{this.scene.tweens.add({targets:this.flashBGWhite,alpha:0,duration:250*gameVars.gameManualSlowSpeed+10*e,ease:"Cubic.easeOut"})}}),messageBus.publish("showCircleShadow",.03+.005*e,20*e-90),this.mindBurnAnim.currAnim&&this.mindBurnAnim.currAnim.stop(),this.animateMindBurn(5,t),messageBus.publish("enemyOnFire",5))}animateMindBurn(e,t){this.mindBurnAnim.setScale(.75+.052*t),this.mindBurnAnimBack.setScale(this.mindBurnAnim.scaleX),this.mindBurnAnim.alpha=.62,this.mindBurnAnimBack.alpha=.62,messageBus.publish("enemyTakeTrueDamage",t,!1,0,!0);var a=.85*Math.max(0,t+1);messageBus.publish("addCastAggravate",a,!1,0,!0),this.mindBurnAnim.currAnim=e<=1?PhaserScene.tweens.add({targets:[this.mindBurnAnim,this.mindBurnAnimBack],alpha:0,scaleX:1+.05*t,scaleY:1+.05*t,duration:250,ease:"Quad.easeOut"}):this.scene.tweens.add({targets:[this.mindBurnAnim,this.mindBurnAnimBack],alpha:.3,duration:500,scaleX:.65+.05*t,scaleY:.65+.05*t,completeDelay:500,onComplete:()=>{this.animateMindBurn(e-1,t)}})}applyVoidBurn(t=1,e,a){if(globalObjects.currentEnemy){let e=.7+.1*Math.sqrt(t);this.voidSliceImage1.visible=!0,this.voidSliceImage3.visible=!0,this.voidSliceImage1.alpha=.75,this.voidSliceImage3.alpha=.75,this.voidSliceImage1.setScale(.4*e,.95*e),this.voidSliceImage3.setScale(.4*e,.95*e),this.scene.tweens.add({targets:[this.voidSliceImage1,this.voidSliceImage3],ease:"Cubic.easeOut",scaleX:.8*e,scaleY:.8*e,alpha:.45,duration:150*gameVars.gameManualSlowSpeed}),this.voidSliceImage1.anim&&(this.currVoidAnim.remove(),this.voidSliceImage1.anim.stop(),this.voidSliceImage3.anim.stop()),this.voidSliceImage1.anim=this.scene.tweens.add({delay:100,targets:this.voidSliceImage1,scaleX:.5*e,scaleY:.95*e,alpha:.65,ease:"Quad.easeOut",duration:1e3*gameVars.gameManualSlowSpeed}),this.voidSliceImage3.anim=this.scene.tweens.add({delay:100,targets:this.voidSliceImage3,scaleX:.45*e,scaleY:e,alpha:.7,ease:"Quad.easeOut",duration:2e3*gameVars.gameManualSlowSpeed}),this.currVoidAnim=PhaserScene.time.delayedCall(1100,()=>{this.fireVoidSpike(this.voidSliceImage1,e,t),this.currVoidAnim=PhaserScene.time.delayedCall(700,()=>{if(this.fireVoidSpike(this.voidSliceImage3,e,t),a){let e=getTempPoolObject("tutorial","rune_void_large.png","specialAttack",1300);e.setAlpha(.05).setDepth(999).setScale(5).setPosition(gameConsts.halfWidth,this.voidSliceImage3.y-42).setRotation(-3),playSound("void_body"),this.scene.tweens.add({targets:e,duration:125,alpha:1}),this.scene.tweens.add({targets:e,duration:1250,rotation:0,ease:"Quart.easeOut"}),this.scene.tweens.add({targets:e,duration:125,scaleX:3.2,scaleY:3.2,ease:"Quint.easeIn",onComplete:()=>{zoomTemp(1.02),screenShake(3),messageBus.publish("setSlowMult",.25,15),this.scene.tweens.add({delay:200,targets:e,duration:900,alpha:0,ease:"Cubic.easeOut"}),this.scene.tweens.add({delay:200,targets:e,duration:900,scaleX:4,scaleY:4,ease:"Cubic.easeIn"})}})}})})}}fireVoidSpike(e,t,a){e.anim&&e.anim.stop(),e.alpha=1,playSound("void_strike",.3),PhaserScene.time.delayedCall(100*gameVars.gameManualSlowSpeed,()=>{messageBus.publish("enemyTakeDamage",a,!0,void 0,"void"),messageBus.publish("setPauseDur",30)}),e.setScale(4*t,.6*t),this.scene.tweens.add({delay:1,targets:e,ease:"Quart.easeOut",scaleX:1.9*t,scaleY:.75*t,duration:100*gameVars.gameManualSlowSpeed,onComplete:()=>{this.scene.tweens.add({delay:100,targets:e,ease:"Cubic.easeIn",scaleX:t,scaleY:0,duration:150*gameVars.gameManualSlowSpeed})}})}handleVoidForm(){this.castDisabled=!0,this.bufferedCastAvailable=!1,this.outerDragDisabled=!0,this.innerDragDisabled=!0,this.lastDragTime=Math.min(this.lastDragTime,-9999),gameVars.playerNotMoved=!1,this.disableSpellDescDisplay=!0,this.removeDelayedDamage()}clearVoidForm(){this.castDisabled=!1,this.outerDragDisabled=!1,this.innerDragDisabled=!1,this.lastDragTime=0,this.disableSpellDescDisplay=!1}clearMindForm(e){}hasRune(e){for(var t in this.elements)if(this.elements[t].runeName===e&&!this.elements[t].burnedOut)return!0;for(var a in this.embodiments)if(this.embodiments[a].runeName===e&&!this.embodiments[a].burnedOut)return!0;return!1}clearEffects(e){if(!e)for(this.voidSliceImage1.visible=!1,this.voidSliceImage3.visible=!1,this.mindBurnAnim.alpha=0,this.mindBurnAnimBack.alpha=0,this.removeDelayedDamage();0<this.stalagmites.length;){var t=this.stalagmites.pop();poolManager.returnItemToPool(t,"stalagmite")}}disableMovement(){this.greyed.visible=!0,this.manualDisabled=!0,this.disableSpellDescDisplay=!0}enableMovement(){this.greyed.visible=!1,this.manualDisabled=!1,this.disableSpellDescDisplay=!1}playerDied(){this.removeDelayedDamage(),this.disableMovement(),this.greyedDead.visible=!0,this.greyedDead.alpha=1,this.disappearDeath&&this.disappearDeath.stop()}playerRevived(){this.enableMovement(),this.disappearDeath=this.scene.tweens.add({targets:this.greyedDead,alpha:0,duration:250*gameVars.gameManualSlowSpeed})}highlightRunes(){if(this.errorBoxElement.setDepth(1e4),this.errorBoxEmbodiment.setDepth(1e4),this.elementHighlight.setDepth(1e4),this.embodimentHighlight.setDepth(1e4),this.elements)for(let e=0;e<this.elements.length;e++)this.elements[e].glow.setDepth(1e4);if(this.embodiments)for(let e=0;e<this.embodiments.length;e++)this.embodiments[e].glow.setDepth(1e4)}unhighlightRunes(){if(this.errorBoxElement.setDepth(121),this.errorBoxEmbodiment.setDepth(121),this.elementHighlight.setDepth(104),this.embodimentHighlight.setDepth(104),this.elements)for(let e=0;e<this.elements.length;e++)this.elements[e].glow.setDepth(103);if(this.embodiments)for(let e=0;e<this.embodiments.length;e++)this.embodiments[e].glow.setDepth(103)}showCircleShadow(e=.25,t=0,a=99999){this.shadowCircle.setDepth(a),this.shadowCircle.alpha=e,this.shadowCircle.currAnim&&this.shadowCircle.currAnim.stop(),this.shadowCircle.currAnim=this.scene.tweens.add({targets:this.shadowCircle,alpha:0,ease:"Cubic.easeIn",duration:950*gameVars.gameManualSlowSpeed+1e3*e+t})}setCircleShadow(e=.2){this.shadowCircle.alpha=e}consumeAllStrikes(t=()=>{}){let a=0;for(var s in this.embodiments){s=this.embodiments[s];if(s.glow.visible&&s.runeName===RUNE_STRIKE){cheats.infiniteAmmo||(s.glow.visible=!1,s.burnedOut=!0);var i=s.x+180*Math.sin(s.rotation),n=s.y-180*Math.cos(s.rotation);let e=PhaserScene.add.image(i,n,"circle","bright_rune_strike.png");e.setScale(1.05).setOrigin(.5,.25).setDepth(s.depth).setRotation(s.rotation),e.strikeCount=a,PhaserScene.tweens.add({targets:e,duration:450,rotation:0,ease:"Cubic.easeOut"}),PhaserScene.tweens.add({targets:e,duration:250,scaleX:1.2,scaleY:1.2,easeParams:[3],ease:"Back.easeOut",onComplete:()=>{t(e,e.strikeCount)}}),a++}}let l=!1;for(let e=0;e<this.embodiments.length;e++)if(!this.embodiments[e].burnedOut&&null!=this.embodiments[e].runeName){l=!0;break}return l||this.postCastResetWheel(),a}refreshHoverText(){"center"===gameOptions.infoBoxAlign?(this.spellDescriptor.setOrigin(.48,1),this.spellDescriptor.setPosition(gameConsts.halfWidth,isMobile?gameConsts.height-366:gameConsts.height-358),this.spellDescriptor.setAlign("center"),this.spellDescriptor.setAlpha(.9),this.spellElementText.y=this.spellElementText.startY,this.spellNameText.y=this.spellNameText.startY,this.spellActionText.y=this.spellActionText.startY):"none"===gameOptions.infoBoxAlign?(this.spellDescriptor.setPosition(-9999,0),this.spellElementText.y=this.y-249,this.spellNameText.y=this.y-249,this.spellActionText.y=this.y-249):"left"===gameOptions.infoBoxAlign&&(this.spellDescriptor.setOrigin(0,1),this.spellDescriptor.setPosition(0,gameConsts.height-310),this.spellDescriptor.setAlign("left"),this.spellDescriptor.setAlpha(.98),this.spellElementText.y=this.y-249,this.spellNameText.y=this.y-249,this.spellActionText.y=this.y-249)}firePillar(t){this.outerCircle.rotVel=0,t.rotation=.06-.12*Math.random()+.2*t.rotation;var e=this.stalagmites.findIndex(e=>e.stalagIdx===t.stalagIdx);-1!==e&&this.stalagmites.splice(e,1),this.pillarFireDelay+=180,PhaserScene.tweens.add({delay:this.pillarFireDelay-180,targets:t,scaleX:1,scaleY:1.12,ease:"Quart.easeIn",duration:100,onStart:()=>{this.stalagFlipFlop=!this.stalagFlipFlop,t.setAlpha(1).setDepth(62),playSound("matter_ultimate",1.1).detune=(this.stalagFlipFlop?100:-300)+200*Math.random(),playSound("rock_crumble",this.stalagFlipFlop?.25:.45).detune=200*Math.random()-100},onComplete:()=>{t.setFrame("stalagmite1.png"),t.setScale(1,1.13),t.setDepth(61),messageBus.publish("enemyTakeDamage",20,!1),messageBus.publish("addCastAggravate",20),screenShake(4),zoomTemp(1.015),PhaserScene.tweens.add({targets:t,scaleX:1,scaleY:1,ease:"Quart.easeOut",duration:300,onComplete:()=>{t.setDepth(60),PhaserScene.tweens.add({delay:500,targets:t,alpha:0,scaleY:.8,ease:"Quart.easeIn",duration:300,onComplete:()=>{poolManager.returnItemToPool(t,"stalagmite")}})}})}})}addStalagmites(t=1){for(let e=0;e<t;e++){var a,s=gameConsts.halfWidth;let n=globalObjects.player.getY(),e=poolManager.getItemFromPool("stalagmite"),t=poolManager.getItemFromPool("stalagmite");for(a in e=e||PhaserScene.add.sprite(s,n,"spells","stalagmite0.png").setDepth(60),t=t||PhaserScene.add.sprite(s,n,"spells","stalagmite0.png").setDepth(60),e.setRotation(-1.57).setAlpha(.8).setDepth(61),e.lastRotation=e.rotation,e.startRotation=e.rotation-this.outerCircle.rotation,e.stalagIdx=this.stalagIdx++,t.setRotation(1.57).setAlpha(.8).setDepth(61),t.lastRotation=t.rotation,t.startRotation=t.rotation-this.outerCircle.rotation,t.stalagIdx=this.stalagIdx++,e.fire=()=>{this.firePillar(e)},t.fire=()=>{this.firePillar(t)},e.setScale(.76,.5),t.setScale(.76,.5),this.stalagmites)this.stalagmites[a].setDepth(60);this.shiftAroundPillar(e),this.shiftAroundPillar(t),this.stalagmites.push(e),this.stalagmites.push(t),PhaserScene.tweens.add({targets:[e,t],scaleX:.78,scaleY:.61,ease:"Cubic.easeIn",duration:200}),PhaserScene.time.delayedCall(50,()=>{for(let e=0;e<6;e++){var t=-.15-.2*Math.random(),a=.15+.2*Math.random(),s=.75*(Math.random()-.5),i=250+500*Math.random();globalObjects.spellManager.createRockParticle(gameConsts.halfWidth-150,n,t,s,i),globalObjects.spellManager.createRockParticle(gameConsts.halfWidth+150,n,a,s,i)}})}}shiftAroundPillar(a){var s=[0,.1,-.1,.2,-.2,.3,-.3];for(let t=0;t<s.length;t++){var i,n=s[t];let e=!0;for(i in this.stalagmites){var l=this.stalagmites[i].startRotation-a.startRotation-n;if(l<.05&&-.05<l){e=!1;break}}if(e)return void(a.startRotation+=n)}a.startRotation+=.3-.6*Math.random()}}class Player{constructor(e,t,a){this.scene=e,this.initStats(t,a),this.resetStats(),this.createHealthBar(t,a+.5),this.createMisc(),this.subscriptions=[messageBus.subscribe("selfTakeEffect",this.takeEffect.bind(this)),messageBus.subscribe("selfTakeEnemyEffect",this.takeEnemyEffect.bind(this)),messageBus.subscribe("selfTakeDamage",this.takeDamage.bind(this)),messageBus.subscribe("selfHeal",this.selfHeal.bind(this)),messageBus.subscribe("selfHealPercent",this.selfHealPercent.bind(this)),messageBus.subscribe("selfHealDelayPercent",this.selfHealDelayPercent.bind(this)),messageBus.subscribe("selfHealRecent",this.selfHealRecent.bind(this)),messageBus.subscribe("selfTakeTrueDamage",this.takeTrueDamage.bind(this)),messageBus.subscribe("clearSpellMultiplier",this.clearSpellMultiplier.bind(this)),messageBus.subscribe("clearAttackMultiplier",this.clearAttackMultiplier.bind(this)),messageBus.subscribe("clearDamageAdder",this.clearDamageAdder.bind(this)),messageBus.subscribe("startVoidForm",this.handleVoidForm.bind(this)),messageBus.subscribe("stopVoidForm",this.clearVoidForm.bind(this)),messageBus.subscribe("enemyMadeAttack",this.enemyMadeAttack.bind(this)),messageBus.subscribe("selfClearEffect",this.clearSpecificEffect.bind(this)),messageBus.subscribe("spellClicked",this.incrementSpellsCast.bind(this)),messageBus.subscribe("enemyHasDied",this.clearAllEffects.bind(this)),messageBus.subscribe("enemyHasDied",()=>{this.refreshRecentInjuryBar(!0)})],updateManager.addFunction(this.update.bind(this)),this.bleedObj=this.scene.add.image(t,a,"pixels","red_pixel.png").setAlpha(0).setScale(1e3)}initStats(e,t){this.x=e,this.y=t,this.reInitStats()}reInitStats(){let e=80;cheats.extraHealth&&(e+=1e3),cheats.bonusHealth&&(e+=20),challenges.lowHealth&&(e-=78),this.trueHealthMax=e,this.healthMax=this.trueHealthMax,this.health=this.healthMax,this.lastInjuryHealth=this.healthMax,this.resetRecentDamage(),this.recentlyTakenDelayedDamageAmt=0,this.playerCastSpells=0,this.statuses={}}resetRecentDamage(){this.recentlyTakenDamageAmt=0}getX(){return this.x}getY(){return this.y}getStatuses(){return this.statuses}getHealth(){return this.health}getHealthMax(){return this.healthMax}setHealth(e=80){this.health=e,this.refreshHealthBar(),this.health<=0&&this.die()}setHealthMaxTemp(e=80){this.healthMax=e,this.refreshHealthBar(),this.healthMax<=0&&this.die()}incrementSpellsCast(){this.playerCastSpells++;var e=this.statuses.timeUnload;e&&(e.turns--,e.displayAmt=e.turns,e.turns<=0?messageBus.publish("selfClearStatuses","timeUnload"):messageBus.publish("selfTakeEffect",e)),messageBus.publish("playerCastedSpell")}spellMultiplier(){return this.statuses.mindUnload?this.statuses.mindUnload.multiplier||3:1}attackEnhanceMultiplier(){return this.statuses.timeEnhance?this.statuses.timeEnhance.multiplier||2:1}attackDamageAdder(){let e=0;var t=this.statuses.matterEnhance,t=(t&&(t=t.multiplier||1,e+=6*t),this.statuses.voidEnhance);return t&&(t=t.displayAmt||0,e+=t),e}trueDamageAdder(){var e=this.getStatuses().mindReinforce;return e?e.displayAmt:0}clearSpellMultiplier(){this.statuses.mindUnload&&(this.statuses.mindUnload.cleanUp(this.statuses),this.statuses.mindUnload=null),globalObjects.magicCircle.setAuraAlpha(0)}clearAttackMultiplier(){this.statuses.timeEnhance&&(this.statuses.timeEnhance.cleanUp(this.statuses),this.statuses.timeEnhance=null)}clearDamageAdder(){this.statuses.matterEnhance&&(this.statuses.matterEnhance.cleanUp(this.statuses),this.statuses.matterEnhance=null)}createHealthBar(t,a){this.healthBarReady=!0,this.barAssetsSmall=[],this.injureBarRecentLast=this.scene.add.sprite(t,a-.5,"circle","healthbar_seg_red.png").setDepth(130).setVisible(!1).setRotation(-Math.PI),this.injureBarRecent2=this.scene.add.sprite(t,a-.5,"circle","healthbar_seg_red.png").setDepth(130),this.injureBarRecent=this.scene.add.sprite(t,a-.5,"circle","healthbar_seg_red.png").setDepth(130),this.injureBarRecentFlash=this.scene.add.sprite(t,a-.5,"circle","healthbar_seg_red_half_flash.png").setDepth(130).setAlpha(0),this.healthBarPartial=this.scene.add.sprite(t,a-.5,"circle","healthbar_partial.png").setDepth(991).setVisible(!1),this.healthBarMain=this.scene.add.sprite(t,a-.5,"circle","healthbar_full.png").setDepth(991);for(let e=0;e<5;e++){var s=this.scene.add.sprite(t,a-.5,"circle","healthbar_sliver.png").setDepth(990);s.rotation=0,s.visible=!1,this.barAssetsSmall.push(s)}this.castText=this.scene.add.text(t,a,"CAST",{fontFamily:"germania",fontSize:30,color:"#040404",align:"center"}).setOrigin(.5,.5).setDepth(9900),this.castText.setAlpha(.5),this.healthText=this.scene.add.text(t,a+38,"HP "+this.health+"/"+this.healthMax,{fontFamily:"germania",fontSize:isMobile?24:21,color:"#040404",align:"left"}),this.healthText.setAlpha(.7),this.healthText.setFontStyle("bold"),this.healthText.setTint(0),this.healthText.setOrigin(.5,.5),this.healthText.setDepth(9900)}setCastTextAlpha(e=.65){this.castText.setAlpha(e)}createMisc(){this.hurtIndicator=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.height+40,"enemies","warning.png").setRotation(Math.PI).setScale(100,1).setAlpha(0).setDepth(-1),this.deadBG=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight,"pixels","grey_pixel.png").setDepth(20).setAlpha(0).setScale(500)}showHurt(e,t){var a=t?1:0;let s=e<=1?.75:1;this.hurtTween&&this.hurtTween.stop(),this.hurtIndicator.setAlpha(.75*s+.006*e+.4*a+this.hurtIndicator.alpha+.04),this.hurtIndicator.setScale(100,2*s+.03*e+a+this.hurtIndicator.scaleY+.02),this.hurtTween=this.scene.tweens.add({targets:this.hurtIndicator,duration:Math.floor((650+3*e+300*a)*s),scaleY:1.5,alpha:0}),t&&!this.recentlyGasped&&(this.recentlyGasped=!0,playSound("emergency"),playSound("death_cast",.08),setTimeout(()=>{this.recentlyGasped=!1},2e4))}refreshHealthBar(e){e=e||this.health/this.healthMax;this.healthText.setText("HP "+this.health+"/"+this.healthMax);for(let e=0;e<this.barAssetsSmall.length;e++)this.barAssetsSmall[e].visible=!1;this.healthBarPartial.visible=!0;var t=(e-1)*Math.PI*6/4;if(e<=0)this.healthBarMain.setFrame("circleEffect10.png"),this.healthBarPartial.visible=!1;else if(e<.018)this.healthBarMain.setFrame("healthbar_0thirds.png"),this.healthBarPartial.setFrame("circleEffect10.png");else if(e<.038)this.healthBarMain.setFrame("healthbar_0thirds.png"),this.healthBarPartial.setFrame("healthbar_partial_sliver.png");else if(e<.17){this.healthBarMain.setFrame("healthbar_0thirds.png"),this.healthBarPartial.setFrame("healthbar_partial_sliver.png");var a=Math.max(0,1.25*(t- -6*Math.PI/4)-.28);for(let e=0;e<this.barAssetsSmall.length;e++)this.barAssetsSmall[e].visible=!0,this.barAssetsSmall[e].rotation=-6*Math.PI/4+a*e/this.barAssetsSmall.length+.16}else e<.341?(this.healthBarMain.setFrame("healthbar_1thirds_half.png"),this.healthBarPartial.setFrame("healthbar_partial_half.png")):e<.671?(this.healthBarMain.setFrame("healthbar_1thirds.png"),this.healthBarPartial.setFrame("healthbar_partial.png")):e<1?(this.healthBarMain.setFrame("healthbar_2thirds.png"),this.healthBarPartial.setFrame("healthbar_partial.png")):(this.healthBarMain.setFrame("healthbar_full.png"),this.healthBarPartial.visible=!1);this.healthBarPartial.rotation=t,this.refreshRecentInjuryBar()}flashRecentInjury(e=!1,t=null,a=!1){a&&this.injureBarRecentFlash.isFlashing||(a=this.health/this.healthMax,e=e?0:Math.max(0,this.lastInjuryHealth-this.health),e=(Math.min(1,(this.health+(null===t?e:t))/this.healthMax)-1)*Math.PI*6/4,this.injureBarRecentFlash.rotation=e,this.injureBarRecentFlash.currAnim&&this.injureBarRecentFlash.currAnim.stop(),this.injureBarRecentFlash.alpha=1.3,a<.15?this.injureBarRecentFlash.setFrame("healthbar_seg_red_eith_flash.png"):this.injureBarRecentFlash.setFrame("healthbar_seg_red_half_flash.png"),this.injureBarRecentFlash.isFlashing=!0,this.injureBarRecentFlash.currAnim=PhaserScene.tweens.add({targets:this.injureBarRecentFlash,duration:1e3,alpha:0,ease:"Quad.easeOut",onComplete:()=>{this.injureBarRecentFlash.isFlashing=!1}}))}refreshRecentInjuryBar(e=!1){var t=e?0:Math.max(0,this.lastInjuryHealth-this.health),a=this.health/this.healthMax,s=Math.min(1,(this.health+t)/this.healthMax),i=Math.min(1,t/this.healthMax),n=(s-1)*Math.PI*6/4,s=(.5*(s+a)-1)*Math.PI*6/4;this.injureBarRecent.rotation=n,this.injureBarRecent2.rotation=s,0<t&&this.flashRecentInjury(e);this.injureBarRecentLast.visible=!1,0==a?(this.injureBarRecent.setFrame("blastEffect6.png"),this.injureBarRecent2.setFrame("blastEffect6.png")):i<.33?i<.165?i<.0825?(this.injureBarRecent.setFrame("healthbar_seg_red_eighth.png"),this.injureBarRecent2.setFrame("healthbar_seg_red_eighth.png")):(this.injureBarRecent.setFrame("healthbar_seg_red_quarter.png"),this.injureBarRecent2.setFrame("healthbar_seg_red_quarter.png")):(this.injureBarRecent.setFrame("healthbar_seg_red_half.png"),this.injureBarRecent2.setFrame("healthbar_seg_red_half.png")):(this.injureBarRecent.setFrame("healthbar_seg_red.png"),this.injureBarRecent2.setFrame("healthbar_seg_red.png"),this.injureBarRecentLast.visible=!0,this.injureBarRecent2.rotation=Math.max(s,-1*Math.PI/2))}resetStats(){this.healthMax=this.trueHealthMax,this.health=this.healthMax,this.playerCastSpells=0,this.timeExhaustion=0,this.lastInjuryHealth=this.healthMax,this.resetRecentDamage(),this.recentlyTakenDelayedDamageAmt=0,this.clearAllEffects(),this.healthBarReady&&this.refreshHealthBar(),cheats.superShield&&messageBus.publish("castSpell",{runeName:"rune_matter"},{runeName:"rune_superprotect"},"shield9",0)}update(e){if(this.blackBalls)for(let e=0;e<this.blackBalls.length-3;e++){var t,a;this.blackBalls[e].origX&&(t=2*(Math.random()-.5),a=1.88*(Math.random()-.5),this.blackBalls[e].x=.05*this.blackBalls[e].origX+.95*this.blackBalls[e].x+t,this.blackBalls[e].y=.05*this.blackBalls[e].origY+.95*this.blackBalls[e].y+a)}}handleVoidForm(e){this.blackBalls=e;for(let e=0;e<this.blackBalls.length;e++)this.blackBalls[e].origX=this.blackBalls[e].x,this.blackBalls[e].origY=this.blackBalls[e].y}getPlayerCastSpellsCount(){return this.playerCastSpells}getPlayerTimeExhaustion(){return this.timeExhaustion}incrementTimeExhaustion(){this.timeExhaustion++}clearVoidForm(){this.blackBalls=null}adjustDamageTaken(e){return e}takeEffect(e){this.statuses[e.name]=e}clearSpecificEffect(e){this.statuses[e]&&this.statuses[e].cleanUp(this.statuses)}clearAllEffects(){for(var e in this.statuses)this.statuses[e]&&this.statuses[e].cleanUp(this.statuses);this.statuses={},messageBus.publish("selfClearStatuses")}takeEnemyEffect(e){this.statuses.voidProtect?this.statuses.voidProtect.cleanUp(this.statuses):(this.statuses[e.name]=e,zoomTemp(1.006))}enemyMadeAttack(e){this.canResetRecentDamage=!0}addRecentlyTakenDamage(e){this.recentlyTakenDamageAmt+=e}addRecentlyTakenDelayedDamage(e){this.recentlyTakenDelayedDamageAmt+=e}getRecentlyTakenDamageAmt(){return this.recentlyTakenDamageAmt+this.recentlyTakenDelayedDamageAmt}takeDamage(e,t=!1,a=null,s=!1){if((globalObjects.currentEnemy&&!globalObjects.currentEnemy.dead||s)&&!this.blackBalls){var i,n,s=this.handleDamageStatuses(e=e<0?0:e),e=this.health,s=this.adjustDamageTaken(s);if(1<=s&&!t)this.canResetRecentDamage&&(this.canResetRecentDamage=!1,this.lastInjuryHealth=e,this.resetRecentDamage(),this.recentlyTakenDelayedDamageAmt=0),this.addRecentlyTakenDamage(s),this.bleedObj.alpha=.04*Math.sqrt(s),this.restrictShake||(this.restrictShake=!0,screenShake(2),setTimeout(()=>{this.restrictShake=!1},100)),this.scene.tweens.add({targets:this.bleedObj,duration:250,alpha:0,ease:"Quad.easeOut"}),null!==a&&(t=getTempPoolObject("lowq","sharpflashred.webp","sharpflashred",450),i=gameConsts.halfWidth-a,n=.55+.25*Math.sqrt(s),t.setScale(n,1.2*n).setPosition(a,globalObjects.player.getY()-191+Math.abs(.1*i)).setDepth(1).setAlpha(1),t.setRotation(.002*i),this.scene.tweens.add({targets:t,duration:450,scaleX:.55,ease:"Quad.easeOut"}),this.scene.tweens.add({targets:t,duration:450,scaleY:0}));else if(void 0===s)return;globalObjects.currentEnemy.dead||(this.health=Math.max(0,this.health-s),1<=s&&(n=e>.2*this.healthMax&&this.health<.2*this.healthMax,this.showHurt(s,n)),this.animateHealthChange(-s),this.refreshHealthBar(),this.health<=0&&this.die())}}selfHeal(e){let t=0;var a=this.health+e;return a>this.healthMax&&(t=a-this.healthMax),this.health=Math.min(this.healthMax,a),this.animateHealthChange(e),this.refreshHealthBar(),t}selfHealPercent(e){e=Math.ceil((this.healthMax-this.health)*e*.01);this.selfHeal(e)}selfHealDelayPercent(e=.5){e=Math.ceil(e*globalObjects.magicCircle.delayedDamage);messageBus.publish("playerReduceDelayedDamage",e)}getSelfHealAmt(e=.5){var t=Math.max(0,this.lastInjuryHealth-this.health);let a=Math.ceil(e*(this.recentlyTakenDamageAmt+this.recentlyTakenDelayedDamageAmt)),s=0;a>t&&(s=a-t,a=t);t=globalObjects.magicCircle.getDelayedDamage()-s,t=Math.ceil(t*e);return s+a+t}selfHealRecent(e=.5){var t=Math.max(0,this.lastInjuryHealth-this.health);let a=Math.ceil(e*(this.recentlyTakenDamageAmt+this.recentlyTakenDelayedDamageAmt)),s=(this.recentlyTakenDamageAmt=this.recentlyTakenDamageAmt-a,this.recentlyTakenDamageAmt<0&&(this.recentlyTakenDelayedDamageAmt=Math.max(0,this.recentlyTakenDelayedDamageAmt-Math.abs(this.recentlyTakenDamageAmt)),this.resetRecentDamage()),0);a>t&&(s=a-t,a=t),this.selfHeal(a,!1);var t=globalObjects.magicCircle.getDelayedDamage()-s,i=Math.ceil(t*e);s+=Math.ceil(t*e),this.recentlyTakenDelayedDamageAmt=Math.max(0,this.recentlyTakenDelayedDamageAmt-i),0<s&&messageBus.publish("playerReduceDelayedDamage",s),setTimeout(()=>{this.resetRecentDamage()},250),this.refreshRecentInjuryBar(!0)}takeTrueDamage(e){globalObjects.currentEnemy&&!globalObjects.currentEnemy.dead&&(this.health=Math.max(0,this.health-e),this.animateHealthChange(-e),this.refreshHealthBar(),this.showHurt(1,!1),this.health<=0)&&this.die()}handleDamageStatuses(a){let s=a;var t,i=this.getStatuses(),l=[];if(this.statuses.voidReinforce){s=0;let e=this.scene.add.sprite(gameConsts.halfWidth,globalObjects.player.getY()-190,"spells","blackCircleLarge.png").setDepth(997).setScale(.3),t=this.scene.add.sprite(gameConsts.halfWidth,globalObjects.player.getY()-190,"spells","blackCircleLarge.png").setDepth(997).setScale(.3);var a=150*(Math.random()-.5),n=100*Math.random();this.scene.tweens.add({targets:[e,t],duration:600,scaleX:0,scaleY:0,y:"-="+n,x:"+="+a,ease:"Quad.easeOut",onComplete:()=>{e.destroy(),t.destroy()}})}if(this.statuses.matterUnload){let e=0;this.statuses.matterUnload.health>s?(this.statuses.matterUnload.health=this.statuses.matterUnload.health-s,e=s,s=0,this.statuses.matterUnload.animObj[1].setText(this.statuses.matterUnload.health),this.statuses.matterUnload.animObj[1].setScale(1.3),this.scene.tweens.add({targets:this.statuses.matterUnload.animObj[1],duration:250,scaleX:1,scaleY:1,ease:"Quad.easeOut"}),this.statuses.matterUnload.animObj[0].y+=3,this.scene.tweens.add({targets:this.statuses.matterUnload.animObj[0],duration:250,y:"-=3",ease:"Cubic.easeOut"}),messageBus.publish("animateBlockNum",gameConsts.halfWidth,this.getY()-150,"BLOCKED",1.2)):(s-=this.statuses.matterUnload.health,e=this.statuses.matterUnload.health,this.statuses.matterUnload.health=0,this.statuses.matterUnload.animObj[1].setScale(1.1),this.statuses.matterUnload.animObj[1].setText(this.statuses.matterUnload.health),this.statuses.matterUnload.cleanUp(this.statuses),messageBus.publish("selfClearStatuses","matterUnload"),messageBus.publish("animateBlockNum",gameConsts.halfWidth,gameConsts.halfHeight+40,-e,1.5+.125*Math.sqrt(e)))}for(let e=0;e<10;e++)i["shield"+e]&&l.push(i["shield"+e]);for(let e=0;e<l.length;e++){var r=l[e];switch(r.type){case"matter":if(0<s&&r.active){if(playSound("shield_block",.4),r.health>s)r.health-=s,s=0,r.shakeAmt=.05+.005*s,r.impactVisibleTime=6,r.animObj[2].rotateOffset=.92*-r.animObj[0].rotation,messageBus.publish("animateBlockNum",r.animObj[1].x+1,r.animObj[1].y+31,"BLOCKED",.9,{y:"-=5",ease:"Quart.easeOut"},{scaleX:.85,scaleY:.85,alpha:0});else{playSound("shield_break",.6),s-=r.health,r.health,r.health=0;let e=this.scene.add.sprite(r.animObj[1].x,r.animObj[1].y,"spells","rockCircle.png");e.setScale(.1),e.setDepth(999),e.setAlpha(1.4),this.scene.tweens.add({targets:e,duration:150,scaleX:.5,scaleY:.5,y:"+=20",alpha:0,ease:"Quad.easeOut",onComplete:()=>{e.destroy()}}),messageBus.publish("animateBlockNum",r.animObj[1].x+1,r.animObj[1].y+5,"-BROKE-",1,{y:"+=10",ease:"Quart.easeOut"},{alpha:0,scaleX:1,scaleY:1}),r.cleanUp(this.statuses)}r.animObj[1].setText(r.health),r.animObj[1].setScale(1.3),messageBus.publish("tempPause",100),this.scene.tweens.add({targets:r.animObj[1],duration:250,scaleX:1,scaleY:1,ease:"Quad.easeOut"})}break;case"mind":case"time":break;case"void":if(0<s&&r.active){playSound("void_strike_hit");var o=r.animObj[1].length;let e;(e=o%2==0?r.animObj[1].pop():r.animObj[1].shift()).setScale(2),this.scene.tweens.add({targets:e,duration:300,scaleX:0,scaleY:0,ease:"Quad.easeIn",onComplete:()=>{e.destroy()}}),0==r.animObj[1].length?r.cleanUp(this.statuses):r.jiggleAmt=1,messageBus.publish("animateBlockNum",gameConsts.halfWidth,gameConsts.halfHeight+100,"NEGATED",1.2),messageBus.publish("tempPause",100),s=0}}}if(0<s){if(this.statuses.matterReinforce){for(let t=0;t<this.statuses.matterReinforce.animObj.length;t++){let e=this.statuses.matterReinforce.animObj[t];e.alpha=1,this.statuses.matterReinforce.animObj[t].origScale||(this.statuses.matterReinforce.animObj[t].origScale=this.statuses.matterReinforce.animObj[t].scaleX),1===t?(e.setScale(1.12*e.origScale),this.scene.tweens.add({targets:e,duration:250,scaleX:e.origScale,scaleY:e.origScale,alpha:.5})):(e.setScale(.99*e.origScale),this.scene.tweens.add({targets:e,duration:100,scaleX:1.06*e.origScale,scaleY:1.06*e.origScale,ease:"Cubic.easeIn",alpha:1,onComplete:()=>{this.scene.tweens.add({targets:e,duration:200,scaleX:e.origScale,scaleY:e.origScale,ease:"Quad.easeOut",alpha:.7})}}))}let e=getTempPoolObject("spells","spikeout.png","spikeout",460);e.setScale(2.35).setAlpha(1).setDepth(150).setPosition(this.x,this.y).setRotation(.1*(Math.random()-1)),this.scene.tweens.add({targets:e,duration:50,scaleX:1.04*e.scaleX,scaleY:1.04*e.scaleX,ease:"Cubic.easeIn",onComplete:()=>{this.scene.tweens.add({targets:e,duration:400,scaleX:2.1,scaleY:2.1,ease:"Quint.easeOut"})}}),this.scene.tweens.add({targets:e,duration:450,alpha:0}),s=Math.max(0,s-this.statuses.matterReinforce.protection),messageBus.publish("enemyTakeDamage",this.statuses.matterReinforce.damage,!1,30)}for(let e=0;e<l.length;e++){let n=l[e];switch(n.type){case"mind":if(0<s&&n.active){let e=Math.ceil(.49999*s);e>Math.floor(.50001*s)+.9&&(n.soakedExtra?n.soakedExtra=!1:(e--,n.soakedExtra=!0)),s-=e,n.impactVisibleTime=8,n.storedDamage+=e*n.multiplier,n.textObj.setText(n.storedDamage);var h=.4+.12*Math.sqrt(n.storedDamage);n.textObj.setScale(.6+h),this.scene.tweens.add({targets:n.textObj,duration:300,scaleX:h,scaleY:h,ease:"Cubic.easeOut"}),playSound("fizzle"),messageBus.publish("tempPause",100),n.animObj[0].setScale(2.2*n.animObj[0].origScaleX,n.animObj[0].scaleY),n.animObj[0].y=n.animObj[0].startY+4,this.scene.tweens.add({targets:n.animObj[0],duration:300,scaleX:n.animObj[0].origScaleX,ease:"Quad.easeOut"}),this.scene.tweens.add({targets:n.animObj[0],duration:75,y:n.animObj[0].y+1,ease:"Cubic.easeOut",onComplete:()=>{this.scene.tweens.add({targets:n.animObj[0],duration:450,y:n.animObj[0].startY,ease:"Quint.easeOut"})}}),n.animObj[2].setAlpha(0).setScale(.9),n.reflectAnim&&n.reflectAnim.stop(),n.reflectAnim=this.scene.tweens.add({targets:n.animObj[2],duration:1250,scaleX:2,scaleY:2,alpha:1,ease:"Quad.easeOut",onComplete:()=>{n.animObj[2].alpha=0}}),n.eyeBlastAnim&&n.eyeBlastAnim.stop(),n.animObj[1].setScale(n.animObj[1].origScale).setAlpha(.3),n.isBlasting=!0,n.eyeBlastAnim=this.scene.tweens.add({targets:[n.animObj[0],n.animObj[1]],duration:1300,alpha:1.1,completeDelay:20,onComplete:()=>{if(!globalObjects.player.dead){var e=.4+.015*n.storedDamage,s=(playSound("mind_shield_retaliate",e),.03*n.multiplier-.03);for(let a=0;a<n.multiplier;a++){let e=this.scene.add.sprite(gameConsts.halfWidth,globalObjects.player.getY(),"spells","blast.png").setScale(1.3,4),t=this.scene.add.sprite(gameConsts.halfWidth,globalObjects.player.getY(),"spells","blast2.png").setScale(1.3,3.95);e.setDepth(99).setOrigin(.5,1.165).setAlpha(0),t.setDepth(9999).setOrigin(.5,1.165).setAlpha(0),e.origScale=e.scaleX,e.rotation=n.animObj[0].rotation-s+.06*a,t.rotation=e.rotation,e.scaleX=e.origScale*(1.2+.095*Math.sqrt(n.storedDamage)),t.scaleX=e.scaleX,this.scene.tweens.add({delay:90*a-7*gameVars.avgDeltaScale,targets:[e,t],duration:25,scaleX:e.origScale*(.9+.05*Math.sqrt(n.storedDamage)),ease:"Quint.easeIn",yoyo:!0,repeat:1.1<n.multiplier?5:6,onStart:()=>{e.setAlpha(1),t.setAlpha(1)},onComplete:()=>{e.destroy(),t.destroy()}})}var e=gameConsts.halfWidth+204*Math.sin(n.animObj[0].rotation),t=globalObjects.player.getY()-204*Math.cos(n.animObj[0].rotation),a=getTempPoolObject("spells","shockEffect1.png","shockEffect",1100).play("powerEffect"),i=2.4+.05*n.storedDamage;a.setPosition(e,t).setDepth(989).setScale(.6*i,.15*i).setRotation(n.animObj[0].rotation),this.scene.tweens.add({targets:a,duration:1e3,scaleX:1.4*i,scaleY:.35*i,ease:"Quint.easeOut"}),n.active?(messageBus.publish("enemyTakeTrueDamage",n.storedDamage,!1,95,!0),n.animObj[1].setScale(n.animObj[1].origScale),this.scene.tweens.add({targets:n.animObj[1],duration:25,scaleX:.95*n.animObj[1].origScale,scaleY:.95*n.animObj[1].origScale,ease:"Quint.easeIn",yoyo:!0,repeat:6}),n.animObj[1].setAlpha(1)):messageBus.publish("animateBlockNum",e,t,"MISSED",.85)}n.isLocked=!0,n.textObj&&n.textObj.active&&n.textObj.setText(" "),n.eyeBlastAnim=this.scene.tweens.add({targets:n.animObj[1],duration:180,scaleX:1.3*n.animObj[1].origScale,scaleY:1.3*n.animObj[1].origScale,alpha:0,ease:"Cubic.easeOut",completeDelay:200,onComplete:()=>{n.isLocked=!1}}),n.storedDamage=0,n.isBlasting=!1,n.cleanUp(this.statuses)}})}break;case"time":1<=s&&n.active&&(playSound("time_strike_hit"),n.animObj[0].setScale(1.3*n.animObj[0].origScaleX,n.animObj[0].scaleY),n.animObj[1].setScale(1.25*n.animObj[1].origScaleX,n.animObj[0].scaleY),n.shakeAmt=.05+.005*s,n.animObj[0].alpha=1,n.animObj[1].alpha=1,this.scene.tweens.add({targets:n.animObj[0],duration:250,alpha:.85,scaleX:n.animObj[0].origScaleX,ease:"Cubic.easeIn"}),this.scene.tweens.add({targets:n.animObj[1],duration:350,alpha:.85,scaleX:n.animObj[1].origScaleX,ease:"Cubic.easeIn"}),(h=globalObjects.magicCircle.delayedDamage+s-n.maxAmt)<=0?(messageBus.publish("playerAddDelayedDamage",s),s=0,messageBus.publish("animateBlockNum",gameConsts.halfWidth,MAGIC_CIRCLE_HEIGHT-185,"DELAYED",1.05)):(s=h,t=n.maxAmt-globalObjects.magicCircle.delayedDamage,messageBus.publish("playerAddDelayedDamage",t),messageBus.publish("animateBlockNum",gameConsts.halfWidth,MAGIC_CIRCLE_HEIGHT-185,"OVERLOADED",1,{y:"+=10"},{alpha:0,scaleX:1,scaleY:1}),n.cleanUp(this.statuses)),messageBus.publish("tempPause",100))}}}return s}die(){this.dead||globalObjects.currentEnemy&&globalObjects.currentEnemy.dead||(globalObjects.magicCircle.setAuraAlpha(0),sdkGameplayStop(),messageBus.publish("closeCombatText"),globalObjects.textPopupManager.hideInfoText(),globalObjects.bannerTextManager.closeBanner(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton(),this.dead=!0,this.clearAllEffects(),messageBus.publish("playerDied"),playSound("you_died"),messageBus.publish("enemyClearEffect"),gameVars.isDeathThree?setTimeout(()=>{showCutscene1()},1200):(this.deadBG.alpha=.85,this.swirl1||(this.swirl2=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-200,"backgrounds","fog_swirl_glow.png").setDepth(30),this.swirl1=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-200,"backgrounds","fog_swirl.png").setDepth(30)),this.swirl1.setAlpha(0).setScale(3),this.swirl2.setAlpha(0).setScale(3),this.currentSwirlAnim=this.scene.tweens.add({targets:[this.swirl1,this.swirl2],duration:2500,alpha:.5,scaleX:1.3,scaleY:1.3,ease:"Cubic.easeInOut",onComplete:()=>{}}),this.deadSwirlAnim=this.scene.tweens.add({targets:[this.swirl1,this.swirl2],duration:3e4,rotation:"+=6.283",repeat:-1}),this.deadBGAnim=this.scene.tweens.add({targets:this.deadBG,duration:750,alpha:.5,ease:"Cubic.easeOut",onComplete:()=>{let i=PhaserScene.add.image(gameConsts.halfWidth-32,gameConsts.halfHeight-190,"misc","locket_broken.png").setOrigin(.45,.5).setDepth(200).setAlpha(0).setRotation(.25).setScale(.6);i.currAnim=this.scene.tweens.add({delay:400,targets:i,scaleX:.75,scaleY:.75,alpha:.95,ease:"Cubic.easeInOut",rotation:0,y:"-=15",duration:2e3}),this.deadBGAnim=this.scene.tweens.add({targets:this.deadBG,duration:1500,alpha:1,ease:"Cubic.easeIn",onComplete:()=>{globalObjects.floatingDeath&&setFloatingDeathVisible(!1),this.cheatIcons=[];let e,t,a;var s=(e=new Button({normal:{ref:"menu_btn_normal.png",atlas:"buttons",x:gameConsts.halfWidth,y:gameConsts.height-389},hover:{ref:"menu_btn_hover.png",atlas:"buttons"},press:{ref:"menu_btn_hover.png",atlas:"buttons"},disable:{alpha:0},onHover:()=>{playSound("click",1.1).detune=-100,canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{canvas&&(canvas.style.cursor="default"),this.revive(),gotoMainMenu(),t.destroy(),e.destroy(),a.destroy(),this.hideLocket(i)}})).addText(getLangText("menu"),{fontFamily:"germania",fontSize:34,color:"#000000",align:"center"}),s=(e.setDepth(200),(a=new Button({normal:{ref:"menu_btn_normal.png",atlas:"buttons",x:gameConsts.halfWidth+145,y:gameConsts.height-389},hover:{ref:"menu_btn_hover.png",atlas:"buttons"},press:{ref:"menu_btn_hover.png",atlas:"buttons"},disable:{alpha:0},onHover:()=>{playSound("click",1.1),canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{canvas&&(canvas.style.cursor="default"),this.revive(),globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),globalObjects.currentEnemy&&globalObjects.currentEnemy.destroy(),globalObjects.player&&globalObjects.player.resetStats(),beginLevel(-1*CURRENT_LEVEL+1),e.destroy(),t.destroy(),a.destroy(),this.hideLocket(i)}})).addText(getLangText("back_to_training"),{fontFamily:"germania",fontSize:24,color:"#000000",align:"center"}),a.setDepth(200),8<=CURRENT_LEVEL||CURRENT_LEVEL<=3?a.setState(DISABLE):(e.setPos(gameConsts.halfWidth-145,gameConsts.height-389),s.setPosition(gameConsts.halfWidth-145,gameConsts.height-389)),(t=new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:i.y+22,alpha:.9,scaleX:190,scaleY:95},hover:{ref:"blackPixel",scaleX:210,scaleY:105,alpha:1},press:{ref:"blackPixel",alpha:.8},disable:{alpha:0},onHover:()=>{playSound("click",1.1),canvas&&(canvas.style.cursor="pointer"),i.alpha=1,i.setScale(.765)},onHoverOut:()=>{i.alpha=.95,i.setScale(.75),canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{this.revive(),canvas&&(canvas.style.cursor="default"),globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),globalObjects.currentEnemy&&globalObjects.currentEnemy.destroy(),globalObjects.player&&globalObjects.player.resetStats(),setTimeout(()=>{createEnemy(CURRENT_LEVEL)},0),e.destroy(),t.destroy(),a.destroy(),this.hideLocket(i)}})).addText(getLangText("retry"),{fontFamily:"germania",fontSize:40,color:"#FFFFFF",align:"center"}));t.setDepth(-15),s.setDepth(200).setStroke("#000000",5)}})}})))}hideLocket(e){e.currAnim&&e.currAnim.stop(),e.setFrame("locket1.png"),e.setScale(.78),e.y-=2,playSound("locket_close"),this.scene.tweens.add({targets:e,scaleX:.75,scaleY:.75,ease:"Back.easeOut",y:"+=1",duration:100,onComplete:()=>{this.scene.tweens.add({targets:e,scaleX:.98,scaleY:.98,alpha:0,ease:"Cubic.easeIn",y:"+=30",duration:500,onComplete:()=>{e.destroy()}})}})}createCheatCode(e,t){if(0<e&&e<13){t.visible=!0,t.alpha=0;var a=this.getCheatName(e),s=(e<10?t.setText("CHEAT UNLOCKED\n"+a):t.setText("ACCESS UNLOCKED\n"+a),this.getCheatList(e));for(let e=0;e<5;e++){var i=gameConsts.halfWidth-120+60*e,i=PhaserScene.add.sprite(i,gameConsts.height+25,"circle",s[e]).setDepth(200).setAlpha(0);this.cheatIcons.push(i)}PhaserScene.tweens.add({delay:1700,targets:this.cheatIcons,alpha:1,ease:"Quad.easeIn",duration:2e3}),PhaserScene.tweens.add({targets:t,alpha:1,duration:2e3})}else t.visible=!1}getCheatName(e){return["Access Code Test","+1000 HEALTH","+20 HEALTH","SUPER SHIELD","X2 DAMAGE","SUPER SHIELD","X2 MORE DAMAGE","EXTRA ULTIMATE","CALM ENEMIES","INFINITE AMMO","ACCESS DEATH LEVEL","ACCESS DEATH LEVEL 2","ACCESS DEATH LEVEL 3","ACCESS DEATH LEVEL 4"][e]}getCheatList(e){return[["bright_rune_matter.png","bright_rune_matter.png","bright_rune_matter.png","bright_rune_matter.png","bright_rune_matter.png"],["bright_rune_void.png","bright_rune_reinforce.png","bright_rune_time.png","bright_rune_reinforce.png","bright_rune_unload.png"],["bright_rune_matter.png","bright_rune_matter.png","bright_rune_matter.png","bright_rune_matter.png","bright_rune_mind.png"],["bright_rune_matter.png","bright_rune_protect.png","bright_rune_protect.png","bright_rune_protect.png","bright_rune_protect.png"],["bright_rune_strike.png","bright_rune_strike.png","bright_rune_strike.png","bright_rune_strike.png","bright_rune_strike.png"],["bright_rune_matter.png","bright_rune_protect.png","bright_rune_protect.png","bright_rune_protect.png","bright_rune_protect.png"],["bright_rune_mind.png","bright_rune_reinforce.png","bright_rune_mind.png","bright_rune_reinforce.png","bright_rune_mind.png"],["bright_rune_unload.png","bright_rune_unload.png","bright_rune_reinforce.png","bright_rune_unload.png","bright_rune_unload.png"],["bright_rune_void.png","bright_rune_void.png","bright_rune_matter.png","bright_rune_matter.png","bright_rune_protect.png"],["bright_rune_mind.png","bright_rune_mind.png","bright_rune_mind.png","bright_rune_mind.png","bright_rune_strike.png"],["bright_rune_unload.png","bright_rune_protect.png","bright_rune_protect.png","bright_rune_protect.png","bright_rune_protect.png"],["bright_rune_reinforce.png","bright_rune_matter.png","bright_rune_mind.png","bright_rune_time.png","bright_rune_void.png"],["bright_rune_unload.png","bright_rune_unload.png","bright_rune_unload.png","bright_rune_unload.png","bright_rune_reinforce.png"],["bright_rune_reinforce.png","bright_rune_time.png","bright_rune_protect.png","bright_rune_unload.png","bright_rune_void.png"]][e]}revive(){this.dead=!1,this.deadBGAnim&&(this.deadSwirlAnim.stop(),this.deadBGAnim.stop(),this.currentSwirlAnim&&this.currentSwirlAnim.stop(),this.scene.tweens.add({targets:this.deadBG,duration:500,alpha:0,ease:"Quad.easeOut"}),this.scene.tweens.add({targets:[this.swirl1,this.swirl2],duration:1e3,alpha:0,rotation:"-=1",scaleX:3,scaleY:3,ease:"Cubic.easeIn"})),messageBus.publish("manualResetElements"),messageBus.publish("manualResetEmbodiments"),messageBus.publish("playerRevived")}isDead(){return this.dead}animateHealthChange(e,t=!1){let a=1,s=(t||e<-1&&zoomTemp(1.01),this.health<20&&(a+=.2),0),i=(s=12<e?12:e,.18*Math.sqrt(Math.abs(s))+.04*Math.abs(s));var n;80<Math.abs(e)&&(i=.18*Math.sqrt(80)+3.2),1.2<(a+=i)&&(n=a-1.2,a=1+.5*n),t?messageBus.publish("animateBlockNum",this.healthText.x-31+60*Math.random(),this.healthText.y-65+50*Math.random(),e,a):0<e?messageBus.publish("animateHealNum",this.healthText.x-21+40*Math.random(),this.healthText.y-25+40*Math.random(),"+"+e,.5+a,{duration:1750,ease:"Quart.easeOut",scaleX:.5+.9*a,scaleY:.5+.9*a}):0!==e&&messageBus.publish("animateDamageNum",this.healthText.x-41+80*Math.random(),this.healthText.y-90+130*Math.random(),e,.4+a,{duration:400,completeDelay:1200,ease:"Back.easeOut",y:"-=10",scaleX:.9*a,scaleY:.9*a})}}function setupMainMenuBG(){var e,t,a,s;globalObjects.menuBack||(globalObjects.menuBack=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight,"backgrounds","menu_back.png").setDepth(-9).setScale(.95),globalObjects.menuBack.startScale=globalObjects.menuBack.scaleX,globalObjects.menuTop=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"backgrounds","menu_top.png").setDepth(-9).setScale(.85),globalObjects.menuTop.startScale=globalObjects.menuTop.scaleX,e=1<=gameVars.maxLevel,globalObjects.menuButtons=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight,"backgrounds",e?"menu_buttons.png":"menu_buttons_start.png").setDepth(-5).setScale(1),e&&!globalObjects.continueButtonSprite&&(globalObjects.continueButtonSprite=PhaserScene.add.sprite(gameConsts.halfWidth-175,gameConsts.halfHeight-132,"misc","continuegame.webp"),globalObjects.levelButtonSprite=PhaserScene.add.sprite(gameConsts.halfWidth-183,gameConsts.halfHeight-43,"misc","selectgame.webp").setScale(.85)),a=(t=!e)?gameConsts.halfHeight-122:gameConsts.halfHeight-260,s=t?gameConsts.halfWidth-150:gameConsts.halfWidth-176,globalObjects.startButtonSprite||(globalObjects.startButtonSprite=PhaserScene.add.sprite(s,38+a,"misc","newgame.webp")),globalObjects.startButtonSprite.setScale(t?1.02:.9),e?(globalObjects.startButtonSprite.setRotation(.17),globalObjects.startButtonSprite.rotationOffset=.17):(globalObjects.startButtonSprite.setRotation(-.14),globalObjects.startButtonSprite.rotationOffset=-.14),globalObjects.creditsButtonSprite=PhaserScene.add.sprite(gameConsts.halfWidth+225,gameConsts.halfHeight-5,"misc","creditsgame.webp"),2<=gameVars.maxLevel&&(globalObjects.protectedDummySprite=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+8,"enemies","lesser_dummy_shield_smal.png").setDepth(-1).setAlpha(.95)))}function playNewGameFlash(){1<=gameVars.maxLevel||setTimeout(()=>{globalObjects.startButtonSprite.visible&&(globalObjects.startButtonSpriteFlash=PhaserScene.add.sprite(globalObjects.startButtonSprite.x+3,globalObjects.startButtonSprite.y,"shields","btnFlash1.png"),globalObjects.startButtonSpriteFlash.play("btnFlash"),globalObjects.startButtonSpriteFlash.setScale(2.55*globalObjects.startButtonSprite.scaleX).setRotation(globalObjects.startButtonSprite.rotation))},250)}function clearOnlyMenuButtons(){globalObjects.continueButton&&(globalObjects.continueButton.destroy(),globalObjects.continueButtonSprite.destroy()),globalObjects.levelSelectButton&&(globalObjects.levelSelectButton.destroy(),globalObjects.levelButtonSprite.destroy()),globalObjects.startButton.destroy(),globalObjects.startButtonSprite.visible=!1,globalObjects.startButtonSprite.destroy(),globalObjects.startButtonSpriteFlash&&globalObjects.startButtonSpriteFlash.destroy(),globalObjects.cheatButton4.destroy(),globalObjects.creditsButton.destroy(),globalObjects.creditsButtonSprite.destroy(),globalObjects.extrasButton.destroy(),globalObjects.extrasButtonSprite.destroy(),globalObjects.protectedDummySprite&&PhaserScene.tweens.add({targets:globalObjects.protectedDummySprite,alpha:0,ease:"Cubic.easeOut",duration:400,onComplete:()=>{globalObjects.protectedDummySprite.destroy()}}),globalObjects.protectedDummyButton&&globalObjects.protectedDummyButton.destroy()}function minorZoomMenu(){globalObjects.menuBack&&(PhaserScene.tweens.add({targets:[globalObjects.menuBack],scaleX:1.19*globalObjects.menuBack.startScale,scaleY:1.2*globalObjects.menuBack.startScale,y:gameConsts.halfHeight-110,ease:"Quint.easeInOut",duration:1500}),PhaserScene.tweens.add({targets:[globalObjects.menuTop],scaleX:1.19*globalObjects.menuTop.startScale,scaleY:1.2*globalObjects.menuTop.startScale,y:gameConsts.halfHeight-110,ease:"Quint.easeInOut",duration:1500}),PhaserScene.tweens.add({targets:[globalObjects.menuButtons],scaleX:1.12,scaleY:1.12,y:gameConsts.halfHeight-93,ease:"Quint.easeInOut",duration:1500}),PhaserScene.tweens.add({targets:[globalObjects.menuButtons],ease:"Cubic.easeOut",duration:700,alpha:0}))}function clearOnlyMenuBack(){globalObjects.menuBack&&(globalObjects.menuButtons.currAnim1=PhaserScene.tweens.add({targets:[globalObjects.menuButtons],scaleX:2.15,scaleY:2.15,y:gameConsts.halfHeight+30,ease:"Cubic.easeInOut",duration:2500}),globalObjects.menuButtons.currAnim2=PhaserScene.tweens.add({targets:[globalObjects.menuButtons],ease:"Cubic.easeOut",alpha:0,duration:700}),globalObjects.menuTop.currAnim1=PhaserScene.tweens.add({targets:[globalObjects.menuTop],scaleX:1.6*globalObjects.menuTop.startScale,scaleY:1.6*globalObjects.menuTop.startScale,y:gameConsts.halfHeight+20,ease:"Cubic.easeInOut",duration:2500}),globalObjects.menuTop.currAnim2=PhaserScene.tweens.add({delay:450,targets:[globalObjects.menuTop],alpha:0,duration:900,ease:"Quad.easeInOut",onComplete:()=>{}}),globalObjects.menuBack.currAnim1=PhaserScene.tweens.add({targets:[globalObjects.menuBack],scaleX:1.6*globalObjects.menuBack.startScale,scaleY:1.6*globalObjects.menuBack.startScale,x:gameConsts.halfWidth,y:gameConsts.halfHeight+20,ease:"Cubic.easeInOut",duration:2500}),globalObjects.menuBack.currAnim2=PhaserScene.tweens.add({delay:1800,targets:[globalObjects.menuBack],alpha:0,ease:"Quad.easeIn",duration:500,onComplete:()=>{}}))}function clearMenuButtons(){gameVars.isInMainMenu=!1,clearOnlyMenuButtons(),clearOnlyMenuBack()}function gotoMainMenu(){switchBackground("grass_bg.webp"),globalObjects.magicCircle.setWheelTint(),globalObjects.magicCircle.enableMovement(),gameVars.isInMainMenu||(gameVars.isInMainMenu=!0,gotoMainMenuNoButtons(),showMainMenuButtons())}function gotoMainMenuNoButtons(){setupMainMenuBG(),globalObjects.postFightScreen.clearWindSound(),globalObjects.magicCircle.setAuraAlpha(0),globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),globalObjects.currentEnemy&&globalObjects.currentEnemy.destroy(),globalObjects.player&&globalObjects.player.resetStats(),globalObjects.menuBack.currAnim1&&(globalObjects.menuBack.currAnim1.stop(),globalObjects.menuBack.currAnim2.stop()),globalObjects.menuTop.currAnim1&&(globalObjects.menuTop.currAnim1.stop(),globalObjects.menuTop.currAnim2.stop()),globalObjects.menuButtons.currAnim1&&(globalObjects.menuButtons.currAnim1.stop(),globalObjects.menuButtons.currAnim2.stop()),globalObjects.menuBack.setAlpha(Math.max(.2,globalObjects.menuBack.alpha)).setScale(globalObjects.menuBack.startScale).setPosition(gameConsts.halfWidth,gameConsts.halfHeight),globalObjects.menuTop.setAlpha(Math.max(.2,globalObjects.menuTop.alpha)).setScale(globalObjects.menuTop.startScale).setPosition(gameConsts.halfWidth,gameConsts.halfHeight),globalObjects.menuButtons.setAlpha(Math.max(.2,globalObjects.menuButtons.alpha)).setScale(globalObjects.menuButtons.startScale).setPosition(gameConsts.halfWidth,gameConsts.halfHeight),PhaserScene.tweens.add({targets:[globalObjects.menuBack,globalObjects.menuTop,globalObjects.menuButtons],alpha:1,ease:"Quart.easeOut",duration:400})}function showMainMenuButtons(){var e=1<=gameVars.maxLevel;e&&(globalObjects.continueButtonSprite&&globalObjects.continueButtonSprite.active||(globalObjects.continueButtonSprite=PhaserScene.add.sprite(gameConsts.halfWidth-175,gameConsts.halfHeight-132,"misc","continuegame.webp")),globalObjects.continueButton=new Button({normal:{atlas:"pixels",ref:"blank_pixel.png",x:gameConsts.halfWidth-175,y:gameConsts.halfHeight-132,alpha:1,scaleX:115,scaleY:40},hover:{scaleX:120,scaleY:45},press:{},disable:{alpha:0},onHover:()=>{canvas&&(playSound("button_hover",1.5).detune=-75,canvas.style.cursor="pointer"),globalObjects.continueButtonSprite.setFrame("continuegame_hover.webp"),globalObjects.continueButtonSprite.setScale(1.025),globalObjects.continueButtonSprite.setRotation(-.03)},onHoverOut:()=>{canvas&&(canvas.style.cursor="default"),globalObjects.continueButtonSprite.setFrame("continuegame.webp"),globalObjects.continueButtonSprite.setRotation(.045),PhaserScene.tweens.add({targets:globalObjects.continueButtonSprite,duration:100,scaleX:1,scaleY:1,easeParams:[3],rotation:0,ease:"Bounce.easeOut"})},onMouseUp:()=>{playSound("click"),clearMenuButtons(),gameVars.currLevel?beginPreLevel(gameVars.currLevel):beginPreLevel(gameVars.latestLevel+1)}}),globalObjects.continueButton.setOrigin(.5,.5),globalObjects.continueButton.addText(getLangText("cont_ui"),{fontFamily:"germania",fontSize:30,color:"#FDF6F4",align:"left"}).setAlpha(.97),globalObjects.continueButton.setTextOffset(0,-5),globalObjects.continueButton.setStroke("#301010",5),globalObjects.continueButton.setRotation(-.02)),e&&(globalObjects.levelButtonSprite&&globalObjects.levelButtonSprite.active||(globalObjects.levelButtonSprite=PhaserScene.add.sprite(gameConsts.halfWidth-183,gameConsts.halfHeight-43,"misc","selectgame.webp").setScale(.85)),globalObjects.levelSelectButton=new Button({normal:{atlas:"pixels",ref:"blank_pixel.png",x:gameConsts.halfWidth-183,y:gameConsts.halfHeight-38,alpha:1,scaleX:115,scaleY:40},hover:{scaleX:120,scaleY:43},press:{},disable:{alpha:0},onHover:()=>{canvas&&(playSound("button_hover",1.5).detune=-150,canvas.style.cursor="pointer"),globalObjects.levelButtonSprite.setFrame("selectgame_hover.webp"),globalObjects.levelButtonSprite.setScale(.855),globalObjects.levelButtonSprite.setRotation(-.03)},onHoverOut:()=>{canvas&&(canvas.style.cursor="default"),globalObjects.levelButtonSprite.setFrame("selectgame.webp"),globalObjects.levelButtonSprite.setRotation(.045),PhaserScene.tweens.add({targets:globalObjects.levelButtonSprite,duration:100,scaleX:.85,scaleY:.85,easeParams:[3],rotation:0,ease:"Bounce.easeOut"})},onMouseUp:()=>{playSound("flip1"),showLevelSelectScreen()}}),globalObjects.levelSelectButton.setOrigin(.5,.5),(a=globalObjects.levelSelectButton.addText(getLangText("lvl_select"),{fontFamily:"germania",fontSize:26,color:"#FDF6F4",align:"left"})).setAlpha(.97),globalObjects.levelSelectButton.setStroke("#301010",5),globalObjects.levelSelectButton.setTextOffset(-6,-8),globalObjects.levelSelectButton.setRotation(-.22),"fr"===language)&&a.setFontSize(23);let t=!e;var a=t?gameConsts.halfHeight-122:gameConsts.halfHeight-260,e=t?gameConsts.halfWidth-160:gameConsts.halfWidth-176;globalObjects.startButtonSprite&&globalObjects.startButtonSprite.active||(globalObjects.startButtonSprite=PhaserScene.add.sprite(e,38+a,"misc","newgame.webp")),globalObjects.startButtonSprite.setScale(t?1.02:.9),t?(globalObjects.startButtonSprite.setRotation(-.14),globalObjects.startButtonSprite.rotationOffset=-.14):(globalObjects.startButtonSprite.setRotation(.17),globalObjects.startButtonSprite.rotationOffset=.17),globalObjects.startButton=new Button({normal:{atlas:"pixels",ref:"blank_pixel.png",x:globalObjects.startButtonSprite.x,y:globalObjects.startButtonSprite.y-5,alpha:1,scaleX:120,scaleY:40},hover:{scaleX:125,scaleY:45},press:{},disable:{alpha:0},onHover:()=>{canvas&&(playSound("button_hover",1.5).detune=0,canvas.style.cursor="pointer"),globalObjects.startButtonSprite.setFrame("newgame_hover.webp"),globalObjects.startButtonSprite.setScale(t?1.03:.91),globalObjects.startButtonSprite.setRotation(-.03+globalObjects.startButtonSprite.rotationOffset)},onHoverOut:()=>{canvas&&(canvas.style.cursor="default"),globalObjects.startButtonSprite.setFrame("newgame.webp"),globalObjects.startButtonSprite.setRotation(.045+globalObjects.startButtonSprite.rotationOffset),PhaserScene.tweens.add({targets:globalObjects.startButtonSprite,duration:100,scaleX:t?1.02:.9,scaleY:t?1.02:.9,easeParams:[3],rotation:globalObjects.startButtonSprite.rotationOffset,ease:"Bounce.easeOut"})},onMouseUp:()=>{var e;t?(clearOnlyMenuButtons(),beginPreLevel(0)):(e=getLangText("new_game")+"?",showYesNoPopup(getLangText("cont_ui"),getLangText("back"),e,getLangText("new_game_long"),()=>{clearOnlyMenuButtons(),beginPreLevel(0)},!0))}}),globalObjects.startButton.setOrigin(.5,.5);globalObjects.startButton.addText(getLangText("new_game"),{fontFamily:"germania",fontSize:30,color:"#FDF6F4",align:"left"}).alpha=.96,globalObjects.startButton.setTextOffset(-6,-2),globalObjects.startButton.setStroke("#301010",5),globalObjects.startButton.setRotation(-.05+globalObjects.startButtonSprite.rotationOffset),globalObjects.startButton.isSolo=t,(globalObjects.startButton.isSolo=t)?(globalObjects.menuButtons.setFrame("menu_buttons_start.png"),setTimeout(()=>{},850)):globalObjects.menuButtons.setFrame("menu_buttons.png"),globalObjects.cheatButton4=new Button({normal:{ref:"menu_btn_normal.png",atlas:"buttons",x:gameConsts.width+150+gameVars.hideCheatConst,y:245},hover:{ref:"menu_btn_hover.png",atlas:"buttons"},press:{ref:"menu_btn_press.png",atlas:"buttons"},disable:{alpha:0},onMouseUp:()=>{playSound("click"),toggleCheat("inam")}}),globalObjects.cheatButton4.setScale(.5),globalObjects.cheatButton4.addText("INFINITE AMMO",{fontFamily:"germania",fontSize:20,color:"#000000",align:"left"}),2<=gameVars.maxLevel&&(globalObjects.protectedDummySprite&&globalObjects.protectedDummySprite.active||(globalObjects.protectedDummySprite=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+8,"enemies","lesser_dummy_shield_smal.png").setDepth(-1).setAlpha(.95),gameVars.dummyDied&&globalObjects.protectedDummySprite.setFrame("lesser_dummy_dead_far.png")),globalObjects.protectedDummyButton=new Button({normal:{ref:"blackPixel",alpha:0,x:gameConsts.halfWidth+15,y:gameConsts.halfHeight-80,scaleX:65,scaleY:90},onHover:()=>{canvas&&(playSound("button_hover",1).detune=200,canvas.style.cursor="pointer"),gameVars.dummyDied?globalObjects.protectedDummySprite.setFrame("lesser_dummy_dead_far_glow.png"):globalObjects.protectedDummySprite.setFrame("lesser_dummy_shield_smal_hover.png")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default"),gameVars.dummyDied?globalObjects.protectedDummySprite.setFrame("lesser_dummy_dead_far.png"):globalObjects.protectedDummySprite.setFrame("lesser_dummy_shield_smal.png")},onMouseUp:()=>{gameVars.dummyDied?(gameVars.dummyDied=!1,playSound("lesserfall",.55),globalObjects.protectedDummySprite.setFrame("lesser_dummy_shield_smal_hover.png"),globalObjects.protectedDummySprite.setRotation(-.1),PhaserScene.tweens.add({targets:globalObjects.protectedDummySprite,rotation:0,ease:"Bounce.easeOut",duration:700})):(clearOnlyMenuButtons(),beginPreLevel(-99))}})),globalObjects.creditsButtonSprite&&globalObjects.creditsButtonSprite.active||(globalObjects.creditsButtonSprite=PhaserScene.add.sprite(gameConsts.halfWidth+225,gameConsts.halfHeight-5,"misc","creditsgame.webp")),globalObjects.creditsButton=new Button({normal:{atlas:"pixels",ref:"blank_pixel.png",x:gameConsts.halfWidth+225,y:gameConsts.halfHeight-2,alpha:.9,scaleX:95,scaleY:36},hover:{alpha:1},press:{alpha:.7},disable:{},onHover:()=>{canvas&&(playSound("button_hover",1).detune=200,canvas.style.cursor="pointer"),globalObjects.creditsButtonSprite.setFrame("creditsgame_hover.webp"),globalObjects.creditsButtonSprite.setScale(1.025),globalObjects.creditsButtonSprite.setRotation(.03)},onHoverOut:()=>{canvas&&(canvas.style.cursor="default"),globalObjects.creditsButtonSprite.setFrame("creditsgame.webp"),globalObjects.creditsButtonSprite.setRotation(-.045),PhaserScene.tweens.add({targets:globalObjects.creditsButtonSprite,duration:100,scaleX:1,scaleY:1,easeParams:[3],rotation:0,ease:"Bounce.easeOut"})},onMouseUp:()=>{globalObjects.magicCircle.disableMovement(),playSound("flip3"),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton();let e=[],t=[],a=PhaserScene.add.image(gameConsts.halfWidth-190,gameConsts.halfHeight-305,"ui","paperTab.png").setDepth(99999).setAlpha(0),s=PhaserScene.add.text(a.x,a.y-55,"PAGE 1",{fontFamily:"germania",fontSize:18,color:"#000000",align:"center"}).setOrigin(.5,0).setDepth(99999).setAlpha(0),i=PhaserScene.add.image(gameConsts.halfWidth-90,gameConsts.halfHeight-278,"ui","paperTab.png").setDepth(99999).setAlpha(0),n=PhaserScene.add.text(i.x,i.y-55,"PAGE 2",{fontFamily:"germania",fontSize:18,color:"#000000",align:"center"}).setOrigin(.5,0).setDepth(99999).setAlpha(0);let l=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"ui","paper.png").setDepth(1e5).setScale(.975),r=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight-1,"misc","credits.png").setDepth(1e5).setScale(.975),o=PhaserScene.add.text(gameConsts.halfWidth-54,r.y+238,getLangText("wishlist_on_steam"),{fontFamily:"germania",fontSize:"fr"===language?24:32,color:"#200000",align:"left"}).setOrigin(0,.5).setDepth(1e5).setAlpha(.3).setScale(1.03),h,c=((h=new Button({normal:{ref:"blackPixel",scaleX:1e3,scaleY:1e3,alpha:.6,x:gameConsts.halfWidth,y:gameConsts.halfHeight},disable:{alpha:0},onMouseUp:()=>{}})).setDepth(1e3),new Button({normal:{atlas:"ending",ref:"wishlist.png",x:gameConsts.halfWidth,y:r.y+238,alpha:.95,scaleX:1,scaleY:1},hover:{atlas:"ending",ref:"wishlist.png",alpha:1,scaleX:1.01,scaleY:1.01},press:{atlas:"ending",ref:"wishlist.png",alpha:.7,scaleX:1.01,scaleY:1.01},disable:{atlas:"ending",ref:"wishlist.png",alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{}})),g=(c.setDepth(1e5),PhaserScene.add.text(gameConsts.halfWidth-255,l.y-284,'Additional Credits:\n\n"Magic Escape Room" by Kevin MacLeod\n(incompetech.com)\nLicensed under Creative Commons:\nBy Attribution 4.0 License\n\nRocks - Effects - Source Recordings\n- 05 by GregorQuendel\n- https://freesound.org/s/424997/\n- License: Attribution 4.0\n\nrocks2.wav by mystiscool\n- https://freesound.org/s/7136/\n- License: Attribution 4.0\n\nR4_00328-2_EXP.wav by kevp888\n- https://freesound.org/s/636777/\n- License: Attribution 4.0\n\nBig Bell_4.wav by eardeer\n- https://freesound.org/s/337565/\n- License: Attribution 4.0\n\nUnlocking lock.wav by Stefan21100190\n- https://freesound.org/s/593112/\n- License: Attribution 4.0\n\nSound Effects by Lara Sluyter\n(LARAS HORROR SOUNDS on YouTube)\n\nSmall_Swoosh - 1.wav by SoundFlakes\n-- https://freesound.org/s/416468/\n- License: Attribution 4.0',{fontSize:16,color:"#000000",align:"left"}).setOrigin(0,0).setDepth(1e5).setAlpha(0)),d=(PhaserScene.tweens.add({targets:[l,a,s,i,n,o],duration:180,scaleX:1,scaleY:1,alpha:1}),PhaserScene.tweens.add({targets:[r],duration:180,scaleX:.958,scaleY:.958,alpha:1}),e.push(r,o),t.push(g),new Button({normal:{ref:"blackPixel",alpha:0,x:s.x,y:s.y+26,scaleX:45,scaleY:48},hover:{ref:"blackPixel",alpha:0,x:s.x,y:s.y+26,scaleX:46,scaleY:49},disable:{alpha:0},onHover:()=>{a.setFrame("paperTab_glow.png"),canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{a.setFrame("paperTab.png"),canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{playSound("flip1"),c.setState(NORMAL),PhaserScene.tweens.add({targets:a,y:gameConsts.halfHeight-305,duration:180,ease:"Cubic.easeOut"}),PhaserScene.tweens.add({targets:s,y:gameConsts.halfHeight-305-55,duration:180,ease:"Cubic.easeOut"}),PhaserScene.tweens.add({targets:i,y:gameConsts.halfHeight-278,duration:180,ease:"Cubic.easeOut"}),PhaserScene.tweens.add({targets:n,y:gameConsts.halfHeight-278-55,duration:180,ease:"Cubic.easeOut"}),PhaserScene.tweens.add({targets:e,alpha:1,duration:180,ease:"Cubic.easeIn"}),PhaserScene.tweens.add({targets:t,alpha:0,duration:180,ease:"Cubic.easeOut"})}}).setDepth(1e5),new Button({normal:{ref:"blackPixel",alpha:0,x:n.x,y:s.y+26,scaleX:45,scaleY:48},hover:{ref:"blackPixel",alpha:0,x:n.x,y:s.y+26,scaleX:46,scaleY:49},disable:{alpha:0},onHover:()=>{i.setFrame("paperTab_glow.png"),canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{i.setFrame("paperTab.png"),canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{playSound("flip2"),c.setState(DISABLE),PhaserScene.tweens.add({targets:a,y:gameConsts.halfHeight-278,duration:180,ease:"Cubic.easeOut"}),PhaserScene.tweens.add({targets:s,y:gameConsts.halfHeight-278-55,duration:180,ease:"Cubic.easeOut"}),PhaserScene.tweens.add({targets:i,y:gameConsts.halfHeight-305,duration:180,ease:"Cubic.easeOut"}),PhaserScene.tweens.add({targets:n,y:gameConsts.halfHeight-305-55,duration:180,ease:"Cubic.easeOut"}),PhaserScene.tweens.add({targets:t,alpha:1,duration:180,ease:"Cubic.easeIn"}),PhaserScene.tweens.add({targets:e,alpha:0,duration:180,ease:"Cubic.easeOut"})}}).setDepth(1e5),messageBus.subscribe("cancelScreen",()=>{globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),h.destroy(),l.destroy(),o.destroy(),r.destroy(),c.destroy(),g.destroy(),a.destroy(),i.destroy(),s.destroy(),n.destroy(),d.unsubscribe(),globalObjects.magicCircle.enableMovement(),this.closeButton.destroy(),canvas&&(canvas.style.cursor="default")}));this.closeButton=new Button({normal:{atlas:"buttons",ref:"closebtn.png",alpha:.95,x:gameConsts.halfWidth+244,y:gameConsts.halfHeight-275},hover:{alpha:1,atlas:"buttons",ref:"closebtn_hover.png"},press:{atlas:"buttons",ref:"closebtn_press.png",alpha:1},disable:{atlas:"buttons",ref:"closebtn.png",alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{playSound("flip1",.7).detune=-200,globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),h.destroy(),l.destroy(),o.destroy(),r.destroy(),c.destroy(),g.destroy(),a.destroy(),i.destroy(),s.destroy(),n.destroy(),d.unsubscribe(),globalObjects.magicCircle.enableMovement(),this.closeButton.destroy(),canvas&&(canvas.style.cursor="default")}}),this.closeButton.setDepth(1e5)}}),globalObjects.creditsButton.addText(getLangText("credits"),{fontFamily:"germania",fontSize:26,color:"#FDF6F4",align:"center",lineSpacing:-8}).setOrigin(.5,.5).setAlpha(.96),globalObjects.creditsButton.setStroke("#301010",6),globalObjects.creditsButton.setRotation(-.03),globalObjects.extrasButtonSprite&&globalObjects.extrasButtonSprite.active||(globalObjects.extrasButtonSprite=PhaserScene.add.sprite(gameConsts.halfWidth+222,gameConsts.halfHeight-72,"misc","wishlistgame.webp")),globalObjects.extrasButton=new Button({normal:{atlas:"pixels",ref:"blank_pixel.png",x:globalObjects.extrasButtonSprite.x,y:globalObjects.extrasButtonSprite.y,alpha:.9,scaleX:95,scaleY:36},hover:{alpha:1},press:{alpha:.7},disable:{},onHover:()=>{canvas&&(playSound("button_hover",1).detune=200,canvas.style.cursor="pointer"),globalObjects.extrasButtonSprite.setFrame("wishlistgame_hover.webp"),globalObjects.extrasButtonSprite.setScale(1.025),globalObjects.extrasButtonSprite.setRotation(.03)},onHoverOut:()=>{canvas&&(canvas.style.cursor="default"),globalObjects.extrasButtonSprite.setFrame("wishlistgame.webp"),globalObjects.extrasButtonSprite.setRotation(-.045),PhaserScene.tweens.add({targets:globalObjects.extrasButtonSprite,duration:100,scaleX:1,scaleY:1,easeParams:[3],rotation:0,ease:"Bounce.easeOut"})},onMouseUp:()=>{openWishlist()}});e=globalObjects.extrasButton.addText(getLangText("wishlist"),{fontFamily:"germania",fontSize:26,color:"#FDF6F4",align:"center",lineSpacing:-8}).setOrigin(.5,.5);e.setAlpha(.96),globalObjects.extrasButton.setStroke("#301010",6),"fr"===language&&e.setFontSize(20),globalObjects.extrasButton.setRotation(-.145)}function updateMenuLanguage(){var e;globalObjects.startButton&&!globalObjects.startButton.isDestroyed&&globalObjects.startButton.setText(getLangText("new_game")),globalObjects.continueButton&&!globalObjects.continueButton.isDestroyed&&globalObjects.continueButton.setText(getLangText("cont_ui")),globalObjects.levelSelectButton&&!globalObjects.levelSelectButton.isDestroyed&&(e=globalObjects.levelSelectButton.setText(getLangText("lvl_select")))&&("fr"===language?e.setFontSize(23):e.setFontSize(26)),globalObjects.creditsButton&&!globalObjects.creditsButton.isDestroyed&&globalObjects.creditsButton.setText(getLangText("credits")),globalObjects.extrasButton&&!globalObjects.extrasButton.isDestroyed&&(e=globalObjects.extrasButton.setText(getLangText("wishlist")))&&("fr"===language?e.setFontSize(20):e.setFontSize(26))}function showLevelSelectScreen(){globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton();createGlobalClickBlocker(!1);var e=[gameConsts.halfWidth-120,gameConsts.halfWidth,gameConsts.halfWidth+120,gameConsts.halfWidth-180,gameConsts.halfWidth-60,gameConsts.halfWidth+60,gameConsts.halfWidth+180,gameConsts.halfWidth-180,gameConsts.halfWidth-60,gameConsts.halfWidth+60,gameConsts.halfWidth+180,gameConsts.halfWidth-180,gameConsts.halfWidth-60,gameConsts.halfWidth+60,gameConsts.halfWidth+180],t=[gameConsts.halfHeight-180,gameConsts.halfHeight-180,gameConsts.halfHeight-180,gameConsts.halfHeight-60,gameConsts.halfHeight-60,gameConsts.halfHeight-60,gameConsts.halfHeight-60,gameConsts.halfHeight+60,gameConsts.halfHeight+60,gameConsts.halfHeight+60,gameConsts.halfHeight+60,gameConsts.halfHeight+180,gameConsts.halfHeight+180,gameConsts.halfHeight+180,gameConsts.halfHeight+180];let s=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight-22,"ui","paper.png").setDepth(1e4).setScale(.92,.9),i=getBackgroundBlackout(),n=(i.setDepth(9999).setAlpha(0),PhaserScene.add.text(gameConsts.halfWidth,s.y-260,getLangText("lvl_select"),{fontFamily:"germania",fontSize:30,color:"#200000",align:"center"}).setOrigin(.5,0).setAlpha(.8).setScale(.89,.89).setDepth(1e4));PhaserScene.tweens.add({targets:s,scaleX:.93,scaleY:.91,ease:"Back.easeOut",duration:250}),PhaserScene.tweens.add({targets:n,scaleX:1,scaleY:1,ease:"Cubic.easeOut",duration:250}),PhaserScene.tweens.add({targets:i,alpha:.67,ease:"Quart.easeOut",duration:250});let l,r=new Button({normal:{atlas:"buttons",ref:"closebtn.png",alpha:.95,x:gameConsts.halfWidth+217,y:n.y+20},hover:{alpha:1,atlas:"buttons",ref:"closebtn_hover.png"},press:{atlas:"buttons",ref:"closebtn_press.png",alpha:1},disable:{atlas:"buttons",ref:"closebtn.png",alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{for(var e in closeLevelSelectScreen(),i.setAlpha(0),n.destroy(),s.destroy(),r.destroy(),l.unsubscribe(),o)o[e].destroy()}}),o=(r.setDepth(this.baseDepth+10),l=messageBus.subscribe("cancelScreen",()=>{for(var e in closeLevelSelectScreen(),i.setAlpha(0),n.destroy(),s.destroy(),r.destroy(),l.unsubscribe(),o)o[e].destroy()}),[]),h=Math.min(15,Math.max(gameVars.latestLevel+1,Math.min(gameVars.maxLevel,15)));8<=h&&(h=15);for(let a=1;a<=h;a++){var c=e[a-1],g=t[a-1],d=`level${a}btn.png`,d=new Button({normal:{ref:d,atlas:"tutorial",x:c,y:g,alpha:.75,scaleX:.98,scaleY:.98},hover:{alpha:.9,scaleX:1,scaleY:1},press:{alpha:1,scaleX:1,scaleY:1},disable:{alpha:0,scaleX:1,scaleY:1},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{if(11===a)for(var e in closeLevelSelectScreen(),clearMenuButtons(),beginLevel(a),switchLevelBackground(a),i.setAlpha(0),n.destroy(),s.destroy(),r.destroy(),l.unsubscribe(),o)o[e].destroy();else if(8<=a)showWishlistPage();else for(var t in closeLevelSelectScreen(),clearMenuButtons(),beginPreLevel(a),i.setAlpha(0),n.destroy(),s.destroy(),r.destroy(),l.unsubscribe(),o)o[t].destroy()}});d.setDepth(1e4),o.push(d)}}function showWishlistPage(){playSound("flip2");let e=new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:gameConsts.halfHeight,alpha:.15,scaleX:1e3,scaleY:1e3},onMouseUp:()=>{}}),t=(e.setDepth(99999),PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight,"ui","paper.png").setDepth(99999).setAlpha(0).setScale(.95,1.08)),a=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight+172,"ending","poster.png").setDepth(99999).setAlpha(0).setScale(.77),s=PhaserScene.add.text(gameConsts.halfWidth,gameConsts.halfHeight-300,getLangText("wishlist_title"),{fontFamily:"germania",fontSize:42,color:"#200000",align:"center"}),i=(s.setDepth(99999).setOrigin(.5,.5).setAlpha(0),PhaserScene.add.text(gameConsts.halfWidth,gameConsts.halfHeight-274,getLangText("wishlist_subtitle"),{fontFamily:"germania",fontSize:28,color:"#200000",align:"center"})),n=(i.setDepth(99999).setOrigin(.5,0).setAlpha(0),PhaserScene.add.text(gameConsts.halfWidth-240,gameConsts.halfHeight-238,getLangText("wishlist_body"),{fontFamily:"germania",fontSize:24,color:"#200000",align:"left"})),l=(n.setDepth(99999).setOrigin(0,0).setAlpha(0),PhaserScene.tweens.add({targets:[t],scaleX:.965,scaleY:1.1,ease:"Back.easeOut",duration:250}),PhaserScene.tweens.add({targets:[a],scaleX:.79,scaleY:.79,ease:"Back.easeOut",duration:300}),this.wishlistButton=new Button({normal:{atlas:"ending",ref:"wishlist.png",alpha:.95,scaleX:1,scaleY:1,x:gameConsts.halfWidth,y:gameConsts.halfHeight-35},hover:{alpha:1,scaleX:1.01,scaleY:1.01,atlas:"ending",ref:"wishlist.png"},press:{atlas:"ending",ref:"wishlist.png",alpha:1},disable:{atlas:"endings",ref:"wishlist.png",alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{openWishlist()}}),this.wishlistButton.setDepth(1e5),PhaserScene.add.text(gameConsts.halfWidth-50,this.wishlistButton.getYPos(),getLangText("wishlist_on_steam"),{fontFamily:"germania",fontSize:"fr"===language?24:32,color:"#200000",align:"left"}));l.setDepth(1e5).setOrigin(0,.5).setAlpha(0),PhaserScene.tweens.add({targets:[t,a,s,i,n,l],alpha:1,ease:"Cubic.easeOut",duration:250,onComplete:()=>{t.canDelete=!0}}),this.closeButton=new Button({normal:{atlas:"buttons",ref:"closebtn.png",alpha:.95,x:gameConsts.halfWidth+234,y:gameConsts.halfHeight-305},hover:{alpha:1,atlas:"buttons",ref:"closebtn_hover.png"},press:{atlas:"buttons",ref:"closebtn_press.png",alpha:1},disable:{atlas:"buttons",ref:"closebtn.png",alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{t.canDelete&&(playSound("flip1",.7).detune=-200,e.destroy(),this.closeButton.destroy(),this.wishlistButton.destroy(),canvas&&(canvas.style.cursor="default"),PhaserScene.tweens.add({targets:[t,a,s,i,n,l],alpha:0,duration:250,ease:"Quad.easeOut",onComplete:()=>{t.destroy(),a.destroy(),s.destroy(),i.destroy(),n.destroy(),l.destroy()}}))}}),this.closeButton.setDepth(1e5)}function closeLevelSelectScreen(){hideGlobalClickBlocker(),globalObjects.encyclopedia.showButton(),globalObjects.options.showButton()}function openWishlist(){window.open("https://store.steampowered.com/app/3170660/Spellwheel/","_blank").focus()}function openUnlocks(){}class PostFightScreen{constructor(e){this.scene=e,this.bgShade=null,this.backing=null,this.titleText=null,this.spellsCastText=null,this.healthLeftText=null,this.locketSprite=null,this.locketDialogImage=null,this.locketDialog=null,this.locketMusic=null,this.locketRecentlyClicked=!1,this.locketDialogIndex=0,this.isActive=!1}startGloom(){this.gloom||(this.gloom=this.scene.add.image(gameConsts.width+600,gameConsts.halfHeight-160,"blurry","gloom.webp").setScale(5.4,6).setDepth(100002).setAlpha(0).setBlendMode(Phaser.BlendModes.MULTIPLY)),this.gloom.setPosition(gameConsts.width+600,gameConsts.halfHeight-155),this.gloom.currAnim&&this.gloom.currAnim.stop(),this.gloom.currAnim=PhaserScene.tweens.add({targets:[this.gloom],alpha:.2,duration:1e3})}initAssets(e=!0,t=!1,a=!0){if(sdkShowBannerAd(),this.locketIsOpen=!1,this.locketIsClosable=!1,this.bgShade||(this.bgShade=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setDepth(1e5).setAlpha(0).setScale(500,500)),this.backing||(this.backing=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-30,"backgrounds","battleOverScreen.png").setDepth(1e5).setAlpha(0)),this.titleText||(this.titleText=this.scene.add.text(gameConsts.halfWidth-225,gameConsts.halfHeight-269,"(placeholder title)",{fontFamily:"germania",fontSize:46,color:"#000000",align:"left"}).setAlpha(0).setOrigin(0,.5).setDepth(1e5)),this.healthLeftText||(this.healthLeftText=this.scene.add.text(gameConsts.halfWidth-225,gameConsts.halfHeight-219,getLangText("post_fight_health"),{fontFamily:"garamondmax",fontSize:26,color:"#000000",align:"left"}).setAlpha(0).setOrigin(0,.5).setDepth(1e5)),this.spellsCastText||(this.spellsCastText=this.scene.add.text(gameConsts.halfWidth-225,gameConsts.halfHeight-184,getLangText("post_fight_spells"),{fontFamily:"garamondmax",fontSize:26,color:"#000000",align:"left"}).setAlpha(0).setOrigin(0,.5).setDepth(1e5)),a&&!this.locketSprite&&(this.locketSprite=this.scene.add.sprite(gameConsts.width+300,gameConsts.halfHeight-120,"misc","locket1.png").setScale(.75).setDepth(100003).setAlpha(0).setOrigin(.5,.5)),this.locketDialogImage||(this.locketDialogImage=this.scene.add.sprite(gameConsts.halfWidth-146,gameConsts.halfHeight-170,"lowq","story_img_1.png").setDepth(100003).setAlpha(0).setOrigin(.46,.1).setBlendMode(Phaser.BlendModes.MULTIPLY)),this.locketDialog||(this.locketDialog=this.scene.add.text(gameConsts.halfWidth-225,gameConsts.halfHeight-85,"(placeholder story)",{fontFamily:"garamondmax",fontSize:24,color:"#000000",align:"left"}).setAlpha(0).setOrigin(0,0).setDepth(1e5)),this.newRuneAnnounce||(this.newRuneAnnounce=this.scene.add.text(gameConsts.halfWidth-225,gameConsts.halfHeight-131,getLangText("post_fight_newrune"),{fontFamily:"germania",fontSize:26,color:"#000000",align:"left"}).setAlpha(0).setOrigin(0,.5).setDepth(1e5)),this.newRuneDesc||(this.newRuneDesc=this.scene.add.text(gameConsts.halfWidth-225,gameConsts.halfHeight-95,"(insert rune description)",{fontFamily:"garamondmax",fontSize:22,color:"#000000",align:"left"}).setAlpha(0).setOrigin(0,0).setDepth(1e5)),this.newRuneIcon||(this.newRuneIcon=this.scene.add.image(gameConsts.halfWidth-55,gameConsts.halfHeight-135,"tutorial","rune_matter_large.png").setScale(0).setDepth(100002).setAlpha(0)),this.flashObj||(this.flashObj=this.scene.add.image(.76*gameConsts.width,gameConsts.halfHeight-160,"blurry","flash.webp").setScale(0).setDepth(100002).setAlpha(.5)),!this.continueButton){this.continueButton=new Button({normal:{atlas:"ui",ref:"nextLevel.png",visible:!0,alpha:.95,x:gameConsts.halfWidth-161,y:gameConsts.halfHeight+226},hover:{atlas:"ui",alpha:1,ref:"nextLevel_hover.png"},press:{atlas:"ui",alpha:1,ref:"nextLevel_press.png"},disable:{atlas:"ui",ref:"nextLevel_press.png",alpha:0},onHover:()=>{playSound("button_hover").detune=100,canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{}}),this.continueButton.addText(getLangText("post_fight_skip_training"),{fontFamily:"germania",fontSize:19,color:"#000000",align:"center"});let e=this.continueButton.getText();e.alpha=0,this.continueButton.setOnHoverFunc(()=>{playSound("button_hover").detune=75,canvas&&(canvas.style.cursor="pointer"),e.alpha=1}),this.continueButton.setOnHoverOutFunc(()=>{canvas&&(canvas.style.cursor="default"),e.alpha=.7}),this.continueButton.setDepth(1e5)}this.trainingButton||(this.trainingButton=new Button({normal:{atlas:"ui",ref:"practice.png",visible:!0,alpha:.95,x:gameConsts.halfWidth,y:gameConsts.halfHeight+175},hover:{atlas:"ui",alpha:1,ref:"practice_hover.png"},press:{atlas:"ui",alpha:1,ref:"practice_press.png"},disable:{atlas:"ui",ref:"practice_press.png",alpha:0},onHover:()=>{playSound("button_hover").detune=60,canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{}}),this.trainingButton.addText(getLangText("post_fight_training"),{fontFamily:"germania_italics",fontSize:28,color:"#000000",align:"center"}),this.trainingButton.setDepth(1e5),this.trainingButton.setState(DISABLE),this.trainingRuneIcon=this.scene.add.image(this.trainingButton.getXPos()-128,this.trainingButton.getYPos(),"tutorial","rune_matter_large.png").setScale(0).setDepth(100002).setAlpha(0)),this.gloom||(this.gloom=this.scene.add.image(this.locketSprite.x,this.locketSprite.y-55,"blurry","gloom.webp").setScale(5.4,6).setDepth(100002).setAlpha(0).setBlendMode(Phaser.BlendModes.MULTIPLY)),this.locketButton||(this.locketButton=new Button({normal:{ref:"blackPixel",alpha:0,x:.8*gameConsts.width,y:gameConsts.halfHeight-150,scaleX:110,scaleY:110},disable:{alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer"),this.gloom.currAnim&&this.gloom.currAnim.stop(),this.gloom.currAnim=PhaserScene.tweens.add({targets:this.gloom,scaleX:8,scaleY:9.3,alpha:.23,duration:800,ease:"Cubic.easeOut"}),this.locketSprite.setScale(.77)},onHoverOut:()=>{canvas&&(canvas.style.cursor="default"),this.gloom.currAnim&&this.gloom.currAnim.stop(),this.locketSprite.setScale(.75),this.gloom.currAnim=PhaserScene.tweens.add({targets:this.gloom,scaleX:5,scaleY:6,alpha:.27,duration:500,ease:"Back.easeOut"})},onMouseUp:()=>{this.locketRecentlyClicked=!0,this.locketIsOpen?this.locketIsClosable?(playSound("locket_close"),"locket4.png"===this.locketSprite.frame.name&&(this.locketButton.setState(DISABLE),PhaserScene.tweens.add({targets:[this.locketSprite],x:gameConsts.width+140,alpha:0,ease:"Cubic.easeIn",duration:450}),canvas)&&(canvas.style.cursor="default"),this.locketSprite.setFrame("locket4.png").setOrigin(.5,.8),this.locketSprite.setScale(this.locketSprite.scaleX+.02),PhaserScene.tweens.add({targets:[this.locketSprite],scaleX:.75,scaleY:.75,ease:"Cubic.easeOut",duration:250})):this.closeLocket():this.openLocket()}}),this.locketButton.setDepth(100001)),this.subscription||(this.subscription=messageBus.subscribe("language_switch",()=>{gameVars.currLevel<=8&&0<=gameVars.currLevel&&1!==gameVars.currLevel?this.trainingButton.setText(getLangText("post_fight_training")):this.trainingButton.setText(getLangText("post_fight_no_training")),this.setTextUI(gameVars.currLevel)})),this.locketButton.setState(DISABLE),this.backing.setScale(.98),this.titleText.setScale(.97),this.healthLeftText.setScale(.97),this.spellsCastText.setScale(.97),this.newRuneAnnounce.setScale(.97),this.newRuneIcon.setScale(.4),this.trainingRuneIcon.setScale(.4).setVisible(!0),e&&(a&&!this.locketRecentlyClicked&&(this.locketSprite.visible=!0,this.locketSprite.x=gameConsts.width+300,this.locketSprite.y=gameConsts.halfHeight-105,this.locketSprite.setScale(.75),this.locketSprite.setFrame("locket1.png").setOrigin(.5,.8)),t?this.gloom.visible=!1:(this.gloom.visible=!0,this.gloom.setPosition(this.locketSprite.x,this.locketSprite.y-50),this.gloom.currAnim&&this.gloom.currAnim.stop(),this.gloom.currAnim=PhaserScene.tweens.add({targets:[this.gloom],alpha:.25,ease:"Cubic.easeOut",duration:400}))),this.continueButton.setState(DISABLE),gameVars.currLevel<=8&&0<=gameVars.currLevel&&1!==gameVars.currLevel?(this.trainingButton.setText(getLangText("post_fight_training")),this.trainingButton.setState(NORMAL),setTimeout(()=>{var e;this.trainingButton.getState()!==DISABLE&&(e=this.continueButton.setText(getLangText("post_fight_skip_training")),this.continueButton.setState(NORMAL),gameVars.currLevel+1<gameVars.maxLevel?e.alpha=.7:gameVars.currLevel<=2?e.alpha=0:e.alpha=.25)},3e3)):(this.trainingButton.setText(getLangText("post_fight_no_training")),this.trainingButton.setState(NORMAL),this.continueButton.setState(DISABLE),this.continueButton.setText(getLangText("post_fight_continue")),this.trainingRuneIcon.visible=!1),PhaserScene.tweens.add({targets:[this.bgShade],alpha:.4,duration:1e3}),PhaserScene.tweens.add({targets:[this.backing,this.titleText],scaleX:1,scaleY:1,alpha:1,ease:"Back.easeOut",duration:450,onComplete:()=>{PhaserScene.tweens.add({delay:200,targets:[this.newRuneIcon,this.trainingRuneIcon],scaleX:.435,scaleY:.435,alpha:1,duration:250,onComplete:()=>{}}),PhaserScene.tweens.add({delay:200,targets:[this.spellsCastText,this.healthLeftText,this.newRuneAnnounce,this.newRuneDesc],scaleX:1,scaleY:1,alpha:1,duration:250}),a&&e&&(this.locketSprite.visible=!this.locketRecentlyClicked,PhaserScene.tweens.add({delay:400,targets:[this.locketSprite],alpha:1,duration:700,onStart:()=>{this.locketRecentlyClicked||(this.locketButton.setState(NORMAL),PhaserScene.tweens.add({targets:[this.locketSprite,this.gloom],x:.76*gameConsts.width,ease:"Cubic.easeOut",duration:1e3,onComplete:()=>{var e=this.locketSprite.scaleX;this.locketSprite.setFrame("locket2.png").setOrigin(.5,.8).setScale(1.05*e),PhaserScene.tweens.add({targets:this.locketSprite,scaleY:e,scaleX:e,ease:"Back.easeOut",duration:300}),this.flashObj.alpha=.5,this.scene.tweens.add({targets:this.flashObj,scaleX:1.7,scaleY:1.7,ease:"Cubic.easeIn",rotation:"+=0.1",duration:300,alpha:1,onComplete:()=>{this.scene.tweens.add({targets:this.flashObj,scaleX:0,scaleY:0,ease:"Cubic.easeOut",rotation:"+=0.15",duration:500,onComplete:()=>{this.flashObj.alpha=0,this.flashObj.rotation=-.2}})}})}}))}}))}})}closeLocket(){this.locketIsClosable=!0,PhaserScene.tweens.add({delay:50,targets:[this.locketSprite],scaleX:.75,scaleY:.75,x:.8*gameConsts.width+10,y:gameConsts.halfHeight-115,ease:"Cubic.easeInOut",duration:400}),this.returnStatText()}openLocket(){this.locketSprite&&(playSound("locket_open"),this.locketIsOpen=!0,this.locketSprite.setFrame("locket3.png").setOrigin(.5,.8),this.locketSprite.setScale(this.locketSprite.scaleX+.02),this.gloom.currAnim&&this.gloom.currAnim.stop(),this.gloom.currAnim=PhaserScene.tweens.add({targets:[this.gloom],alpha:0,ease:"Cubic.easeOut",duration:301,onComplete:()=>{this.gloom.visible=!1}}),PhaserScene.tweens.add({targets:[this.locketSprite],scaleX:.75,scaleY:.75,y:"-=35",x:"+=12",ease:"Cubic.easeOut",duration:250}),this.showStoryText(gameVars.currLevel))}clearWindSound(){this.windSfx&&fadeAwaySound(this.windSfx,1500)}createWinScreen(e=0){this.windSfx=playSound("wind",.01,!0),this.windSfx.detune=-700,fadeInSound(this.windSfx,.85,2e3),gameVars.maxLevel=Math.max(gameVars.maxLevel,e+1),e>gameVars.latestLevel&&(gameVars.latestLevel=e,sdkSetItem("latestLevel",gameVars.latestLevel.toString()),sdkSetItem("maxLevel",gameVars.maxLevel.toString())),1===(gameVars.currLevel=e)||4===e?this.createWinScreenUIAlt(e):(this.createWinScreenUI(e),this.continueButton.setOnMouseUpFunc(()=>{this.locketRecentlyClicked=!1,this.trainingButton.getState(),DISABLE,this.moveToNextLevel(e)}),this.trainingButton.setOnMouseUpFunc(()=>{playSound("button_click"),this.clearPostFightScreen(),beginPreLevel(e<8?-e:e+1),canvas&&(canvas.style.cursor="default")}))}moveToNextLevel(e){playSound("button_click"),this.clearPostFightScreen(),beginPreLevel(e+1),canvas&&(canvas.style.cursor="default")}createWinScreenBoom(e=0){this.createWinScreenUI(e),this.continueButton.setState(DISABLE),this.trainingButton.setState(NORMAL),this.trainingButton.setOnMouseUpFunc(()=>{this.locketRecentlyClicked=!1,this.clearPostFightScreen(!1),messageBus.publish("robotExplosion"),canvas&&(canvas.style.cursor="default")})}createWinScreenUI(e=0){globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),this.isMin=!1,this.isCreated=!0,this.locketRecentlyClicked=!1,globalObjects.magicCircle.disableMovement(),this.trainingRuneIcon&&(this.trainingRuneIcon.visible=!0),this.initAssets(!0),this.newRuneDesc.alpha=0,this.newRuneIcon.visible=!0,this.gloom.alpha=0,this.newRuneIcon.setFrame(this.getNewRuneFrame(e)),this.trainingRuneIcon.setFrame(this.getNewRuneFrame(e)),this.setTextUI(e),this.locketDialogImage.setFrame("story_img_"+e+".png"),globalObjects.bannerTextManager.setDialog(this.locketDialog)}createWinScreenUIAlt(e=0){this.isMin=!1,this.isCreated=!0,this.locketRecentlyClicked=!1,globalObjects.magicCircle.disableMovement(),this.trainingRuneIcon&&(this.trainingRuneIcon.visible=!0),this.locketSprite||(this.locketSprite=this.scene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight-60,"misc","locket1.png")),this.locketSprite.setRotation(-.25).setScale(.75).setDepth(100003).setAlpha(0).setVisible(!0).setFrame("locket1.png").setOrigin(.5,.8),PhaserScene.tweens.add({delay:200,targets:this.locketSprite,alpha:1,ease:"Cubic.easeOut",duration:1150}),PhaserScene.tweens.add({delay:250,targets:this.locketSprite,ease:"Cubic.easeOut",scaleX:.85,scaleY:.85,duration:650,onComplete:()=>{PhaserScene.tweens.add({targets:this.locketSprite,ease:"Cubic.easeOut",scaleX:.75,scaleY:.75,duration:900})}}),PhaserScene.tweens.add({delay:950,targets:this.locketSprite,x:.76*gameConsts.width,y:gameConsts.halfHeight-105,ease:"Cubic.easeInOut",duration:1050,onComplete:()=>{}}),PhaserScene.tweens.add({delay:250,targets:this.locketSprite,rotation:0,ease:"Cubic.easeInOut",duration:1600,onComplete:()=>{globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),this.initAssets(!0,void 0,!1),playSound("flip3"),this.newRuneDesc.alpha=0,this.newRuneIcon.visible=!0,this.gloom.alpha=0,this.newRuneIcon.setFrame(this.getNewRuneFrame(e)),this.trainingRuneIcon.setFrame(this.getNewRuneFrame(e)),this.setTextUI(e),this.locketDialogImage.setFrame("story_img_"+e+".png"),globalObjects.bannerTextManager.setDialog(this.locketDialog),this.continueButton.setOnMouseUpFunc(()=>{this.locketRecentlyClicked=!1,this.trainingButton.getState(),DISABLE,this.moveToNextLevel(e)}),this.trainingButton.setOnMouseUpFunc(()=>{playSound("button_click"),this.clearPostFightScreen(),beginPreLevel(e<8?-e:e+1),canvas&&(canvas.style.cursor="default")}),setTimeout(()=>{this.locketButton.setState(NORMAL),this.gloom.x=.76*gameConsts.width;var e=this.locketSprite.scaleX;this.locketSprite.setFrame("locket2.png").setOrigin(.5,.8).setScale(1.05*e),playSound("locket_open"),PhaserScene.tweens.add({targets:this.locketSprite,scaleY:e,scaleX:e,ease:"Back.easeOut",duration:300}),this.flashObj.alpha=.5,this.scene.tweens.add({targets:this.flashObj,scaleX:1.7,scaleY:1.7,ease:"Cubic.easeIn",rotation:"+=0.1",duration:300,alpha:1,onComplete:()=>{this.scene.tweens.add({targets:this.flashObj,scaleX:0,scaleY:0,ease:"Cubic.easeOut",rotation:"+=0.15",duration:500,onComplete:()=>{this.flashObj.alpha=0,this.flashObj.rotation=-.2}})}})},150)}})}setTextUI(e=gameVars.currLevel){this.isMin?(this.titleText.setText(getLangText("post_fight_title2")),this.newRuneAnnounce.setText(" "),this.newRuneDesc.setText(" "),this.trainingButton.setText(getLangText("post_fight_no_training"))):(this.titleText.setText(getLangText("post_fight_title")),this.newRuneAnnounce.setText(this.getNewRuneAnnounce(e)),this.newRuneDesc.setText(this.getNewRuneDesc(e))),this.healthLeftText.setText(getLangText("post_fight_health")+globalObjects.player.getHealth()+"/"+globalObjects.player.getHealthMax()),this.spellsCastText.setText(getLangText("post_fight_spells")+globalObjects.player.getPlayerCastSpellsCount()),gameVars.currLevel<=8&&0<=gameVars.currLevel&&1!==gameVars.currLevel?this.continueButton.setText(getLangText("post_fight_skip_training")):this.continueButton.setText(getLangText("post_fight_continue")),this.locketDialog.setText(this.getStoryDialog(e)),this.titleText.setText(getLangText("post_fight_day")+e+getLangText("post_fight_day2"))}showStoryText(e){var t=[this.spellsCastText,this.healthLeftText,this.newRuneAnnounce,this.newRuneDesc,this.newRuneIcon];this.locketMusic=playMusic("sleepless",.5),this.windSfx||(this.windSfx=playSound("wind",.01,!0),this.windSfx.detune=-700),fadeInSound(this.windSfx,.3,2e3),PhaserScene.tweens.add({delay:100,targets:[this.locketDialog,this.locketDialogImage],alpha:1,ease:"Cubic.easeIn",duration:500}),PhaserScene.tweens.add({targets:t,alpha:0,ease:"Cubic.easeOut",duration:500}),PhaserScene.tweens.add({targets:this.titleText,alpha:.1,ease:"Cubic.easeOut",duration:300,onComplete:()=>{this.titleText.setText(getLangText("post_fight_day")+e+getLangText("post_fight_day2")),PhaserScene.tweens.add({targets:this.titleText,alpha:1,duration:350})}})}returnStatText(){this.locketMusic&&fadeAwaySound(this.locketMusic,3500,"Quad.easeOut");var e=[this.titleText,this.spellsCastText,this.healthLeftText,this.newRuneAnnounce,this.newRuneDesc,this.newRuneIcon];PhaserScene.tweens.add({targets:[this.locketDialog,this.locketDialogImage],alpha:0,ease:"Cubic.easeOut",duration:500}),PhaserScene.tweens.add({delay:100,targets:e,alpha:1,ease:"Cubic.easeIn",duration:500})}getNewRuneAnnounce(e){return e<9?getLangText("post_fight_newrune"):11<=e?getLangText("post_fight_noupgrade"):getLangText("post_fight_upgrade")}getNewRuneDesc(e){switch(e){case 1:case 2:return getLangText("mind_tut_desc");case 3:return getLangText("protect_tut_desc");case 4:return getLangText("reinforce_tut_desc");case 5:return getLangText("time_tut_desc");case 6:case 7:return getLangText("void_tut_desc");case 8:return getLangText("unload_tut_desc");case 9:return getLangText("matter_plus_tut_desc");case 10:return getLangText("mind_plus_tut_desc");case 11:return getLangText("no_improve_tut_desc");default:return"(missing description)"}}getNewRuneFrame(e){switch(e){case 1:case 2:return"rune_energy_large.png";case 3:return"rune_protect_large.png";case 4:return"rune_reinforce_large.png";case 5:return"rune_time_large.png";case 6:case 7:return"rune_void_large.png";case 8:return"rune_unload_large.png";case 9:return"rune_matter_large.png";case 10:return"rune_energy_large.png";default:return"blank.png"}}getStoryDialog(e){switch(e){case 0:return"And so my journey begins.\nIt won't be long before\nI see you again, Rosemary.";case 1:case 2:return getLangText("post_fight_story1");case 3:return getLangText("post_fight_story2");case 4:return getLangText("post_fight_story3");case 5:return getLangText("post_fight_story4");case 6:case 7:return getLangText("post_fight_story5");case 8:return getLangText("post_fight_story6");case 9:return getLangText("post_fight_story7");case 10:return getLangText("post_fight_story8");case 11:return getLangText("post_fight_story9");default:return"..."}}clearGloom(){this.gloom&&(this.gloom.currAnim&&this.gloom.currAnim.stop(),this.gloom.currAnim=PhaserScene.tweens.add({targets:[this.gloom],alpha:0,ease:"Cubic.easeOut",duration:500}))}clearPostFightScreen(e=!0){this.isCreated&&(this.clearWindSound(),this.clearGloom(),PhaserScene.tweens.add({targets:[this.bgShade,this.backing,this.titleText,this.spellsCastText,this.healthLeftText,this.newRuneDesc,this.newRuneIcon,this.trainingRuneIcon,this.newRuneAnnounce,this.locketSprite,this.locketDialog,this.locketDialogImage],alpha:0,ease:"Quad.easeOut",duration:600,onComplete:()=>{this.locketSprite.visible=!1}}),this.locketMusic&&fadeAwaySound(this.locketMusic,800,void 0,()=>{this.locketMusic=null}),globalObjects.bannerTextManager.setOnFinishFunc(()=>{}),globalObjects.bannerTextManager.closeBanner(),this.continueButton.setState(DISABLE),this.trainingButton.setState(DISABLE),this.locketButton.setState(DISABLE),globalObjects.magicCircle.enableMovement(),e)&&clearDeathFog()}}class ConfirmPopup{constructor(e){this.scene=e,this.confirmFunc=()=>{},messageBus.subscribe("showConfirmPopup",e=>{this.confirmFunc=e}),this.defaultDepth=100100,this.darkBG=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setScale(500).setDepth(this.defaultDepth).setAlpha(0),this.backing=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"ui","small_paper.png").setDepth(this.defaultDepth).setAlpha(0)}showPopup(){this.scene.tweens.add({targets:this.darkBG,alpha:.4,ease:"Cubic.easeOut",duration:250}),this.scene.tweens.add({targets:this.backing,alpha:1,ease:"Cubic.easeOut",duration:250})}confirm(){this.confirmFunc()}hide(){this.scene.tweens.add({targets:[this.darkBG,this.backing],alpha:0,duration:250})}}function getBackgroundBlackout(){if(globalObjects)return globalObjects.blackBackground||(globalObjects.blackBackground=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setScale(1e3,1e3).setDepth(-3)),globalObjects.blackBackground.setDepth(-3),globalObjects.blackBackground}function getBackgroundBlackout2(){if(globalObjects)return globalObjects.blackBackground2||(globalObjects.blackBackground2=PhaserScene.add.sprite(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setScale(1e3,1e3).setDepth(-8).setAlpha(0)),globalObjects.blackBackground2}function createGlobalClickBlocker(e){return globalObjects.clickBlocker?(globalObjects.clickBlocker.setState(NORMAL),globalObjects.clickBlocker.setOnMouseUpFunc(()=>{}),buttonManager.bringButtonToTop(globalObjects.clickBlocker)):globalObjects.clickBlocker=new Button({normal:{ref:"blackPixel",x:gameConsts.halfWidth,y:gameConsts.halfHeight,alpha:.001,scaleX:1e3,scaleY:1e3},onMouseUp:()=>{}}),globalObjects.magicCircle&&globalObjects.magicCircle.disableMovement(),e&&canvas&&(canvas.style.cursor="pointer"),globalObjects.clickBlocker}function hideGlobalClickBlocker(){globalObjects.clickBlocker.setState(DISABLE),canvas&&(canvas.style.cursor="default"),globalObjects.magicCircle&&globalObjects.magicCircle.enableMovement()}let cheatsDisplay;function toggleCheat(e){switch(e){case"cene":cheats.calmEnemies=!cheats.calmEnemies;break;case"dd":cheats.extraDmg=!cheats.extraDmg;break;case"edd":cheats.extraExtraDmg=!cheats.extraExtraDmg;break;case"hpx":cheats.extraHealth=!cheats.extraHealth,globalObjects.player.reInitStats(),globalObjects.player.resetStats();break;case"hpdx":cheats.bonusHealth=!cheats.bonusHealth,globalObjects.player.reInitStats(),globalObjects.player.resetStats();break;case"sshd":cheats.superShield=!cheats.superShield,cheats.superShield?messageBus.publish("castSpell",{runeName:"rune_matter"},{runeName:"rune_superprotect"},"shield9",0):globalObjects.player.clearSpecificEffect("shield9");break;case"inam":cheats.infiniteAmmo=!cheats.infiniteAmmo,messageBus.publish("manualResetElements"),messageBus.publish("manualResetEmbodiments");break;case"flal":cheats.fullArsenal=!cheats.fullArsenal,updateSpellState(gameVars.currLevel),globalObjects.magicCircle.buildRunes(),messageBus.publish("manualResetElements"),messageBus.publish("manualResetEmbodiments");break;case"ultr":cheats.extraUlt=!cheats.extraUlt,updateSpellState(gameVars.currLevel),globalObjects.magicCircle.buildRunes(),messageBus.publish("manualResetElements"),messageBus.publish("manualResetEmbodiments")}updateCheatsDisplay()}function updateCheatsDisplay(){let e="C:",t=(cheatsDisplay||(cheatsDisplay=PhaserScene.add.text(gameConsts.width-7,gameConsts.height," ",{fontFamily:"robotomedium",fontSize:15,color:"#FF0000",align:"right"}).setOrigin(1,1)).setDepth(500).setAlpha(.5),!1);for(var a in cheats)cheats[a]&&(t=!0,e+="\n"+a);cheatsDisplay.visible=!0,t?(cheatsDisplay.setText(e),gameVars.hasCheated=!0):gameVars.hasCheated?cheatsDisplay.setText("C"):cheatsDisplay.visible=!1}function isUsingCheats(){for(var e in cheats)if(cheats[e])return!0;return!1}class Encyclopedia{constructor(e,t,a){this.startX=t,this.startY=a,this.baseDepth=101e3,this.listOfThingsToHide=[],this.currentPageItems=[],this.listOfButtonsToDisable=[],this.button=new Button({normal:{atlas:"buttons",ref:"encyclopedia_btn_normal.png",alpha:1,x:t,y:a},hover:{atlas:"buttons",ref:"encyclopedia_btn_hover.png",alpha:1},press:{atlas:"buttons",ref:"encyclopedia_btn_press.png",alpha:1},disable:{atlas:"buttons",ref:"encyclopedia_btn_press.png",alpha:0},onHover:()=>{playSound("click",1.1).detune=100,canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{this.showEncyclopedia()}}),this.button.setDepth(this.baseDepth),messageBus.subscribe("cancelScreen",this.hideEncyclopedia.bind(this)),this.button.setScrollFactor(0,0)}showEncyclopedia(){globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton(),this.hidingAnim1&&this.hidingAnim1.stop(),this.darkenBG||(this.darkenBG=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setDepth(this.baseDepth-1),this.darkenBG.setScale(500,500)),this.tab1||(this.tab1=PhaserScene.add.image(gameConsts.halfWidth-190,gameConsts.halfHeight-310,"ui","paperTab.png").setDepth(this.baseDepth-1).setAlpha(0),this.tab1Icon=PhaserScene.add.image(this.tab1.x,this.tab1.y-70,"ui","tab_icon_control.png").setDepth(this.baseDepth-1).setAlpha(0),this.listOfThingsToHide.push(this.tab1),this.listOfThingsToHide.push(this.tab1Icon)),this.tab2||(this.tab2=PhaserScene.add.image(gameConsts.halfWidth-90,gameConsts.halfHeight-310,"ui","paperTab.png").setDepth(this.baseDepth-1).setAlpha(0),this.tab2Icon=PhaserScene.add.image(this.tab2.x,this.tab2.y-70,"ui","tab_icon_runes.png").setDepth(this.baseDepth-1).setAlpha(0),this.listOfThingsToHide.push(this.tab2),this.listOfThingsToHide.push(this.tab2Icon)),this.tab3||(this.tab3=PhaserScene.add.image(gameConsts.halfWidth+10,gameConsts.halfHeight-310,"ui","paperTab.png").setDepth(this.baseDepth-1).setAlpha(0),this.tab3Icon=PhaserScene.add.image(this.tab3.x,this.tab3.y-70,"ui","tab_icon_combos.png").setDepth(this.baseDepth-1).setAlpha(0),this.listOfThingsToHide.push(this.tab3),this.listOfThingsToHide.push(this.tab3Icon)),this.bgPage||(this.bgPage=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight+22,"ui","paper.png").setDepth(this.baseDepth).setAlpha(0).setScale(1,1.08),this.listOfThingsToHide.push(this.bgPage)),this.title||(this.title=PhaserScene.add.text(gameConsts.halfWidth-255,gameConsts.halfHeight-290,getLangText("pre_fight_0a"),{fontFamily:"germania",fontSize:24,color:"#200000",align:"left"}).setDepth(this.baseDepth).setAlpha(0),this.listOfThingsToHide.push(this.title)),createGlobalClickBlocker(),this.activateTabButtons(),this.closeButton?(buttonManager.bringButtonToTop(this.closeButton),this.closeButton.setState(NORMAL)):(this.closeButton=new Button({normal:{atlas:"buttons",ref:"closebtn.png",alpha:.95,x:gameConsts.halfWidth+230,y:gameConsts.halfHeight-275},hover:{alpha:1,atlas:"buttons",ref:"closebtn_hover.png"},press:{atlas:"buttons",ref:"closebtn_press.png",alpha:1},disable:{atlas:"buttons",ref:"closebtn.png",alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{this.hideEncyclopedia()}}),this.closeButton.setDepth(this.baseDepth+10),this.listOfButtonsToDisable.push(this.closeButton)),this.setFirstPage(),this.darkenBG.setAlpha(.55),PhaserScene.tweens.add({targets:this.listOfThingsToHide,alpha:1,ease:"Cubic.easeOut",duration:.25,onComplete:()=>{this.canClose=!0}}),this.raiseTab(1),messageBus.publish("pauseGame",.002)}activateTabButtons(){this.tab1Button?(buttonManager.bringButtonToTop(this.tab1Button),this.tab1Button.setState(NORMAL)):(this.tab1Button=new Button({normal:{ref:"blackPixel",alpha:0,x:this.tab1Icon.x,y:this.tab1Icon.y+26,scaleX:42,scaleY:52},hover:{ref:"blackPixel",alpha:0,x:this.tab1Icon.x,y:this.tab1Icon.y+26,scaleX:43,scaleY:53},disable:{alpha:0},onHover:()=>{this.tab1.setFrame("paperTab_glow.png"),canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{this.tab1.setFrame("paperTab.png"),canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{this.clearCurrentPage(),this.setFirstPage(),this.raiseTab(1)}}),this.tab1Button.setDepth(this.baseDepth),this.listOfButtonsToDisable.push(this.tab1Button)),this.tab2Button?(buttonManager.bringButtonToTop(this.tab2Button),this.tab2Button.setState(NORMAL)):(this.tab2Button=new Button({normal:{ref:"blackPixel",alpha:0,x:this.tab2Icon.x,y:this.tab2Icon.y+26,scaleX:42,scaleY:52},hover:{ref:"blackPixel",alpha:0,x:this.tab2Icon.x,y:this.tab2Icon.y+26,scaleX:43,scaleY:53},disable:{alpha:0},onHover:()=>{this.tab2.setFrame("paperTab_glow.png"),canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{this.tab2.setFrame("paperTab.png"),canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{this.clearCurrentPage(),this.setSecondPage(),this.raiseTab(2)}}),this.tab2Button.setDepth(this.baseDepth),this.listOfButtonsToDisable.push(this.tab2Button)),this.tab3Button?(buttonManager.bringButtonToTop(this.tab3Button),this.tab3Button.setState(NORMAL)):(this.tab3Button=new Button({normal:{ref:"blackPixel",alpha:0,x:this.tab3Icon.x,y:this.tab3Icon.y+26,scaleX:42,scaleY:52},hover:{ref:"blackPixel",alpha:0,x:this.tab3Icon.x,y:this.tab3Icon.y+26,scaleX:43,scaleY:53},disable:{alpha:0},onHover:()=>{this.tab3.setFrame("paperTab_glow.png"),canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{this.tab3.setFrame("paperTab.png"),canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{this.clearCurrentPage(),this.setThirdPage(),this.raiseTab(3)}}),this.tab3Button.setDepth(this.baseDepth),this.listOfButtonsToDisable.push(this.tab3Button))}raiseTab(e){let t=[this.tab2,this.tab3],a=[this.tab2Icon,this.tab3Icon],s=this.tab1,i=this.tab1Icon;2==e?(s=this.tab2,i=this.tab2Icon,t=[this.tab1,this.tab3],a=[this.tab1Icon,this.tab3Icon]):3==e&&(s=this.tab3,i=this.tab3Icon,t=[this.tab1,this.tab2],a=[this.tab1Icon,this.tab2Icon]),PhaserScene.tweens.add({targets:t,y:gameConsts.halfHeight-293,ease:"Cubic.easeOut",duration:.5}),PhaserScene.tweens.add({targets:a,y:gameConsts.halfHeight-323,ease:"Cubic.easeOut",duration:.5}),PhaserScene.tweens.add({targets:[s],y:gameConsts.halfHeight-325,ease:"Cubic.easeOut",duration:.5}),PhaserScene.tweens.add({targets:[i],y:gameConsts.halfHeight-350,ease:"Cubic.easeOut",duration:.5})}clearCurrentPage(){let t=[...this.currentPageItems];PhaserScene.tweens.add({targets:t,alpha:0,ease:"Cubic.easeOut",duration:.5,onComplete:()=>{for(var e in t)t[e].destroy()}}),this.currentPageItems=[]}setFirstPage(){playSound("flip1"),this.title.setText(getLangText("pre_fight_0a"));var e=PhaserScene.add.image(gameConsts.halfWidth-3,gameConsts.halfHeight+14,"ui","newgame_paper.png").setDepth(this.baseDepth).setAlpha(0).setScale(1),t=PhaserScene.add.image(gameConsts.halfWidth-3,gameConsts.halfHeight+10,"ui","newgame_paper_bot.png").setDepth(this.baseDepth).setAlpha(0).setScale(1),a="zh_cn"===language||"zh_tw"===language?24:18,s=PhaserScene.add.text(gameConsts.halfWidth-84,e.y+55,getLangText("encyc_action"),{fontFamily:"germania",fontSize:a,color:"#200000",align:"center"}),a=(s.setDepth(this.baseDepth).setOrigin(.5,0).setAlpha(0),PhaserScene.add.text(gameConsts.halfWidth-91,e.y+141,getLangText("encyc_element"),{fontFamily:"germania",fontSize:a,color:"#200000",align:"center"})),i=(a.setDepth(this.baseDepth).setOrigin(.5,0).setAlpha(0),PhaserScene.add.text(gameConsts.halfWidth+138,gameConsts.halfHeight-185,getLangText("pre_fight_0c"),{fontFamily:"germania",fontSize:24,color:"#200000",align:"right"})),n=(i.setDepth(this.baseDepth).setAlpha(0).setOrigin(1,.5),PhaserScene.add.text(gameConsts.halfWidth+138,gameConsts.halfHeight-125,getLangText("pre_fight_0d"),{fontFamily:"germania",fontSize:24,color:"#200000",align:"right"})),l=(n.setDepth(this.baseDepth).setAlpha(0).setOrigin(1,.5),PhaserScene.add.text(gameConsts.halfWidth+212,gameConsts.halfHeight-66,getLangText("pre_fight_0g"),{fontFamily:"germania",fontSize:24,color:"#200000",align:"right"})),r=(l.setDepth(this.baseDepth).setAlpha(0).setOrigin(1,.5),PhaserScene.add.text(gameConsts.halfWidth-3,gameConsts.halfHeight+242,getLangText("pre_fight_0h"),{fontFamily:"germania",fontSize:24,color:"#200000",align:"center"}));r.setDepth(this.baseDepth).setAlpha(0).setOrigin(.5,.5),this.currentPageItems.push(e),this.currentPageItems.push(t),this.currentPageItems.push(s),this.currentPageItems.push(a),this.currentPageItems.push(i),this.currentPageItems.push(n),this.currentPageItems.push(l),this.currentPageItems.push(r),PhaserScene.tweens.add({targets:this.currentPageItems,alpha:1,ease:"Cubic.easeOut",duration:.5}),this.closeButton.tweenToPos(this.closeButton.getXPos(),gameConsts.halfHeight-275,.5,"Cubic.easeOut"),PhaserScene.tweens.add({targets:this.bgPage,scaleY:1.08,y:gameConsts.halfHeight+22,ease:"Cubic.easeOut",duration:.5})}setSecondPage(){playSound("flip2"),this.title.setText(" ");var e=PhaserScene.add.text(gameConsts.halfWidth-252,gameConsts.halfHeight-290,getLangText("encyclopedia_rune_element"),{fontFamily:"germania",fontSize:24,color:"#200000",align:"left"}).setDepth(this.baseDepth),t=PhaserScene.add.text(gameConsts.halfWidth-252,gameConsts.halfHeight-12,getLangText("encyclopedia_rune_action"),{fontFamily:"germania",fontSize:24,color:"#200000",align:"left"}).setDepth(this.baseDepth),a=(this.currentPageItems.push(e),this.currentPageItems.push(t),this.closeButton.tweenToPos(this.closeButton.getXPos(),gameConsts.halfHeight-275,.5,"Cubic.easeOut"),PhaserScene.tweens.add({targets:this.bgPage,scaleY:1.08,y:gameConsts.halfHeight+22,ease:"Cubic.easeOut",duration:.5}),["rune_matter_large.png","rune_strike_large.png","rune_enhance_large.png","rune_energy_large.png","blank.png","rune_protect_large.png","rune_reinforce_large.png","rune_time_large.png","rune_void_large.png","rune_unload_large.png"]),s=[getLangText("pre_fight_0d"),getLangText("pre_fight_0c"),getLangText("encyc_enhance"),getLangText("encyc_energy"),"",getLangText("encyc_shield"),getLangText("encyc_body"),getLangText("encyc_time"),getLangText("encyc_void"),getLangText("encyc_ultimate")],i=[getLangText("matter_short"),getLangText("strike_short"),getLangText("enhance_short"),getLangText("energy_short"),"",getLangText("shield_short"),getLangText("body_short"),getLangText("time_short"),getLangText("void_short"),getLangText("ultimate_short")],e=gameConsts.halfHeight-226,t=gameConsts.halfHeight+55,n=[e,t,t+56,56+e,t,t+112,t+168,112+e,168+e,t+224],l="fr"===language?22:24;for(let e=0;e<a.length&&!(e>Math.min(gameVars.maxLevel+1,6));e++){var r=PhaserScene.add.image(gameConsts.halfWidth-219,n[e],"tutorial",a[e]).setAlpha(0).setDepth(this.baseDepth).setScale(.6),o=PhaserScene.add.text(gameConsts.halfWidth-180,n[e],s[e],{fontFamily:"germania",fontSize:l,color:"#200000",align:"left"}).setDepth(this.baseDepth).setOrigin(0,.5),h=PhaserScene.add.text(gameConsts.halfWidth-63,n[e],"| "+i[e],{fontFamily:"germania",fontSize:l,color:"#200000",align:"left"}).setDepth(this.baseDepth).setOrigin(0,.5);this.currentPageItems.push(r),this.currentPageItems.push(o),this.currentPageItems.push(h)}PhaserScene.tweens.add({targets:this.currentPageItems,alpha:1,ease:"Cubic.easeOut",duration:.5})}createDescLong(e,t){if("unload"===e&&"time"===t)return"time_unload_desc_long_full";let a="";return 8<gameVars.latestLevel&&"matter"===t&&("strike"!==e&&"protect"!==e||(a="_plus")),t+"_"+e+(a=9<gameVars.latestLevel&&"mind"===t&&"enhance"===e?"_plus":a)+"_desc_long"}removeNewlinesIfLong(e){let a=e;if("zh_cn"===language||"zh_tw"===language||"jp"===language){a=e.replace("\n","");let t=0;for(let e=0;e<Math.min(33,a.length);e++)" "==a[e]&&t++;var s=Math.floor(29+.5*t);a.length>s&&(a=a.substring(0,s)+"\n"+a.substring(s))}else{a=e.replace("\n"," ");let t=55;if("fr"==language&&(t=59),a.length>t)for(let e=t;0<e;e--)if(" "==a[e]){a=a.substring(0,e)+"\n"+a.substring(e+1);break}}return a}setThirdPage(){playSound("flip2"),this.title.setText(" ");var e=PhaserScene.add.text(gameConsts.halfWidth-252,gameConsts.halfHeight-303,getLangText("encyclopedia_rune_combos"),{fontFamily:"germania",fontSize:24,color:"#200000",align:"left"}).setDepth(this.baseDepth),t=(this.currentPageItems.push(e),PhaserScene.tweens.add({targets:e,y:"-=20",ease:"Cubic.easeOut",duration:.5}),this.closeButton.tweenToPos(this.closeButton.getXPos(),gameConsts.halfHeight-298,.5,"Cubic.easeOut"),PhaserScene.tweens.add({targets:this.bgPage,scaleY:1.18,y:gameConsts.halfHeight+31,ease:"Cubic.easeOut",duration:.5}),["enhance","energy","","protect","reinforce","time","void","unload"]),a=["strike","matter"],s=Math.max(Math.min(6,gameVars.latestLevel+1),Math.min(gameVars.maxLevel,6));for(let e=0;e<Math.min(t.length,s);e++)a.push(t[e]);var i=[["strike","matter"],["strike","energy"],["strike","time"],["strike","void"],["enhance","matter"],["enhance","energy"],["enhance","time"],["enhance","void"],["protect","matter"],["protect","energy"],["protect","time"],["protect","void"],["reinforce","matter"],["reinforce","energy"],["reinforce","time"],["reinforce","void"],["unload","matter"],["unload","energy"],["unload","time"],["unload","void"]],n=gameConsts.halfHeight-278;for(let t=0;t<i.length;t++){var l=i[t][0];let e=i[t][1];var r=-1!==a.indexOf(l),o=-1!==a.indexOf(e),h=PhaserScene.add.image(gameConsts.halfWidth-244,n+33.4*t,"tutorial","rune_"+(r?l:"question")+"_large.png").setAlpha(0).setDepth(this.baseDepth).setScale(.38,.36),h=(this.currentPageItems.push(h),"rune_"+(o?e:"question")+"_large.png"),h=PhaserScene.add.image(gameConsts.halfWidth-199,n+33.4*t,"tutorial",h).setAlpha(0).setDepth(this.baseDepth).setScale(.38,.36);this.currentPageItems.push(h),r&&o&&("energy"===e&&(e="mind"),(h=PhaserScene.add.text(gameConsts.halfWidth-168,n+33.4*t,this.removeNewlinesIfLong(getLangText(this.createDescLong(l,e))),{fontFamily:"robotomedium",fontSize:16,color:"#200000",align:"left",lineSpacing:-3}).setAlpha(0).setDepth(this.baseDepth).setScale(.95,1)).setOrigin(0,.5),this.currentPageItems.push(h))}PhaserScene.tweens.add({targets:this.currentPageItems,alpha:1,ease:"Cubic.easeOut",duration:.5})}hideEncyclopedia(){if(!this.canClose)return!1;this.canClose=!1,globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),messageBus.publish("unpauseGame"),hideGlobalClickBlocker(),this.darkenBG.setAlpha(0),this.hidingAnim1=PhaserScene.tweens.add({targets:this.listOfThingsToHide,alpha:0,ease:"Cubic.easeOut",duration:400}),this.clearCurrentPage();for(let e=0;e<this.listOfButtonsToDisable.length;e++)this.listOfButtonsToDisable[e].setState(DISABLE);return!0}showButton(){this.button.setPos(this.startX,this.startY)}hideButton(){this.button.setPos(this.startX,-100)}}class Options{constructor(e,t,a){this.startX=t,this.startY=a,this.canBeClicked=!0,this.baseDepth=101e3,this.langTextToUpdate=[],this.listOfThingsToHide=[],this.listOfThingsToHideSemiAlpha=[],this.listOfButtonsToDisable=[],this.button=new Button({normal:{atlas:"buttons",ref:"options_btn_normal.png",alpha:1,x:t,y:a},hover:{atlas:"buttons",ref:"options_btn_hover.png",alpha:1},press:{atlas:"buttons",ref:"options_btn_press.png",alpha:1},disable:{atlas:"buttons",ref:"options_btn_press.png",alpha:0},onHover:()=>{playSound("click",1.1).detune=220,canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{this.showOptions()}}),this.button.setDepth(this.baseDepth),this.button.setScrollFactor(0,0),messageBus.subscribe("cancelScreen",this.cancelScreen.bind(this))}cancelScreen(){if(this.popupElements&&0<this.popupElements.length&&!this.popupElements[0].isDestroyed)for(var e in this.popupElements)this.popupElements[e].destroy();else this.hideOptions()}addLangTextUpdateable(e,t){this.langTextToUpdate.push([e,t])}showOptions(){if(!this.canBeClicked||this.opened||this.canClose)console.log("fail open because",this.canBeClicked,this.opened,this.canClose);else{if(sdkGameplayStop(),this.opened=!0,addPopup(this.hideOptions.bind(this)),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton(),playSound("flip2"),this.hidingAnim1&&this.hidingAnim1.stop(),this.hidingAnim2&&this.hidingAnim2.stop(),this.darkenBG||(this.darkenBG=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight,"blackPixel").setDepth(this.baseDepth),this.darkenBG.setScale(500,500).setAlpha(.4),this.listOfThingsToHide.push(this.darkenBG)),this.bgPage||(this.bgPage=PhaserScene.add.image(gameConsts.halfWidth,gameConsts.halfHeight-2,"ui","paper.png").setDepth(this.baseDepth).setScale(1,.9),this.listOfThingsToHide.push(this.bgPage)),this.settingsTitle||(this.settingsTitle=PhaserScene.add.text(gameConsts.halfWidth-230,isMobile?gameConsts.halfWidth-115:gameConsts.halfWidth-132,getLangText("settings"),{fontFamily:"germania",fontSize:28,color:"#200000",align:"left"}).setOrigin(0,1).setDepth(this.baseDepth)),this.listOfThingsToHideSemiAlpha.push(this.settingsTitle),this.addLangTextUpdateable(this.settingsTitle,"settings"),this.menuBtn?this.menuBtn.setText(getLangText("menu")):(this.menuBtn=new Button({normal:{ref:"menu_btn_normal.png",atlas:"buttons",x:gameConsts.halfWidth-135,y:gameConsts.halfHeight+220,alpha:1},hover:{ref:"menu_btn_hover.png",atlas:"buttons",alpha:1},press:{ref:"menu_btn_normal.png",atlas:"buttons",alpha:1},disable:{ref:"menu_btn_normal.png",atlas:"buttons",alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{globalObjects.currentEnemy&&!globalObjects.currentEnemy.isDestroyed&&-99!==globalObjects.currentEnemy.level?this.popupElements=showYesNoPopup(getLangText("exit"),getLangText("back"),getLangText("main_menu"),getLangText("exit_long"),()=>{this.hideOptions(),getBackgroundBlackout().alpha=0,globalObjects.player.revive(),gotoMainMenu(),globalObjects.textPopupManager.hideInfoText(),globalObjects.bannerTextManager.closeBanner(),globalObjects.floatingDeath&&(globalObjects.floatingDeath.visible=!1,globalObjects.floatingDeath2.visible=!1),globalObjects.postFightScreen.clearPostFightScreen()},!0):(this.hideOptions(),getBackgroundBlackout().alpha=0,globalObjects.player.revive(),gotoMainMenu(),globalObjects.textPopupManager.hideInfoText(),globalObjects.bannerTextManager.closeBanner(),globalObjects.floatingDeath&&(globalObjects.floatingDeath.visible=!1,globalObjects.floatingDeath2.visible=!1),globalObjects.postFightScreen.clearPostFightScreen())}}),this.menuBtn.addText(getLangText("menu"),{fontFamily:"germania",fontSize:28,color:"#000000",align:"center"}),this.addLangTextUpdateable(this.menuBtn,"menu"),this.menuBtn.setDepth(this.baseDepth+1),this.menuBtn.setScale(.8,.8),this.listOfButtonsToDisable.push(this.menuBtn)),this.resumeBtn?this.resumeBtn.setText(getLangText("resume")):(this.resumeBtn=new Button({normal:{ref:"menu_btn2_normal.png",atlas:"buttons",x:gameConsts.halfWidth+135,y:gameConsts.halfHeight+220,alpha:1},hover:{ref:"menu_btn2_hover.png",atlas:"buttons",alpha:1},press:{ref:"menu_btn2_normal.png",atlas:"buttons",alpha:1},disable:{ref:"menu_btn2_normal.png",atlas:"buttons",alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{this.hideOptions()}}),this.resumeBtn.addText(getLangText("resume"),{fontFamily:"germania",fontSize:28,color:"#000000",align:"center"}),this.addLangTextUpdateable(this.resumeBtn,"resume"),this.resumeBtn.setDepth(this.baseDepth+1),this.resumeBtn.setScale(.8,.8),this.listOfButtonsToDisable.push(this.resumeBtn)),!this.sliderBGM){this.draggerBGM,this.draggerSFX;let a=gameConsts.halfWidth+15;this.BGMIcon=PhaserScene.add.image(gameConsts.halfWidth-200,gameConsts.halfHeight-179,"ui","music.png").setDepth(this.baseDepth),this.SFXIcon=PhaserScene.add.image(gameConsts.halfWidth-200,gameConsts.halfHeight-113,"ui","sound_full.png").setDepth(this.baseDepth),this.sliderBGM=new Button({isDraggable:!0,normal:{atlas:"ui",ref:"slider.png",alpha:0,x:a,y:this.BGMIcon.y},onDrag:(e,t)=>{this.updateBGMSlider(a,e)},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseDown:(e,t)=>{this.updateBGMSlider(a,e)},onDrop:(e,t)=>{this.sliderBGM.setPos(a,this.BGMIcon.y),this.updateBGMSlider(a,e),playFakeBGMusic("button"),this.draggerBGM.setFrame("slider_indicator.png")}}),this.sliderBGM.setDepth(this.baseDepth),this.listOfButtonsToDisable.push(this.sliderBGM),this.sliderSFX=new Button({isDraggable:!0,normal:{atlas:"ui",ref:"slider.png",alpha:0,x:a,y:this.SFXIcon.y},onDrag:(e,t)=>{this.updateSFXSlider(a,e)},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseDown:(e,t)=>{this.updateSFXSlider(a,e)},onDrop:e=>{this.sliderSFX.setPos(a,this.SFXIcon.y),this.updateSFXSlider(a,e),playSound("button"),this.draggerSFX.setFrame("slider_indicator.png")}}),this.sliderSFX.setDepth(this.baseDepth),this.listOfButtonsToDisable.push(this.sliderSFX),this.BGMVisual=PhaserScene.add.image(a,this.BGMIcon.y,"ui","slider.png").setDepth(this.baseDepth),this.SFXVisual=PhaserScene.add.image(a,this.SFXIcon.y,"ui","slider.png").setDepth(this.baseDepth);var e=30*(10*globalMusicVol-9),t=30*(10*globalVolume-9);this.draggerBGM=PhaserScene.add.image(a+120+e,this.BGMIcon.y,"ui","slider_indicator.png").setDepth(this.baseDepth),this.draggerSFX=PhaserScene.add.image(a+120+t,this.SFXIcon.y,"ui","slider_indicator.png").setDepth(this.baseDepth),this.listOfThingsToHideSemiAlpha.push(this.BGMIcon),this.listOfThingsToHideSemiAlpha.push(this.SFXIcon),this.listOfThingsToHideSemiAlpha.push(this.BGMVisual),this.listOfThingsToHideSemiAlpha.push(this.SFXVisual),this.listOfThingsToHide.push(this.draggerBGM),this.listOfThingsToHide.push(this.draggerSFX)}this.createInfoBoxPosText(),this.createSkipIntroToggle(),this.createFullScreenToggle(),createGlobalClickBlocker(),this.closeButton||(this.closeButton=new Button({normal:{atlas:"buttons",ref:"closebtn.png",alpha:.95,x:gameConsts.halfWidth+240,y:gameConsts.halfHeight-241},hover:{alpha:1,atlas:"buttons",ref:"closebtn_hover.png"},press:{atlas:"buttons",ref:"closebtn_press.png",alpha:1},disable:{atlas:"buttons",ref:"closebtn.png",alpha:0},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:()=>{this.hideOptions()}}),this.closeButton.setDepth(this.baseDepth+10),this.listOfButtonsToDisable.push(this.closeButton));for(let e=0;e<this.listOfButtonsToDisable.length;e++)this.listOfButtonsToDisable[e].setState(NORMAL),buttonManager.bringButtonToTop(this.listOfButtonsToDisable[e]);this.createLanguageSelect(),this.createCodeItem(),"left"==gameOptions.infoBoxAlign?this.infoLeftButton.setState(DISABLE):"center"==gameOptions.infoBoxAlign?this.infoCenterButton.setState(DISABLE):"none"==gameOptions.infoBoxAlign&&this.infoNoneButton.setState(DISABLE);for(let e=0;e<this.listOfThingsToHide.length;e++)this.listOfThingsToHide[e].alpha=1;for(let e=0;e<this.listOfThingsToHideSemiAlpha.length;e++)this.listOfThingsToHideSemiAlpha[e].alpha=.82;this.darkenBG.setAlpha(.4),this.bgPage.setAlpha(.2),PhaserScene.tweens.add({targets:this.bgPage,alpha:1,ease:"Cubic.easeOut",duration:.25,onComplete:()=>{this.canClose=!0}}),messageBus.publish("pauseGame",.002)}}createInfoBoxPosText(){var e;this.infoBoxPosText?(this.infoBoxPosText.setText(getLangText("spell_info_position")),this.infoBoxPosTextLeft.setText(getLangText("left")),this.infoBoxPosTextCenter.setText(getLangText("center")),this.infoBoxPosTextNone.setText(getLangText("hidden"))):(e=gameConsts.halfHeight-10,this.infoBoxPosText=PhaserScene.add.text(gameConsts.halfWidth-230,e-23,getLangText("spell_info_position"),{fontFamily:"germania",fontSize:28,color:"#200000",align:"left"}).setOrigin(0,1).setDepth(this.baseDepth),this.listOfThingsToHideSemiAlpha.push(this.infoBoxPosText),this.infoBoxPosTextLeft=PhaserScene.add.text(gameConsts.halfWidth-193,e,getLangText("left"),{fontFamily:"germania",fontSize:20,color:"#200000",align:"left"}).setOrigin(0,.5).setDepth(this.baseDepth),this.listOfThingsToHideSemiAlpha.push(this.infoBoxPosTextLeft),this.infoBoxPosTextCenter=PhaserScene.add.text(gameConsts.halfWidth-18,e,getLangText("center"),{fontFamily:"germania",fontSize:20,color:"#200000",align:"left"}).setOrigin(0,.5).setDepth(this.baseDepth),this.listOfThingsToHideSemiAlpha.push(this.infoBoxPosTextCenter),this.infoBoxPosTextNone=PhaserScene.add.text(gameConsts.halfWidth+157,e,getLangText("hidden"),{fontFamily:"germania",fontSize:20,color:"#200000",align:"left"}).setOrigin(0,.5).setDepth(this.baseDepth),this.listOfThingsToHideSemiAlpha.push(this.infoBoxPosTextNone),this.addLangTextUpdateable(this.infoBoxPosText,"spell_info_position"),this.addLangTextUpdateable(this.infoBoxPosTextLeft,"left"),this.addLangTextUpdateable(this.infoBoxPosTextCenter,"center"),this.addLangTextUpdateable(this.infoBoxPosTextNone,"hidden"),this.infoLeftButton=new Button({normal:{atlas:"buttons",ref:"select_btn_normal.png",alpha:1,x:gameConsts.halfWidth-178,y:e},hover:{atlas:"buttons",ref:"select_btn_hover.png",alpha:1},press:{atlas:"buttons",ref:"select_btn_press.png",alpha:1},disable:{atlas:"buttons",ref:"select_btn_disable.png",alpha:1},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:(e,t)=>{this.infoLeftButton.setState(DISABLE),this.infoCenterButton.setState(NORMAL),this.infoNoneButton.setState(NORMAL),gameOptions.infoBoxAlign="left",sdkSetItem("info_align",gameOptions.infoBoxAlign),messageBus.publish("refreshHoverDisplay"),canvas&&(canvas.style.cursor="default")}}),this.infoLeftButton.setDepth(this.baseDepth+10),this.listOfButtonsToDisable.push(this.infoLeftButton),this.infoCenterButton=new Button({normal:{atlas:"buttons",ref:"select_btn_normal.png",alpha:1,x:gameConsts.halfWidth-5,y:e},hover:{atlas:"buttons",ref:"select_btn_hover.png",alpha:1},press:{atlas:"buttons",ref:"select_btn_press.png",alpha:1},disable:{atlas:"buttons",ref:"select_btn_disable.png",alpha:1},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:(e,t)=>{this.infoLeftButton.setState(NORMAL),this.infoCenterButton.setState(DISABLE),this.infoNoneButton.setState(NORMAL),gameOptions.infoBoxAlign="center",sdkSetItem("info_align",gameOptions.infoBoxAlign),messageBus.publish("refreshHoverDisplay"),canvas&&(canvas.style.cursor="default")}}),this.infoCenterButton.setDepth(this.baseDepth+10),this.listOfButtonsToDisable.push(this.infoCenterButton),this.infoNoneButton=new Button({normal:{atlas:"buttons",ref:"select_btn_normal.png",alpha:1,x:gameConsts.halfWidth+168,y:e},hover:{atlas:"buttons",ref:"select_btn_hover.png",alpha:1},press:{atlas:"buttons",ref:"select_btn_press.png",alpha:1},disable:{atlas:"buttons",ref:"select_btn_disable.png",alpha:1},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:(e,t)=>{this.infoLeftButton.setState(NORMAL),this.infoCenterButton.setState(NORMAL),this.infoNoneButton.setState(DISABLE),gameOptions.infoBoxAlign="none",sdkSetItem("info_align",gameOptions.infoBoxAlign),messageBus.publish("refreshHoverDisplay"),canvas&&(canvas.style.cursor="default")}}),this.infoNoneButton.setDepth(this.baseDepth+10),this.listOfButtonsToDisable.push(this.infoNoneButton))}createLanguageSelect(){var e,t=["English","","","Franais"];let n=["en_us","zh_cn","zh_tw","fr"];if(this.langSelectText)this.langSelectText.setText(getLangText("language_text"));else{var a=gameConsts.halfHeight+80;this.langSelectText=PhaserScene.add.text(gameConsts.halfWidth-230,a-43,getLangText("language_text"),{fontFamily:"germania",fontSize:28,color:"#200000",align:"left"}).setOrigin(0,.5).setDepth(this.baseDepth).setAlpha(.82),this.addLangTextUpdateable(this.langSelectText,"language_text"),this.langWarningText=PhaserScene.add.text(gameConsts.halfWidth+215,a-31,getLangText("translate_warn"),{fontFamily:"germania",fontSize:16,color:"#604A4A",align:"right"}).setOrigin(1,.6).setDepth(this.baseDepth).setAlpha(.82),this.addLangTextUpdateable(this.langWarningText,"translate_warn"),this.listOfThingsToHideSemiAlpha.push(this.langSelectText),this.listOfThingsToHideSemiAlpha.push(this.langWarningText),this.listOfLanguageText=[],this.listOfLangButtons=[];for(let i in t){var l=t[i],r=gameConsts.halfWidth-193,o=(gameConsts.halfWidth+157-r)/(t.length-1),h=PhaserScene.add.text(r+o*i-4,a,l,{fontFamily:"germania",fontSize:20,color:"#200000",align:"left"}).setOrigin(0,.5).setDepth(this.baseDepth);this.listOfThingsToHideSemiAlpha.push(h);let s=new Button({normal:{atlas:"buttons",ref:"select_btn_normal.png",alpha:1,x:r+o*i+15,y:a},hover:{atlas:"buttons",ref:"select_btn_hover.png",alpha:1},press:{atlas:"buttons",ref:"select_btn_press.png",alpha:1},disable:{atlas:"buttons",ref:"select_btn_disable.png",alpha:1},onHover:()=>{canvas&&(canvas.style.cursor="pointer")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default")},onMouseUp:(e,t)=>{for(var a in this.listOfLangButtons)this.listOfLangButtons[a].setState(NORMAL);s.setState(DISABLE),messageBus.publish("refreshHoverDisplay"),canvas&&(canvas.style.cursor="default"),setLanguage(n[i]),updateMenuLanguage(),this.updateOptionsLanguage()}});l==n[i]&&s.setState(DISABLE),s.language=n[i],s.setDepth(this.baseDepth+10),this.listOfButtonsToDisable.push(s),this.listOfLangButtons.push(s)}}for(e in this.listOfLangButtons)language==this.listOfLangButtons[e].language&&this.listOfLangButtons[e].setState(DISABLE)}createCodeItem(){if(!this.codeAnnounce)return}createSkipIntroToggle(){var e;this.introText||(e=gameConsts.halfHeight+150,this.introText=PhaserScene.add.text(gameConsts.halfWidth-193,e,getLangText("skip_intro"),{fontFamily:"germania",fontSize:20,color:"#200000",align:"left"}).setOrigin(0,.5).setDepth(this.baseDepth).setAlpha(.82),this.addLangTextUpdateable(this.introText,"skip_intro"),this.listOfThingsToHideSemiAlpha.push(this.introText),this.introToggleVisual=PhaserScene.add.sprite(gameConsts.halfWidth-153,e,"buttons",gameOptions.skipIntro?"check_box_on.png":"check_box_normal.png"),this.introToggleVisual.setDepth(this.baseDepth+1),this.listOfThingsToHide.push(this.introToggleVisual),this.introButton=new Button({normal:{atlas:"buttons",ref:"check_box_normal.png",alpha:0,x:this.introToggleVisual.x,y:e},onHover:()=>{canvas&&(canvas.style.cursor="pointer"),gameOptions.skipIntro?this.introToggleVisual.setFrame("check_box_hover2.png"):this.introToggleVisual.setFrame("check_box_hover.png")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default"),this.introToggleVisual.setFrame(gameOptions.skipIntro?"check_box_on.png":"check_box_normal.png")},onMouseUp:(e,t)=>{gameOptions.skipIntro=!gameOptions.skipIntro,this.introToggleVisual.setFrame(gameOptions.skipIntro?"check_box_on.png":"check_box_normal.png"),sdkSetItem("skip_intro",gameOptions.skipIntro.toString())}}),this.introButton.setDepth(this.baseDepth+10),this.listOfButtonsToDisable.push(this.introButton))}createFullScreenToggle(){var e;this.fullscreenText||(e=gameConsts.halfHeight+150,this.fullscreenText=PhaserScene.add.text(gameConsts.halfWidth+83,e,getLangText("fullscreen"),{fontFamily:"germania",fontSize:20,color:"#200000",align:"left"}).setOrigin(0,.5).setDepth(this.baseDepth).setAlpha(.82),this.addLangTextUpdateable(this.fullscreenText,"fullscreen"),this.listOfThingsToHideSemiAlpha.push(this.fullscreenText),this.fullscreenToggleVisual=PhaserScene.add.sprite(this.fullscreenText.x+40,e,"buttons",gameOptions.fullscreen?"check_box_on.png":"check_box_normal.png"),this.fullscreenToggleVisual.setDepth(this.baseDepth+1),this.listOfThingsToHide.push(this.fullscreenToggleVisual),this.fullscreenButton=new Button({normal:{atlas:"buttons",ref:"check_box_normal.png",alpha:0,x:this.fullscreenToggleVisual.x,y:e},onHover:()=>{canvas&&(canvas.style.cursor="pointer"),gameOptions.fullscreen?this.fullscreenToggleVisual.setFrame("check_box_hover2.png"):this.fullscreenToggleVisual.setFrame("check_box_hover.png")},onHoverOut:()=>{canvas&&(canvas.style.cursor="default"),this.fullscreenToggleVisual.setFrame(gameOptions.fullscreen?"check_box_on.png":"check_box_normal.png")},onMouseUp:(e,t)=>{gameOptions.fullscreen=!gameOptions.fullscreen,gameOptions.fullscreen?openFullscreen():document.exitFullscreen(),this.fullscreenToggleVisual.setFrame(gameOptions.fullscreen?"check_box_on.png":"check_box_normal.png"),localStorage.setItem("fullscreen",gameOptions.fullscreen.toString())}}),this.fullscreenButton.setDepth(this.baseDepth+10),this.listOfButtonsToDisable.push(this.fullscreenButton))}updateRunes(e,t,a,s){e.setFrame(this.listOfRunes[(this.listOfIconPos[s]+1)%9]),t.setFrame(this.listOfRunes[this.listOfIconPos[s]]),a.setFrame(this.listOfRunes[(this.listOfIconPos[s]+8)%9]),e.setOrigin(.5,.16),t.setOrigin(.5,.16),a.setOrigin(.5,.16)}scrollDown(e){let t=this.listOfIcons[e][0],a=this.listOfIcons[e][1],s=this.listOfIcons[e][2];this.updateRunes(t,a,s,e),this.listOfIconPos[e]=(this.listOfIconPos[e]+1)%9,t.currAnim1&&(t.currAnim1.stop(),t.currAnim2.stop(),a.currAnim1.stop(),a.currAnim2.stop(),s.currAnim1.stop(),s.currAnim2.stop()),t.y=this.icon1PosY,a.y=this.icon2PosY,s.y=this.icon3PosY,t.setScale(.92,.41),a.setScale(.92),s.setScale(.92,.41),t.currAnim1=PhaserScene.tweens.add({targets:t,y:this.icon2PosY,duration:.15}),t.currAnim2=PhaserScene.tweens.add({targets:t,scaleY:.92,ease:"Cubic.easeOut",duration:.15}),a.currAnim1=PhaserScene.tweens.add({targets:a,y:this.icon3PosY,ease:"Quad.easeOut",duration:.15}),a.currAnim2=PhaserScene.tweens.add({targets:a,scaleY:.41,alpha:.82,ease:"Quad.easeIn",duration:.15}),s.currAnim1=PhaserScene.tweens.add({targets:s,y:this.icon3PosY+4,duration:.1,ease:"Quad.easeOut",onComplete:()=>{s.y=this.icon1PosY-4,s.setFrame(this.listOfRunes[(this.listOfIconPos[e]+1)%9]),s.setOrigin(.5,.16),s.currAnim1=PhaserScene.tweens.add({targets:s,y:this.icon1PosY,duration:.1,onComplete:()=>{t.scaleY=.41,t.y=this.icon1PosY,a.scaleY=.92,a.y=this.icon2PosY,a.alpha=1,s.scaleY=.41,s.y=this.icon3PosY,this.updateRunes(t,a,s,e)}}),s.currAnim2=PhaserScene.tweens.add({targets:s,scaleY:.41,duration:.1})}}),s.currAnim2=PhaserScene.tweens.add({targets:s,ease:"Quad.easeOut",scaleY:0,duration:.1})}scrollUp(e){let t=this.listOfIcons[e][0],a=this.listOfIcons[e][1],s=this.listOfIcons[e][2];this.updateRunes(t,a,s,e),this.listOfIconPos[e]=(this.listOfIconPos[e]+8)%9,t.currAnim1&&(t.currAnim1.stop(),t.currAnim2.stop(),a.currAnim1.stop(),a.currAnim2.stop(),s.currAnim1.stop(),s.currAnim2.stop()),t.y=this.icon1PosY,a.y=this.icon2PosY,s.y=this.icon3PosY,t.setScale(.92,.41),a.setScale(.92),s.setScale(.92,.41),s.currAnim1=PhaserScene.tweens.add({targets:s,y:this.icon2PosY,duration:.2}),s.currAnim2=PhaserScene.tweens.add({targets:s,scaleY:.92,ease:"Cubic.easeOut",duration:.2}),a.currAnim1=PhaserScene.tweens.add({targets:a,y:this.icon1PosY,ease:"Quad.easeOut",duration:.2}),a.currAnim2=PhaserScene.tweens.add({targets:a,scaleY:.41,alpha:.82,ease:"Quad.easeIn",duration:.2}),t.currAnim1=PhaserScene.tweens.add({targets:t,y:this.icon1PosY-4,duration:.1,ease:"Quad.easeOut",onComplete:()=>{t.y=this.icon3PosY+4,t.setFrame(this.listOfRunes[(this.listOfIconPos[e]+8)%9]),t.setOrigin(.5,.16),t.currAnim1=PhaserScene.tweens.add({targets:t,y:this.icon3PosY,duration:.1,onComplete:()=>{t.scaleY=.41,t.y=this.icon1PosY,a.scaleY=.92,a.y=this.icon2PosY,a.alpha=1,s.scaleY=.41,s.y=this.icon3PosY,this.updateRunes(t,a,s,e)}}),t.currAnim2=PhaserScene.tweens.add({targets:t,scaleY:.41,duration:.1})}}),t.currAnim2=PhaserScene.tweens.add({targets:t,ease:"Quad.easeOut",scaleY:0,duration:.1})}activateCode(){if(this.listOfIconPos&&!(this.listOfIconPos.length<5)){let e=1e3*this.listOfIconPos[1]+100*this.listOfIconPos[2]+10*this.listOfIconPos[3]+this.listOfIconPos[4];switch(e=String.fromCharCode(this.listOfIconPos[0]+65)+e.toString(),console.log(e),console.log(sha256(e)),this.codeAnnounce.visible=!0,this.codeAnnounce.alpha=1,this.codeAnnounce.setColor("#00FF33"),this.codeAnnounce.setScale(1),this.codeAnnounce.currAnim&&this.codeAnnounce.currAnim.stop(),sha256(e)){case"aa508c2187fca56f397ff75adc52b94e02f38122cdd48bd42105106e5e0f8e14":this.codeAnnounce.setText("CODES CAN UNLOCK\nDIFFERENT PARTS OF THE GAME."),this.codeAnnounce.setScale(.75);break;case"1865223aedef36687e7506a828eb83b78f139d3a927946593cca1636933be360":this.codeAnnounce.setText("Level: Goblin"),clearMenuButtons(),globalObjects.postFightScreen.clearPostFightScreen(),beginPreLevel(2),this.hideOptions(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton();break;case"959c1c84d4572ce1b60ed01e0ffef02db605a973792b7c632b0bdc402654a456":this.codeAnnounce.setText("Level: Tree"),clearMenuButtons(),globalObjects.postFightScreen.clearPostFightScreen(),beginPreLevel(3),this.hideOptions(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton();break;case"4fb04b4ad0f01d65f9848680910fbb8587136f3845c0edca243f827005d86eb8":this.codeAnnounce.setText("Level: Magician"),clearMenuButtons(),globalObjects.postFightScreen.clearPostFightScreen(),beginPreLevel(4),this.hideOptions(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton();break;case"eb0c0da2a8245bf41ab37672ee7b3497e5ec47b4b69d0d58741a280aa250763c":this.codeAnnounce.setText("Level: Knight"),clearMenuButtons(),globalObjects.postFightScreen.clearPostFightScreen(),beginPreLevel(5),this.hideOptions(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton();break;case"5c864ebe1619f609becf7c741d074a54e66f3d77b0d4274ad290a5b68a4b8468":this.codeAnnounce.setText("Level: Wall"),clearMenuButtons(),globalObjects.postFightScreen.clearPostFightScreen(),beginPreLevel(6),this.hideOptions(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton();break;case"65daf73e9bc15ea710fdb3873b397d2b6eb180fecaf9bf43507a63f22a857b5b":this.codeAnnounce.setText("Level: Super Doll"),clearMenuButtons(),globalObjects.postFightScreen.clearPostFightScreen(),beginPreLevel(7),this.hideOptions(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton();break;case"445714fa45b496cd630e03e196c77fcb1710e285cb5180f22c9cf9210cff4603":this.codeAnnounce.setText("Level: Assassin"),clearMenuButtons(),globalObjects.postFightScreen.clearPostFightScreen(),beginPreLevel(8),this.hideOptions(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton();break;case"26d38d317704c4982064ac2867e0556d6935cb53a81889ce85ea60be7f1771c5":this.codeAnnounce.setText("Level: Robot"),clearMenuButtons(),globalObjects.postFightScreen.clearPostFightScreen(),beginPreLevel(9),this.hideOptions(),globalObjects.encyclopedia.hideButton(),globalObjects.options.hideButton();break;case"74291ba36b6bdc4c9cf428eda60dcaac0b867971312a61240c1d834b06b34fd7":this.codeAnnounce.setText("Level: Death The Reaper"),clearMenuButtons(),globalObjects.postFightScreen.clearPostFightScreen(),beginPreLevel(10),this.hideOptions();break;case"dd0e5c288c1062d8abb0b28f1dfd35129c576a28ee7ba1603c43e696cbe6a8cb":this.codeAnnounce.setText("Level: Death The Destroyer"),clearMenuButtons(),globalObjects.postFightScreen.clearPostFightScreen(),beginPreLevel(11),this.hideOptions();break;case"85ea9896b888eae23cb13e39826cde6c2511183518f2c31d218be4cc7fd51446":this.codeAnnounce.setText("Level: Death The Destroyer++"),clearMenuButtons(),globalObjects.postFightScreen.clearPostFightScreen(),beginPreLevel(12),this.hideOptions();break;case"f8fefa9c66edaa0100adb94e85641e9ec3e612a76573e2a18d5dcdbfb4426482":this.codeAnnounce.setText("Level: Death The Guide"),clearMenuButtons(),globalObjects.postFightScreen.clearPostFightScreen(),beginPreLevel(13),this.hideOptions();break;case"b71eb988a0e29ad88f899faa4123a6eaa2d7978b230989fca0dd112f08efec2e":this.codeAnnounce.setText("Skipping entire game!!!"),this.codeAnnounce.setScale(.9),setTimeout(()=>{this.codeAnnounce.setText("(joking)"),playSound("derp",.4)},2500);break;case"4ce5c0152be75f840fc291699586c69dc49aacd4b66d44ed82bac3ab81fba232":toggleCheat("inam"),cheats.infiniteAmmo?(this.codeAnnounce.setText("CHEAT: INFINITE AMMO ENABLED"),playSound("mind_ultimate_2",.75)):(this.codeAnnounce.setText("INFINITE AMMO DISABLED"),this.codeAnnounce.setColor("#888888"),this.codeAnnounce.setScale(.9));break;case"07a3f553bd83604c46badf5d59495e72a539c570fbc58ab16d5c0fb6a5a1535a":toggleCheat("flal"),cheats.fullArsenal?(this.codeAnnounce.setText("CHEAT: FULL ARSENAL ENABLED"),playSound("matter_body",.6)):(this.codeAnnounce.setText("FULL ARSENAL DISABLED"),this.codeAnnounce.setColor("#888888"),this.codeAnnounce.setScale(.9));break;case"7468eb2fafacc40a127adab1f3e84914ddb48c8daa63f4992ef42d5390aa8e2b":toggleCheat("ultr"),cheats.extraUlt?(this.codeAnnounce.setText("CHEAT: EXTRA ULT RUNE ENABLED"),playSound("matter_body",.6)):(this.codeAnnounce.setText("EXTRA ULT RUNE DISABLED"),this.codeAnnounce.setColor("#888888"),this.codeAnnounce.setScale(.9));break;case"16a36e86f6fed5d465ff332511a0ce1a863b55d364b25a7cdaa25db19abf9648":toggleCheat("hpdx"),cheats.bonusHealth?(this.codeAnnounce.setText("CHEAT: +20 HEALTH ENABLED"),playSound("magic",.6)):(this.codeAnnounce.setText("+20 HEALTH DISABLED"),this.codeAnnounce.setColor("#888888"),this.codeAnnounce.setScale(.9));break;case"96c89195a5a61917821ba4bef1e432bebcc13db08e6c36b6210f5bc6a0268fab":this.codeAnnounce.setText("HEAL SELF"),playSound("magic",.6),gameVars.hasCheated=!0,updateCheatsDisplay(),globalObjects.player.selfHeal(80);break;case"ec3851e00c9a510bd82c08299cc9366df7291b0e35e3cc8577c6e18c913d944e":toggleCheat("cene"),cheats.calmEnemies?(this.codeAnnounce.setText("CHEAT: CALM ENEMIES ENABLED"),playSound("mind_enhance",.7)):(this.codeAnnounce.setText("CALM ENEMIES DISABLED"),this.codeAnnounce.setColor("#888888"),this.codeAnnounce.setScale(.9));break;case"38a5be817f63fcd1d3207358368ad2f7ef81e1c21d225c6c15efcc8184c4ca49":challenges.angryEnemies=!challenges.angryEnemies,challenges.angryEnemies?(this.codeAnnounce.setText("CHALLENGE: ANGRY ENEMIES ENABLED"),this.codeAnnounce.setColor("#FF0000"),playSound("mind_shield_retaliate",.7)):(this.codeAnnounce.setText("ANGRY ENEMIES DISABLED"),this.codeAnnounce.setColor("#888888"),this.codeAnnounce.setScale(.9));break;case"c283b107c9be924f5be08e4f91abf2a042d2b58b0770ff9810bd4dc2620fcf0c":challenges.lowHealth=!challenges.lowHealth,globalObjects.player.reInitStats(),globalObjects.player.resetStats(),challenges.lowHealth?(this.codeAnnounce.setText("CHALLENGE: LOW HEALTH ENABLED"),this.codeAnnounce.setColor("#FF0000"),playSound("void_body",.7)):(this.codeAnnounce.setText("CHALLENGE: LOW HEALTH DISABLED"),this.codeAnnounce.setColor("#888888"),this.codeAnnounce.setScale(.9));break;case"d7b9a5d383a37262fe24f1985d7eb39c9c664292cf2c313911978467f2cb583b":toggleCheat("dd"),cheats.extraDmg?(this.codeAnnounce.setText("CHEAT: X2 DAMAGE ENABLED"),playSound("mind_enhance",.7)):(this.codeAnnounce.setText("X2 DAMAGE DISABLED"),this.codeAnnounce.setColor("#888888"),this.codeAnnounce.setScale(.9));break;case"d81bbd22822c4b94dd25738ab60f2fa452f0359d0c5f2634c07c7a7b6aa7b16b":toggleCheat("edd"),cheats.extraExtraDmg?(this.codeAnnounce.setText("CHEAT: X2 MORE DAMAGE ENABLED"),playSound("mind_enhance",.7)):(this.codeAnnounce.setText("X2 MORE DAMAGE DISABLED"),this.codeAnnounce.setColor("#888888"),this.codeAnnounce.setScale(.9));break;case"663409641b29b53f255ed4e01ce8ad89dd6179119a2abb8845552c38735342a6":toggleCheat("sshd"),cheats.superShield?(this.codeAnnounce.setText("CHEAT: SUPER SHIELD ENABLED"),playSound("matter_shield",.7)):(this.codeAnnounce.setText("SUPER SHIELD DISABLED"),this.codeAnnounce.setColor("#888888"),this.codeAnnounce.setScale(.9));break;case"bf8ee00cae00a44aaabcc577dd4bdcb97f1ec6e53d776cb23ac1b3e683aea14a":toggleCheat("hpx"),cheats.extraHealth?(this.codeAnnounce.setText("CHEAT: +1000 HEALTH ENABLED"),playSound("magic",.75)):(this.codeAnnounce.setText("+1000 HEALTH DISABLED"),this.codeAnnounce.setColor("#888888"),this.codeAnnounce.setScale(.9));break;default:playSound("fizzle",.8),this.codeAnnounce.setText(getLangText("unknown_code")),this.codeAnnounce.setColor("#E01010"),this.codeAnnounce.setScale(.9)}this.codeAnnounce.currAnim=PhaserScene.tweens.add({delay:3.6+.2*this.codeAnnounce.text.length,targets:this.codeAnnounce,alpha:0,duration:1,onComplete:()=>{this.codeAnnounce.visible=!1}})}}updateOptionsLanguage(){for(var e in this.langTextToUpdate){e=this.langTextToUpdate[e];e[0].setText(getLangText(e[1]))}}updateSFXSlider(e,t){e=this.dragSlider(this.draggerSFX,e,t);4<=e?this.SFXIcon.setFrame("sound_full.png"):0<=e?this.SFXIcon.setFrame("sound_most.png"):-5===e?this.SFXIcon.setFrame("sound_mute.png"):this.SFXIcon.setFrame("sound_half.png"),updateGlobalVolume(.1*(e+5))}updateBGMSlider(e,t){e=this.dragSlider(this.draggerBGM,e,t);-5===e?this.BGMIcon.setFrame("music_mute.png"):this.BGMIcon.setFrame("music.png"),updateGlobalMusicVolume(.1*(e+5))}dragSlider(e,t,a=null){let s=a;a-=t;let i=0;return a<-150?(s=t-150,i=-5):150<a?(s=t+150,i=5):(i=Math.round(a/30),s=t+30*i),e.setFrame("slider_indicator_glow.png"),e.x=s,i}hideOptions(e=!0){if(!this.opened||!this.canClose)return!1;e&&removePopup(),this.opened=!1,this.canClose=!1,globalObjects.encyclopedia.showButton(),globalObjects.options.showButton(),messageBus.publish("unpauseGame"),hideGlobalClickBlocker(),this.hidingAnim1=PhaserScene.tweens.add({targets:this.listOfThingsToHide,alpha:0,duration:180}),this.hidingAnim2=PhaserScene.tweens.add({targets:this.listOfThingsToHideSemiAlpha,alpha:0,duration:180});for(let e=0;e<this.listOfButtonsToDisable.length;e++)this.listOfButtonsToDisable[e].setState(DISABLE),this.listOfButtonsToDisable[e].setAlpha(0);return!0}showButton(){this.canBeClicked=!0,this.button.setPos(this.startX,this.startY)}hideButton(){this.canBeClicked=!1,this.button.setPos(this.startX,-100)}}let unlocks={};class Unlocks{constructor(){this.subscriptions=[messageBus.subscribe("newUnlock",this.newUnlock.bind(this))]}newUnlock(e){if(!unlocks[e])switch(unlocks[e]=!0,e){case"gobbohit":case"shieldgain":break;default:console.warn("Unrecognized unlock: ",e)}}}